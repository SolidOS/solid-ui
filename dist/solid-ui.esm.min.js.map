{"version":3,"file":"solid-ui.esm.min.js","mappings":"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","sources":["webpack://solid-ui/./node_modules/mime-types/index.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/OverloadYield.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorKeys.js","webpack://solid-ui/./src/iconBase.ts","webpack://solid-ui/./node_modules/solid-namespace/index.js","webpack://solid-ui/./src/debug.ts","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorDefine.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorValues.js","webpack://solid-ui/./node_modules/escape-html/index.js","webpack://solid-ui/./node_modules/mime-db/index.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/typeof.js","webpack://solid-ui/./node_modules/@babel/runtime/regenerator/index.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorAsync.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","webpack://solid-ui/./node_modules/mime-types/mimeScore.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/regenerator.js","webpack://solid-ui/webpack/bootstrap","webpack://solid-ui/webpack/runtime/compat get default export","webpack://solid-ui/webpack/runtime/define property getters","webpack://solid-ui/webpack/runtime/harmony module decorator","webpack://solid-ui/webpack/runtime/hasOwnProperty shorthand","webpack://solid-ui/webpack/runtime/make namespace object","webpack://solid-ui/external module \"$rdf\"","webpack://solid-ui/./src/ns.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://solid-ui/./src/log.ts","webpack://solid-ui/./src/utils/label.ts","webpack://solid-ui/./src/acl/acl.ts","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack://solid-ui/./src/styleConstants.js","webpack://solid-ui/./src/style.js","webpack://solid-ui/./src/widgets/dragAndDrop.js","webpack://solid-ui/./src/utils/index.js","webpack://solid-ui/./src/widgets/error.ts","webpack://solid-ui/./src/widgets/widgetHelpers.ts","webpack://solid-ui/./src/widgets/buttons/iconLinks.ts","webpack://solid-ui/./src/widgets/buttons.ts","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://solid-ui/./src/signup/config-default.js","webpack://solid-ui/./src/signup/signup.js","webpack://solid-ui/./src/widgets/forms/fieldParams.ts","webpack://solid-ui/./src/widgets/forms/fieldFunction.ts","webpack://solid-ui/./src/widgets/forms/formStyle.ts","webpack://solid-ui/./src/widgets/forms/basic.ts","webpack://solid-ui/./src/widgets/forms/autocomplete/language.ts","webpack://solid-ui/./src/widgets/forms/autocomplete/publicData.ts","webpack://solid-ui/./src/widgets/forms/autocomplete/autocompletePicker.ts","webpack://solid-ui/./src/widgets/forms/autocomplete/autocompleteBar.ts","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack://solid-ui/./src/style_multiSelect.js","webpack://solid-ui/./src/widgets/multiSelect.js","webpack://solid-ui/./src/widgets/forms.js","webpack://solid-ui/./src/widgets/forms/autocomplete/autocompleteField.ts","webpack://solid-ui/./src/login/login.ts","webpack://solid-ui/./src/acl/add-agent-buttons.ts","webpack://solid-ui/./src/acl/access-groups.ts","webpack://solid-ui/./src/acl/access-controller.ts","webpack://solid-ui/./src/acl/acl-control.ts","webpack://solid-ui/./src/acl/index.ts","webpack://solid-ui/./src/create/create.ts","webpack://solid-ui/./src/create/index.ts","webpack://solid-ui/./src/matrix/matrix.ts","webpack://solid-ui/./src/matrix/index.ts","webpack://solid-ui/./src/media/media-capture.ts","webpack://solid-ui/./src/media/index.ts","webpack://solid-ui/./node_modules/uuid/dist/esm-browser/native.js","webpack://solid-ui/./node_modules/uuid/dist/esm-browser/rng.js","webpack://solid-ui/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://solid-ui/./node_modules/uuid/dist/esm-browser/v4.js","webpack://solid-ui/./src/widgets/peoplePicker.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack://solid-ui/./src/messageArea.js","webpack://solid-ui/./src/chat/dateFolder.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/crypto.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/utils.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/_md.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/_u64.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/sha2.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/hmac.js","webpack://solid-ui/./node_modules/@noble/curves/esm/utils.js","webpack://solid-ui/./node_modules/@noble/curves/esm/abstract/modular.js","webpack://solid-ui/./node_modules/@noble/curves/esm/abstract/curve.js","webpack://solid-ui/./node_modules/@noble/curves/esm/abstract/weierstrass.js","webpack://solid-ui/./node_modules/@noble/curves/esm/secp256k1.js","webpack://solid-ui/./node_modules/@noble/curves/esm/_shortw_utils.js","webpack://solid-ui/./node_modules/@noble/hashes/esm/sha256.js","webpack://solid-ui/./src/chat/signature.ts","webpack://solid-ui/./src/utils/keyHelpers/otherHelpers.ts","webpack://solid-ui/./src/utils/keyHelpers/accessData.ts","webpack://solid-ui/./src/utils/keyHelpers/acl.ts","webpack://solid-ui/./src/chat/keys.ts","webpack://solid-ui/./src/chat/chatLogic.js","webpack://solid-ui/./src/participation.ts","webpack://solid-ui/./src/pad.ts","webpack://solid-ui/./src/chat/bookmarks.js","webpack://solid-ui/./src/chat/messageTools.js","webpack://solid-ui/./src/chat/message.js","webpack://solid-ui/./src/chat/infinite.js","webpack://solid-ui/./src/preferences.js","webpack://solid-ui/./src/table.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/isNativeFunction.js","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/construct.js","webpack://solid-ui/./src/tabs.ts","webpack://solid-ui/./node_modules/@babel/runtime/helpers/esm/inherits.js","webpack://solid-ui/./src/header/empty-profile.ts","webpack://solid-ui/./src/utils/headerFooterHelpers.ts","webpack://solid-ui/./src/header/index.ts","webpack://solid-ui/./src/footer/index.ts","webpack://solid-ui/./src/index.ts"],"sourcesContent":["/*!\n * mime-types\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar db = require('mime-db')\nvar extname = require('path').extname\nvar mimeScore = require('./mimeScore')\n\n/**\n * Module variables.\n * @private\n */\n\nvar EXTRACT_TYPE_REGEXP = /^\\s*([^;\\s]*)(?:;|\\s|$)/\nvar TEXT_TYPE_REGEXP = /^text\\//i\n\n/**\n * Module exports.\n * @public\n */\n\nexports.charset = charset\nexports.charsets = { lookup: charset }\nexports.contentType = contentType\nexports.extension = extension\nexports.extensions = Object.create(null)\nexports.lookup = lookup\nexports.types = Object.create(null)\nexports._extensionConflicts = []\n\n// Populate the extensions/types maps\npopulateMaps(exports.extensions, exports.types)\n\n/**\n * Get the default charset for a MIME type.\n *\n * @param {string} type\n * @return {boolean|string}\n */\n\nfunction charset (type) {\n  if (!type || typeof type !== 'string') {\n    return false\n  }\n\n  // TODO: use media-typer\n  var match = EXTRACT_TYPE_REGEXP.exec(type)\n  var mime = match && db[match[1].toLowerCase()]\n\n  if (mime && mime.charset) {\n    return mime.charset\n  }\n\n  // default text/* to utf-8\n  if (match && TEXT_TYPE_REGEXP.test(match[1])) {\n    return 'UTF-8'\n  }\n\n  return false\n}\n\n/**\n * Create a full Content-Type header given a MIME type or extension.\n *\n * @param {string} str\n * @return {boolean|string}\n */\n\nfunction contentType (str) {\n  // TODO: should this even be in this module?\n  if (!str || typeof str !== 'string') {\n    return false\n  }\n\n  var mime = str.indexOf('/') === -1 ? exports.lookup(str) : str\n\n  if (!mime) {\n    return false\n  }\n\n  // TODO: use content-type or other module\n  if (mime.indexOf('charset') === -1) {\n    var charset = exports.charset(mime)\n    if (charset) mime += '; charset=' + charset.toLowerCase()\n  }\n\n  return mime\n}\n\n/**\n * Get the default extension for a MIME type.\n *\n * @param {string} type\n * @return {boolean|string}\n */\n\nfunction extension (type) {\n  if (!type || typeof type !== 'string') {\n    return false\n  }\n\n  // TODO: use media-typer\n  var match = EXTRACT_TYPE_REGEXP.exec(type)\n\n  // get extensions\n  var exts = match && exports.extensions[match[1].toLowerCase()]\n\n  if (!exts || !exts.length) {\n    return false\n  }\n\n  return exts[0]\n}\n\n/**\n * Lookup the MIME type for a file path/extension.\n *\n * @param {string} path\n * @return {boolean|string}\n */\n\nfunction lookup (path) {\n  if (!path || typeof path !== 'string') {\n    return false\n  }\n\n  // get the extension (\"ext\" or \".ext\" or full path)\n  var extension = extname('x.' + path)\n    .toLowerCase()\n    .slice(1)\n\n  if (!extension) {\n    return false\n  }\n\n  return exports.types[extension] || false\n}\n\n/**\n * Populate the extensions and types maps.\n * @private\n */\n\nfunction populateMaps (extensions, types) {\n  Object.keys(db).forEach(function forEachMimeType (type) {\n    var mime = db[type]\n    var exts = mime.extensions\n\n    if (!exts || !exts.length) {\n      return\n    }\n\n    // mime -> extensions\n    extensions[type] = exts\n\n    // extension -> mime\n    for (var i = 0; i < exts.length; i++) {\n      var extension = exts[i]\n      types[extension] = _preferredType(extension, types[extension], type)\n\n      // DELETE (eventually): Capture extension->type maps that change as a\n      // result of switching to mime-score.  This is just to help make reviewing\n      // PR #119 easier, and can be removed once that PR is approved.\n      const legacyType = _preferredTypeLegacy(\n        extension,\n        types[extension],\n        type\n      )\n      if (legacyType !== types[extension]) {\n        exports._extensionConflicts.push([extension, legacyType, types[extension]])\n      }\n    }\n  })\n}\n\n// Resolve type conflict using mime-score\nfunction _preferredType (ext, type0, type1) {\n  var score0 = type0 ? mimeScore(type0, db[type0].source) : 0\n  var score1 = type1 ? mimeScore(type1, db[type1].source) : 0\n\n  return score0 > score1 ? type0 : type1\n}\n\n// Resolve type conflict using pre-mime-score logic\nfunction _preferredTypeLegacy (ext, type0, type1) {\n  var SOURCE_RANK = ['nginx', 'apache', undefined, 'iana']\n\n  var score0 = type0 ? SOURCE_RANK.indexOf(db[type0].source) : 0\n  var score1 = type1 ? SOURCE_RANK.indexOf(db[type1].source) : 0\n\n  if (\n    exports.types[extension] !== 'application/octet-stream' &&\n    (score0 > score1 ||\n      (score0 === score1 &&\n        exports.types[extension]?.slice(0, 12) === 'application/'))\n  ) {\n    return type0\n  }\n\n  return score0 > score1 ? type0 : type1\n}\n","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// Works in FF extension - what about browserify??\n// 2021-04-08 Convert to TS\n\n/* The Firefox case is left for historical record, as we don't currenly\n * have a FF extension for mashlib, but we could.  This is sthepoint to\n * hack the place it can find its icons internally\n *\n * The $SolidTestEnvironment is important and is used for\n * example when testing on localhost to specify a place the icons be found\n * in your test set up.\n *\n * You can also use it if you want to just run a mashlib whhich takes its\n * icons seved by other than github.\n */\n\nimport { log } from './debug'\n\ndeclare let $SolidTestEnvironment\n\n// Do not export. Always us this module to find the icons, as they vary\nconst iconsOnGithub = 'https://solidos.github.io/solid-ui/src' // changed org 2022-05\n\nexport const icons = (module as any).scriptURI // Firefox extension\n  ? {\n      iconBase:\n        (module as any).scriptURI.slice(0, (module as any).scriptURI.lastIndexOf('/')) + '/icons/',\n      originalIconBase:\n        (module as any).scriptURI.slice(0, (module as any).scriptURI.lastIndexOf('/')) +\n        '/originalIcons/'\n    }\n  : typeof $SolidTestEnvironment !== 'undefined' && $SolidTestEnvironment.iconBase // Test environemnt\n    ? {\n        iconBase: $SolidTestEnvironment.iconBase,\n        originalIconBase: $SolidTestEnvironment.originalIconBase\n      }\n    : {\n      // Normal case:\n        iconBase: iconsOnGithub + '/icons/',\n        originalIconBase: iconsOnGithub + '/originalIcons/'\n      }\n\nlog('   icons.iconBase is set to : ' + icons.iconBase)\n\n// allow tests etc  named-import this directly from this module\nexport const iconBase = icons.iconBase\nexport const originalIconBase = icons.originalIconBase\n","/**\n * Provides a way to access commonly used namespaces\n *\n * Usage:\n *\n *   ```\n *   const $rdf = require('rdflib'); //or any other RDF/JS-compatible library\n *   const ns = require('solid-namespace')($rdf);\n *   const store = $rdf.graph();\n *\n *   let me = ...;\n *   let name = store.any(me, ns.vcard(fn)) || store.any(me, ns.foaf(name));\n *   ```\n * @module vocab\n */\nconst aliases = {\n  acl: 'http://www.w3.org/ns/auth/acl#',\n  arg: 'http://www.w3.org/ns/pim/arg#',\n  as: 'https://www.w3.org/ns/activitystreams#',\n  bookmark: 'http://www.w3.org/2002/01/bookmark#',\n  cal: 'http://www.w3.org/2002/12/cal/ical#',\n  cco: 'http://www.ontologyrepository.com/CommonCoreOntologies/',\n  cert: 'http://www.w3.org/ns/auth/cert#',\n  contact: 'http://www.w3.org/2000/10/swap/pim/contact#',\n  dc: 'http://purl.org/dc/elements/1.1/',\n  dct: 'http://purl.org/dc/terms/',\n  doap: 'http://usefulinc.com/ns/doap#',\n  foaf: 'http://xmlns.com/foaf/0.1/',\n  geo: 'http://www.w3.org/2003/01/geo/wgs84_pos#',\n  gpx: 'http://www.w3.org/ns/pim/gpx#',\n  gr: 'http://purl.org/goodrelations/v1#',\n  http: 'http://www.w3.org/2007/ont/http#',\n  httph: 'http://www.w3.org/2007/ont/httph#',\n  icalTZ: 'http://www.w3.org/2002/12/cal/icaltzd#', // Beware: not cal:\n  ldp: 'http://www.w3.org/ns/ldp#',\n  link: 'http://www.w3.org/2007/ont/link#',\n  log: 'http://www.w3.org/2000/10/swap/log#',\n  meeting: 'http://www.w3.org/ns/pim/meeting#',\n  mo: 'http://purl.org/ontology/mo/',\n  org: 'http://www.w3.org/ns/org#',\n  owl: 'http://www.w3.org/2002/07/owl#',\n  pad: 'http://www.w3.org/ns/pim/pad#',\n  patch: 'http://www.w3.org/ns/pim/patch#',\n  prov: 'http://www.w3.org/ns/prov#',\n  pto: 'http://www.productontology.org/id/',\n  qu: 'http://www.w3.org/2000/10/swap/pim/qif#',\n  trip: 'http://www.w3.org/ns/pim/trip#',\n  rdf: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\n  rdfs: 'http://www.w3.org/2000/01/rdf-schema#',\n  rss: 'http://purl.org/rss/1.0/',\n  sched: 'http://www.w3.org/ns/pim/schedule#',\n  schema: 'http://schema.org/', // @@ beware confusion with documents no 303\n  sioc: 'http://rdfs.org/sioc/ns#',\n  skos: 'http://www.w3.org/2004/02/skos/core#',\n  solid: 'http://www.w3.org/ns/solid/terms#',\n  space: 'http://www.w3.org/ns/pim/space#',\n  stat: 'http://www.w3.org/ns/posix/stat#',\n  tab: 'http://www.w3.org/2007/ont/link#',\n  tabont: 'http://www.w3.org/2007/ont/link#',\n  ui: 'http://www.w3.org/ns/ui#',\n  vann: 'http://purl.org/vocab/vann/',\n  vcard: 'http://www.w3.org/2006/vcard/ns#',\n  wf: 'http://www.w3.org/2005/01/wf/flow#',\n  xsd: 'http://www.w3.org/2001/XMLSchema#',\n}\n\n/**\n * @param [rdflib] {RDF} Optional RDF Library (such as rdflib.js or rdf-ext) to inject\n */\nfunction vocab (rdf = { namedNode: u => u }) {\n  const namespaces = {}\n  for (const alias in aliases) {\n    const expansion = aliases[alias]\n    namespaces[alias] = function (localName = '') {\n      return rdf.namedNode(expansion + localName)\n    }\n  };\n\n  return namespaces\n};\n\nmodule.exports = vocab\n","export function log (...args: any[]) {\n  console.log(...args)\n}\n\nexport function warn (...args: any[]) {\n  console.warn(...args)\n}\n\nexport function error (...args: any[]) {\n  console.error(...args)\n}\n\nexport function trace (...args: any[]) {\n  console.trace(...args)\n}\n","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module variables.\n * @private\n */\n\nvar matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = escapeHtml;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nfunction escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}\n","/*!\n * mime-db\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015-2022 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * Module exports.\n */\n\nmodule.exports = require('./db.json')\n","var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// 'mime-score' back-ported to CommonJS\n\n// Score RFC facets (see https://tools.ietf.org/html/rfc6838#section-3)\nvar FACET_SCORES = {\n  'prs.': 100,\n  'x-': 200,\n  'x.': 300,\n  'vnd.': 400,\n  default: 900\n}\n\n// Score mime source (Logic originally from `jshttp/mime-types` module)\nvar SOURCE_SCORES = {\n  nginx: 10,\n  apache: 20,\n  iana: 40,\n  default: 30 // definitions added by `jshttp/mime-db` project?\n}\n\nvar TYPE_SCORES = {\n  // prefer application/xml over text/xml\n  // prefer application/rtf over text/rtf\n  application: 1,\n\n  // prefer font/woff over application/font-woff\n  font: 2,\n\n  default: 0\n}\n\n/**\n * Get each component of the score for a mime type.  The sum of these is the\n * total score.  The higher the score, the more \"official\" the type.\n */\nmodule.exports = function mimeScore (mimeType, source = 'default') {\n  if (mimeType === 'application/octet-stream') {\n    return 0\n  }\n\n  const [type, subtype] = mimeType.split('/')\n\n  const facet = subtype.replace(/(\\.|x-).*/, '$1')\n\n  const facetScore = FACET_SCORES[facet] || FACET_SCORES.default\n  const sourceScore = SOURCE_SCORES[source] || SOURCE_SCORES.default\n  const typeScore = TYPE_SCORES[type] || TYPE_SCORES.default\n\n  // All else being equal prefer shorter types\n  const lengthScore = 1 - mimeType.length / 100\n\n  return facetScore + sourceScore + typeScore + lengthScore\n}\n","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = __WEBPACK_EXTERNAL_MODULE_$rdf__;","// Namespaces we commonly use and have common prefixes for around Solid\n\nimport solidNamespace from 'solid-namespace' // Delegate to this which takes RDFlib as param.\nimport * as $rdf from 'rdflib'\n\nexport default solidNamespace($rdf)\n","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","// ///////////////////////  Logging\n//\n// bitmask levels\n// const TNONE = 0\n/** @internal */\nconst TERROR = 1\n/** @internal */\nconst TWARN = 2\n/** @internal */\nconst TMESG = 4\n/** @internal */\nconst TSUCCESS = 8\n/** @internal */\nconst TINFO = 16\n/** @internal */\nconst TDEBUG = 32\n/** @internal */\nconst TALL = 63\n\n/** @internal */\nexport enum LogLevel {\n  Error = TERROR,\n  Warning = TWARN,\n  Message = TMESG,\n  Success = TSUCCESS,\n  Info = TINFO,\n  Debug = TDEBUG,\n  All = TALL\n}\n\n/** @internal */\nlet _level: number = TERROR + TWARN + TMESG\n/** @internal */\nlet _ascending: boolean = false\n/** @internal */\nlet _dom: HTMLDocument = document // must be able to override for tests\n/** @internal */\nlet _window: Window = window // must be able to override for tests\n\n/** @internal */\nfunction log (str: string, type: number = TMESG, typestr: string = 'mesg') {\n  if (!(_level & type)) return // bitmask\n\n  if (typeof _dom !== 'undefined') {\n    const logArea = _dom.getElementById('status')\n    if (!logArea) return\n\n    const addendum = _dom.createElement('span')\n    addendum.setAttribute('class', typestr)\n    const now = new Date()\n    addendum.innerHTML = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()} [${typestr}] ${escapeForXML(str)}<br/>`\n    if (_ascending) {\n      logArea.insertBefore(addendum, logArea.firstChild)\n    } else {\n      logArea.appendChild(addendum)\n    }\n  } else if (typeof console !== 'undefined') {\n    console.log(str)\n  }\n}\n\n/**\n * Adds a message to the element with id \"status\". The messages are prepended with\n * time and type of message, in this case [mesg].\n */\nexport function msg (message: string) {\n  log(message)\n}\n\n/**\n * Adds a warning message to the element with id \"status\". The messages are\n * prepended with time and type of message, in this case [warn].\n */\nexport function warn (message: string): void {\n  log(message, TWARN, 'warn')\n}\n\n/**\n * Adds a debugging message to the element with id \"status\". The messages are\n * prepended with time and type of message, in this case [dbug].\n */\nexport function debug (message: string): void {\n  log(message, TDEBUG, 'dbug')\n}\n\n/**\n * Adds a info message to the element with id \"status\". The messages are\n * prepended with time and type of message, in this case [info].\n */\nexport function info (message: string): void {\n  log(message, TINFO, 'info')\n}\n\n/**\n * Adds a error to the element with id \"status\". The messages are\n * prepended with time and type of message, in this case [eror].\n */\nexport function error (message: string): void {\n  log(message, TERROR, 'eror')\n}\n\n/**\n * Adds a success message to the element with id \"status\". The messages are\n * prepended with time and type of message, in this case [good].\n */\nexport function success (message: string): void {\n  log(message, TSUCCESS, 'good')\n}\n\n/**\n * Uses the global alert to send an alert. If global alert is not available, it\n * will output the message using the method [[warning]]s.\n */\nexport function alert (message: string): void {\n  if (_window && typeof _window.alert !== 'undefined') {\n    _window.alert(message)\n  } else {\n    warn(message)\n  }\n}\n\n/**\n * Will clear the content of the element with id \"status\".\n */\nexport function clear (): void {\n  const logArea = _dom?.getElementById('status')\n  if (!logArea) return\n  logArea.innerHTML = ''\n}\n\n/**\n * Lets you configure which types of messages will be shown. The module uses\n * [bitmask](https://en.wikipedia.org/wiki/Mask_(computing)) to filter which\n * types of messages should be shown. E.g. if you only want warning messages\n * to be shown, pass 2 to the function, if you want warning and success to be\n * shown, pass 10 (2+8). By passing the sum of all, 63, you'll show all\n * types of messages.\n *\n * - Error: 1\n * - Warning: 2\n * - Message: 4\n * - Success: 8\n * - Info: 16\n * - Debug: 32\n */\nexport function setLevel (level: number): void {\n  _level = TALL\n  debug('Log level is now ' + level)\n  _level = level\n}\n\n/**\n * Will dump the current HTML using the [[debug]] method.\n */\nexport function dumpHTML (): void {\n  if (!_dom) return\n  const level = _level\n  _level = TALL\n  debug(_dom?.body?.innerHTML || '')\n  _level = level\n}\n\n/**\n * Will start prepending messages the list of log messages.\n */\nexport function logAscending () {\n  _ascending = true\n}\n\n/**\n * Will start appending messages the list of log messages. (This is default\n * behavior.)\n */\nexport function logDescending () {\n  _ascending = false\n}\n\n/** @internal */\nexport function escapeForXML (str: string): string {\n  // can be replaced with function utils module when migrating\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n}\n\n/** @internal */\nexport function setInternals (window, document) {\n  _window = window\n  _dom = document\n}\n","import * as log from '../log'\nimport { store } from 'solid-logic'\nimport ns from '../ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n\nconst UI = { log, ns, rdf }\n\n// This ubiquitous function returns the best label for a thing\n//\n// The hacks in this code make a major difference to the usability\nexport function label (thing, initialCap = false): string {\n  function doCap (label: string) {\n    if (initialCap) {\n      return label.slice(0, 1).toUpperCase() + label.slice(1)\n    }\n    return label\n  }\n  function cleanUp (label: string) {\n    let result = ''\n    if (label.slice(-1) === '/') label = label.slice(0, -1) // chop trailing slash\n    for (let i = 0; i < label.length; i++) {\n      if (label[i] === '_' || label[i] === '-') {\n        result += ' '\n        continue\n      }\n      result += label[i]\n      if (\n        i + 1 < label.length &&\n        label[i].toUpperCase() !== label[i] &&\n        label[i + 1].toLowerCase() !== label[i + 1]\n      ) {\n        result += ' '\n      }\n    }\n    if (result.slice(0, 4) === 'has ') result = result.slice(4)\n    return doCap(result)\n  }\n\n  const label = getWellKnownLabel(thing)\n\n  if (label) {\n    return doCap(label.value)\n  }\n\n  // Default to label just generated from the URI\n\n  if (thing.termType === 'BlankNode') {\n    return '...'\n  }\n  if (thing.termType === 'Collection') {\n    return '(' + thing.elements.length + ')'\n  }\n  let s = thing.uri\n  if (typeof s === 'undefined') return thing.toString() // can't be a symbol\n  // s = decodeURI(s) // This can crash is random valid @ signs are presentation\n  // The idea was to clean up eg URIs encoded in query strings\n  // Also encoded character in what was filenames like @ [] {}\n  try {\n    s = s\n      .split('/')\n      .map(decodeURIComponent)\n      .join('/') // If it is properly encoded\n  } catch (_e) {\n    // try individual decoding of ASCII code points\n    for (let i = s.length - 3; i > 0; i--) {\n      const hex = '0123456789abcefABCDEF' // The while upacks multiple layers of encoding\n      while (\n        s[i] === '%' &&\n        hex.indexOf(s[i + 1]) >= 0 &&\n        hex.indexOf(s[i + 2]) >= 0\n      ) {\n        s =\n          s.slice(0, i) +\n          String.fromCharCode(parseInt(s.slice(i + 1, i + 3), 16)) +\n          s.slice(i + 3)\n      }\n    }\n  }\n\n  s = slice(s, '/profile/card#me')\n  s = slice(s, '#this')\n  s = slice(s, '#me')\n\n  const hash = s.indexOf('#')\n  if (hash >= 0) return cleanUp(s.slice(hash + 1))\n\n  // Eh? Why not do this? e.g. dc:title needs it only trim URIs, not rdfs:labels\n  const slash = s.lastIndexOf('/', s.length - 2) // (len-2) excludes trailing slash\n  if (slash >= 0 && slash < thing.uri.length) return cleanUp(s.slice(slash + 1))\n\n  return doCap(decodeURIComponent(thing.uri))\n}\n\nfunction slice (s: string, suffix: string) {\n  const length = suffix.length * -1\n  if (s.slice(length) === suffix) {\n    return s.slice(0, length)\n  }\n  return s\n}\n\n// Hard coded known label predicates\n//  @@ TBD: Add subproperties of rdfs:label\nfunction getWellKnownLabel (thing) {\n  return store.any(thing, UI.ns.ui('label')) || // Prioritize ui:label\n      store.any(thing, UI.ns.link('message')) ||\n      store.any(thing, UI.ns.vcard('fn')) ||\n      store.any(thing, UI.ns.foaf('name')) ||\n      store.any(thing, UI.ns.dct('title')) ||\n      store.any(thing, UI.ns.dc('title')) ||\n      store.any(thing, UI.ns.rss('title')) ||\n      store.any(thing, UI.ns.contact('fullName')) ||\n      store.any(thing, store.sym('http://www.w3.org/2001/04/roadmap/org#name')) ||\n      store.any(thing, UI.ns.cal('summary')) ||\n      store.any(thing, UI.ns.foaf('nick')) ||\n      store.any(thing, UI.ns.as('name')) ||\n      store.any(thing, UI.ns.schema('name')) ||\n      store.any(thing, UI.ns.rdfs('label')) ||\n      store.any(thing, store.sym('http://www.w3.org/2004/02/skos/core#prefLabel'))\n}\n","/**\n * Non-UI functions for access control.\n * See https://github.com/solidos/web-access-control-spec\n * for the spec that defines how ACL documents work.\n * @packageDocumentation\n */\n\nimport ns from '../ns'\nimport { solidLogicSingleton, ACL_LINK } from 'solid-logic'\nimport * as utils from '../utils'\nimport { AgentMapMap, AgentMapUnion, ComboList } from './types'\nimport * as debug from '../debug'\nimport { graph, Store, NamedNode, serialize, st, Statement, sym, LiveStore } from 'rdflib'\n\nconst kb = solidLogicSingleton.store\n\n/**\n * Take the \"default\" ACL and convert it into the equivalent ACL\n * which the resource would have had. Return it as a new separate store.\n * The \"defaultForNew\" predicate is also accepted, as a deprecated\n * synonym for \"default\".\n */\nexport function adoptACLDefault (\n  doc: NamedNode,\n  aclDoc: NamedNode,\n  defaultResource: NamedNode,\n  defaultACLDoc: NamedNode\n): Store {\n  const ACL = ns.acl\n  const isContainer = doc.uri.slice(-1) === '/' // Give default for all directories\n\n  const defaults = kb\n    .each(undefined, ACL('default'), defaultResource, defaultACLDoc)\n    .concat(kb.each(undefined, ACL('defaultForNew'), defaultResource, defaultACLDoc))\n\n  const proposed = defaults.reduce((accumulatedStatements, da) => accumulatedStatements\n    .concat(kb.statementsMatching(da as NamedNode, ns.rdf('type'), ACL('Authorization'), defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('agent'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('agentClass'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('agentGroup'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('origin'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('originClass'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('mode'), undefined, defaultACLDoc))\n    .concat(st(da as NamedNode, ACL('accessTo'), doc, defaultACLDoc))\n    .concat(isContainer ? st(da as NamedNode, ACL('default'), doc, defaultACLDoc) : []), [] as Statement[])\n\n  const kb2 = graph() // Potential - derived is kept apart\n  proposed.forEach(st => kb2.add(move(st.subject), move(st.predicate), move(st.object), sym(aclDoc.uri)))\n  return kb2 as LiveStore\n\n  function move (symbol) {\n    const y = defaultACLDoc.uri.length // The default ACL file\n    return sym(\n      symbol.uri.slice(0, y) === defaultACLDoc.uri\n        ? aclDoc.uri + symbol.uri.slice(y)\n        : symbol.uri\n    )\n  }\n}\n\n/**\n * Read and canonicalize the ACL for x in aclDoc\n *\n * Accumulate the access rights which each agent or class has\n */\nexport function readACL (\n  doc: NamedNode,\n  aclDoc: NamedNode,\n  kb2: Store = kb,\n  getDefaults: boolean = false\n): AgentMapMap {\n  const auths: Array<NamedNode> = getDefaults\n    ? getDefaultsFallback(kb2, ns)\n    : kb2.each(undefined, ns.acl('accessTo'), doc)\n\n  const ACL = ns.acl\n  const ac = {\n    agent: {},\n    agentClass: {},\n    agentGroup: {},\n    origin: {},\n    originClass: {}\n  }\n  Object.keys(ac).forEach(pred => {\n    auths.forEach(function (a) {\n      (kb2.each(a, ACL('mode')) as Array<NamedNode>).forEach(function (mode) {\n        (kb2.each(a, ACL(pred)) as Array<NamedNode>).forEach(function (agent) {\n          ac[pred][agent.uri] = ac[pred][agent.uri] || {}\n          ac[pred][agent.uri][mode.uri] = a // could be \"true\" but leave pointer just in case\n        })\n      })\n    })\n  })\n  return ac\n\n  function getDefaultsFallback (kb, ns) {\n    return kb\n      .each(undefined, ns.acl('default'), doc)\n      .concat(kb.each(undefined, ns.acl('defaultForNew'), doc))\n  }\n}\n\n/**\n * Compare two ACLs\n */\nexport function sameACL (a: AgentMapMap | AgentMapUnion, b: AgentMapMap | AgentMapUnion): boolean {\n  const contains = function (a, b) {\n    for (const pred in {\n      agent: true,\n      agentClass: true,\n      agentGroup: true,\n      origin: true,\n      originClass: true\n    }) {\n      if (a[pred]) {\n        for (const agent in a[pred]) {\n          for (const mode in a[pred][agent]) {\n            if (!b[pred][agent] || !b[pred][agent][mode]) {\n              return false\n            }\n          }\n        }\n      }\n    }\n    return true\n  }\n  return contains(a, b) && contains(b, a)\n}\n\n/**\n * Union N ACLs\n */\nexport function ACLunion (list: Array<AgentMapMap | AgentMapUnion>): AgentMapUnion {\n  const b = list[0]\n  let a, ag\n  for (let k = 1; k < list.length; k++) {\n    ;['agent', 'agentClass', 'agentGroup', 'origin', 'originClass'].forEach(\n      function (pred) {\n        a = list[k]\n        if (a[pred]) {\n          for (ag in a[pred]) {\n            for (const mode in a[pred][ag]) {\n              if (!b[pred][ag]) b[pred][ag] = []\n              b[pred][ag][mode] = true\n            }\n          }\n        }\n      }\n    )\n  }\n  return b as AgentMapUnion\n}\n\ntype loadUnionACLCallback = (ok: boolean, message?: string | NamedNode | AgentMapUnion | AgentMapMap) => void\n\n/**\n * Merge ACLs lists from things to form union\n */\nexport function loadUnionACL (subjectList: Array<NamedNode>, callbackFunction: loadUnionACLCallback): void {\n  const aclList: Array<AgentMapMap> = []\n  const doList = function (list) {\n    if (list.length) {\n      const doc = list.shift().doc()\n      getACLorDefault(doc, function (\n        ok,\n        p2,\n        targetDoc,\n        targetACLDoc,\n        defaultHolder,\n        defaultACLDoc\n      ) {\n        const defa = !p2\n        if (!ok || !defaultHolder || !defaultACLDoc) return callbackFunction(ok, targetACLDoc)\n        const acl = defa\n          ? readACL(defaultHolder, defaultACLDoc)\n          : readACL(targetDoc as NamedNode, targetACLDoc as NamedNode)\n        aclList.push(acl)\n        doList(list.slice(1))\n      })\n    } else {\n      // all gone\n      callbackFunction(true, ACLunion(aclList))\n    }\n  }\n  doList(subjectList)\n}\n\n/**\n * Represents these as an RDF graph by combination of modes\n *\n * Each agent can only be in one place in this model, one combination of modes.\n * Combos are like full control, read append, read only etc.\n */\nexport function ACLbyCombination (ac: AgentMapMap | AgentMapUnion): ComboList {\n  const byCombo = {}\n  ;['agent', 'agentClass', 'agentGroup', 'origin', 'originClass'].forEach(function (pred) {\n    for (const agent in ac[pred]) {\n      const combo: string[] = []\n      for (const mode in ac[pred][agent]) {\n        combo.push(mode)\n      }\n      combo.sort()\n      const combo2 = combo.join('\\n')\n      if (!byCombo[combo2]) byCombo[combo2] = []\n      byCombo[combo2].push([pred, agent])\n    }\n  })\n  return byCombo\n}\n\n/**\n * Write ACL graph to store from AC\n */\nexport function makeACLGraph (kb: Store, x: NamedNode, ac: AgentMapMap, aclDoc: NamedNode): void {\n  const byCombo = ACLbyCombination(ac)\n  return makeACLGraphbyCombo(kb, x, byCombo, aclDoc)\n}\n\n/**\n * Write ACL graph to store from combo\n */\nexport function makeACLGraphbyCombo (\n  kb: Store,\n  x: NamedNode,\n  byCombo: ComboList,\n  aclDoc: NamedNode,\n  main?: boolean,\n  defa?: boolean\n): void {\n  const ACL = ns.acl\n  for (const combo in byCombo) {\n    const pairs = byCombo[combo]\n    if (!pairs.length) continue // do not add to store when no agent\n    const modeURIs = combo.split('\\n')\n    let short = modeURIs\n      .map(function (u) {\n        return u.split('#')[1]\n      })\n      .join('')\n    if (defa && !main) short += 'Default' // don't muddle authorizations\n    const a = kb.sym(aclDoc.uri + '#' + short)\n    kb.add(a, ns.rdf('type'), ACL('Authorization'), aclDoc)\n    if (main) {\n      kb.add(a, ACL('accessTo'), x, aclDoc)\n    }\n    if (defa) {\n      kb.add(a, ACL('default'), x, aclDoc)\n    }\n    for (let i = 0; i < modeURIs.length; i++) {\n      kb.add(a, ACL('mode'), kb.sym(modeURIs[i]), aclDoc)\n    }\n    for (let i = 0; i < pairs.length; i++) {\n      const pred = pairs[i][0]\n      const ag = pairs[i][1]\n      kb.add(a, ACL(pred), kb.sym(ag), aclDoc)\n    }\n  }\n}\n\n/**\n * Debugging short strings for dumping ACL\n * and possibly in the UI\n */\nexport function ACLToString (ac: AgentMapMap): string {\n  return comboToString(ACLbyCombination(ac))\n}\n\n/**\n * Convert a [[ComboList]] to a string\n */\nexport function comboToString (byCombo: ComboList): string {\n  let str = ''\n  for (const combo in byCombo) {\n    const modeURIs = combo.split('\\n')\n    const initials = modeURIs\n      .map(function (u) {\n        return u.split('#')[1][0]\n      })\n      .join('')\n    str += initials + ':'\n    const pairs = byCombo[combo]\n    for (let i = 0; i < pairs.length; i++) {\n      const pred = pairs[i][0]\n      const ag = sym(pairs[i][1])\n      str += pred === 'agent' ? '@' : ''\n      str += ag.sameTerm(ns.foaf('Agent')) ? '*' : utils.label(ag)\n      if (i < pairs.length - 1) str += ','\n    }\n    str += ';'\n  }\n  return '{' + str.slice(0, -1) + '}' // drop extra semicolon\n}\n\n/**\n * Write ACL graph as Turtle\n */\nexport function makeACLString (x: NamedNode, ac: AgentMapMap, aclDoc: NamedNode): string {\n  const kb2 = graph()\n  makeACLGraph(kb2, x, ac, aclDoc)\n  return serialize(aclDoc, kb2, aclDoc.uri, 'text/turtle') || ''\n}\n\n/**\n * Write ACL graph to web\n */\nexport function putACLObject (\n  kb: LiveStore,\n  x: NamedNode,\n  ac: AgentMapMap | AgentMapUnion,\n  aclDoc: NamedNode,\n  callbackFunction: (ok: boolean, message?: string) => void\n): void {\n  const byCombo = ACLbyCombination(ac)\n  return putACLbyCombo(kb, x, byCombo, aclDoc, callbackFunction)\n}\n\n/**\n * Write ACL graph to web from a [[ComboList]]\n */\nexport function putACLbyCombo (\n  kb: LiveStore,\n  x: NamedNode,\n  byCombo: ComboList,\n  aclDoc: NamedNode,\n  callbackFunction: (ok: boolean, message?: string) => void\n): void {\n  const kb2 = graph()\n  makeACLGraphbyCombo(kb2, x, byCombo, aclDoc, true)\n\n  // const str = makeACLString = function(x, ac, aclDoc)\n  kb.updater?.put(\n    aclDoc,\n    kb2.statementsMatching(undefined, undefined, undefined, aclDoc),\n    'text/turtle',\n    function (uri, ok, message) {\n      if (!ok) {\n        callbackFunction(ok, message)\n      } else {\n        kb.fetcher?.unload(aclDoc)\n        makeACLGraphbyCombo(kb, x, byCombo, aclDoc, true)\n        kb.fetcher!.requested[aclDoc.uri] = 'done' // missing: save headers\n        callbackFunction(ok)\n      }\n    }\n  )\n}\n\ntype fixIndividualCardACLCallback = (ok: boolean, message?: string | NamedNode | AgentMapUnion | AgentMapMap) => void\ntype fixIndividualACLCallback = (ok: boolean, message?: string | NamedNode | AgentMapUnion | AgentMapMap) => void\n\n/**\n * Fix the ACl for an individual card as a function of the groups it is in\n *\n * All group files must be loaded first\n */\nexport function fixIndividualCardACL (person: NamedNode, log: Function, callbackFunction: fixIndividualCardACLCallback): void {\n  const groups = kb.each(undefined, ns.vcard('hasMember'), person) as NamedNode[]\n  // const doc = person.doc()\n  if (groups) {\n    fixIndividualACL(person, groups, log, callbackFunction)\n  } else {\n    log('This card is in no groups')\n    callbackFunction(true) // fine, no requirements to access. default should be ok\n  }\n  // @@ if no groups, then use default for People container or the book top container.?\n}\n\n/**\n * This function is used by [[fixIndividualCardACL]]\n */\nexport function fixIndividualACL (item: NamedNode, subjects: Array<NamedNode>, log: Function, callbackFunction: fixIndividualACLCallback): void {\n  log = log || debug.log\n  const doc = item.doc()\n  getACLorDefault(doc, function (\n    ok,\n    exists,\n    targetDoc,\n    targetACLDoc,\n    defaultHolder,\n    defaultACLDoc\n  ) {\n    if (!ok || !defaultHolder || !defaultACLDoc) return callbackFunction(false, targetACLDoc) // ie message\n    const ac = exists\n      ? readACL(targetDoc as NamedNode, targetACLDoc as NamedNode)\n      : readACL(defaultHolder, defaultACLDoc)\n    loadUnionACL(subjects, function (ok, union) {\n      if (!ok) return callbackFunction(false, union)\n      if (sameACL(union as AgentMapMap | AgentMapUnion, ac)) {\n        log('Nice - same ACL. no change ' + utils.label(item) + ' ' + doc)\n      } else {\n        log('Group ACLs differ for ' + utils.label(item) + ' ' + doc)\n\n        // log(\"Group ACLs: \" + makeACLString(targetDoc, union, targetACLDoc))\n        // log((exists ? \"Previous set\" : \"Default\") + \" ACLs: \" +\n        // makeACLString(targetDoc, ac, targetACLDoc))\n\n        putACLObject(\n          kb as unknown as LiveStore,\n          targetDoc as NamedNode,\n          union as AgentMapMap | AgentMapUnion,\n          targetACLDoc as NamedNode,\n          callbackFunction\n        )\n      }\n    })\n  })\n}\n\n/**\n * Set an ACL\n */\nexport function setACL (\n  docURI: NamedNode,\n  aclText: string,\n  callbackFunction: (ok: boolean, message: string) => void\n): void {\n  const aclDoc = kb.any(\n    docURI,\n    ACL_LINK\n  ) // @@ check that this get set by web.js\n  if (!kb.fetcher) {\n    throw new Error('Store has no fetcher')\n  }\n  if (aclDoc) {\n    // Great we already know where it is\n    kb.fetcher\n      .webOperation('PUT', aclDoc.value, {\n        data: aclText,\n        contentType: 'text/turtle'\n      })\n      .then((res) => {\n        callbackFunction(res.ok, res.error || '')\n      }) // @@@ check params\n  } else {\n    kb.fetcher.nowOrWhenFetched(docURI, undefined, function (ok, body) {\n      if (!ok) return callbackFunction(ok, 'Gettting headers for ACL: ' + body)\n      const aclDoc = kb.any(\n        docURI,\n        ACL_LINK\n      ) // @@ check that this get set by web.js\n      if (!aclDoc) {\n        // complainIfBad(false, \"No Link rel=ACL header for \" + docURI)\n        callbackFunction(false, 'No Link rel=ACL header for ' + docURI)\n      } else {\n        if (!kb.fetcher) {\n          throw new Error('Store has no fetcher')\n        }\n        kb.fetcher\n          .webOperation('PUT', aclDoc.value, {\n            data: aclText,\n            contentType: 'text/turtle'\n          })\n          .then((res) => {\n            callbackFunction(res.ok, res.error || '')\n          })\n      }\n    })\n  }\n}\n\n/**\n * Get ACL file or default if necessary\n *\n * @param callbackFunction  Will be called in the following ways, in the following cases:\n * * `callbackFunction(true, true, doc, aclDoc)` if the ACL did exist\n * * `callbackFunction(true, false, doc, aclDoc, defaultHolder, defaultACLDoc)` if the ACL file did not exist but a default did\n * * `callbackFunction(false, false, status, message)` when there was an error getting the original\n * * `callbackFunction(false, true, status, message)` when there was an error getting the default\n */\nexport function getACLorDefault (\n  doc: NamedNode,\n  callbackFunction: (\n    a: boolean,\n    b: boolean,\n    statusOrMessage: number | NamedNode,\n    message: string | NamedNode,\n    c?: NamedNode,\n    d?: NamedNode\n  ) => void\n): void {\n  getACL(doc, function (ok, status, aclDoc, message): string | void {\n    const ACL = ns.acl\n    if (!ok) return callbackFunction(false, false, status as number, message as string)\n\n    // Recursively search for the ACL file which gives default access\n    const tryParent = function (uri) {\n      if (uri.slice(-1) === '/') {\n        uri = uri.slice(0, -1)\n      }\n      const right = uri.lastIndexOf('/')\n      const left = uri.indexOf('/', uri.indexOf('//') + 2)\n      if (left > right) {\n        return callbackFunction(false, true, 404, 'Found no ACL resource')\n      }\n      uri = uri.slice(0, right + 1)\n      const doc2 = sym(uri)\n      getACL(doc2, function (ok, status, defaultACLDoc: any): NamedNode | void {\n        if (!ok) {\n          return callbackFunction(\n            false,\n            true,\n            status as number,\n            `( No ACL pointer ${uri} ${status})${defaultACLDoc}`\n          ) as void\n        } else if (status === 403) {\n          return callbackFunction(\n            false,\n            true,\n            status,\n            `( default ACL file FORBIDDEN. Stop.${uri})`\n          )\n        } else if (status === 404) {\n          return tryParent(uri)\n        } else if (status !== 200) {\n          return callbackFunction(\n            false,\n            true,\n            status as number,\n            `Error status '${status}' searching for default for ${doc2}`\n          )\n        }\n        // 200\n        // statusBlock.textContent += (\" ACCESS set at \" + uri + \". End search.\")\n        const defaults = kb\n          .each(undefined, ACL('default'), kb.sym(uri), defaultACLDoc)\n          .concat(\n            kb.each(undefined, ACL('defaultForNew'), kb.sym(uri), defaultACLDoc)\n          )\n        if (!defaults.length) {\n          return tryParent(uri) // Keep searching\n        }\n        const defaultHolder = kb.sym(uri)\n        return callbackFunction(\n          true,\n          false,\n          doc,\n          aclDoc as NamedNode,\n          defaultHolder,\n          defaultACLDoc as NamedNode\n        )\n      })\n    } // tryParent\n\n    if (!ok) {\n      return callbackFunction(\n        false,\n        false,\n        status as number,\n        `Error accessing Access Control information for ${doc}) ${message}`\n      )\n    } else if (status === 404) {\n      tryParent(doc.uri) //  @@ construct default one - the server should do that\n    } else if (status === 403) {\n      return callbackFunction(\n        false,\n        false,\n        status,\n        `(Sharing not available to you)${message}`\n      )\n    } else if (status !== 200) {\n      return callbackFunction(\n        false,\n        false,\n        status as number,\n        `Error ${status} accessing Access Control information for ${doc}: ${message}`\n      )\n    } else {\n      // 200\n      return callbackFunction(true, true, doc, aclDoc as NamedNode)\n    }\n  }) // Call to getACL\n}\n\n/**\n * Calls back `(ok, status, acldoc, message)` as follows\n *\n * * `(false, 900, errormessage)` if no link header\n * * `(true, 403, documentSymbol, fileaccesserror)` if not authorized\n * * `(true, 404, documentSymbol, fileaccesserror)` if does not exist\n * * `(true, 200, documentSymbol)` if file exists and read OK\n */\nexport function getACL (\n  doc: NamedNode,\n  callbackFunction: (\n    ok: boolean,\n    messageOrStatus: number | string,\n    messageOrDoc?: NamedNode | string,\n    message?: string\n  ) => void\n): void {\n  if (!kb.fetcher) {\n    throw new Error('kb has no fetcher')\n  }\n  kb.fetcher.nowOrWhenFetched(doc, undefined, function (ok, body) {\n    if (!ok) {\n      return callbackFunction(ok, `Can't get headers to find ACL for ${doc}: ${body}`)\n    }\n    const aclDoc = kb.any(\n      doc,\n      ACL_LINK\n    ) // @@ check that this get set by web.js\n    if (!aclDoc) {\n      callbackFunction(false, 900, `No Link rel=ACL header for ${doc}`)\n    } else {\n      if (!kb.fetcher) {\n        throw new Error('kb has no fetcher')\n      }\n      if (kb.fetcher.nonexistent[aclDoc.value]) {\n        return callbackFunction(\n          true,\n          404,\n          aclDoc as NamedNode,\n          `ACL file ${aclDoc} does not exist.`\n        )\n      }\n      kb.fetcher.nowOrWhenFetched(aclDoc as NamedNode, undefined, function (\n        ok,\n        message,\n        response\n      ) {\n        if (!ok) {\n          callbackFunction(\n            true,\n            response.status,\n            aclDoc as NamedNode,\n            `Can't read Access Control File ${aclDoc}: ${message}`\n          )\n        } else {\n          callbackFunction(true, 200, aclDoc as NamedNode)\n        }\n      })\n    }\n  })\n}\n\n/**\n * Calls [[getACLorDefault]] and then (?)\n */\nexport async function getProspectiveHolder (targetDirectory: string): Promise<NamedNode | undefined> {\n  return new Promise((resolve, reject) => getACLorDefault(sym(targetDirectory), (\n    ok,\n    isDirectACL,\n    targetDoc,\n    targetACLDoc,\n    defaultHolder\n  ) => {\n    if (ok) {\n      return resolve((isDirectACL ? targetDoc : defaultHolder) as NamedNode)\n    }\n    return reject(new Error(`Error loading ${targetDirectory}`))\n  }))\n}\n","function _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nexport { _classCallCheck as default };","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nexport { _createClass as default };","function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nexport { _arrayLikeToArray as default };","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? arrayLikeToArray(r, a) : void 0;\n  }\n}\nexport { _unsupportedIterableToArray as default };","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nfunction _slicedToArray(r, e) {\n  return arrayWithHoles(r) || iterableToArrayLimit(r, e) || unsupportedIterableToArray(r, e) || nonIterableRest();\n}\nexport { _slicedToArray as default };","function _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nexport { _arrayWithHoles as default };","function _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = !0,\n      o = !1;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) {\n        if (Object(t) !== t) return;\n        f = !1;\n      } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = !0, n = r;\n    } finally {\n      try {\n        if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nexport { _iterableToArrayLimit as default };","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nexport { _nonIterableRest as default };","export default {\n  highlightColor: '#7C4DFF', // Solid lavender https://design.inrupt.com/atomic-core/?cat=Core\n\n  formBorderColor: '#888888', // Mid-grey\n  formHeadingColor: '#888888', // originally was brown; now grey\n  lowProfileLinkColor: '#3B5998', // Grey-blue, e.g., for field labels linking to ontology\n  formFieldNameBoxWidth: '8em', // The fixed amount to get form fields to line up\n  // We put in the latter when switching away from using tables.  However, getting\n  // alignment between fields in different groups is a hard problem.\n\n  mediaModuleCanvasWidth: '640',\n  mediaModuleCanvasHeight: '480',\n\n  textInputSize: 20, // Rough default text input size, in characters\n  tabBorderRadius: '0.2em',\n\n  textInputBackgroundColor: '#eef',\n  textInputBackgroundColorUneditable: '#fff',\n  textInputColor: '#000',\n  textInputColorPending: '#888',\n\n  defaultErrorBackgroundColor: '#fee',\n\n  participationDefaultBackground: 'white',\n\n  basicMaxLength: '4096'\n}\n","// Common readable consistent stylesheet\n// to avoid using style sheets which are document-global\n// and make programmable style toggling with selection, drag over, etc easier\n// These must all end with semicolon so they can be appended to.\n\nimport styleConstants from './styleConstants'\n\nexport const style = { // styleModule\n\n  checkboxStyle: 'color: black; font-size: 100%; padding-left: 0.5 em; padding-right: 0.5 em;',\n  checkboxInputStyle: 'font-size: 150%; height: 1.2em; width: 1.2em; background-color: #eef; border-radius:0.2em; margin: 0.1em;',\n\n  fieldLabelStyle: 'color: #3B5998; text-decoration: none;',\n  formSelectStyle:\n    'background-color: #eef; padding: 0.5em;  border: .05em solid #88c; border-radius:0.2em; font-size: 100%; margin:0.4em;',\n  textInputStyle:\n    'background-color: #eef; padding: 0.5em;  border: .05em solid #88c; border-radius:0.2em; font-size: 100%; margin:0.4em;',\n  textInputStyleUneditable: // Color difference only\n    'background-color: white; padding: 0.5em;  border: .05em solid white; border-radius:0.2em; font-size: 100%; margin:0.4em;',\n  buttonStyle:\n      'background-color: #fff; padding: 0.7em;  border: .01em solid white; border-radius:0.2em; font-size: 100%; margin: 0.3em;', // 'background-color: #eef;\n  commentStyle: 'padding: 0.7em;  border: none; font-size: 100%; white-space: pre-wrap;',\n  iconStyle: 'width: 3em; height: 3em; margin: 0.1em; border-radius: 1em;',\n  smallButtonStyle: 'margin: 0.2em; width: 1em; height:1em;',\n  classIconStyle: 'width: 3em; height: 3em; margin: 0.1em; border-radius: 0.2em; border: 0.1em solid green; padding: 0.2em; background-color: #efe;', // combine with buttonStyle\n  confirmPopupStyle: 'padding: 0.7em; border-radius: 0.2em; border: 0.1em solid orange; background-color: white; box-shadow: 0.5em 0.9em #888;',\n  messageBodyStyle:\n    'white-space: pre-wrap; width: 99%; font-size:100%; border: 0.07em solid #eee; border-radius:0.2em; padding: .3em 0.5em; margin: 0.1em;',\n  pendingeditModifier: 'color: #bbb;',\n\n  // Contacts\n  personaBarStyle: 'width: 100%; height: 4em; background-color: #eee; vertical-align: middle;',\n  searchInputStyle: 'border: 0.1em solid #444; border-radius: 0.2em; width: 100%; font-size: 100%; padding: 0.1em 0.6em; margin 0.2em;',\n  autocompleteRowStyle: 'border: 0.2em solid straw;',\n\n  // Login buttons\n  signInAndUpButtonStyle: 'padding: 1em; border-radius:0.2em; font-size: 100%;', // was 0.5em radius\n  headerBannerLoginInput: 'margin: 0.75em 0 0.75em 0.5em !important; padding: 0.5em !important;',\n  signUpBackground: 'background-color: #eef;',\n  signInBackground: 'background-color: #efe;',\n\n  // Forms\n  heading1Style: 'font-size: 180%; font-weight: bold; color: #888888; padding: 0.5em; margin: 0.7em 0.0m;', // originally was brown; now grey\n  heading2Style: 'font-size: 130%; font-weight: bold; color: #888888; padding: 0.4em; margin: 0.7em 0.0em;', // originally was brown; now grey\n  heading3Style: 'font-size: 120%; font-weight: bold; color: #888888; padding: 0.3em; margin: 0.7em 0.0em;', // For example, in large forms or before a small form\n  heading4Style: 'font-size: 110%; font-weight: bold; color: #888888; padding: 0.2em; margin: 0.7em 0.0em;', // Lowest level used by default in small things\n\n  formHeadingStyle: 'font-size: 110%; font-weight: bold; color: #888888; padding: 0.2em;  margin: 0.7em 0.0em;', // originally was brown; now grey\n  formTextInput: 'font-size: 100%; margin: 0.1em; padding: 0.1em;', // originally used this\n  formGroupStyle: [`padding-left: 0em; border: 0.0em solid ${styleConstants.formBorderColor}; border-radius: 0.2em;`, // weight 0\n    `padding-left: 2em; border: 0.05em solid ${styleConstants.formBorderColor}; border-radius: 0.2em;`,\n    `padding-left: 2em; border: 0.1em solid ${styleConstants.formBorderColor}; border-radius: 0.2em;`,\n    `padding-left: 2em; border: 0.2em solid ${styleConstants.formBorderColor}; border-radius: 0.2em;` // @@ pink\n  ],\n\n  formFieldLabelStyle: `color: ${styleConstants.lowProfileLinkColor}; text-decoration: none;`,\n  formFieldNameBoxStyle: `padding: 0.3em; vertical-align: middle; width:${styleConstants.formFieldNameBoxWidth};`,\n  multilineTextInputStyle: 'font-size:100%; white-space: pre-wrap; background-color: #eef;' +\n  ' border: 0.07em solid gray; padding: 1em 0.5em; margin: 1em 1em;',\n\n  // Buttons\n  renderAsDivStyle: 'display: flex; align-items: center; justify-content: space-between; height: 2.5em; padding: 1em;',\n  imageDivStyle: 'width:2.5em; padding:0.5em; height: 2.5em;',\n  linkDivStyle: 'width:2em; padding:0.5em; height: 4em;',\n\n  // ACL\n  aclControlBoxContainer: 'margin: 1em;',\n  aclControlBoxHeader: 'font-size: 120%; margin: 0 0 1rem;',\n  aclControlBoxStatus: 'display: none; margin: 1rem 0;',\n  aclControlBoxStatusRevealed: 'display: block;',\n  aclGroupContent: 'maxWidth: 650;',\n  accessGroupList: 'display: grid; grid-template-columns: 1fr; margin: 1em; width: 100%;',\n  accessGroupListItem: 'display: grid; grid-template-columns: 100px auto 30%;',\n  defaultsController: 'display: flex;',\n  defaultsControllerNotice: 'color: #888; flexGrow: 1; fontSize: 80%;',\n  bigButton: 'background-color: white; border: 0.1em solid #888; border-radius: 0.3em; max-width: 50%; padding-bottom: 1em; padding-top: 1em;',\n  group: 'color: #888;',\n  group1: 'color: green;',\n  group2: 'color: #cc0;',\n  group3: 'color: orange;',\n  group5: 'color: red;',\n  group9: 'color: blue;',\n  group13: 'color: purple;',\n\n  trustedAppAddApplicationsTable: 'background-color: #eee;',\n  trustedAppCancelButton: 'float: right;',\n  trustedAppControllerI: 'border-color: orange; border-radius: 1em; border-width: 0.1em;',\n  temporaryStatusInit: 'background: green;',\n  temporaryStatusEnd: 'background: transparent; transition: background 5s linear;',\n\n  // header\n  headerUserMenuLink: 'background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em;  width: 100%; text-decoration: none;',\n  headerUserMenuLinkHover: 'background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em;  width: 100%; text-decoration: none; background-image: linear-gradient(to right, #7C4DFF 0%, #18A9E6 50%, #01C9EA 100%);',\n  headerUserMenuTrigger: 'background: none; border: 0; cursor: pointer; width: 60px; height: 60px;',\n  headerUserMenuTriggerImg: 'border-radius: 50%; height: 56px; width: 28px !important;',\n  headerUserMenuButton: 'background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em; width: 100%;',\n  headerUserMenuButtonHover: 'background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em; width: 100%; background-image: linear-gradient(to right, #7C4DFF 0%, #18A9E6 50%, #01C9EA 100%);',\n  headerUserMenuList: 'list-style: none; margin: 0; padding: 0;',\n  headerUserMenuListDisplay: 'list-style: none; margin: 0; padding: 0; display:true;',\n  headerUserMenuNavigationMenu: 'background: white; border: solid 1px #000000; border-right: 0; position: absolute; right: 0; top: 60px; width: 200px; z-index: 1; display: true;',\n  headerUserMenuNavigationMenuNotDisplayed: 'background: white; border: solid 1px #000000; border-right: 0; position: absolute; right: 0; top: 60px; width: 200px; z-index: 1; display: none;',\n  headerUserMenuListItem: 'border-bottom: solid 1px #000000;',\n  headerUserMenuPhoto: 'border-radius: 50%; background-position: center; background-repeat: no-repeat; background-size: cover; height: 50px; width: 50px;',\n  headerBanner: 'box-shadow: 0px 1px 4px #000000; display: flex; justify-content: space-between; padding: 0 1.5em; margin-bottom: 4px;',\n  headerBannerLink: 'display: block;',\n  headerBannerRightMenu: 'display: flex;',\n  headerBannerLogin: 'margin-left: auto;',\n  allChildrenVisible: 'display:true;',\n  headerBannerUserMenu: 'border-left: solid 1px #000000; margin-left: auto;',\n  headerBannerHelpMenu: 'border-left: solid 1px #000000; margin-left: auto;',\n  headerBannerIcon: 'background-size: 65px 60px !important; height: 60px !important; width: 65px !important;', // may just be 65px round($icon-size * 352 / 322);\n\n  // footer\n  footer: 'border-top: solid 1px $divider-color; font-size: 0.9em; padding: 0.5em 1.5em;',\n\n  // buttons\n  primaryButton: 'background-color: #7c4dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;',\n  primaryButtonHover: 'background-color: #9f7dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;',\n  primaryButtonNoBorder: 'background-color: #ffffff; color: #7c4dff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;',\n  primaryButtonNoBorderHover: 'background-color: #7c4dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;',\n  secondaryButton: 'background-color: #01c9ea; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;',\n  secondaryButtonHover: 'background-color: #37cde6; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;',\n  secondaryButtonNoBorder: 'background-color: #ffffff; color: #01c9ea; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;',\n  secondaryButtonNoBorderHover: 'background-color: #01c9ea; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;',\n\n  // media\n  controlStyle: `border-radius: 0.5em; margin: 0.8em; width:${styleConstants.mediaModuleCanvasWidth}; height:${styleConstants.mediaModuleCanvasHeight};`,\n\n  // dragAndDrop\n  dragEvent: 'background-color: #ccc; border: 0.25em dashed black; border-radius: 0.3em;',\n  dropEvent: 'background-color: white; border: 0em solid black;',\n  restoreStyle: 'background-color: white;',\n\n  // errors\n  errorCancelButton: 'width: 2em; height: 2em; align: right;',\n  errorMessageBlockStyle: 'margin: 0.1em; padding: 0.5em; border: 0.05em solid gray; color:black;',\n\n  // pad\n  notepadStyle: 'padding: 1em; overflow: auto; resize: horizontal; min-width: 40em;',\n  upstreamStatus: 'width: 50%;',\n  downstreamStatus: 'width: 50%;',\n  baseStyle: 'font-size: 100%; font-family: monospace; width: 100%; border: none; white-space: pre-wrap;',\n  headingCore: 'font-family: sans-serif; font-weight: bold;  border: none;',\n  headingStyle: [\n    'font-size: 110%; padding-top: 0.5em; padding-bottom: 0.5em; width: 100%;',\n    'font-size: 120%; padding-top: 1em; padding-bottom: 1em; width: 100%;',\n    'font-size: 150%; padding-top: 1em; padding-bottom: 1em; width: 100%;'\n  ],\n\n  // participation\n  participantsStyle: 'margin: 0.8em;',\n  participantsBlock: 'height: 1.5em; width: 1.5em; margin: 0.3em; border 0.01em solid #888;',\n  personTableTD: 'vertical-align: middle;',\n\n  // tabs\n  tabsNavElement: 'margin: 0;',\n  tabsRootElement: 'display: flex; height: 100%; width: 100%;',\n  tabsMainElement: 'margin: 0; width:100%; height: 100%;',\n  tabContainer: 'list-style-type: none; display: flex; height: 100%; width: 100%; margin: 0; padding: 0;',\n  makeNewSlot: 'background: none; border: none; font: inherit; cursor: pointer;',\n  ellipsis: 'position: absolute; right: 0; bottom: 0; width: 20%; background: none; color: inherit; border: none; padding: 0; font: inherit; cursor: pointer; outline: inherit;'\n\n}\n\nstyle.setStyle = function setStyle (ele, styleName) {\n  ele.style = style[styleName]\n}\n","/* Drag and drop common functionality\n *\n * It is easy to make something draggable, or to make it a drag target!\n * Just call the functions below. In a Solid world, any part of the UI which\n * represents one thing which has a URI, should be made draggable using makeDraggable.\n * Any list of things should typically allow you to drag new members of the list\n * onto it.\n * The file upload function, uploadFiles, is provided as often as someone drags a file from the computer\n * desktop. You may want to upload it into the pod.\n */\nimport * as debug from '../debug'\nimport * as mime from 'mime-types'\nimport { style } from '../style'\n\n/* global FileReader alert */\n\nexport function makeDropTarget (ele, droppedURIHandler, droppedFileHandler) {\n  const dragoverListener = function (e) {\n    e.preventDefault() // Need this; otherwise, drop does not work.\n    e.dataTransfer.dropEffect = 'copy'\n  }\n\n  const dragenterListener = function (e) {\n    debug.log('dragenter event dropEffect: ' + e.dataTransfer.dropEffect)\n    if (this.localStyle) {\n      //  necessary not sure when\n      if (!this.savedStyle) {\n        this.savedStyle = style.dragEvent\n      }\n    }\n\n    e.dataTransfer.dropEffect = 'link'\n    debug.log('dragenter event dropEffect 2: ' + e.dataTransfer.dropEffect)\n  }\n  const dragleaveListener = function (e) {\n    debug.log('dragleave event dropEffect: ' + e.dataTransfer.dropEffect)\n    if (this.savedStyle) {\n      this.localStyle = this.savedStyle\n    } else {\n      this.localStyle = style.dropEvent\n    }\n  }\n\n  const dropListener = function (e) {\n    if (e.preventDefault) e.preventDefault() // stops the browser from redirecting off to the text.\n    debug.log('Drop event. dropEffect: ' + e.dataTransfer.dropEffect)\n    debug.log(\n      'Drop event. types: ' +\n        (e.dataTransfer.types ? e.dataTransfer.types.join(', ') : 'NOPE')\n    )\n\n    let uris = null\n    let text\n    if (e.dataTransfer.types) {\n      for (let t = 0; t < e.dataTransfer.types.length; t++) {\n        const type = e.dataTransfer.types[t]\n        if (type === 'text/uri-list') {\n          uris = e.dataTransfer.getData(type).split('\\n') // @ ignore those starting with #\n          debug.log('Dropped text/uri-list: ' + uris)\n        } else if (type === 'text/plain') {\n          text = e.dataTransfer.getData(type)\n        } else if (type === 'Files' && droppedFileHandler) {\n          const files = e.dataTransfer.files // FileList object.\n          for (let i = 0; files[i]; i++) {\n            const f = files[i]\n            debug.log(\n              'Filename: ' +\n                f.name +\n                ', type: ' +\n                (f.type || 'n/a') +\n                ' size: ' +\n                f.size +\n                ' bytes, last modified: ' +\n                (f.lastModifiedDate\n                  ? f.lastModifiedDate.toLocaleDateString()\n                  : 'n/a')\n            )\n          }\n          droppedFileHandler(files)\n        }\n      }\n      if (uris === null && text && text.slice(0, 4) === 'http') {\n        uris = text\n        debug.log('Waring: Poor man\\'s drop: using text for URI') // chrome disables text/uri-list??\n      }\n    } else {\n      // ... however, if we're IE, we don't have the .types property, so we'll just get the Text value\n      uris = [e.dataTransfer.getData('Text')]\n      debug.log('WARNING non-standard drop event: ' + uris[0])\n    }\n    debug.log('Dropped URI list (2): ' + uris)\n    if (uris) {\n      droppedURIHandler(uris)\n    }\n    this.localStyle = style.restoreStyle // restore style\n    return false\n  } // dropListener\n\n  const addTargetListeners = function (ele) {\n    if (!ele) {\n      debug.log('@@@ addTargetListeners: ele ' + ele)\n    }\n    ele.addEventListener('dragover', dragoverListener)\n    ele.addEventListener('dragenter', dragenterListener)\n    ele.addEventListener('dragleave', dragleaveListener)\n    ele.addEventListener('drop', dropListener)\n  }\n  addTargetListeners(ele, droppedURIHandler)\n} // listen for dropped URIs\n\n// Make an HTML element draggable as a URI-identified thing\n//\n// Possibly later set the drag image too?\n//\nexport function makeDraggable (tr, obj) {\n  tr.setAttribute('draggable', 'true') // Stop the image being dragged instead - just the TR\n\n  tr.addEventListener(\n    'dragstart',\n    function (e) {\n      tr.style.fontWeight = 'bold'\n      e.dataTransfer.setData('text/uri-list', obj.uri)\n      e.dataTransfer.setData('text/plain', obj.uri)\n      e.dataTransfer.setData('text/html', tr.outerHTML)\n      debug.log(\n        'Dragstart: ' + tr + ' -> ' + obj + 'de: ' + e.dataTransfer.dropEffect\n      )\n    },\n    false\n  )\n\n  tr.addEventListener(\n    'drag',\n    function (e) {\n      e.preventDefault()\n      e.stopPropagation()\n      // debug.log('Drag: dropEffect: ' + e.dataTransfer.dropEffect)\n    },\n    false\n  )\n\n  tr.addEventListener(\n    'dragend',\n    function (e) {\n      tr.style.fontWeight = 'normal'\n      debug.log('Dragend dropeffect: ' + e.dataTransfer.dropEffect)\n      debug.log('Dragend: ' + tr + ' -> ' + obj)\n    },\n    false\n  )\n}\n\n/** uploadFiles\n**\n**  Generic uploader of local files to the web\n**   typically called from dropped file handler\n**\n**  @param {Fetcher} fetcher    instance of class Fetcher as in kb.fetcher\n**  @param {Array<File>} files      Array of file objects\n**  @param {String} fileBase    URI of folder in which to put files (except images) (no trailing slash)\n**  @param {String } imageBase  URI of folder in which to put images\n**  @param successHandler function(file, uploadedURI)    Called after EACH success upload\n**                              With file object an final URI as params\n*/\n\nexport function uploadFiles (fetcher, files, fileBase, imageBase, successHandler) {\n  for (let i = 0; files[i]; i++) {\n    const f = files[i]\n    debug.log(\n      ' dropped: Filename: ' +\n        f.name +\n        ', type: ' +\n        (f.type || 'n/a') +\n        ' size: ' +\n        f.size +\n        ' bytes, last modified: ' +\n        (f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a')\n    ) // See e.g. https://www.html5rocks.com/en/tutorials/file/dndfiles/\n\n    // @@ Add: progress bar(s)\n    const reader = new FileReader()\n    reader.onload = (function (theFile) {\n      return function (e) {\n        const data = e.target.result\n        let suffix = ''\n        debug.log(' File read byteLength : ' + data.byteLength)\n        let contentType = theFile.type\n        if (!theFile.type || theFile.type === '') {\n          // Not known by browser\n          contentType = mime.lookup(theFile.name)\n          if (!contentType) {\n            const msg =\n              'Filename needs to have an extension which gives a type we know: ' +\n              theFile.name\n            debug.log(msg)\n            alert(msg)\n            throw new Error(msg)\n          }\n        } else {\n          const extension = mime.extension(theFile.type)\n          // Note not simple: eg .mp3 => audio/mpeg; .mpga => audio/mpeg; audio/mp3 => .mp3\n          if (extension && extension !== 'false' && !theFile.name.endsWith('.' + extension) && // Not already has preferred extension? and ...\n            theFile.type !== mime.lookup(theFile.name)) { // the mime type of this ext is not the right one?\n            suffix = '_.' + extension\n            // console.log('MIME TYPE MISMATCH: ' + mime.lookup(theFile.name) + ': adding extension: ' + suffix)\n          }\n        }\n        const folderName = theFile.type.startsWith('image/')\n          ? imageBase || fileBase\n          : fileBase\n        const destURI =\n          folderName +\n          (folderName.endsWith('/') ? '' : '/') +\n          encodeURIComponent(theFile.name) +\n          suffix\n\n        fetcher\n          .webOperation('PUT', destURI, {\n            data,\n            contentType\n          })\n          .then(\n            _response => {\n              debug.log(' Upload: put OK: ' + destURI)\n              successHandler(theFile, destURI)\n            },\n            error => {\n              const msg = ' Upload: FAIL ' + destURI + ', Error: ' + error\n              debug.log(msg)\n              alert(msg)\n              throw new Error(msg)\n            }\n          )\n      }\n    })(f)\n    reader.readAsArrayBuffer(f)\n  }\n}\n","//                  Solid-UI general Utilities\n//                  ==========================\n//\n// This must load AFTER the rdflib.js and log-ext.js (or log.js).\n//\nimport * as log from '../log'\nimport { store } from 'solid-logic'\nimport ns from '../ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\nimport { label } from './label'\n\nconst UI = { log, ns, rdf }\n\nexport {\n  addLoadEvent, // not used anywhere\n  AJARImage,\n  ancestor,\n  beep,\n  clearVariableNames,\n  emptyNode,\n  escapeForXML,\n  findPos,\n  genUuid,\n  getAbout,\n  getEyeFocus,\n  getTarget,\n  getTerm,\n  hashColor,\n  include,\n  label,\n  labelForXML,\n  labelWithOntology,\n  newVariableName,\n  ontologyLabel,\n  predicateLabel,\n  predicateLabelForXML,\n  predParentOf,\n  RDFComparePredicateObject,\n  RDFComparePredicateSubject,\n  shortName,\n  stackString,\n  syncTableToArray,\n  syncTableToArrayReOrdered\n}\n\nlet nextVariable = 0\n\nfunction newVariableName () {\n  return 'v' + nextVariable++\n}\n\nfunction clearVariableNames () {\n  nextVariable = 0\n}\n\n// http://stackoverflow.com/questions/879152/how-do-i-make-javascript-beep\n// http://www.tsheffler.com/blog/2013/05/14/audiocontext-noteonnoteoff-and-time-units/\n\nlet audioContext\n\nif (typeof AudioContext !== 'undefined') {\n  audioContext = AudioContext\n} else if (typeof window !== 'undefined') {\n  audioContext = window.AudioContext || window.webkitAudioContext\n}\n\nfunction beep () {\n  if (!audioContext) {\n    return\n  } // Safari 2015\n\n  const ContextClass = audioContext\n  const ctx = new ContextClass()\n\n  return function (duration, frequency, type, finishedCallback) {\n    duration = +(duration || 0.3)\n\n    // Only 0-4 are valid types.\n    type = type || 'sine' // sine, square, sawtooth, triangle\n\n    if (typeof finishedCallback !== 'function') {\n      finishedCallback = function () {}\n    }\n\n    const osc = ctx.createOscillator()\n\n    osc.type = type\n    osc.frequency.value = frequency || 256\n\n    osc.connect(ctx.destination)\n    osc.start(0)\n    osc.stop(duration)\n  }\n}\n\n// Make pseudorandom color from a uri\n// NOT USED ANYWHERE\nfunction hashColor (who) {\n  who = who.uri || who\n  const hash = function (x) {\n    return x.split('').reduce(function (a, b) {\n      a = (a << 5) - a + b.charCodeAt(0)\n      return a & a\n    }, 0)\n  }\n  return '#' + ((hash(who) & 0xffffff) | 0xc0c0c0).toString(16) // c0c0c0 or 808080 forces pale\n}\n\nfunction genUuid () {\n  // http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0\n    const v = c === 'x' ? r : (r & 0x3) | 0x8\n    return v.toString(16)\n  })\n}\n\n/** Sync a DOM table with an array of things\n *\n * @param {DomElement} table - will have a tr for each thing\n * @param {Array<NamedNode>} things - ORDERED array of NamedNode objects\n * @param {function({NamedNode})} createNewRow(thing) returns a TR table row for a new thing\n *\n * Tolerates out of order elements but puts new ones in order.\n * Can be used for any element type; does not have to be a table and tr.\n */\nfunction syncTableToArray (table, things, createNewRow) {\n  let foundOne\n  let row\n  let i\n\n  for (i = 0; i < table.children.length; i++) {\n    row = table.children[i]\n    row.trashMe = true\n  }\n\n  for (let g = 0; g < things.length; g++) {\n    const thing = things[g]\n    foundOne = false\n\n    for (i = 0; i < table.children.length; i++) {\n      row = table.children[i]\n      if (row.subject && row.subject.sameTerm(thing)) {\n        row.trashMe = false\n        foundOne = true\n        break\n      }\n    }\n    if (!foundOne) {\n      const newRow = createNewRow(thing)\n      // Insert new row in position g in the table to match array\n      if (g >= table.children.length) {\n        table.appendChild(newRow)\n      } else {\n        const ele = table.children[g]\n        table.insertBefore(newRow, ele)\n      }\n      newRow.subject = thing\n    } // if not foundOne\n  } // loop g\n\n  for (i = 0; i < table.children.length; i++) {\n    row = table.children[i]\n    if (row.trashMe) {\n      table.removeChild(row)\n    }\n  }\n} // syncTableToArray\n\n/** Sync a DOM table with an array of things\n *\n * @param {DomElement} table - will have a tr for each thing\n * @param {Array<NamedNode>} things - ORDERED array of UNIQUE NamedNode objects. No duplicates\n * @param {function({NamedNode})} createNewRow(thing) returns a rendering of a new thing\n *\n * Ensures order matches exacly.  We will re-rder existing elements if necessary\n * Can be used for any element type; does not have to be a table and tr.\n * Any RDF node value can only appear ONCE in the array\n */\nfunction syncTableToArrayReOrdered (table, things, createNewRow) {\n  const elementMap = {}\n\n  for (let i = 0; i < table.children.length; i++) {\n    const row = table.children[i]\n    elementMap[row.subject.toNT()] = row // More sophisticaed would be to have a bag of duplicates\n  }\n\n  for (let g = 0; g < things.length; g++) {\n    const thing = things[g]\n    if (g >= table.children.length) { // table needs extending\n      const newRow = createNewRow(thing)\n      newRow.subject = thing\n      table.appendChild(newRow)\n    } else {\n      const row = table.children[g]\n      if (row.subject.sameTerm(thing)) {\n        // ...\n      } else {\n        const existingRow = elementMap[thing.toNT()]\n        if (existingRow) {\n          table.removeChild(existingRow)\n          table.insertBefore(existingRow, row) // Insert existing row in place of this one\n        } else {\n          const newRow = createNewRow(thing)\n          row.before(newRow) // Insert existing row in place of this one\n          newRow.subject = thing\n        }\n      }\n    }\n  } // loop g\n  // Lop off any we don't need any more:\n  while (table.children.length > things.length) {\n    table.removeChild(table.children[table.children.length - 1])\n  }\n} // syncTableToArrayReOrdered\n\n/* Error stack to string for better diagnotsics\n **\n ** See  http://snippets.dzone.com/posts/show/6632\n */\nfunction stackString (e) {\n  let str = '' + e + '\\n'\n  let i\n  if (!e.stack) {\n    return str + 'No stack available.\\n'\n  }\n  const lines = e.stack.toString().split('\\n')\n  const toPrint = []\n  for (i = 0; i < lines.length; i++) {\n    let line = lines[i]\n    if (line.indexOf('ecmaunit.js') > -1) {\n      // remove useless bit of traceback\n      break\n    }\n    if (line.charAt(0) === '(') {\n      line = 'function' + line\n    }\n    const chunks = line.split('@')\n    toPrint.push(chunks)\n  }\n  // toPrint.reverse();  No - I prefer the latest at the top by the error message -tbl\n\n  for (i = 0; i < toPrint.length; i++) {\n    str += '  ' + toPrint[i][1] + '\\n    ' + toPrint[i][0]\n  }\n  return str\n}\n\nfunction emptyNode (node) {\n  const nodes = node.childNodes\n  const len = nodes.length\n  for (let i = len - 1; i >= 0; i--) node.removeChild(nodes[i])\n  return node\n}\n\nfunction getTarget (e) {\n  let target\n  e = e || window.event\n  if (e.target) target = e.target\n  else if (e.srcElement) target = e.srcElement\n  if (target.nodeType === 3) {\n    // defeat Safari bug [sic]\n    target = target.parentNode\n  }\n  // UI.log.debug(\"Click on: \" + target.tagName)\n  return target\n}\n\nfunction ancestor (target, tagName) {\n  let level\n  for (level = target; level; level = level.parentNode) {\n    // UI.log.debug(\"looking for \"+tagName+\" Level: \"+level+\" \"+level.tagName)\n    try {\n      if (level.tagName === tagName) return level\n    } catch (e) {\n      // can hit \"TypeError: can't access dead object\" in ffox\n      return undefined\n    }\n  }\n  return undefined\n}\n\nfunction getAbout (kb, target) {\n  let level, aa\n  for (\n    level = target;\n    level && level.nodeType === 1;\n    level = level.parentNode\n  ) {\n    // UI.log.debug(\"Level \"+level + ' '+level.nodeType + ': '+level.tagName)\n    aa = level.getAttribute('about')\n    if (aa) {\n      // UI.log.debug(\"kb.fromNT(aa) = \" + kb.fromNT(aa))\n      return kb.fromNT(aa)\n      //        } else {\n      //            if (level.tagName=='TR') return undefined//this is to prevent literals passing through\n    }\n  }\n  UI.log.debug('getAbout: No about found')\n  return undefined\n}\n\nfunction getTerm (target) {\n  const statementTr = target.parentNode\n  const st = statementTr ? statementTr.AJAR_statement : undefined\n\n  const className = st ? target.className : '' // if no st then it's necessary to use getAbout\n  switch (className) {\n    case 'pred':\n    case 'pred selected':\n      return st.predicate\n    case 'obj':\n    case 'obj selected':\n      if (!statementTr.AJAR_inverse) {\n        return st.object\n      } else {\n        return st.subject\n      }\n    case '':\n    case 'selected': // header TD\n      return getAbout(store, target) // kb to be changed\n    case 'undetermined selected':\n      return target.nextSibling\n        ? st.predicate\n        : !statementTr.AJAR_inverse\n            ? st.object\n            : st.subject\n  }\n}\n\nfunction include (document, linkstr) {\n  const lnk = document.createElement('script')\n  lnk.setAttribute('type', 'text/javascript')\n  lnk.setAttribute('src', linkstr)\n  // TODO:This needs to be fixed or no longer used.\n  // document.getElementsByTagName('head')[0].appendChild(lnk)\n  return lnk\n}\n\nfunction addLoadEvent (func) {\n  const oldonload = window.onload\n  if (typeof window.onload !== 'function') {\n    window.onload = func\n  } else {\n    window.onload = function () {\n      oldonload()\n      func()\n    }\n  }\n} // addLoadEvent\n\n// Find the position of an object relative to the window\nfunction findPos (obj) {\n  // C&P from http://www.quirksmode.org/js/findpos.html\n  const myDocument = obj.ownerDocument\n  const DocBox = myDocument.documentElement.getBoundingClientRect()\n  const box = obj.getBoundingClientRect()\n  return [box.left - DocBox.left, box.top - DocBox.top]\n}\n\nfunction getEyeFocus (element, instantly, isBottom, myWindow) {\n  if (!myWindow) myWindow = window\n  const elementPosY = findPos(element)[1]\n  const appContext = window.SolidAppContext || {}\n  const scrollDiff = (appContext && appContext.scroll) || 52 // 52 = magic number for web-based version\n  const totalScroll = elementPosY - scrollDiff - myWindow.scrollY\n\n  if (instantly) {\n    if (isBottom) {\n      myWindow.scrollBy(\n        0,\n        elementPosY +\n        element.clientHeight -\n        (myWindow.scrollY + myWindow.innerHeight)\n      )\n      return\n    }\n    myWindow.scrollBy(0, totalScroll)\n    return\n  }\n  const id = myWindow.setInterval(scrollAmount, 50)\n  let times = 0\n  function scrollAmount () {\n    myWindow.scrollBy(0, totalScroll / 10)\n    times++\n    if (times === 10) {\n      myWindow.clearInterval(id)\n    }\n  }\n}\n\nfunction AJARImage (src, alt, tt, doc) {\n  if (!doc) {\n    doc = document\n  }\n  const image = doc.createElement('img')\n  image.setAttribute('src', src)\n  image.addEventListener('copy', function (e) {\n    e.clipboardData.setData('text/plain', '')\n    e.clipboardData.setData('text/html', '')\n    e.preventDefault() // We want no title data to be written to the clipboard\n  })\n  //    if (typeof alt != 'undefined')      // Messes up cut-and-paste of text\n  //        image.setAttribute('alt', alt)\n  if (typeof tt !== 'undefined') {\n    image.setAttribute('title', tt)\n  }\n  return image\n}\n\n//  Make short name for ontology\n\nfunction shortName (uri) {\n  let p = uri\n  if ('#/'.indexOf(p[p.length - 1]) >= 0) p = p.slice(0, -1)\n  const namespaces = []\n  for (const ns in this.prefixes) {\n    namespaces[this.prefixes[ns]] = ns // reverse index\n  }\n  let pok\n  const canUse = function canUse (pp) {\n    // if (!__Serializer.prototype.validPrefix.test(pp)) return false; // bad format\n    if (pp === 'ns') return false // boring\n    // if (pp in this.namespaces) return false; // already used\n    // this.prefixes[uri] = pp;\n    // this.namespaces[pp] = uri;\n    pok = pp\n    return true\n  }\n\n  let i\n  const hash = p.lastIndexOf('#')\n  if (hash >= 0) p = p.slice(hash - 1) // lop off localid\n  // eslint-disable-next-line no-unreachable-loop\n  for (;;) {\n    const slash = p.lastIndexOf('/')\n    if (slash >= 0) p = p.slice(slash + 1)\n    i = 0\n    while (i < p.length) {\n      if (this.prefixchars.indexOf(p[i])) i++\n      else break\n    }\n    p = p.slice(0, i)\n    if (p.length < 6 && canUse(p)) return pok // exact i sbest\n    if (canUse(p.slice(0, 3))) return pok\n    if (canUse(p.slice(0, 2))) return pok\n    if (canUse(p.slice(0, 4))) return pok\n    if (canUse(p.slice(0, 1))) return pok\n    if (canUse(p.slice(0, 5))) return pok\n    for (i = 0; ; i++) if (canUse(p.slice(0, 3) + i)) return pok\n  }\n}\n\n// Short name for an ontology\nfunction ontologyLabel (term) {\n  if (term.uri === undefined) return '??'\n  let s = term.uri\n  const namespaces = []\n  let i = s.lastIndexOf('#')\n  let part\n  if (i >= 0) {\n    s = s.slice(0, i + 1)\n  } else {\n    i = s.lastIndexOf('/')\n    if (i >= 0) {\n      s = s.slice(0, i + 1)\n    } else {\n      return term.uri + '?!' // strange should have # or /\n    }\n  }\n  for (const ns in UI.ns) {\n    namespaces[UI.ns[ns]] = ns // reverse index\n  }\n  try {\n    return namespaces[s]\n  } catch (e) {}\n\n  s = s.slice(0, -1) // Chop off delimiter ... now have just\n\n  while (s) {\n    i = s.lastIndexOf('/')\n    if (i >= 0) {\n      part = s.slice(i + 1)\n      s = s.slice(0, i)\n      if (part !== 'ns' && '0123456789'.indexOf(part[0]) < 0) {\n        return part\n      }\n    } else {\n      return term.uri + '!?' // strange should have a nice part\n    }\n  }\n}\n\nfunction labelWithOntology (x, initialCap) {\n  const t = store.findTypeURIs(x)\n  if (t[UI.ns.rdf('Predicate').uri] || t[UI.ns.rdfs('Class').uri]) {\n    return label(x, initialCap) + ' (' + ontologyLabel(x) + ')'\n  }\n  return label(x, initialCap)\n}\n\nfunction escapeForXML (str) {\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;')\n}\n\n//  As above but escaped for XML and chopped of contains a slash\nfunction labelForXML (x) {\n  return escapeForXML(label(x))\n}\n\nfunction predicateLabelForXML (p, inverse) {\n  return escapeForXML(predicateLabel(p, inverse))\n}\n// As above but for predicate, possibly inverse\nfunction predicateLabel (p, inverse) {\n  const lab = label(p)\n  if (inverse) {\n    // If we know an inverse predicate, use its label\n    const ip = store.any(p, UI.ns.owl('inverseOf')) || store.any(undefined, UI.ns.owl('inverseOf'), p)\n    if (ip) return label(ip)\n    if (lab === 'type') return '...' // Not \"is type of\"\n    return 'is ' + lab + ' of'\n  }\n  return lab\n}\n\n// Not a method. For use in sorts\nfunction RDFComparePredicateObject (self, other) {\n  const x = self.predicate.compareTerm(other.predicate)\n  if (x !== 0) return x\n  return self.object.compareTerm(other.object)\n}\n\nfunction RDFComparePredicateSubject (self, other) {\n  const x = self.predicate.compareTerm(other.predicate)\n  if (x !== 0) return x\n  return self.subject.compareTerm(other.subject)\n}\n// ends\n\nfunction predParentOf (node) {\n  let n = node\n  while (true) {\n    if (n.getAttribute('predTR')) {\n      return n\n    } else if (n.previousSibling && n.previousSibling.nodeName === 'TR') {\n      n = n.previousSibling\n    } else {\n      UI.log.error('Could not find predParent')\n      return node\n    }\n  }\n}\n\n// makeQueryRow moved to outline mode\n","/**\n * Create an error message block\n * @param dom The DOM on which dom.createElement will be called\n * @param err The error message string to display (or an error object)\n * @param backgroundColor Background color. Default: '#fee'\n * @param err2 Is the second param is a string, you can put the original Error in here\n * @returns A div element with the err string\n *\n * This will return a DOM element you can put in the UI as a notice for the user\n *  Meanwhile the stack is dumped to the console for the developer, so you actually know\n *  where it happened!\n */\n\nimport { cancelButton } from '../widgets'\nimport { style } from '../style'\nimport styleConstants from '../styleConstants'\n\nexport function errorMessageBlock (dom: HTMLDocument, err: string | Error, backgroundColor?: string, err2?: Error): HTMLDivElement {\n  const div = dom.createElement('div')\n\n  /* tslint:disable-next-line */ // Too complex for TS?\n  // @ts-ignore\n  const errorObject:Error = err2 || err instanceof Error ? err : null\n\n  if (errorObject) {\n    console.error(`errorMessageBlock: ${errorObject} at: ${errorObject.stack || '??'}`, errorObject) // @@ pick one\n    div.textContent = errorObject.message\n  } else {\n    div.textContent = err as string\n  }\n\n  div.appendChild(cancelButton(dom, () => { if (div.parentNode) div.parentNode.removeChild(div) }))\n    .style = style.errorCancelButton\n\n  div.setAttribute('style', style.errorMessageBlockStyle)\n  div.style.backgroundColor = (backgroundColor || styleConstants.defaultErrorBackgroundColor)\n  return div\n}\n","import { style } from '../style'\n\n/**\n * Wraps a Div in a TR/RD\n *\n * Takes a div and wraps it in a TR/TD to be backwards compatible to the\n * table structure of mashlib\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param div the created widget will be appended to this\n * @param obj not sure what this is used for exactly\n *\n * @returns The HTML widget created\n *\n * @internal exporting this only for unit tests\n */\n\nexport const wrapDivInATR = (dom: HTMLDocument, div: HTMLDivElement, obj: any) => {\n  const tr = dom.createElement('tr')\n  const td = tr.appendChild(dom.createElement('td'))\n  td.appendChild(div)\n  ;(tr as any).subject = obj\n  return tr\n}\n\n/**\n * Adds a click listener to a div\n *\n * Adds a given function as a click listener on the given div\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param onClickFunction the click function to add to the click listener\n *\n * @returns The HTML widget created\n *\n * @internal exporting this only for unit tests\n */\n\nexport const addClickListenerToElement = (div: HTMLDivElement, onClickFunction: () => void) => {\n  div.addEventListener('click', onClickFunction)\n}\n\n/**\n * Wraps a Div in a TR/RD\n *\n * Takes a div and wraps it in a TR/TD to be backwards compatible to the\n * table structure of mashlib\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param div the created widget will be appended to this\n * @param obj not sure what this is used for exactly\n *\n * @returns The HTML widget created\n *\n * @internal exporting this only for unit tests\n */\n\nexport const createImageDiv = (dom: HTMLDocument, div: HTMLDivElement, image: HTMLImageElement | HTMLObjectElement) => {\n  const imageDiv = div.appendChild(dom.createElement('div'))\n\n  imageDiv.setAttribute('style', style.imageDivStyle)\n  imageDiv.appendChild(image)\n  image.setAttribute('draggable', 'false') // Stop the image being dragged instead - just the TR\n}\n","import { NamedNode } from 'rdflib'\nimport { originalIconBase } from '../../iconBase'\n\n/**\n * Creates an anchor tag for a NamedNode\n *\n * Takes a NamedNode and creates an anchor tag for it\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param subject NamedNode the anchor tag is created for\n * @param iconURI? Optional if you have your own icon link\n *\n * @returns The anchor tag for the subject\n *\n */\n\nexport function linkIcon (dom: HTMLDocument, subject: NamedNode, iconURI?: string): HTMLElement {\n  const anchor = dom.createElement('a')\n  anchor.setAttribute('href', subject.uri)\n  if (subject.uri.startsWith('http')) {\n    // If diff web page\n    anchor.setAttribute('target', '_blank') // open in a new tab or window\n  } // as mailboxes and mail messages do not need new browser window\n  const img = anchor.appendChild(dom.createElement('img'))\n  img.setAttribute(\n    'src',\n    iconURI || originalIconBase + 'go-to-this.png'\n  )\n  img.setAttribute('style', 'margin: 0.3em;')\n  return anchor\n}\n/**\n * Creates a Link for a URI\n *\n * Takes a div element for a link and attaches the provided linkIcon\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param linkDiv the created link will be appended to this\n * @param obj NamedNode the link needs to be created for\n *\n * @returns The HTML widget created\n *\n */\n\nexport const createLinkForURI = (dom: HTMLDocument, linkDiv: HTMLDivElement, obj: NamedNode) => {\n  const iconLink = linkIcon(dom, obj)\n  const anchor = linkDiv.appendChild(iconLink)\n  anchor.classList.add('HoverControlHide')\n  linkDiv.appendChild(dom.createElement('br'))\n}\n","/*  Buttons\n*/\nimport { IndexedFormula, NamedNode, st, sym, uri, Util } from 'rdflib'\nimport { icons } from '../iconBase'\nimport ns from '../ns'\nimport { style } from '../style'\nimport * as debug from '../debug'\nimport { info } from '../log'\nimport { uploadFiles, makeDraggable, makeDropTarget } from './dragAndDrop'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { errorMessageBlock } from './error'\nimport { addClickListenerToElement, createImageDiv, wrapDivInATR } from './widgetHelpers'\nimport { linkIcon, createLinkForURI } from './buttons/iconLinks'\n\n/**\n * UI Widgets such as buttons\n * @packageDocumentation\n */\n\n/* global alert */\n\nconst { iconBase } = icons\n\nconst cancelIconURI = iconBase + 'noun_1180156.svg' // black X\nconst checkIconURI = iconBase + 'noun_1180158.svg' // green checkmark; Continue\n\nexport type StatusAreaContext = {\n  statusArea?: HTMLElement\n  div?: HTMLElement\n  dom?: HTMLDocument\n}\nexport type ButtonType = 'Primary' | 'Secondary'\n\nexport type ButtonWidgetOptions = {\n  buttonColor?: ButtonType,\n  needsBorder?: boolean\n}\n\nexport type RenderAsDivOptions = {\n  image?: HTMLImageElement,\n  title?: string,\n  deleteFunction?: () => void,\n  link?: boolean,\n  noun?: string,\n  draggable?: boolean,\n  clickable?: boolean,\n  onClickFunction?: () => void,\n  wrapInATR?: boolean\n}\n\nfunction getStatusArea (context?: StatusAreaContext) {\n  let box = (context && context.statusArea) || (context && context.div) || null\n  if (box) return box\n  let dom = context && context.dom\n  if (!dom && typeof document !== 'undefined') {\n    dom = document\n  }\n  if (dom) {\n    const body = dom.getElementsByTagName('body')[0]\n    box = dom.createElement('div')\n    body.insertBefore((box as unknown as HTMLElement), body.firstElementChild)\n    if (context) {\n      context.statusArea = (box as unknown as HTMLElement)\n    }\n    return box\n  }\n  return null\n}\n\n/**\n * Display an error message block\n */\nexport function complain (context?: StatusAreaContext, err?: string) {\n  if (!err) return // only if error\n  const ele = getStatusArea(context)\n  debug.log('Complaint: ' + err)\n  if (ele) ele.appendChild(errorMessageBlock((context && context.dom) || document, err))\n  else alert(err)\n}\n\n/**\n * Remove all the children of an HTML element\n */\nexport function clearElement (ele: HTMLElement) {\n  while (ele.firstChild) {\n    ele.removeChild(ele.firstChild)\n  }\n  return ele\n}\n\n/**\n * To figure out the log URI from the full URI used to invoke the reasoner\n */\nexport function extractLogURI (fullURI) {\n  const logPos = fullURI.search(/logFile=/)\n  const rulPos = fullURI.search(/&rulesFile=/)\n  return fullURI.substring(logPos + 8, rulPos)\n}\n\n/**\n * By default, converts e.g. '2020-02-19T19:35:28.557Z' to '19:35'\n * if today is 19 Feb 2020, and to 'Feb 19' if not.\n * @@@ TODO This needs to be changed to local time\n * @param noTime Return a string like 'Feb 19' even if it's today.\n */\nexport function shortDate (str?: string, noTime?: boolean): string {\n  if (!str) return '???'\n  const month = [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'Jun',\n    'Jul',\n    'Aug',\n    'Sep',\n    'Oct',\n    'Nov',\n    'Dec'\n  ]\n  try {\n    const nowZ = new Date().toISOString()\n    // var nowZ = $rdf.term(now).value\n    // var n = now.getTimezoneOffset() // Minutes\n    if (str.slice(0, 10) === nowZ.slice(0, 10) && !noTime) {\n      return str.slice(11, 16)\n    }\n    if (str.slice(0, 4) === nowZ.slice(0, 4)) {\n      return (\n        month[parseInt(str.slice(5, 7), 10) - 1] +\n        ' ' +\n        parseInt(str.slice(8, 10), 10)\n      )\n    }\n    return str.slice(0, 10)\n  } catch (e) {\n    return 'shortdate:' + e\n  }\n}\n\n/**\n * Format a date and time\n * @param date for instance `new Date()`\n * @param format  for instance '{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\n * @returns for instance '2000-01-15T23:14:23.002'\n */\nexport function formatDateTime (date: Date, format: string): string {\n  return format\n    .split('{')\n    .map(function (s) {\n      const k = s.split('}')[0]\n      const width = { Milliseconds: 3, FullYear: 4 }\n      const d = { Month: 1 }\n      return s\n        ? ('000' + (date['get' + k]() + (d[k] || 0))).slice(-(width[k] || 2)) + s.split('}')[1]\n        : ''\n    })\n    .join('')\n}\n\n/**\n * Get a string representation of the current time\n * @returns for instance '2000-01-15T23:14:23.002'\n */\nexport function timestamp (): string {\n  return formatDateTime(\n    new Date(),\n    '{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\n  )\n}\n\n/**\n * Get a short string representation of the current time\n * @returns for instance '23:14:23.002'\n */\nexport function shortTime (): string {\n  return formatDateTime(\n    new Date(),\n    '{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\n  )\n}\n\n// ///////////////////// Handy UX widgets\n\n/**\n * Sets the best name we have and looks up a better one\n */\nexport function setName (element: HTMLElement, x: NamedNode) {\n  const kb = store\n  const findName = function (x) {\n    const name =\n      kb.any(x, ns.vcard('fn')) ||\n      kb.any(x, ns.foaf('name')) ||\n      kb.any(x, ns.vcard('organization-name'))\n    return name ? name.value : null\n  }\n  const name = x.sameTerm(ns.foaf('Agent')) ? 'Everyone' : findName(x)\n  element.textContent = name || utils.label(x)\n  if (!name && x.uri) {\n    if (!kb.fetcher) {\n      throw new Error('kb has no fetcher')\n    }\n    // Note this is only a fetch, not a lookUP of all sameAs etc\n    kb.fetcher.nowOrWhenFetched(x.doc(), undefined, function (_ok) {\n      element.textContent = findName(x) || utils.label(x) // had: (ok ? '' : '? ') +\n    })\n  }\n}\n\n/**\n * Set of suitable images\n * See also [[findImage]]\n * @param x The thing for which we want to find an image\n * @param kb The RDF store to look in\n * @returns It goes looking for triples in `kb`,\n *          `(subject: x), (predicate: see list below) (object: image-url)`\n *          to find any image linked from the thing with one of the following\n *          predicates (in order):\n *          * ns.sioc('avatar')\n *          * ns.foaf('img')\n *          * ns.vcard('logo')\n *          * ns.vcard('hasPhoto')\n *          * ns.vcard('photo')\n *          * ns.foaf('depiction')\n\n */\nexport function imagesOf (x: NamedNode | null, kb: IndexedFormula): any[] {\n  return kb\n    .each(x, ns.sioc('avatar'))\n    .concat(kb.each(x, ns.foaf('img')))\n    .concat(kb.each(x, ns.vcard('logo')))\n    .concat(kb.each(x, ns.vcard('hasPhoto')))\n    .concat(kb.each(x, ns.vcard('photo')))\n    .concat(kb.each(x, ns.foaf('depiction')))\n}\n\n/**\n * Best logo or avatar or photo etc to represent someone or some group etc\n */\nexport const iconForClass = {\n  // Potentially extendable by other apps, panes, etc\n  // Relative URIs to the iconBase\n  'solid:AppProviderClass': 'noun_144.svg', //  @@ classs name should not contain 'Class'\n  'solid:AppProvider': 'noun_15177.svg', // @@\n  'solid:Pod': 'noun_Cabinet_1434380.svg',\n  'vcard:Group': 'noun_339237.svg',\n  'vcard:Organization': 'noun_143899.svg',\n  'vcard:Individual': 'noun_15059.svg',\n  'schema:Person': 'noun_15059.svg',\n  'foaf:Person': 'noun_15059.svg',\n  'foaf:Agent': 'noun_98053.svg',\n  'acl:AuthenticatedAgent': 'noun_99101.svg',\n  'prov:SoftwareAgent': 'noun_Robot_849764.svg', // Bot\n  'vcard:AddressBook': 'noun_15695.svg',\n  'trip:Trip': 'noun_581629.svg',\n  'meeting:LongChat': 'noun_1689339.svg',\n  'meeting:Meeting': 'noun_66617.svg',\n  'meeting:Project': 'noun_1036577.svg',\n  'ui:Form': 'noun_122196.svg',\n  'rdfs:Class': 'class-rectangle.svg', // For RDF developers\n  'rdf:Property': 'property-diamond.svg',\n  'owl:Ontology': 'noun_classification_1479198.svg',\n  'wf:Tracker': 'noun_122196.svg',\n  'wf:Task': 'noun_17020_gray-tick.svg',\n  'wf:Open': 'noun_17020_sans-tick.svg',\n  'wf:Closed': 'noun_17020.svg'\n}\n\n/**\n * Returns the origin of the URI of a NamedNode\n */\nfunction tempSite (x: NamedNode) {\n  // use only while one in rdflib fails with origins 2019\n  const str = x.uri.split('#')[0]\n  const p = str.indexOf('//')\n  if (p < 0) throw new Error('This URI does not have a web site part (origin)')\n  const q = str.indexOf('/', p + 2)\n  if (q < 0) {\n    // no third slash?\n    return str.slice(0) + '/' // Add slash to a bare origin\n  } else {\n    return str.slice(0, q + 1)\n  }\n}\n\n/**\n * Find an image for this thing as a class\n */\nexport function findImageFromURI (x: NamedNode | string): string | null {\n  const iconDir = iconBase\n\n  // Special cases from URI scheme:\n  if (typeof x !== 'string' && x.uri) {\n    if (\n      x.uri.split('/').length === 4 &&\n      !x.uri.split('/')[1] &&\n      !x.uri.split('/')[3]\n    ) {\n      return iconDir + 'noun_15177.svg' // App -- this is an origin\n    }\n    // Non-HTTP URI types imply types\n    if (x.uri.startsWith('message:') || x.uri.startsWith('mid:')) {\n      // message: is apple bug-- should be mid:\n      return iconDir + 'noun_480183.svg' // envelope  noun_567486\n    }\n    if (x.uri.startsWith('mailto:')) {\n      return iconDir + 'noun_567486.svg' // mailbox - an email desitination\n    }\n    // For HTTP(s) documents, we could look at the MIME type if we know it.\n    if (x.uri.startsWith('https:') && x.uri.indexOf('#') < 0) {\n      return tempSite(x) + 'favicon.ico' // was x.site().uri + ...\n      // Todo: make the document icon a fallback for if the favicon does not exist\n      // todo: pick up a possible favicon for the web page itself from a link\n      // was: return iconDir + 'noun_681601.svg' // document - under solid assumptions\n    }\n    return null\n  }\n\n  return iconDir + 'noun_10636_grey.svg' // Grey Circle -  some thing\n}\n\n/**\n * Find something we have as explicit image data for the thing\n * See also [[imagesOf]]\n * @param thing The thing for which we want to find an image\n * @returns The URL of a globe icon if thing equals `ns.foaf('Agent')`\n *          or `ns.rdf('Resource')`. Otherwise, it goes looking for\n *          triples in `store`,\n *          `(subject: thing), (predicate: see list below) (object: image-url)`\n *          to find any image linked from the thing with one of the following\n *          predicates (in order):\n *          * ns.sioc('avatar')\n *          * ns.foaf('img')\n *          * ns.vcard('logo')\n *          * ns.vcard('hasPhoto')\n *          * ns.vcard('photo')\n *          * ns.foaf('depiction')\n */\nexport function findImage (thing: NamedNode): string {\n  const kb = store\n  const iconDir = iconBase\n  if (thing.sameTerm(ns.foaf('Agent')) || thing.sameTerm(ns.rdf('Resource'))) {\n    return iconDir + 'noun_98053.svg' // Globe\n  }\n  const image =\n    kb.any(thing, ns.sioc('avatar')) ||\n    kb.any(thing, ns.foaf('img')) ||\n    kb.any(thing, ns.vcard('logo')) ||\n    kb.any(thing, ns.vcard('hasPhoto')) ||\n    kb.any(thing, ns.vcard('photo')) ||\n    kb.any(thing, ns.foaf('depiction'))\n  return image ? (image as any).uri : null as any\n}\n\n/**\n * Do the best you can with the data available\n *\n * @return {Boolean} Are we happy with this icon?\n * Sets src AND STYLE of the image.\n */\nfunction trySetImage (element, thing, iconForClassMap) {\n  const kb = store\n\n  const explitImage = findImage(thing)\n  if (explitImage) {\n    element.setAttribute('src', explitImage)\n    return true\n  }\n  // This is one of the classes we know about - the class itself?\n  const typeIcon = iconForClassMap[thing.uri]\n  if (typeIcon) {\n    element.setAttribute('src', typeIcon)\n    element.style = style.classIconStyle\n    // element.style.border = '0.1em solid green;'\n    // element.style.backgroundColor = '#eeffee' // pale green\n    return true\n  }\n  const schemeIcon = findImageFromURI(thing)\n  if (schemeIcon) {\n    element.setAttribute('src', schemeIcon)\n    return true // happy with this -- don't look it up\n  }\n\n  // Do we have a generic icon for something in any class its in?\n  const types = kb.findTypeURIs(thing)\n  for (const typeURI in types) {\n    if (iconForClassMap[typeURI]) {\n      element.setAttribute('src', iconForClassMap[typeURI])\n      return false // maybe we can do better\n    }\n  }\n  element.setAttribute('src', iconBase + 'noun_10636_grey.svg') // Grey Circle -  some thing\n  return false // we can do better\n}\n\n/**\n * ToDo: Also add icons for *properties* like  home, work, email, range, domain, comment,\n */\nexport function setImage (element: HTMLElement, thing: NamedNode) { // 20191230a\n  const kb = store\n\n  const iconForClassMap = {}\n  for (const k in iconForClass) {\n    const pref = k.split(':')[0]\n    const id = k.split(':')[1]\n    const theClass = ns[pref](id)\n    iconForClassMap[theClass.uri] = uri.join(iconForClass[k], iconBase)\n  }\n\n  const happy = trySetImage(element, thing, iconForClassMap)\n  if (!happy && thing.uri) {\n    if (!kb.fetcher) {\n      throw new Error('kb has no fetcher')\n    }\n    kb.fetcher.nowOrWhenFetched(thing.doc(), undefined, (ok) => {\n      if (ok) {\n        trySetImage(element, thing, iconForClassMap)\n      }\n    })\n  }\n}\n\n// If a web page, then a favicon, with a fallback to ???\n// See, e.g., http://stackoverflow.com/questions/980855/inputting-a-default-image\nexport function faviconOrDefault (dom: HTMLDocument, x: NamedNode) {\n  const image = dom.createElement('img')\n  ;(image as any).style = style.iconStyle\n  const isOrigin = function (x) {\n    if (!x.uri) return false\n    const parts = x.uri.split('/')\n    return parts.length === 3 || (parts.length === 4 && parts[3] === '')\n  }\n  image.setAttribute(\n    'src',\n    iconBase + (isOrigin(x) ? 'noun_15177.svg' : 'noun_681601.svg') // App symbol vs document\n  )\n  if (x.uri && x.uri.startsWith('https:') && x.uri.indexOf('#') < 0) {\n    const res = dom.createElement('object') // favico with a fallback of a default image if no favicon\n    res.setAttribute('data', tempSite(x) + 'favicon.ico')\n    res.setAttribute('type', 'image/x-icon')\n    res.appendChild(image) // fallback\n    return res\n  } else {\n    setImage(image, x)\n    return image\n  }\n}\n\n/* Two-option dialog pop-up\n*/\n\nfunction renderDeleteConfirmPopup (dom, refererenceElement, prompt, deleteFunction) {\n  function removePopup () {\n    refererenceElement.parentElement.removeChild(refererenceElement)\n  }\n  function removePopupAndDoDeletion () {\n    removePopup()\n    deleteFunction()\n  }\n  const popup = dom.createElement('div')\n  popup.style = style.confirmPopupStyle\n  popup.style.position = 'absolute'\n  popup.style.top = '-1em' // try leaving original button clear\n\n  popup.style.display = 'grid'\n  popup.style.gridTemplateColumns = 'auto auto'\n  const affirm = dom.createElement('div')\n  affirm.style.gridColumn = '1/2'\n  affirm.style.gridRow = '1' // @@ sigh; TS. could pass number in fact\n  const cancel = dom.createElement('div')\n  cancel.style.gridColumn = '1/2'\n  cancel.style.gridRow = '2'\n\n  const xButton = cancelButton(dom, removePopup)\n  popup.appendChild(xButton)\n  xButton.style.gridColumn = '1'\n  xButton.style.gridRow = '2'\n\n  const cancelPrompt = popup.appendChild(dom.createElement('button'))\n  cancelPrompt.style = style.buttonStyle\n  cancelPrompt.style.gridRow = '2'\n  cancelPrompt.style.gridColumn = '2'\n  cancelPrompt.textContent = 'Cancel' // @@ I18n\n\n  const affirmIcon = button(dom, icons.iconBase + 'noun_925021.svg', 'Delete it') // trashcan\n  popup.appendChild(affirmIcon)\n  affirmIcon.style.gridRow = '1'\n  affirmIcon.style.gridColumn = '1'\n\n  const sureButtonElt = popup.appendChild(dom.createElement('button'))\n  sureButtonElt.style = style.buttonStyle\n  sureButtonElt.style.gridRow = '1'\n  sureButtonElt.style.gridColumn = '2'\n  sureButtonElt.textContent = prompt\n  popup.appendChild(sureButtonElt)\n\n  affirmIcon.addEventListener('click', removePopupAndDoDeletion)\n  sureButtonElt.addEventListener('click', removePopupAndDoDeletion)\n\n  // xButton.addEventListener('click', removePopup)\n  cancelPrompt.addEventListener('click', removePopup)\n\n  return popup\n}\n/**\n * Delete button with a check you really mean it\n * @@ Supress check if command key held down?\n */\nexport function deleteButtonWithCheck (\n  dom: HTMLDocument,\n  container: HTMLElement,\n  noun: string,\n  deleteFunction: () => any\n) {\n  function createPopup () {\n    const refererenceElement = dom.createElement('div')\n    container.insertBefore(refererenceElement, deleteButton)\n    refererenceElement.style.position = 'relative' // Needed as reference for popup\n    refererenceElement.appendChild(renderDeleteConfirmPopup(dom, refererenceElement, prompt, deleteFunction))\n  }\n  const minusIconURI = iconBase + 'noun_2188_red.svg' // white minus in red #cc0000 circle\n  const deleteButton = dom.createElement('img')\n  deleteButton.setAttribute('src', minusIconURI)\n\n  deleteButton.setAttribute('style', style.smallButtonStyle) // @@tsc - would set deleteButton.style\n  deleteButton.style.float = 'right' // Historically this has alwaus floated right\n\n  const prompt = 'Remove this ' + noun\n  deleteButton.title = prompt\n  // @@ In an ideal world, make use of hover an accessibility option\n  deleteButton.classList.add('hoverControlHide')\n\n  deleteButton.addEventListener('click', createPopup)\n\n  container.classList.add('hoverControl')\n  container.appendChild(deleteButton)\n  deleteButton.setAttribute('data-testid', 'deleteButtonWithCheck')\n  return deleteButton // or button div?  caller may change size of image\n}\n\n/*  Make a button\n *\n * @param dom - the DOM document object\n * @Param iconURI - the URI of the icon to use (if any)\n * @param text - the tooltip text or possibly button contents text\n * @param handler <function> - A handler to called when button is clicked\n *\n * @returns <dDomElement> - the button\n */\nexport function button (dom: HTMLDocument, iconURI: string | undefined, text: string,\n  handler?: (_event: any) => void,\n  options: ButtonWidgetOptions = { buttonColor: 'Primary', needsBorder: false }) {\n  const button = dom.createElement('button')\n  button.setAttribute('type', 'button')\n  // button.innerHTML = text  // later, user preferences may make text preferred for some\n  if (iconURI) {\n    const img = button.appendChild(dom.createElement('img'))\n    img.setAttribute('src', iconURI)\n    img.setAttribute('style', 'width: 2em; height: 2em;') // trial and error. 2em disappears\n    img.title = text\n    button.setAttribute('style', style.buttonStyle)\n  } else {\n    button.textContent = text.toLocaleUpperCase()\n\n    button.onmouseover = function () {\n      if (options.buttonColor === 'Secondary') {\n        if (options.needsBorder) {\n          button.setAttribute('style', style.secondaryButtonNoBorderHover)\n        } else {\n          button.setAttribute('style', style.secondaryButtonHover)\n        }\n      } else {\n        if (options.needsBorder) {\n          button.setAttribute('style', style.primaryButtonNoBorderHover)\n        } else {\n          button.setAttribute('style', style.primaryButtonHover)\n        }\n      }\n    }\n    button.onmouseout = function () {\n      if (options.buttonColor === 'Secondary') {\n        if (options.needsBorder) {\n          button.setAttribute('style', style.secondaryButtonNoBorder)\n        } else {\n          button.setAttribute('style', style.secondaryButton)\n        }\n      } else {\n        if (options.needsBorder) {\n          button.setAttribute('style', style.primaryButtonNoBorder)\n        } else {\n          button.setAttribute('style', style.primaryButton)\n        }\n      }\n    }\n\n    if (options.buttonColor === 'Secondary') {\n      if (options.needsBorder) {\n        button.setAttribute('style', style.secondaryButtonNoBorder)\n      } else {\n        button.setAttribute('style', style.secondaryButton)\n      }\n    } else {\n      if (options.needsBorder) {\n        button.setAttribute('style', style.primaryButtonNoBorder)\n      } else {\n        button.setAttribute('style', style.primaryButton)\n      }\n    }\n  }\n\n  if (handler) {\n    button.addEventListener('click', handler, false)\n  }\n  return button\n}\n\n/*  Make a cancel button\n *\n * @param dom - the DOM document object\n * @param handler <function> - A handler to called when button is clicked\n *\n * @returns <dDomElement> - the button\n */\nexport function cancelButton (dom: HTMLDocument, handler: (_event?: any) => void) {\n  const b = button(dom, cancelIconURI, 'Cancel', handler)\n  if (b.firstChild) { // sigh for tsc\n    (b.firstChild as HTMLElement).style.opacity = '0.3' // Black X is too harsh: current language is grey X\n  }\n  return b\n}\n\n/*  Make a continue button\n *\n * @param dom - the DOM document object\n * @param handler <function> - A handler to called when button is clicked\n *\n * @returns <dDomElement> - the button\n */\nexport function continueButton (dom: HTMLDocument, handler: (_event: any) => void) {\n  return button(dom, checkIconURI, 'Continue', handler)\n}\n\n/* Grab a name for a new thing\n *\n * Form to get the name of a new thing before we create it\n * @params theClass  Misspelt to avoid clashing with the JavaScript keyword\n * @returns: a promise of (a name or null if cancelled)\n */\nexport function askName (\n  dom: HTMLDocument,\n  kb: IndexedFormula,\n  container: HTMLDivElement,\n  predicate?: NamedNode,\n  theClass?: NamedNode,\n  noun?: string) {\n  return new Promise(function (resolve, _reject) {\n    const form = dom.createElement('div') // form is broken as HTML behaviour can resurface on js error\n    // classLabel = utils.label(ns.vcard('Individual'))\n    predicate = predicate || ns.foaf('name') // eg 'name' in user's language\n    noun = noun || (theClass ? utils.label(theClass) : '  ') // eg 'folder' in users's language\n    const prompt = noun + ' ' + utils.label(predicate) + ': '\n    form.appendChild(dom.createElement('p')).textContent = prompt\n    const namefield = dom.createElement('input')\n    namefield.setAttribute('type', 'text')\n    namefield.setAttribute('size', '100')\n    namefield.setAttribute('maxLength', '2048') // No arbitrary limits\n    namefield.setAttribute('style', style.textInputStyle)\n    namefield.select() // focus next user input\n    form.appendChild(namefield)\n    container.appendChild(form)\n\n    // namefield.focus()\n\n    function gotName () {\n      ((form as HTMLElement).parentNode as HTMLElement).removeChild(form)\n      resolve(namefield.value.trim())\n    }\n\n    namefield.addEventListener('keyup', function (e) {\n      if (e.keyCode === 13) {\n        gotName()\n      }\n    }, false)\n\n    form.appendChild(dom.createElement('br'))\n\n    form.appendChild(cancelButton(dom, function (_event) {\n      ((form as HTMLElement).parentNode as HTMLElement).removeChild(form)\n      resolve(null)\n    }))\n\n    form.appendChild(continueButton(dom, function (_event) {\n      gotName()\n    }))\n    namefield.focus()\n  }) // Promise\n}\n\n/**\n * A TR to represent a draggable person, etc in a list\n *\n * pred is unused param at the moment\n */\nexport const personTR = renderAsRow // The legacy name is used in a lot of places\n\nexport function renderAsRow (dom: HTMLDocument, pred: NamedNode, obj: NamedNode, options: any): HTMLTableRowElement {\n  const tr = dom.createElement('tr')\n  options = options || {}\n  // tr.predObj = [pred.uri, obj.uri]   moved to acl-control\n  const td1 = tr.appendChild(dom.createElement('td'))\n  const td2 = tr.appendChild(dom.createElement('td'))\n  const td3 = tr.appendChild(dom.createElement('td'))\n\n  // const image = td1.appendChild(dom.createElement('img'))\n  const image = options.image || faviconOrDefault(dom, obj)\n\n  td1.setAttribute('style', 'vertical-align: middle; width:2.5em; padding:0.5em; height: 2.5em;')\n  td2.setAttribute('style', 'vertical-align: middle; text-align:left;')\n  td3.setAttribute('style', 'vertical-align: middle; width:2em; padding:0.5em; height: 4em;')\n  td1.appendChild(image)\n\n  if (options.title) {\n    td2.textContent = options.title\n  } else {\n    setName(td2, obj) // This is async\n  }\n\n  if (options.deleteFunction) {\n    deleteButtonWithCheck(dom, td3, options.noun || 'one', options.deleteFunction)\n  }\n  if (obj.uri) {\n    // blank nodes need not apply\n    if (options.link !== false) {\n      const anchor = td3.appendChild(linkIcon(dom, obj))\n      anchor.classList.add('HoverControlHide')\n      td3.appendChild(dom.createElement('br'))\n    }\n    if (options.draggable !== false) {\n      // default is on\n      image.setAttribute('draggable', 'false') // Stop the image being dragged instead - just the TR\n      makeDraggable(tr, obj)\n    }\n  }\n  ;(tr as any).subject = obj\n  return tr\n}\n\n/* A helper function for renderAsDiv\n*  creates the NameDiv for the person\n*  Note: could not move it to the helper file because they call exported functions\n*  from buttons\n*  @internal exporting this only for unit tests\n*/\nexport function createNameDiv (dom: HTMLDocument, div: HTMLDivElement, title: string | undefined, obj: NamedNode) {\n  const nameDiv = div.appendChild(dom.createElement('div'))\n  if (title) {\n    nameDiv.textContent = title\n  } else {\n    setName(nameDiv, obj) // This is async\n  }\n}\n/* A helper function for renderAsDiv\n*  creates the linkDiv for the person\n*  Note: could not move it to the helper file because they call exported functions\n*  from buttons\n* @internal exporting this only for unit tests\n*/\nexport function createLinkDiv (dom: HTMLDocument, div: HTMLDivElement, obj: NamedNode, options: RenderAsDivOptions) {\n  const linkDiv = div.appendChild(dom.createElement('div'))\n  linkDiv.setAttribute('style', style.linkDivStyle)\n\n  if (options.deleteFunction) {\n    deleteButtonWithCheck(dom, linkDiv, options.noun || 'one', options.deleteFunction)\n  }\n\n  if (obj.uri) {\n    // blank nodes need not apply\n    if (options.link !== false) {\n      createLinkForURI(dom, linkDiv, obj)\n    }\n\n    makeDraggable(div, obj)\n  }\n}\n/**\n * A Div to represent a draggable person, etc in a list\n * configurable to add an onClick listener\n */\nexport function renderAsDiv (dom: HTMLDocument, obj: NamedNode, options: RenderAsDivOptions): HTMLElement {\n  const div = dom.createElement('div')\n  div.setAttribute('style', style.renderAsDivStyle)\n\n  options = options || {}\n  const image = options.image || faviconOrDefault(dom, obj)\n  createImageDiv(dom, div, image)\n  createNameDiv(dom, div, options.title, obj)\n  createLinkDiv(dom, div, obj, options)\n\n  if (options.clickable && options.onClickFunction) {\n    addClickListenerToElement(div, options.onClickFunction)\n  }\n\n  // to be compatible with the SolidOS table layout\n  if (options.wrapInATR) {\n    const tr = wrapDivInATR(dom, div, obj)\n    return tr\n  }\n  return div\n}\n\n/**\n * Refresh a DOM tree recursively\n */\nexport function refreshTree (root: any): void {\n  if (root.refresh) {\n    root.refresh()\n    return\n  }\n  for (let i = 0; i < root.children.length; i++) {\n    refreshTree(root.children[i])\n  }\n}\n\n/**\n * Options argument for [[attachmentList]] function\n */\nexport type attachmentListOptions = {\n  doc?: NamedNode\n  modify?: boolean\n  promptIcon?: string\n  predicate?: NamedNode\n  uploadFolder?: NamedNode\n  noun?: string\n}\n\n/**\n * Component that displays a list of resources, for instance\n * the attachments of a message, or the various documents related\n * to a meeting.\n * Accepts dropping URLs onto it to add attachments to it.\n */\nexport function attachmentList (dom: HTMLDocument, subject: NamedNode, div: HTMLElement, options: attachmentListOptions = {}) {\n  // options = options || {}\n\n  const deleteAttachment = function (target) {\n    if (!kb.updater) {\n      throw new Error('kb has no updater')\n    }\n\n    kb.updater.update(st(subject, predicate, target, doc) as any, [], function (\n      uri,\n      ok,\n      errorBody,\n      _xhr\n    ) {\n      if (ok) {\n        refresh()\n      } else {\n        complain(undefined, 'Error deleting one: ' + errorBody)\n      }\n    })\n  }\n\n  function createNewRow (target) {\n    const theTarget = target\n    const opt: any = { noun }\n    if (modify) {\n      opt.deleteFunction = function () {\n        deleteAttachment(theTarget)\n      }\n    }\n    return personTR(dom, predicate, target, opt)\n  }\n\n  const refresh = function () {\n    const things = kb.each(subject, predicate)\n    things.sort()\n    utils.syncTableToArray(attachmentTable, things, createNewRow)\n  }\n\n  function droppedURIHandler (uris) {\n    const ins: any = []\n    uris.forEach(function (u) {\n      const target = sym(u) // Attachment needs text label to disinguish I think not icon.\n      debug.log('Dropped on attachemnt ' + u) // icon was: iconBase + 'noun_25830.svg'\n      ins.push(st(subject, predicate, target, doc))\n    })\n    if (!kb.updater) {\n      throw new Error('kb has no updater')\n    }\n\n    kb.updater.update([], ins, function (uri, ok, errorBody, _xhr) {\n      if (ok) {\n        refresh()\n      } else {\n        complain(undefined, 'Error adding one: ' + errorBody)\n      }\n    })\n  }\n\n  function droppedFileHandler (files) {\n    uploadFiles(\n      kb.fetcher,\n      files,\n      options.uploadFolder?.uri, // Files\n      options.uploadFolder?.uri, // Pictures\n      function (theFile, destURI) {\n        const ins = [st(subject, predicate, kb.sym(destURI), doc)]\n        if (!kb.updater) {\n          throw new Error('kb has no updater')\n        }\n        kb.updater.update([], ins, function (uri, ok, errorBody, _xhr) {\n          if (ok) {\n            refresh()\n          } else {\n            complain(undefined, 'Error adding link to uploaded file: ' + errorBody)\n          }\n        })\n      }\n    )\n  }\n\n  const doc = options.doc || subject.doc()\n  if (options.modify === undefined) options.modify = true\n  const modify = options.modify\n  const promptIcon: string = options.promptIcon || (iconBase + 'noun_748003.svg' as string) //    target\n  // const promptIcon = options.promptIcon || (iconBase + 'noun_25830.svg') //  paperclip\n  const predicate = options.predicate || ns.wf('attachment')\n  const noun = options.noun || 'attachment'\n\n  const kb = store\n  const attachmentOuter = div.appendChild(dom.createElement('table'))\n  attachmentOuter.setAttribute('style', 'margin-top: 1em; margin-bottom: 1em;')\n  const attachmentOne = attachmentOuter.appendChild(dom.createElement('tr'))\n  const attachmentLeft = attachmentOne.appendChild(dom.createElement('td'))\n  const attachmentRight = attachmentOne.appendChild(dom.createElement('td'))\n  const attachmentTable = attachmentRight.appendChild(dom.createElement('table'))\n  attachmentTable.appendChild(dom.createElement('tr')) // attachmentTableTop\n\n  ;(attachmentOuter as any).refresh = refresh // Participate in downstream changes\n  // ;(attachmentTable as any).refresh = refresh   <- outer should be best?\n\n  refresh()\n\n  if (modify) {\n    // const buttonStyle = 'width; 2em; height: 2em; margin: 0.5em; padding: 0.1em;'\n    const paperclip = button(dom, promptIcon, 'Drop attachments here')\n    // paperclip.style = buttonStyle // @@ needed?  default has white background\n    attachmentLeft.appendChild(paperclip)\n    const fhandler = options.uploadFolder ? droppedFileHandler : null\n    makeDropTarget(paperclip, droppedURIHandler, fhandler) // beware missing the wire of the paparclip!\n    makeDropTarget(attachmentLeft, droppedURIHandler, fhandler) // just the outer won't do it\n\n    if (options.uploadFolder) { // Addd an explicit file upload button as well\n      const buttonDiv = fileUploadButtonDiv(dom, droppedFileHandler)\n      attachmentLeft.appendChild(buttonDiv)\n      // buttonDiv.children[1].style =  buttonStyle\n    }\n  }\n  return attachmentOuter\n}\n\n// /////////////////////////////////////////////////////////////////////////////\n\n/**\n * Event Handler for links within solid apps.\n *\n * Note that native links have constraints in Firefox, they\n * don't work with local files for instance (2011)\n */\nexport function openHrefInOutlineMode (e: Event) {\n  e.preventDefault()\n  e.stopPropagation()\n  const target = utils.getTarget(e)\n  const uri = target.getAttribute('href')\n  if (!uri) return debug.log('openHrefInOutlineMode: No href found!\\n')\n  const dom = window.document\n  if ((dom as any).outlineManager) {\n    // @@ TODO Remove the use of document as a global object\n    // TODO fix dependency cycle to solid-panes by calling outlineManager\n    ;(dom as any).outlineManager.GotoSubject(store.sym(uri), true, undefined, true, undefined)\n  } else if (window && (window as any).panes && (window as any).panes.getOutliner) {\n    // @@ TODO Remove the use of window as a global object\n    ;(window as any).panes\n      .getOutliner()\n      .GotoSubject(store.sym(uri), true, undefined, true, undefined)\n  } else {\n    debug.log('ERROR: Can\\'t access outline manager in this config')\n  }\n  // dom.outlineManager.GotoSubject(store.sym(uri), true, undefined, true, undefined)\n}\n\n/**\n * Make a URI in the Tabulator.org annotation store out of the URI of the thing to be annotated.\n *\n * @@ Todo: make it a personal preference.\n */\nexport function defaultAnnotationStore (subject:NamedNode):NamedNode | undefined {\n  if (subject.uri === undefined) return undefined\n  let s = subject.uri\n  if (s.slice(0, 7) !== 'http://') return undefined\n  s = s.slice(7) // Remove\n  const hash = s.indexOf('#')\n  if (hash >= 0) s = s.slice(0, hash)\n  // Strip trailing\n  else {\n    const slash = s.lastIndexOf('/')\n    if (slash < 0) return undefined\n    s = s.slice(0, slash)\n  }\n  return store.sym('http://tabulator.org/wiki/annnotation/' + s)\n}\n\n/**\n * Retrieve all RDF class URIs from solid-ui's RDF store\n * @returns an object `ret` such that `Object.keys(ret)` is\n * the list of all class URIs.\n */\nexport function allClassURIs (): { [uri: string]: boolean } {\n  const set = {}\n  store\n    .statementsMatching(undefined, ns.rdf('type'), undefined)\n    .forEach(function (st) {\n      if (st.object.value) set[st.object.value] = true\n    })\n  store\n    .statementsMatching(undefined, ns.rdfs('subClassOf'), undefined)\n    .forEach(function (st) {\n      if (st.object.value) set[st.object.value] = true\n      if (st.subject.value) set[st.subject.value] = true\n    })\n  store\n    .each(undefined, ns.rdf('type'), ns.rdfs('Class'))\n    .forEach(function (c) {\n      if (c.value) set[c.value] = true\n    })\n  return set\n}\n\n/**\n * Figuring which properties we know about\n *\n * When the user inputs an RDF property, like for a form field\n * or when specifying the relationship between two arbitrary things,\n * then er can prompt them with properties the session knows about\n *\n * TODO: Look again by catching this somewhere. (On the kb?)\n * TODO: move to diff module? Not really a button.\n * @param {Store} kb The quadstore to be searched.\n */\n\nexport function propertyTriage (kb: IndexedFormula): any {\n  const possibleProperties: any = {}\n  // if (possibleProperties === undefined) possibleProperties = {}\n  // const kb = store\n  const dp = {}\n  const op = {}\n  let no = 0\n  let nd = 0\n  let nu = 0\n  const pi = (kb as any).predicateIndex // One entry for each pred\n  for (const p in pi) {\n    const object = pi[p][0].object\n    if (object.termType === 'Literal') {\n      dp[p] = true\n      nd++\n    } else {\n      op[p] = true\n      no++\n    }\n  } // If nothing discovered, then could be either:\n  const ps = kb.each(undefined, ns.rdf('type'), ns.rdf('Property'))\n  for (let i = 0; i < ps.length; i++) {\n    const p = ps[i].toNT()\n    if (!op[p] && !dp[p]) {\n      dp[p] = true\n      op[p] = true\n      nu++\n    }\n  }\n  possibleProperties.op = op\n  possibleProperties.dp = dp\n  info(`propertyTriage: ${no} non-lit, ${nd} literal. ${nu} unknown.`)\n  return possibleProperties\n}\n\n/**\n * General purpose widgets\n */\n\n/**\n * A button for jumping\n */\nexport function linkButton (dom: HTMLDocument, object: NamedNode): HTMLElement {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.textContent = 'Goto ' + utils.label(object)\n  b.addEventListener('click', function (_event) {\n    // b.parentNode.removeChild(b)\n    // TODO fix dependency cycle to solid-panes by calling outlineManager\n    ;(dom as any).outlineManager.GotoSubject(object, true, undefined, true, undefined)\n  }, true)\n  return b\n}\n\n/**\n * A button to remove some other element from the page\n */\nexport function removeButton (dom: HTMLDocument, element: HTMLElement) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.textContent = '' // MULTIPLICATION X\n  b.addEventListener('click', function (_event) {\n    ;(element as any).parentNode.removeChild(element)\n  }, true)\n  return b\n}\n\n//      Description text area\n//\n// Make a box to demand a description or display existing one\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param store - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n\n// /////////////////////////////////////// Random I/O widgets /////////////\n\n// ////              Column Header Buttons\n//\n//  These are for selecting different modes, sources,styles, etc.\n//\n/*\nbuttons.headerButtons = function (dom, kb, name, words) {\n    const box = dom.createElement('table')\n    var i, word, s = '<tr>'\n    box.setAttribute('style', 'width: 90%; height: 1.5em')\n    for (i=0; i<words.length; i++) {\n        s += '<td><input type=\"radio\" name=\"' + name + '\" id=\"' + words[i] + '\" value='\n    }\n    box.innerHTML = s + '</tr>'\n\n}\n*/\n// ////////////////////////////////////////////////////////////\n//\n//     selectorPanel\n//\n//  A vertical panel for selecting connections to left or right.\n//\n//   @param inverse means this is the object rather than the subject\n//\nexport function selectorPanel (\n  dom: HTMLDocument,\n  kb: IndexedFormula,\n  type: NamedNode,\n  predicate: NamedNode,\n  inverse: boolean,\n  possible: NamedNode[],\n  options: { connectIcon?: string },\n  callbackFunction: (_x: NamedNode, _e: Event, _selected: boolean) => void,\n  linkCallback: (_x: NamedNode, _e: Event, _inverse: boolean, _setStyleFunction: () => void) => void\n) {\n  return selectorPanelRefresh(\n    dom.createElement('div'),\n    dom,\n    kb,\n    type,\n    predicate,\n    inverse,\n    possible,\n    options,\n    callbackFunction,\n    linkCallback\n  )\n}\n\nexport function selectorPanelRefresh (\n  list: HTMLElement,\n  dom: HTMLDocument,\n  kb: IndexedFormula,\n  type: NamedNode,\n  predicate: NamedNode,\n  inverse: boolean,\n  possible: NamedNode[],\n  options: { connectIcon?: string },\n  callbackFunction: (_x: NamedNode, _e: Event, _selected: boolean) => void,\n  linkCallback: (_x: NamedNode, _e: Event, _inverse: boolean, _setStyleFunction: () => void) => void\n) {\n  const style0 =\n    'border: 0.1em solid #ddd; border-bottom: none; width: 95%; height: 2em; padding: 0.5em;'\n  let selected: any = null\n  list.innerHTML = ''\n\n  const refreshItem = function (box: HTMLElement, x: NamedNode) {\n    // Scope to hold item and x\n    let item: any\n    // eslint-disable-next-line prefer-const\n    let image: HTMLImageElement\n\n    const setStyle = function () {\n      const already = inverse\n        ? kb.each(undefined, predicate, x)\n        : kb.each(x, predicate)\n      iconDiv.setAttribute('class', already.length === 0 ? 'hideTillHover' : '') // See tabbedtab.css\n      image.setAttribute(\n        'src',\n        options.connectIcon || iconBase + 'noun_25830.svg'\n      )\n      image.setAttribute('title', already.length ? already.length : 'attach' as any)\n    }\n    const f = index.twoLine.widgetForClass(type)\n    // eslint-disable-next-line prefer-const\n    item = f(dom, x)\n    item.setAttribute('style', style0)\n\n    const nav = dom.createElement('div')\n    nav.setAttribute('class', 'hideTillHover') // See tabbedtab.css\n    nav.setAttribute('style', 'float:right; width:10%')\n\n    const a = dom.createElement('a')\n    a.setAttribute('href', x.uri)\n    a.setAttribute('style', 'float:right')\n    nav.appendChild(a).textContent = '>'\n    box.appendChild(nav)\n\n    const iconDiv = dom.createElement('div')\n    iconDiv.setAttribute(\n      'style',\n      (inverse ? 'float:left;' : 'float:right;') + ' width:30px;'\n    )\n    image = dom.createElement('img')\n    setStyle()\n    iconDiv.appendChild(image)\n    box.appendChild(iconDiv)\n\n    item.addEventListener('click', function (event) {\n      if (selected === item) {\n        // deselect\n        item.setAttribute('style', style0)\n        selected = null\n      } else {\n        if (selected) selected.setAttribute('style', style0)\n        item.setAttribute(\n          'style',\n          style0 + 'background-color: #ccc; color:black;'\n        )\n        selected = item\n      }\n      callbackFunction(x, event, selected === item)\n      setStyle()\n    }, false)\n\n    image.addEventListener('click', function (event) {\n      linkCallback(x, event, inverse, setStyle)\n    }, false)\n\n    box.appendChild(item)\n    return box\n  }\n\n  for (let i = 0; i < possible.length; i++) {\n    const box = dom.createElement('div')\n    list.appendChild(box)\n    refreshItem(box, possible[i])\n  }\n  return list\n}\n\n// ###########################################################################\n//\n//      Small compact views of things\n//\nexport let index: any = {}\n// ///////////////////////////////////////////////////////////////////////////\n// We need these for anything which is a subject of an attachment.\n//\n// These should be moved to type-dependeent UI code. Related panes maybe\n\nfunction twoLineDefault (dom: HTMLDocument, x: NamedNode): HTMLElement {\n  // Default\n  const box = dom.createElement('div')\n  box.textContent = utils.label(x)\n  return box\n}\n\n/**\n * Find a function that can create a widget for a given class\n * @param c The RDF class for which we want a widget generator function\n */\nfunction twoLineWidgetForClass (c: NamedNode): (_dom: HTMLDocument, _x: NamedNode) => HTMLElement {\n  let widget = index.twoLine[c.uri]\n  const kb = store\n  if (widget) return widget\n  const sup = kb.findSuperClassesNT(c)\n  for (const cl in sup) {\n    widget = index.twoLine[kb.fromNT(cl).uri]\n    if (widget) return widget\n  }\n  return index.twoLine['']\n}\n\n/**\n * Display a transaction\n * @param x Should have attributes through triples in store:\n *          * ns.qu('payee') -> a named node\n *          * ns.qu('date) -> a literal\n *          * ns.qu('amount') -> a literal\n */\nfunction twoLineTransaction (dom: HTMLDocument, x: NamedNode): HTMLElement {\n  let failed = ''\n  const enc = function (p) {\n    const y = store.any(x, ns.qu(p))\n    if (!y) failed += '@@ No value for ' + p + '! '\n    return y ? utils.escapeForXML(y.value) : '?' // @@@@\n  }\n  const box = dom.createElement('table')\n  box.innerHTML = `\n      <tr>\n      <td colspan=\"2\"> ${enc('payee')}</td>\n      < /tr>\n      < tr >\n      <td>${enc('date').slice(0, 10)}</td>\n      <td style = \"text-align: right;\">${enc('amount')}</td>\n      </tr>`\n  if (failed) {\n    box.innerHTML = `\n      <tr>\n        <td><a href=\"${utils.escapeForXML(x.uri)}\">${utils.escapeForXML(failed)}</a></td>\n      </tr>`\n  }\n  return box\n}\n\n/**\n * Display a trip\n * @param x Should have attributes through triples in store:\n *          * ns.dc('title') -> a literal\n *          * ns.cal('dtstart') -> a literal\n *          * ns.cal('dtend') -> a literal\n */\nfunction twoLineTrip (\n  dom: HTMLDocument,\n  x: NamedNode\n): HTMLElement {\n  const enc = function (p) {\n    const y = store.any(x, p)\n    return y ? utils.escapeForXML(y.value) : '?'\n  }\n  const box = dom.createElement('table')\n  box.innerHTML = `\n    <tr>\n      <td colspan=\"2\">${enc(ns.dc('title'))}</td>\n    </tr>\n    <tr style=\"color: #777\">\n      <td>${enc(ns.cal('dtstart'))}</td>\n      <td>${enc(ns.cal('dtend'))}</td>\n    </tr>`\n  return box\n}\n\n/**\n * Stick a stylesheet link the document if not already there\n */\nexport function addStyleSheet (dom: HTMLDocument, href: string): void {\n  const links = dom.querySelectorAll('link')\n  for (let i = 0; i < links.length; i++) {\n    if (\n      (links[i].getAttribute('rel') || '') === 'stylesheet' &&\n      (links[i].getAttribute('href') || '') === href\n    ) {\n      return\n    }\n  }\n  const link = dom.createElement('link')\n  link.setAttribute('rel', 'stylesheet')\n  link.setAttribute('type', 'text/css')\n  link.setAttribute('href', href)\n  dom.getElementsByTagName('head')[0].appendChild(link)\n}\n\n// Figure (or guess) whether this is an image, etc\n//\nexport function isAudio (file?: NamedNode) {\n  return isImage(file, 'audio')\n}\nexport function isVideo (file?: NamedNode) {\n  return isImage(file, 'video')\n}\n/**\n *\n */\nexport function isImage (file?: NamedNode, kind?: string): boolean {\n  const dcCLasses = {\n    audio: 'http://purl.org/dc/dcmitype/Sound',\n    image: 'http://purl.org/dc/dcmitype/Image',\n    video: 'http://purl.org/dc/dcmitype/MovingImage'\n  }\n  const what = kind || 'image'\n  // See https://github.com/linkeddata/rdflib.js/blob/e367d5088c/src/formula.ts#L554\n  //\n  const typeURIs = store.findTypeURIs(file as any)\n  // See https://github.com/linkeddata/rdflib.js/blob/d5000f/src/utils-js.js#L14\n  // e.g.'http://www.w3.org/ns/iana/media-types/audio'\n  const prefix: string = Util.mediaTypeClass(what + '/*').uri.split('*')[0]\n  for (const t in typeURIs) {\n    if (t.startsWith(prefix)) return true\n  }\n  if (dcCLasses[what] in typeURIs) return true\n  return false\n}\n\n/**\n * File upload button\n * @param dom The DOM aka document\n * @param  droppedFileHandler Same handler function as drop, takes array of file objects\n * @returns {Element} - a div with a button and a inout in it\n * The input is hidden, as it is uglky - the user clicks on the nice icons and fires the input.\n */\n// See https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\nexport function fileUploadButtonDiv (\n  dom: HTMLDocument,\n  droppedFileHandler: (_files: FileList) => void\n) {\n  const div = dom.createElement('div')\n  const input = div.appendChild(dom.createElement('input'))\n  input.setAttribute('type', 'file')\n  input.setAttribute('multiple', 'true')\n  input.addEventListener(\n    'change',\n    (event: any) => {\n      debug.log('File drop event: ', event)\n      if (event.files) {\n        droppedFileHandler(event.files)\n      } else if (event.target && event.target.files) {\n        droppedFileHandler(event.target.files)\n      } else {\n        alert('Sorry no files .. internal error?')\n      }\n    },\n    false\n  )\n\n  ;(input as any).style = 'display:none'\n  const buttonElt = div.appendChild(\n    button(\n      dom,\n      iconBase + 'noun_Upload_76574_000000.svg',\n      'Upload files',\n      _event => {\n        input.click()\n      }\n    )\n  )\n  makeDropTarget(buttonElt, null, droppedFileHandler) // Can also just drop on button\n  return div\n}\n\nindex = {\n  line: { // Approx 80em\n  },\n  twoLine: { // Approx 40em * 2.4em\n    '': twoLineDefault,\n    'http://www.w3.org/2000/10/swap/pim/qif#Transaction': twoLineTransaction,\n    'http://www.w3.org/ns/pim/trip#Trip': twoLineTrip,\n    widgetForClass: twoLineWidgetForClass\n  }\n}\n","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","/**\n * Provides a simple configuration object for Solid web client and other\n * modules.\n * @module config-default\n */\nexport default { // @@ should not use export default\n  /**\n   * Primary authentication endpoint\n   */\n  authEndpoint: '',\n\n  /**\n   * Fallback authentication endpoint\n   */\n  fallbackAuthEndpoint: 'https://databox.me/',\n\n  /**\n   * Default signup endpoints (list of identity providers)\n   */\n  signupEndpoint: 'https://solidproject.org/use-solid/',\n\n  /**\n   * Default height of the Signup popup window, in pixels\n   */\n  signupWindowHeight: 600,\n\n  /**\n   * Default width of the Signup popup window, in pixels\n   */\n  signupWindowWidth: 1024,\n\n  /**\n   * Path to the client private key (only needed when running within node)\n   */\n  key: '',\n\n  /**\n   * Path to the client certificate (only needed when running within node)\n   */\n  cert: ''\n}\n","import defaultConfig from './config-default'\n\n/**\n * Provides functionality for signing up with a Solid provider\n * @module signup\n */\n\n/**\n * Creates a Signup UI manager\n * @class\n */\nexport function Signup (config) {\n  this.config = config || defaultConfig\n}\n\n/**\n * Sets up an event listener to monitor login messages from child window/iframe\n * @method listen\n * @return {Promise<String>} Event listener promise, resolves to user's WebID\n */\nSignup.prototype.listen = function listen () {\n  const promise = new Promise(function (resolve, reject) {\n    const eventMethod = window.addEventListener\n      ? 'addEventListener'\n      : 'attachEvent'\n    const eventListener = window[eventMethod]\n    const messageEvent = eventMethod === 'attachEvent'\n      ? 'onmessage'\n      : 'message'\n    eventListener(messageEvent, function (e) {\n      const u = e.data\n      if (u.slice(0, 5) === 'User:') {\n        const user = u.slice(5, u.length)\n        if (user && user.length > 0 && user.slice(0, 4) === 'http') {\n          return resolve(user)\n        } else {\n          return reject(user)\n        }\n      }\n    }, true)\n  })\n  return promise\n}\n\n/**\n * Opens a signup popup window, sets up `listen()`.\n * @method signup\n * @static\n * @param signupUrl {String} Location of a Solid server for user signup.\n * @return {Promise<String>} Returns a listener promise, resolves with signed\n *   up user's WebID.\n */\nSignup.prototype.signup = function signup (signupUrl) {\n  signupUrl = signupUrl || this.config.signupEndpoint\n  const width = this.config.signupWindowWidth\n  const height = this.config.signupWindowHeight\n  // set borders\n  const leftPosition = (window.screen.width / 2) - ((width / 2) + 10)\n  // set title and status bars\n  const topPosition = (window.screen.height / 2) - ((height / 2) + 50)\n  const windowTitle = 'Solid signup'\n  const windowUrl = signupUrl + '?origin=' +\n    encodeURIComponent(window.location.origin)\n  const windowSpecs = 'resizable,scrollbars,status,width=' + width + ',height=' +\n    height + ',left=' + leftPosition + ',top=' + topPosition\n  window.open(windowUrl, windowTitle, windowSpecs)\n  const self = this\n  return new Promise(function (resolve) {\n    self.listen()\n      .then(function (webid) {\n        return resolve(webid)\n      })\n  })\n}\n","import ns from '../../ns'\nimport { style } from '../../style'\n\nexport type FieldParamsObject = {\n  size?: number, // input element size attribute\n  type?: string, // input element type attribute. Default: 'text' (not for Comment and Heading)\n  element?: string, // element type to use (Comment and Heading only)\n  style?: string, // style to use\n  dt?: string, // xsd data type for the RDF Literal corresponding to the field value. Default: xsd:string\n  uriPrefix?: string, // e.g. 'mailto:', will be removed when displaying value to user. Overrides dt.\n  namedNode?: boolean, // if true, field value corresponds to the URI of an RDF NamedNode. Overrides dt and uriPrefix.\n  pattern?: RegExp // for client-side input validation; field will go red if violated, green if ok\n}\n\n/**\n * The fieldParams object defines various constants\n * for use in various form fields. Depending on the\n * field in questions, different values may be read\n * from here.\n */\nexport const fieldParams: { [ fieldUri: string ]: FieldParamsObject } = {\n  /**\n   * Text field\n   *\n   * For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n   * or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n   */\n  [ns.ui('ColorField').uri]: {\n    size: 9,\n    type: 'color',\n    style: 'height: 3em;', // around 1.5em is padding\n    dt: 'color',\n    pattern: /^\\s*#[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]([0-9a-f][0-9a-f])?\\s*$/\n  }, // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/color\n\n  [ns.ui('DateField').uri]: {\n    size: 20,\n    type: 'date',\n    dt: 'date',\n    pattern: /^\\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?Z?\\s*$/\n  },\n\n  [ns.ui('DateTimeField').uri]: {\n    size: 20,\n    type: 'datetime-local', // See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime\n    dt: 'dateTime',\n    pattern: /^\\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?(T[0-2][0-9]:[0-5][0-9](:[0-5][0-9])?)?Z?\\s*$/\n  },\n\n  [ns.ui('TimeField').uri]: {\n    size: 10,\n    type: 'time',\n    dt: 'time',\n    pattern: /^\\s*([0-2]?[0-9]:[0-5][0-9](:[0-5][0-9])?)\\s*$/\n  },\n\n  [ns.ui('IntegerField').uri]: {\n    size: 12,\n    style: 'text-align: right;',\n    dt: 'integer',\n    pattern: /^\\s*-?[0-9]+\\s*$/\n  },\n\n  [ns.ui('DecimalField').uri]: {\n    size: 12,\n    style: 'text-align: right;',\n    dt: 'decimal',\n    pattern: /^\\s*-?[0-9]*(\\.[0-9]*)?\\s*$/\n  },\n\n  [ns.ui('FloatField').uri]: {\n    size: 12,\n    style: 'text-align: right;',\n    dt: 'float',\n    pattern: /^\\s*-?[0-9]*(\\.[0-9]*)?((e|E)-?[0-9]*)?\\s*$/\n  },\n\n  [ns.ui('SingleLineTextField').uri]: {\n\n  },\n  [ns.ui('NamedNodeURIField').uri]: {\n    namedNode: true\n  },\n  [ns.ui('TextField').uri]: {\n\n  },\n\n  [ns.ui('PhoneField').uri]: {\n    size: 20,\n    uriPrefix: 'tel:',\n    pattern: /^\\+?[\\d-]+[\\d]*$/\n  },\n\n  [ns.ui('EmailField').uri]: {\n    size: 30,\n    uriPrefix: 'mailto:',\n    pattern: /^\\s*.*@.*\\..*\\s*$/ // @@ Get the right regexp here\n  },\n\n  [ns.ui('Group').uri]: {\n    style: style.formGroupStyle\n  },\n\n  /**\n   * Non-interactive fields\n   */\n  [ns.ui('Comment').uri]: {\n    element: 'p',\n    style: style.commentStyle\n  },\n  [ns.ui('Heading').uri]: {\n    element: 'h3',\n    style: style.formHeadingStyle\n  }\n}\n","import { Node } from 'rdflib'\nimport { solidLogicSingleton } from 'solid-logic'\nimport { debug } from '../../log'\nimport { errorMessageBlock } from '../error'\n\nconst store = solidLogicSingleton.store\n\nexport type FieldFunction = (\n  dom: HTMLDocument, // the DOM\n  container: HTMLElement | undefined, // if defined, the box will be appended to it\n  already: { }, // used to avoid looping in nested forms\n  subject: Node, // the thing for which data will be loaded into the form element\n  form: Node, // the RDF declaration for what the form should have\n  doc: Node, // the online RDF document for data binding (form input values will be read/saved automatically)\n  callbackFunction: (ok: boolean, errorMessage: string) => void // this will be called when data changes (TODO: check this with unit tests)\n) => HTMLElement\n\nexport const field: { [classUri: string]: FieldFunction } = {} // Form field functions by URI of field type.\n\n/**\n * Which class of field is this? Relies on http://www.w3.org/2000/01/rdf-schema#subClassOf and\n * https://linkeddata.github.io/rdflib.js/doc/classes/formula.html#bottomtypeuris\n * to find the most specific RDF type if there are multiple.\n *\n * @param x a form field, e.g. `namedNode('https://timbl.com/timbl/Public/Test/Forms/individualForm.ttl#fullNameField')`\n * @returns the URI of the most specific known class, e.g. `http://www.w3.org/ns/ui#SingleLineTextField`\n */\nexport function mostSpecificClassURI (x: Node): string {\n  const kb = store\n  const ft = kb.findTypeURIs(x as any)\n  const bot = kb.bottomTypeURIs(ft) // most specific\n  const bots: any[] = []\n  for (const b in bot) bots.push(b)\n  // if (bots.length > 1) throw \"Didn't expect \"+x+\" to have multiple bottom types: \"+bots\n  return bots[0]\n}\n\n/**\n * Returns a function that creates a form widget\n * @param dom unused\n * @param fieldInQuestion the field for which to create a form, e.g. namedNode('https://timbl.com/timbl/Public/Test/Forms/individualForm.ttl#fullNameField')\n */\nexport function fieldFunction (dom: any /* unused */, fieldInQuestion: Node): FieldFunction {\n  const uri = mostSpecificClassURI(fieldInQuestion) // What type\n  // const uri = field.uri\n  const fun = field[uri]\n  debug(\n    'paneUtils: Going to implement field ' + fieldInQuestion + ' of type ' + uri\n  )\n  if (!fun) {\n    return function (dom2: HTMLDocument, container?: HTMLElement): HTMLElement {\n      const box = errorMessageBlock(\n        dom2,\n        'No handler for field ' + fieldInQuestion + ' of type ' + uri\n      )\n      if (container) container.appendChild(box)\n\n      return box\n    }\n  }\n  return fun\n}\n","import ns from '../../ns'\nimport { Node } from 'rdflib'\nimport { store } from 'solid-logic'\nimport { fieldParams } from './fieldParams'\n\nimport { mostSpecificClassURI } from './fieldFunction'\n\nconst STYLE_URI_PREFIX = 'https://www.w3.org/ns/css#'\n\nexport function setFieldStyle (ele:HTMLElement, field:Node) {\n  const classUri = mostSpecificClassURI(field)\n  const params = fieldParams[classUri] || {}\n\n  const style = store.any(field as any, ns.ui('style'))\n  if (!style) {\n    if (params.style) {\n      ele.setAttribute('style', params.style)\n    }\n    return\n  }\n  if (style.termType === 'Literal') {\n    if (style) ele.setAttribute('style', style.value)\n  } else {\n    const sts = store.statementsMatching(style as any, null, null, (field as any).doc())\n    sts.forEach(st => {\n      if (st.predicate.uri && st.predicate.uri.startsWith(STYLE_URI_PREFIX)) {\n        const cssAttribute = st.predicate.uri.slice(STYLE_URI_PREFIX.length)\n        try {\n          ele.style[cssAttribute] = st.object.value\n        } catch (_err) {\n          console.warn(`setFieldStyle: Error setting element style ${cssAttribute} to \"${st.object.value}\"`)\n          console.warn(`setFieldStyle:   ... Element tagName was \"${ele.tagName || '???'}\"`)\n        }\n      }\n    })\n  }\n}\n","import { BlankNode, Literal, NamedNode, Node, st, Store, Variable } from 'rdflib'\nimport { solidLogicSingleton } from 'solid-logic'\nimport ns from '../../ns'\nimport { style } from '../../style'\nimport styleConstants from '../../styleConstants'\nimport { label } from '../../utils'\nimport { errorMessageBlock } from '../error'\nimport { mostSpecificClassURI } from './fieldFunction'\nimport { fieldParams } from './fieldParams'\n\nconst store = solidLogicSingleton.store\n\n/*  Style and create a name, value pair\n*/\nexport function renderNameValuePair (dom: HTMLDocument, kb: Store, box: HTMLElement, form: NamedNode, label?: string):HTMLElement {\n  // const property = kb.any(form, ns.ui('property'))\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const lhs = box.appendChild(dom.createElement('div'))\n  lhs.style.width = styleConstants.formFieldNameBoxWidth\n  const rhs = box.appendChild(dom.createElement('div'))\n\n  lhs.setAttribute('class', 'formFieldName')\n  lhs.setAttribute('style', style.formFieldNameBoxStyle)\n  rhs.setAttribute('class', 'formFieldValue')\n  if (label) {\n    lhs.appendChild(dom.createTextNode(label))\n  } else if (kb.any(form, ns.ui('property'))) { // Assume more space for error on right\n    lhs.appendChild(fieldLabel(dom, kb.any(form, ns.ui('property')) as NamedNode, form))\n  } else {\n    rhs.appendChild(errorMessageBlock(dom, 'No property or label given for form field: ' + form))\n    lhs.appendChild(dom.createTextNode('???'))\n  }\n  return rhs\n}\n\n/**\n * Create an anchor element with a label as the anchor text.\n *\n * @param dom The DOM\n * @param property href for the anchor element\n * @param fieldInQuestion field to produce a label for\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldLabel (dom: HTMLDocument, property: NamedNode | undefined, fieldInQuestion: Node): HTMLElement | Text {\n  let lab = store.any(fieldInQuestion as any, ns.ui('label'))\n  if (!lab) lab = label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  /* istanbul ignore next */\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', 'color: #3B5998; text-decoration: none;') // Not too blue and no underline\n  anchor.textContent = lab as any\n  return anchor\n}\n\n/**\n * Returns the document for the first quad that matches\n * the subject and predicate provided, or default if that\n * store is not editable.\n *\n * @param subject Subject about which we want to find an editable RDF document\n * @param predicate Predicate about which we want to find an editable RDF document\n * @param def default RDF document to return if none found\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldStore (subject: NamedNode | BlankNode | Variable, predicate: NamedNode | Variable, def: NamedNode | undefined): NamedNode | undefined {\n  const sts = store.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (!store.updater) {\n    throw new Error('Store has no updater')\n  }\n  if (\n    sts.length > 0 &&\n    sts[0].why.value &&\n    store.updater.editable(sts[0].why.value, store)\n  ) {\n    return store.sym(sts[0].why.value)\n  }\n  return def\n}\n\n/**\n * Render a basic form field\n *\n * The same function is used for many similar one-value fields, with different\n * regexps used to validate.\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param container  If present, the created widget will be appended to this\n * @param already A hash table of (form, subject) kept to prevent recursive forms looping\n * @param subject The thing about which the form displays/edits data\n * @param form The form or field to be rendered\n * @param doc The web document in which the data is\n * @param callbackFunction Called when data is changed?\n *\n * @returns The HTML widget created\n */\n\nexport function basicField (\n  dom: HTMLDocument,\n  container: HTMLElement | undefined,\n  already,\n  subject: NamedNode | BlankNode | Variable,\n  form: NamedNode,\n  doc: NamedNode | undefined,\n  callbackFunction: (_ok: boolean, _errorMessage: string) => void\n): HTMLElement {\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = dom.createElement('div')\n\n  const property = kb.any(form, ns.ui('property'))\n  if (container) container.appendChild(box)\n  if (!property) {\n    return box.appendChild(\n      errorMessageBlock(dom, 'Error: No property given for text field: ' + form)\n    )\n  }\n  const rhs = renderNameValuePair(dom, kb, box, form)\n\n  // It can be cleaner to just remove empty fields if you can't edit them anyway\n  const suppressEmptyUneditable = kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  const uri = mostSpecificClassURI(form)\n  let params = fieldParams[uri]\n  if (params === undefined) params = { style: '' } // non-bottom field types can do this\n  const paramStyle = params.style || ''\n  const inputStyle = style.textInputStyle + paramStyle\n  const field = dom.createElement('input')\n  ;(field as any).style = inputStyle\n  rhs.appendChild(field)\n  field.setAttribute('type', params.type ? params.type : 'text')\n\n  const size = kb.anyJS(form, ns.ui('size')) || styleConstants.textInputSize || 20\n  field.setAttribute('size', size)\n\n  const maxLength = kb.any(form, ns.ui('maxLength'))\n  field.setAttribute('maxLength', maxLength ? '' + maxLength : styleConstants.basicMaxLength)\n\n  doc = doc || fieldStore(subject, property as any, doc)\n\n  let obj = kb.any(subject, property as any, undefined, doc)\n  if (!obj) {\n    obj = kb.any(form, ns.ui('default'))\n  }\n  if (obj && obj.value && params.uriPrefix) {\n    // eg tel: or mailto:\n    field.value = decodeURIComponent(obj.value.replace(params.uriPrefix, '')) // should have no spaces but in case\n      .replace(/ /g, '')\n  } else if (obj) {\n    /* istanbul ignore next */\n    field.value = obj.value || obj.value || ''\n  }\n  field.setAttribute('style', inputStyle)\n  if (!kb.updater) {\n    throw new Error('kb has no updater')\n  }\n  if (!kb.updater.editable((doc as NamedNode).uri)) {\n    field.readOnly = true // was: disabled. readOnly is better\n    ;(field as any).style = style.textInputStyleUneditable + paramStyle\n    if (suppressEmptyUneditable && field.value === '') {\n      box.style.display = 'none' // clutter\n    }\n    return box\n  }\n\n  // read-write:\n  field.addEventListener(\n    'keyup',\n    function (_e) {\n      if (params.pattern) {\n        field.setAttribute(\n          'style',\n          inputStyle +\n            (field.value.match(params.pattern)\n              ? 'color: green;'\n              : 'color: red;')\n        )\n      }\n    },\n    true\n  )\n  field.addEventListener(\n    'change',\n    function (_e) {\n      // i.e. lose focus with changed data\n      if (params.pattern && !field.value.match(params.pattern)) return\n      field.disabled = true // See if this stops getting two dates from fumbling e.g the chrome datepicker.\n      field.setAttribute('style', inputStyle + 'color: gray;') // pending\n      const ds = kb.statementsMatching(subject, property as any) // remove any multiple values\n      let result\n      if (params.namedNode) {\n        result = kb.sym(field.value)\n      } else if (params.uriPrefix) {\n        result = encodeURIComponent(field.value.replace(/ /g, ''))\n        result = kb.sym(params.uriPrefix + field.value)\n      } else {\n        if (params.dt) {\n          result = new Literal(\n            field.value.trim(),\n            undefined,\n            ns.xsd(params.dt)\n          )\n        } else {\n          result = new Literal(field.value)\n        }\n      }\n      let is = ds.map(statement => st(statement.subject, statement.predicate, result, statement.why)) // can include >1 doc\n      if (is.length === 0) {\n        // or none\n        is = [st(subject, property as any, result, doc)]\n      }\n\n      function updateMany (ds, is: { why: { uri: string } }[], callback) {\n        const docs: any[] = []\n        is.forEach(st => {\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        ds.forEach(st => {\n          /* istanbul ignore next */\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        /* istanbul ignore next */\n        if (docs.length === 0) {\n          throw new Error('updateMany has no docs to patch')\n        }\n        if (!kb.updater) {\n          throw new Error('kb has no updater')\n        }\n        if (docs.length === 1) {\n          return kb.updater.update(ds, is as any, callback)\n        }\n        // return kb.updater.update(ds, is, callback)\n\n        const doc = docs.pop()\n        const is1 = is.filter(st => st.why.uri === doc)\n        const is2 = is.filter(st => st.why.uri !== doc)\n        const ds1 = ds.filter(st => st.why.uri === doc)\n        const ds2 = ds.filter(st => st.why.uri !== doc)\n        kb.updater.update(ds1, is1 as any, function (uri, ok, body) {\n          if (ok) {\n            updateMany(ds2, is2, callback)\n          } else {\n            callback(uri, ok, body)\n          }\n        })\n      }\n\n      updateMany(ds, is as any, function (uri, ok, body) {\n        // kb.updater.update(ds, is, function (uri, ok, body) {\n        if (ok) {\n          field.disabled = false\n          field.setAttribute('style', inputStyle)\n        } else {\n          box.appendChild(errorMessageBlock(dom, body))\n        }\n        callbackFunction(ok, body)\n      })\n    },\n    true\n  )\n  return box\n}\n","/* Logic to access public data stores\n*\n* including filtering resut by natural language etc\n* See https://solidos.solidcommunity.net/public/2021/01%20Building%20Solid%20Apps%20which%20use%20Public%20Data.html\n*/\n\nimport * as debug from '../../../debug'\n// import * as logic from '../index'\n// import { authn } from '../../../authn/index'\nimport { authn, store } from 'solid-logic'\nimport ns from '../../../ns'\nimport { Collection, NamedNode, Node } from 'rdflib'\n// import { Binding } from '../widgets/forms/autocomplete/publicData'\n// import { nativeNameForLanguageCode, englishNameForLanguageCode } from './nativeNameForLanguageCode'\n\n// const { currentUser } = logic.authn\n\nexport interface Binding {\n  subject: Node;\n  name?: Node\n  location?: Node\n  coordinates?: Node\n}\n\nexport const languageCodeURIBase = 'https://www.w3.org/ns/iana/language-code/' /// @@ unsupported on the web (2021)\n\nexport const defaultPreferredLanguages = ['en', 'fr', 'de', 'it', 'ar']\n\nexport function addDefaults (array) {\n  if (!array) array = []\n  return array.concat(defaultPreferredLanguages.filter(code => !array.includes(code)))\n}\n\nexport async function getPreferredLanguagesFor (person: NamedNode) {\n  const doc = person.doc()\n  await store.fetcher?.load(doc)\n  const list = store.any(person, ns.schema('knowsLanguage'), null, doc) as Collection | undefined\n  if (!list) {\n    // console.log(`User ${person} has not set their languages in their profile.`)\n    return defaultPreferredLanguages\n  }\n  const languageCodeArray: string[] = []\n  list.elements.forEach(item => {\n    // console.log('@@ item ' + item)\n    const lang = store.any(item as any, ns.solid('publicId'), null, doc)\n    if (!lang) {\n      console.warn('getPreferredLanguages: No publiID of language.')\n      return\n    }\n    if (!lang.value.startsWith(languageCodeURIBase)) {\n      console.error(`What should be a language code ${lang.value} does not start with ${languageCodeURIBase}`)\n      return\n    }\n    const code = lang.value.slice(languageCodeURIBase.length)\n    languageCodeArray.push(code)\n  })\n\n  if (languageCodeArray.length > 0) {\n    console.log(`     User knows languages with codes: \"${languageCodeArray.join(',')}\"`)\n    return addDefaults(languageCodeArray)\n  }\n  return null\n}\n/* Get the preferred langauges for the user\n *\n *  Either from solid preferences or browser preferences or default\n */\nexport async function getPreferredLanguages () {\n  // In future:  cache in the login session for speed, but get from profile and private prefs\n  // We append the defaults so if someone's first choice is not available they don't get something very obscure\n  // See https://github.com/solidos/solidos/issues/42\n  const me = await authn.currentUser() as NamedNode\n  if (me) { // If logged in\n    const solidLanguagePrefs = await getPreferredLanguagesFor(me)\n    if (solidLanguagePrefs) return solidLanguagePrefs\n  }\n  if (typeof navigator !== 'undefined') { // use browser settings\n    if (navigator.languages) {\n      return addDefaults(navigator.languages.map(longForm => longForm.split('-')[0]))\n    }\n    if (navigator.language) {\n      return addDefaults([navigator.language.split('-')[0]])\n    }\n  }\n  return defaultPreferredLanguages\n}\n\n/* From an array of bindings with a names for each row,\n * remove dupliacte names for the same thing, leaving the user's\n * preferred language version\n*/\n\nexport function filterByLanguage (bindings, languagePrefs) {\n  const uris = {}\n  bindings.forEach(binding => { // Organize names by their subject\n    const uri = binding.subject.value\n    uris[uri] = uris[uri] || []\n    uris[uri].push(binding)\n  })\n\n  const languagePrefs2 = languagePrefs || defaultPreferredLanguages\n  languagePrefs2.reverse() // Preferred last\n\n  const slimmed = [] as Array<Binding>\n  // console.log(` @@ {languagePrefs2 ${languagePrefs2}`)\n  for (const u in uris) { // needs hasOwnProperty ?\n    const bindings = uris[u]\n    const sortMe = bindings.map(binding => {\n      const lang = binding.name['xml:lang']\n      const index = languagePrefs2.indexOf(lang)\n      const pair = [index, binding]\n      // console.log(`   @@ lang: ${lang}, index: ${index}`)\n      return pair\n    })\n    sortMe.sort() // best at th ebottom\n    sortMe.reverse() // best at the top\n    // console.debug('@@ sortMe:', sortMe)\n    slimmed.push((sortMe[0][1] as any))\n  } // map u\n  debug.log(` Filter by language: ${bindings.length} -> ${slimmed.length}`)\n  return slimmed\n}\n","/* Logic to access public data stores\n*\n* including filtering resut by natural language etc\n* See https://solidos.solidcommunity.net/public/2021/01%20Building%20Solid%20Apps%20which%20use%20Public%20Data.html\n*/\n\nimport { Literal, NamedNode, parse } from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as debug from '../../../debug'\nimport ns from '../../../ns'\nimport { defaultPreferredLanguages, getPreferredLanguages } from './language'\n\nexport const AUTOCOMPLETE_LIMIT = 200 // How many to get from server\n// With 3000 we could exceed the wikidata timeout\n\nconst subjectRegexp = /\\$\\(subject\\)/g\n\ninterface Term {\n  type: string;\n  value: string\n}\n\nexport interface Binding {\n  subject: Term;\n  name?: Term\n  location?: Term\n  coordinates?: Term\n}\n\ntype Bindings = Binding[]\n\nexport type QueryParameters =\n{\n  label: string;\n  limit?: number;\n  logo?: NamedNode;\n  searchByNameQuery?: string;\n  searchByNameURI?: string;\n  insitituteDetailsQuery?: string;\n  endpoint?: string;\n  objectURIBase?: NamedNode;\n  targetClass?: NamedNode,\n}\n\n// Schema.org seems to suggest NGOs are non-profit and Corporaions are for-profit\n// but doesn't have explicit classes\nexport const wikidataClasses = {\n  Corporation: 'http://www.wikidata.org/entity/Q6881511', // Enterprise is for-profit\n  EducationalOrganization: 'http://www.wikidata.org/entity/Q178706', // insitution\n  GovernmentOrganization: 'http://www.wikidata.org/entity/Q327333', // government agency\n  MedicalOrganization: 'http://www.wikidata.org/entity/Q4287745',\n  MusicGroup: 'http://www.wikidata.org/entity/Q32178211', // music organization\n  NGO: 'http://www.wikidata.org/entity/Q163740', // nonprofit organization @@\n  Occupation: 'http://www.wikidata.org/entity/Q28640', // Profession\n  // Organization: 'http://www.wikidata.org/entity/Q43229',\n  Project: 'http://www.wikidata.org/entity/Q170584',\n  ResearchOrganization: 'http://www.wikidata.org/entity/Q31855',\n  SportsOrganization: 'http://www.wikidata.org/entity/Q4438121'\n}\n\nexport const instituteDetailsWikidataQuery = `prefix vcard: <http://www.w3.org/2006/vcard/ns#>\nCONSTRUCT\n{  wd:Q49108 vcard:fn ?itemLabel.\nwd:Q49108 rdf:type ?klass. ?klass rdfs:label ?klassLabel; rdfs:comment ?klassDescription .\nwd:Q49108 schema:logo ?logo;\n   schema:image ?image;\n   schema:logo  ?sealImage;\n   schema:subOrganization  ?subsidiary .\n      ?subsidiary rdfs:label ?subsidiaryLabel .\n ?supersidiary schema:subOrganization wd:Q49108 .\n      ?supersidiary rdfs:label ?supersidiaryLabel .\n  wd:Q49108 schema:location ?location .\n     ?location  schema:elevation  ?elevation .\n     ?location  wdt:P131  ?region .  ?region rdfs:label ?regionLabel .\n     ?location wdt:P625 ?coordinates .\n     ?location  schema:country  ?country . ?country rdfs:label ?countryLabel .\n}\nWHERE\n{  optional {wd:Q49108 rdfs:label ?itemLabel} .\n  optional {wd:Q49108 wdt:P154 ?logo .}\n  optional {wd:Q49108 wdt:P31 ?klass .}\n  optional {wd:Q49108 wdt:P158  ?sealImage .}\n  optional {wd:Q49108 wdt:P18 ?image .}\n\n  optional { wd:Q49108       wdt:P355 ?subsidiary . }\n  optional { ?supersidiary   wdt:P355 wd:Q49108. }\n\n  optional { wd:Q49108 wdt:P276 ?location .\n\n    optional { ?location  schema:eleveation  ?elevation }\n    optional { ?location  wdt:P131  ?region }\n    optional { ?location wdt:P625 ?coordinates }\n    optional {  ?location  wdt:P17  ?country }\n  }\n  SERVICE wikibase:label { bd:serviceParam wikibase:language \"fr,en,de,it\". }\n}`\n\nexport const fetcherOptionsJsonPublicData = {\n  credentials: 'omit' as 'include' | 'omit' | undefined, // try to avoid CORS problems. Data is public so no auth\n  headers: new Headers({ Accept: 'application/json' })\n}\n\nexport const escoParameters:QueryParameters = {\n  label: 'ESCO',\n  logo: store.sym('https://ec.europa.eu/esco/portal/static_resource2/images/logo/logo_en.gif'),\n  searchByNameURI: 'https://ec.europa.eu/esco/api/search?language=$(language)&type=occupation&text=$(name)'\n  // endpoint: undefined\n  // returnFormat: 'ESCO',\n  // targetClass: {}\n}\n\nexport const dbpediaParameters:QueryParameters = {\n  label: 'DBPedia',\n  logo: store.sym('https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/DBpediaLogo.svg/263px-DBpediaLogo.svg.png'),\n  searchByNameQuery: `select distinct ?subject, ?name where {\n    ?subject a $(targetClass); rdfs:label ?name\n    FILTER regex(?name, \"$(name)\", \"i\")\n  } LIMIT $(limit)`,\n  endpoint: 'https://dbpedia.org/sparql/'\n}\n\nexport const dbPediaTypeMap = { AcademicInsitution: 'http://umbel.org/umbel/rc/EducationalOrganization' }\n\nexport const wikidataOutgoingClassMap = {\n  AcademicInsitution: 'http://www.wikidata.org/entity/Q4671277',\n  Enterprise: 'http://www.wikidata.org/entity/Q6881511',\n  Business: 'http://www.wikidata.org/entity/Q4830453',\n  NGO: 'http://www.wikidata.org/entity/Q79913',\n  CharitableOrganization: 'http://www.wikidata.org/entity/Q708676',\n  Insitute: 'http://www.wikidata.org/entity/Q1664720'\n}\n\nexport const wikidataParameters = {\n  label: 'WikiData',\n  limit: 3000, // Need a high one as very many items, and many languages\n  logo: store.sym('https://www.wikimedia.org/static/images/project-logos/wikidatawiki.png'),\n  endpoint: 'https://query.wikidata.org/sparql',\n  searchByNameQuery: `SELECT ?subject ?name\n  WHERE {\n    ?klass wdt:P279* $(targetClass) .\n    ?subject wdt:P31 ?klass .\n    ?subject rdfs:label ?name.\n    FILTER regex(?name, \"$(name)\", \"i\")\n  } LIMIT $(limit) `, // was SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\" }\n\n  insitituteDetailsQuery: `CONSTRUCT\n{  wd:Q49108 schema:name ?itemLabel;\n             schema:logo ?logo;\n              schema:logo  ?sealImage;\n             schema:subOrganization  ?subsidiary .\n                 ?subsidiary schema:name ?subsidiaryLabel .\n}\nWHERE\n{\n   wd:Q49108 # rdfs:label ?itemLabel ;\n             wdt:P154 ?logo;\n              wdt:P158  ?sealImage ;\n             wdt:P355  ?subsidiary .\n          #  ?subsidiary rdfs:label ?subsidiaryLabel .\n\n  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE], fr\". }\n}`\n}\n\nexport const wikidataIncomingClassMap = {\n  'http://www.wikidata.org/entity/Q15936437': ns.schema('CollegeOrUniversity'), // research university\n  'http://www.wikidata.org/entity/Q1664720': ns.schema('EducationalOrganization'), // insitute @@\n  'http://www.wikidata.org/entity/Q43229': ns.schema('Organization'), // research university\n  'http://www.wikidata.org/entity/Q3918': ns.schema('CollegeOrUniversity'), // university\n  'http://www.wikidata.org/entity/Q170584': ns.schema('Project'), // university\n  'http://www.wikidata.org/entity/Q327333': ns.schema('GovernmentOrganization'), // govt agency\n  'http://www.wikidata.org/entity/Q2221906': ns.schema('Place'), // geographic location\n  'http://www.wikidata.org/entity/Q167037': ns.schema('Corporation') // Corporation\n\n}\nexport const variableNameToPredicateMap = { // allow other mappings to be added in theory hence var\n  // wikidata:\n  targetClass: ns.rdf('type'),\n  // logo: ns.schema('logo'),\n  sealImage: ns.schema('logo'),\n  // image: ns.schema('image'),   defaults to shema\n  shortName: ns.foaf('nick'),\n  subsidiary: ns.schema('subOrganization'),\n  // dbpedia - :\n  city: ns.vcard('locality'),\n  state: ns.vcard('region'),\n  country: ns.vcard('country-name'),\n  homepage: ns.foaf('homepage'),\n  lat: ns.schema('latitude'),\n  long: ns.schema('longitude')\n}\n\nexport function bindingToTerm (item) {\n  const typ = item.type.toLowerCase()\n  if (typ === 'uri' || typ === 'iri') {\n    return store.sym(item.value)\n  } else if (typ === 'literal') {\n    if (item['xml:lang']) {\n      return new Literal(item.value, item['xml:lang'])\n    } else {\n      return new Literal(item.value)\n    }\n  } else {\n    throw new Error(`bindingToTerm: Unexpected type \"${item.type}\" in sparql binding}`)\n  }\n}\n\nexport function loadFromBindings (kb, solidSubject:NamedNode, bindings, doc, predMap = variableNameToPredicateMap) {\n  const results = {}\n  debug.log(`loadFromBindings:  subject: ${solidSubject}`)\n  debug.log(`                       doc: ${doc}`)\n  bindings.forEach(binding => {\n    for (const key in binding) {\n      const result = binding[key]\n      const combined = JSON.stringify(result) // ( result.type, result.value )\n      results[key] = results[key] || new Set()\n      results[key].add(combined) // remove duplicates\n    }\n  })\n  for (const key in results) {\n    const values = results[key]\n    debug.log(`    results ${key} -> ${values}`)\n    values.forEach(combined => {\n      const result = JSON.parse(combined)\n      const { type, value } = result\n      let obj\n      if (type === 'uri') {\n        obj = kb.sym(value)\n      } else if (type === 'literal') {\n        obj = new Literal(value, result.language, result.datatype)\n      } else {\n        throw new Error(`loadFromBindings:  unexpected type: ${type}`)\n      }\n      if (key === 'type') {\n        if (wikidataIncomingClassMap[value]) {\n          obj = wikidataIncomingClassMap[value]\n        } else {\n          debug.warn('Unmapped Wikidata Class: ' + value)\n        }\n      } else if (key === 'coordinates') {\n        // const latlong = value // Like 'Point(-71.106111111 42.375)'\n        debug.log('         @@@ hey a point: ' + value)\n        // const regexp = /.*\\(([-0-9\\.-]*) ([-0-9\\.-]*)\\)/\n        const regexp = /.*\\(([-0-9.-]*) ([-0-9.-]*)\\)/\n        const match = regexp.exec(value)\n        if (match) {\n          const float = ns.xsd('float')\n          const latitude = new Literal(match[1], null, float)\n          const longitude = new Literal(match[2], null, float)\n          kb.add(solidSubject, ns.schema('longitude'), longitude, doc)\n          kb.add(solidSubject, ns.schema('latitude'), latitude, doc)\n        } else {\n          debug.log('Bad coordinates syntax: ' + value)\n        }\n      } else {\n        const pred = predMap[key] || ns.schema(key) // fallback to just using schema.org\n        kb.add(solidSubject, pred, obj, doc) // @@ deal with non-string and objects\n        debug.log(`  public data ${pred} ${obj}.`)\n      }\n    })\n  }\n}\n\n/* ESCO sopecific\n*/\nexport function ESCOResultToBindings (json: Object): Bindings {\n  const results = (json as any)._embedded.results // Array\n  const bindings = results.map(result => {\n    const name = result.title\n    const uri = result.uri // like http://data.europa.eu/esco/occupation/57af9090-55b4-4911-b2d0-86db01c00b02\n    return { name: { value: name, type: 'literal' }, subject: { type: 'IRI', value: uri } } // simulate SPARQL bindings\n  })\n  return bindings\n}\n\n/*  Query all entities of given class and partially matching name\n*/\nexport async function queryESCODataByName (filter: string, theClass:NamedNode, queryTarget: QueryParameters): Promise<Bindings> {\n  if (!queryTarget.searchByNameURI) throw new Error('Missing queryTarget.searchByNameURI on queryESCODataByName')\n  const limit = queryTarget.limit || AUTOCOMPLETE_LIMIT\n  const queryURI = queryTarget.searchByNameURI\n    .replace('$(name)', filter)\n    .replace('$(limit)', '' + limit)\n    .replace('$(targetClass)', theClass.toNT())\n  debug.log('Querying ESCO data - uri: ' + queryURI)\n\n  const response = await store.fetcher?.webOperation('GET', queryURI, fetcherOptionsJsonPublicData)\n  const text = response?.responseText || ''\n  debug.log('    Query result  text' + text.slice(0, 500) + '...')\n  if (text.length === 0) throw new Error('Wot no text back from ESCO query ' + queryURI)\n  const json = JSON.parse(text)\n  // console.log('Whole JSON return object', json)\n  debug.log('    ESCO Query result JSON' + JSON.stringify(json, null, 4).slice(0, 500) + '...')\n  return ESCOResultToBindings(json)\n}\n\n/* Cope ithe syntax probelm in wikidata timeout responses\n*\n* Wikidata bug: https://phabricator.wikimedia.org/T283962\n* This will not be needed whn that  WDQS bug fixed.\n* This is aptured in https://github.com/solidos/solid-ui/issues/403\n*/\nfunction fixWikidataJSON (str) {\n  const syntaxProblem = str.indexOf('SPARQL-QUERY')\n  if (syntaxProblem < 0) return str\n  // console.log('@@ fixWikidataJSON FIXING')\n  debug.warn('  ### Fixing JSON with wikidata error code injection ' + str.slice(syntaxProblem, syntaxProblem + 200))\n  const goodness = str.lastIndexOf('}, {')\n  return str.slice(0, goodness) + ' } ] } } ' // Close binding, array, bindings, results, root object\n}\n/*  Query all entities of given class and partially matching name\n*/\nexport async function queryPublicDataByName (\n  filter: string,\n  theClass:NamedNode,\n  languages: Array<string>,\n  queryTarget: QueryParameters): Promise<Bindings> {\n  function substituteStrings (template: string):string {\n    const limit = queryTarget.limit || AUTOCOMPLETE_LIMIT\n    const u1 = template.replace('$(name)', filter)\n      .replace('$(limit)', '' + limit)\n      .replace('$(language)', language)\n    return u1.replace('$(targetClass)', theClass.toNT())\n  }\n\n  if (!theClass) {\n    throw new Error('queryPublicDataByName: No class provided')\n  }\n\n  const languagePrefs = await getPreferredLanguages() || defaultPreferredLanguages\n  const language = languagePrefs[0] || 'en'\n  if (queryTarget.searchByNameQuery) {\n    const sparql = substituteStrings(queryTarget.searchByNameQuery)\n    debug.log('Querying public data - sparql: ' + sparql)\n    return queryPublicDataSelect(sparql, queryTarget)\n  } else if (queryTarget.searchByNameURI) { // not sparql - random API\n    const queryURI = substituteStrings(queryTarget.searchByNameURI)\n    let response\n    try {\n      response = await store.fetcher?.webOperation('GET', queryURI, fetcherOptionsJsonPublicData)\n    } catch (err) {\n      throw new Error(`Exception when trying to fetch ${queryURI} \\n ${err}`)\n    }\n    const text = response.responseText || '' // ts\n    if (response.status !== 200) {\n      throw new Error(`HTTP error status ${response.status} trying to fetch ${queryURI} `)\n    }\n    debug.log('    Query result  text' + text.slice(0, 500) + '...')\n    if (text.length === 0) throw new Error('queryPublicDataByName: No text back from public data query ' + queryURI)\n    const text2 = fixWikidataJSON(text) // Kludge: strip of interrupting error message\n    const json = JSON.parse(text2)\n    debug.log('    API Query result JSON' + JSON.stringify(json, null, 4).slice(0, 500) + '...')\n    if ((json as any)._embedded) {\n      debug.log('      Looks like ESCO')\n      const bindings = ESCOResultToBindings(json)\n      return bindings\n    } else {\n      alert('Code me: unrecognized API return format')\n      throw new Error(`*** Need to add code to parse unrecognized API JSON return\\n${JSON.stringify(json, null, 4)}`)\n    }\n  } else {\n    throw new Error('Query source must have either rest API or SPARQL endpoint.')\n  }\n}\n\n/* Query a database using SPARQL SELECT\n*/\nexport async function queryPublicDataSelect (sparql: string, queryTarget: QueryParameters): Promise<Bindings> {\n  if (!queryTarget.endpoint) throw new Error('Missing queryTarget.endpoint required for queryPublicDataSelect')\n  const myUrlWithParams = new URL(queryTarget.endpoint)\n  myUrlWithParams.searchParams.append('query', sparql)\n  const queryURI = myUrlWithParams.href\n  debug.log(' queryPublicDataSelect uri: ' + queryURI)\n  const headers = new Headers()\n  headers.append('Accept', 'application/json')\n  const options = {\n    credentials: 'omit' as 'include' | 'omit' | undefined, // CORS - as we know it is public\n    headers\n  }\n\n  const response = await store.fetcher?.webOperation('GET', queryURI, options)\n\n  const text = response?.responseText || ''\n  if (text.length === 0) throw new Error('No text back from query ' + queryURI)\n  const text2 = fixWikidataJSON(text)\n  const json = JSON.parse(text2)\n  debug.log('    Query result JSON' + JSON.stringify(json, null, 4).slice(0, 100) + '...')\n  const bindings = json.results.bindings\n  return bindings\n}\n\n/* Load from a database using SPARQL CONSTRUCT\n*/\nexport async function queryPublicDataConstruct (sparql: string, pubicId: NamedNode, queryTarget: QueryParameters): Promise<void> {\n  debug.log('queryPublicDataConstruct: sparql:', sparql)\n  if (!queryTarget.endpoint) throw new Error('Missing queryTarget.endpoint required for queryPublicDataConstruct')\n  const myUrlWithParams = new URL(queryTarget.endpoint)\n  myUrlWithParams.searchParams.append('query', sparql)\n  const queryURI = myUrlWithParams.href\n  debug.log(' queryPublicDataConstruct uri: ' + queryURI)\n  const headers = new Headers()\n  headers.append('Accept', 'text/turtle')\n  const options = {\n    credentials: 'omit' as 'include' | 'omit' | undefined, // CORS // @tsc pain\n    headers // ({ Accept: 'text/turtle' } as Headers)\n  }\n  const response = await store.fetcher?.webOperation('GET', queryURI, options)\n  const text = response?.responseText || 'No response text?'\n  const report = text.length > 500 ? text.slice(0, 200) + ' ... ' + text.slice(-200) : text\n  debug.log('    queryPublicDataConstruct result text:' + report)\n  if (text.length === 0) throw new Error('queryPublicDataConstruct: No text back from construct query:' + queryURI)\n  parse(text, store, pubicId.uri, 'text/turtle')\n}\n\nexport async function loadPublicDataThing (kb, subject: NamedNode, publicDataID: NamedNode) {\n  if (publicDataID.uri.startsWith('https://dbpedia.org/resource/')) {\n    return getDbpediaDetails(kb, subject, publicDataID)\n  } else if (publicDataID.uri.match(/^https?:\\/\\/www\\.wikidata\\.org\\/entity\\/.*/)) {\n    // const QId = publicDataID.uri.split('/')[4]\n    // const dataURI = `http://www.wikidata.org/wiki/Special:EntityData/${QId}.ttl`\n    // In fact loading the data URI gives much too much irrelevant data, from wikidata, so we do a query.\n    await getWikidataDetails(kb, subject, publicDataID)\n    // await getWikidataLocation(kb, subject, publicDataID)  -- should get that in the details query now\n  } else {\n    const iDToFetch = publicDataID.uri.startsWith('http:')\n      ? kb.sym('https:' + publicDataID.uri.slice(5))\n      : publicDataID\n    const headers = new Headers()\n    headers.append('Accept', 'text/turtle')\n    return kb.fetcher.load(iDToFetch, {\n      credentials: 'omit' as 'include' | 'omit' | undefined,\n      headers\n    })\n  }\n}\n\nexport async function getWikidataDetails (kb, solidSubject:NamedNode, publicDataID:NamedNode) {\n  const subjRegexp = /wd:Q49108/g\n  const sparql = instituteDetailsWikidataQuery.replace(subjRegexp, publicDataID.toNT())\n  await queryPublicDataConstruct(sparql, publicDataID, wikidataParameters)\n  debug.log('getWikidataDetails: loaded.', publicDataID)\n}\n\nexport async function getWikidataDetailsOld (kb, solidSubject:NamedNode, publicDataID:NamedNode) {\n  const sparql = `select distinct *  where {\n  optional { $(subject)  wdt:P31  ?targetClass } # instance of\n  optional { $(subject)  wdt:P154  ?logo }\n  optional { $(subject)  wdt:P158  ?sealImage }\n# optional { $(subject)  wdt:P159  ?headquartersLocation }\n\noptional { $(subject)  wdt:P17  ?country }\noptional { $(subject)  wdt:P18  ?image }\noptional { $(subject)  wdt:P1813  ?shortName }\n\noptional { $(subject)  wdt:P355  ?subsidiary }\n# SERVICE wikibase:label { bd:serviceParam wikibase:language \"fr,en,de,it\" }\n}`\n    .replace(subjectRegexp, publicDataID.toNT())\n  const bindings = await queryPublicDataSelect(sparql, wikidataParameters)\n  loadFromBindings(kb, publicDataID, bindings, publicDataID.doc()) // arg2 was solidSubject\n}\n\nexport async function getWikidataLocation (kb, solidSubject:NamedNode, publicDataID:NamedNode) {\n  const sparql = `select distinct *  where {\n\n  $(subject) wdt:P276 ?location .\n\n  optional { ?location  wdt:P2044  ?elevation }\n  optional { ?location  wdt:P131  ?region }\n  optional { ?location wdt:P625 ?coordinates }\noptional {  ?location  wdt:P17  ?country }\n\n# SERVICE wikibase:label { bd:serviceParam wikibase:language \"fr,en,de,it\" }\n}`.replace(subjectRegexp, publicDataID.toNT())\n  debug.log(' location query sparql:' + sparql)\n  const bindings = await queryPublicDataSelect(sparql, wikidataParameters)\n  debug.log(' location query bindings:', bindings)\n  loadFromBindings(kb, publicDataID, bindings, publicDataID.doc()) // was solidSubject\n}\n\nexport async function getDbpediaDetails (kb, solidSubject:NamedNode, publicDataID:NamedNode) {\n// Note below the string form of the named node with <> works in SPARQL\n  const sparql = `select distinct ?city, ?state, ?country, ?homepage, ?logo, ?lat, ?long,  WHERE {\n    OPTIONAL { <${publicDataID}> <http://dbpedia.org/ontology/city> ?city }\n    OPTIONAL { ${publicDataID} <http://dbpedia.org/ontology/state> ?state }\n    OPTIONAL { ${publicDataID} <http://dbpedia.org/ontology/country> ?country }\n    OPTIONAL { ${publicDataID} foaf:homepage ?homepage }\n    OPTIONAL { ${publicDataID} foaf:lat ?lat; foaf:long ?long }\n    OPTIONAL { ${publicDataID} <http://dbpedia.org/ontology/country> ?country }\n   }`\n  const bindings = await queryPublicDataSelect(sparql, dbpediaParameters)\n  loadFromBindings(kb, publicDataID, bindings, publicDataID.doc())\n  debug.log('Finished getDbpediaDetails.')\n}\n","/* Autocomplete Picker: Create and edit data using public data\n**\n** As the data source is passed as a parameter, all kinds of APIa and query services can be used\n**\n*/\nimport * as debug from '../../../debug'\nimport { style } from '../../../style'\nimport styleConstants from '../../../styleConstants'\nimport * as widgets from '../../../widgets'\nimport { store } from 'solid-logic'\nimport { NamedNode, Literal } from 'rdflib'\nimport { queryPublicDataByName, bindingToTerm, AUTOCOMPLETE_LIMIT, QueryParameters } from './publicData'\nimport { filterByLanguage, getPreferredLanguages, defaultPreferredLanguages } from './language'\n\nconst AUTOCOMPLETE_THRESHOLD = 4 // don't check until this many characters typed\nconst AUTOCOMPLETE_ROWS = 20 // 20?\nconst AUTOCOMPLETE_ROWS_STRETCH = 40\n\n/*\nAutocomplete happens in 6 phases:\n  1. The search string is too small to bother\n  2. The search string is big enough, and we have not loaded the array\n  3. The search string is big enough, and we have loaded array up to the limit\n       Display them and wait for more user input\n  4. The search string is big enough, and we have loaded array NOT to the limit\n     but including all matches.   No more fetches.\n     If user gets more precise, wait for them to select one - or reduce to a single\n  5. Single one selected. Optionally waiting for accept button to be pressed, OR can change string and go to 5 or 2\n  6. Locked with a value. Press 'edit' button to return to 5\n*/\n\nexport type AutocompleteDecoration = {\n  acceptButton?: HTMLElement,\n  cancelButton: HTMLElement, // Must have cancel button\n  editButton?: HTMLElement,\n  deleteButton?: HTMLElement\n}\nexport type AutocompleteOptions = {\n  targetClass?: NamedNode,\n  currentObject?: NamedNode,\n  currentName?: Literal,\n  queryParams: QueryParameters,\n  size?: number,\n  permanent?: boolean\n}\n\ninterface Callback1 {\n  (_subject: NamedNode, _name: Literal): any;\n}\n\nexport function setVisible (element:HTMLElement, visible:boolean) {\n  element.style.display = visible ? '' : 'none' // Do not use visibility, it holds the real estate\n}\n\n// The core of the autocomplete UI\nexport async function renderAutoComplete (dom: HTMLDocument,\n  acOptions:AutocompleteOptions,\n  decoration: AutocompleteDecoration,\n  callback: Callback1) {\n  function complain (message) {\n    const errorRow = table.appendChild(dom.createElement('tr'))\n    debug.log(message)\n    const err = new Error(message)\n    errorRow.appendChild(widgets.errorMessageBlock(dom, err, 'pink'))\n    // errorMessageBlock will log the stack to the console\n    style.setStyle(errorRow, 'autocompleteRowStyle')\n    errorRow.style.padding = '1em'\n  }\n\n  function finish (object, name) {\n    debug.log('Auto complete: finish! ' + object)\n    if (object.termType === 'Literal' && acOptions.queryParams.objectURIBase) {\n      object = store.sym(acOptions.queryParams.objectURIBase.value + object.value)\n    }\n    // remove(decoration.cancelButton)\n    // remove(decoration.acceptButton)\n    // remove(div)\n    clearList()\n    callback(object, name)\n  }\n  async function gotIt (object:NamedNode | Literal, name: Literal) {\n    if (decoration.acceptButton) {\n      (decoration.acceptButton as any).disbaled = false\n      setVisible(decoration.acceptButton, true) // now wait for confirmation\n      searchInput.value = name.value // complete it\n      foundName = name\n      foundObject = object\n      debug.log('Auto complete: name: ' + name)\n      debug.log('Auto complete: waiting for accept ' + object)\n      clearList() // This may be an option - nice and clean but does not allow change of mind\n      return\n    }\n    setVisible(decoration.cancelButton, true)\n    finish(object, name)\n  }\n\n  async function acceptButtonHandler (_event) {\n    if (foundName && searchInput.value === foundName.value) { // still\n      finish(foundObject, foundName)\n    }\n  }\n\n  async function cancelButtonHandler (_event) {\n    debug.log('Auto complete: Canceled by user! ')\n    if (acOptions.permanent) {\n      initialize()\n    } else {\n      if (div.parentNode) {\n        div.parentNode.removeChild(div)\n      }\n    }\n  }\n\n  function nameMatch (filter:string, candidate: string):boolean {\n    const parts = filter.split(' ') // Each name part must be somewhere\n    for (let j = 0; j < parts.length; j++) {\n      const word = parts[j]\n      if (candidate.toLowerCase().indexOf(word) < 0) return false\n    }\n    return true\n  }\n\n  function clearList () {\n    while (table.children.length > 1) {\n      table.removeChild(table.lastChild as Node)\n    }\n  }\n\n  async function inputEventHHandler (_event) {\n    // console.log('@@ AC inputEventHHandler called')\n    setVisible(decoration.cancelButton, true) // only allow cancel when there is something to cancel\n    refreshList() /// @@  debounqce does not work with jest\n    /*\n    if (runningTimeout) {\n      clearTimeout(runningTimeout)\n    }\n    runningTimeout = setTimeout(refreshList, AUTOCOMPLETE_DEBOUNCE_MS)\n    */\n  }\n\n  async function loadBindingsAndFilterByLanguage (filter, languagePrefs) {\n    // console.log('@@ loadBindingsAndFilterByLanguage ' + filter)\n    let bindings\n    try {\n      bindings = await queryPublicDataByName(filter, targetClass as any,\n        languagePrefs || defaultPreferredLanguages, acOptions.queryParams)\n    } catch (err) {\n      complain('Error querying db of organizations: ' + err)\n      inputEventHandlerLock = false\n      return\n    }\n    loadedEnough = bindings.length < AUTOCOMPLETE_LIMIT\n    if (loadedEnough) {\n      lastFilter = filter\n    } else {\n      lastFilter = undefined\n    }\n    clearList()\n    const slimmed = filterByLanguage(bindings, languagePrefs)\n    return slimmed\n  }\n\n  function filterByName (filter, bindings) {\n    return bindings.filter(binding => nameMatch(filter, binding.name.value))\n  }\n\n  async function refreshList () {\n    // console.log('@@ refreshList called')\n    function rowForBinding (binding) {\n      const row = dom.createElement('tr')\n      style.setStyle(row, 'autocompleteRowStyle')\n      row.setAttribute('style', 'padding: 0.3em;')\n      row.style.color = allDisplayed ? '#080' : '#088' // green means 'you should find it here'\n      row.textContent = binding.name.value\n      const object = bindingToTerm(binding.subject)\n      const nameTerm = bindingToTerm(binding.name)\n      row.addEventListener('click', async _event => {\n        debug.log('       click row textContent: ' + row.textContent)\n        debug.log('       click name: ' + nameTerm.value)\n        if (object && nameTerm) {\n          gotIt(object, nameTerm as Literal)\n        }\n      })\n      return row\n    } // rowForBinding\n    function compareBindingsByName (self, other) {\n      return other.name.value > self.name.value\n        ? 1\n        : other.name.name < self.name.value ? -1 : 0\n    }\n\n    if (inputEventHandlerLock) {\n      debug.log(`Ignoring \"${searchInput.value}\" because of lock `)\n      return\n    }\n    debug.log(`Setting lock at \"${searchInput.value}\"`)\n\n    inputEventHandlerLock = true\n    const languagePrefs = await getPreferredLanguages()\n    const filter = searchInput.value.trim().toLowerCase()\n    if (filter.length < AUTOCOMPLETE_THRESHOLD) { // too small\n      clearList()\n      // candidatesLoaded = false\n      numberOfRows = AUTOCOMPLETE_ROWS\n    } else {\n      if (!allDisplayed || !lastFilter || !filter.startsWith(lastFilter)) {\n        debug.log(`   Querying database at \"${filter}\" cf last \"${lastFilter}\".`)\n        lastBindings = await loadBindingsAndFilterByLanguage(filter, languagePrefs) // freesh query\n      }\n      // Trim table as search gets tighter:\n      const slimmed = filterByName(filter, lastBindings)\n      if (loadedEnough && slimmed.length <= AUTOCOMPLETE_ROWS_STRETCH) {\n        numberOfRows = slimmed.length // stretch if it means we get all items\n      }\n      allDisplayed = loadedEnough && slimmed.length <= numberOfRows\n      debug.log(` Filter:\"${filter}\" lastBindings: ${lastBindings.length}, slimmed to ${slimmed.length}; rows: ${numberOfRows}, Enough? ${loadedEnough}, All displayed? ${allDisplayed}`)\n\n      const displayable = slimmed.slice(0, numberOfRows)\n\n      displayable.sort(compareBindingsByName)\n      clearList()\n      for (const binding of displayable) {\n        table.appendChild(rowForBinding(binding))\n      }\n      if (slimmed.length === 1) {\n        gotIt(bindingToTerm(slimmed[0].subject), bindingToTerm(slimmed[0].name) as Literal)\n      }\n    } // else\n    inputEventHandlerLock = false\n  } // refreshList\n\n  function initialize () {\n    if (acOptions.currentObject) { // If have existing value then jump into the endgame of the autocomplete\n      searchInput.value = acOptions.currentName ? acOptions.currentName.value : '??? wot no name for ' + acOptions.currentObject\n      foundName = acOptions.currentName\n      lastFilter = acOptions.currentName ? acOptions.currentName.value : undefined\n      foundObject = acOptions.currentObject\n    } else {\n      searchInput.value = ''\n      lastFilter = undefined\n      foundObject = undefined\n    }\n    if (decoration.deleteButton) {\n      setVisible(decoration.deleteButton, !!acOptions.currentObject)\n    }\n\n    if (decoration.acceptButton) {\n      setVisible(decoration.acceptButton, false) // hide until input complete\n    }\n    if (decoration.editButton) {\n      setVisible(decoration.editButton, true)\n    }\n    if (decoration.cancelButton) {\n      setVisible(decoration.cancelButton, false) // only allow cancel when there is something to cancel\n    }\n    inputEventHandlerLock = false\n    clearList()\n  } // initialiize\n\n  // const queryParams: QueryParameters = acOptions.queryParams\n  const targetClass = acOptions.targetClass\n  if (!targetClass) throw new Error('renderAutoComplete: missing targetClass')\n  // console.log(`renderAutoComplete: targetClass=${targetClass}` )\n  if (decoration.acceptButton) {\n    decoration.acceptButton.addEventListener('click', acceptButtonHandler, false)\n  }\n  if (decoration.cancelButton) {\n    decoration.cancelButton.addEventListener('click', cancelButtonHandler, false)\n  }\n\n  // var candidatesLoaded = false\n  let lastBindings\n  let loadedEnough = false\n  let inputEventHandlerLock = false\n  let allDisplayed = false\n  let lastFilter = undefined as (string | undefined)\n  let numberOfRows = AUTOCOMPLETE_ROWS // this gets slimmed down\n  const div = dom.createElement('div')\n  let foundName = undefined as (Literal | undefined)// once found accepted string must match this\n  let foundObject = undefined as (NamedNode | Literal | undefined)\n  const table = div.appendChild(dom.createElement('table'))\n  table.setAttribute('data-testid', 'autocomplete-table')\n  table.setAttribute('style', 'max-width: 30em; margin: 0.5em;')\n  const head = table.appendChild(dom.createElement('tr'))\n  style.setStyle(head, 'autocompleteRowStyle') // textInputStyle or\n  const cell = head.appendChild(dom.createElement('td'))\n  const searchInput = cell.appendChild(dom.createElement('input'))\n  searchInput.setAttribute('type', 'text')\n\n  initialize()\n\n  const size = acOptions.size || styleConstants.textInputSize || 20\n  searchInput.setAttribute('size', size)\n  searchInput.setAttribute('data-testid', 'autocomplete-input')\n\n  const searchInputStyle = style.textInputStyle || // searchInputStyle ?\n    'border: 0.1em solid #444; border-radius: 0.5em; width: 100%; font-size: 100%; padding: 0.1em 0.6em' // @\n  searchInput.setAttribute('style', searchInputStyle)\n  searchInput.addEventListener('keyup', function (event) {\n    if (event.keyCode === 13) {\n      acceptButtonHandler(event)\n    }\n  }, false)\n\n  searchInput.addEventListener('input', inputEventHHandler)\n  // console.log('@@ renderAutoComplete returns ' + div.innerHTML)\n  return div\n} // renderAutoComplete\n\n// ENDS\n","/* The Autocomplete Control with decorations\n\nThis control has the buttons which control the state between editing, viewing, searching, accepting\nand so on.  See the state diagram in the documentation.  The AUtocomplete Picker does the main work.\n\n*/\nimport ns from '../../../ns'\nimport { icons } from '../../../iconBase'\nimport { store } from 'solid-logic'\nimport * as widgets from '../../../widgets'\nimport * as utils from '../../../utils'\n\nimport { renderAutoComplete, AutocompleteDecoration, setVisible } from './autocompletePicker' // dbpediaParameters\n\nimport { NamedNode } from 'rdflib'\n\nconst WEBID_NOUN = 'Solid ID'\n\nconst GREEN_PLUS = icons.iconBase + 'noun_34653_green.svg'\nconst SEARCH_ICON = icons.iconBase + 'noun_Search_875351.svg'\nconst EDIT_ICON = icons.iconBase + 'noun_253504.svg'\n// const DELETE_ICON = icons.iconBase + 'noun_2188_red.svg'\n\nexport async function renderAutocompleteControl (dom:HTMLDocument,\n  person:NamedNode,\n  barOptions,\n  acOptions,\n  addOneIdAndRefresh,\n  deleteOne): Promise<HTMLElement> {\n  async function autoCompleteDone (object, name) {\n    if (acOptions.permanent) { // remember to set this in publicid panel\n      setVisible(editButton, true)\n      setVisible(acceptButton, false)\n      setVisible(cancelButton, false)\n    } else {\n      // console.log('temporary - removed decoratiion')\n      removeDecorated()\n    }\n    return addOneIdAndRefresh(object, name)\n  }\n\n  async function greenButtonHandler (_event) {\n    const webid = await widgets.askName(dom, store, creationArea, ns.vcard('url'), undefined, WEBID_NOUN)\n    if (!webid) {\n      return // cancelled by user\n    }\n    return addOneIdAndRefresh(person, webid)\n  }\n\n  function removeDecorated () {\n    if (decoratedAutocomplete) {\n      creationArea.removeChild(decoratedAutocomplete)\n      decoratedAutocomplete = undefined\n    }\n  }\n\n  async function displayAutocomplete () {\n    decoratedAutocomplete = dom.createElement('div') as HTMLElement\n    decoratedAutocomplete.setAttribute('style', 'display: flex; flex-flow: wrap;')\n    decoratedAutocomplete.appendChild(await renderAutoComplete(dom, acOptions, decoration, autoCompleteDone))\n    // console.log('@@ acceptButton', acceptButton)\n    decoratedAutocomplete.appendChild(acceptButton)\n    // console.log('@@ cancelButton', cancelButton)\n\n    decoratedAutocomplete.appendChild(cancelButton)\n    // console.log('@@ editButton', editButton)\n\n    decoratedAutocomplete.appendChild(editButton)\n    // console.log('@@ deleteButtonContainer', deleteButtonContainer)\n\n    decoratedAutocomplete.appendChild(deleteButtonContainer)\n    creationArea.appendChild(decoratedAutocomplete)\n  }\n\n  async function searchButtonHandler (_event) {\n    if (decoratedAutocomplete) {\n      creationArea.removeChild(decoratedAutocomplete)\n      decoratedAutocomplete = undefined\n    } else {\n      await displayAutocomplete()\n    }\n  }\n\n  async function droppedURIHandler (uris) {\n    for (const webid of uris) { // normally one but can be more than one\n      await addOneIdAndRefresh(person, webid)\n    }\n  }\n\n  const acceptButton = widgets.continueButton(dom)\n  acceptButton.setAttribute('data-testid', 'accept-button')\n\n  const cancelButton = widgets.cancelButton(dom)\n  cancelButton.setAttribute('data-testid', 'cancel-button')\n  const deleteButtonContainer = dom.createElement('div')\n  const noun = acOptions.targetClass ? utils.label(acOptions.targetClass) : 'item'\n  const deleteButton = widgets.deleteButtonWithCheck(dom, deleteButtonContainer, noun, deleteOne) // need to knock out this UI or caller does that\n  deleteButton.setAttribute('data-testid', 'delete-button')\n  const editButton = widgets.button(dom, EDIT_ICON, 'Edit', _event => {\n    editing = !editing\n    syncEditingStatus()\n  })\n  editButton.setAttribute('data-testid', 'edit-button')\n  let editing = true\n\n  function syncEditingStatus () {\n    if (editing) {\n      setVisible(editButton, false)\n      setVisible(acceptButton, false) // not till got it\n      setVisible(cancelButton, false)\n    } else {\n      setVisible(editButton, true)\n      setVisible(acceptButton, false)\n      setVisible(cancelButton, false)\n    }\n  }\n\n  const decoration:AutocompleteDecoration = {\n    acceptButton, cancelButton, editButton, deleteButton\n  }\n\n  let decoratedAutocomplete = undefined as HTMLElement | undefined\n\n  const creationArea = dom.createElement('div')\n  creationArea.style.display = 'flex'\n  creationArea.style.flexDirection = 'row'\n\n  if (acOptions.permanent || acOptions.currentObject) {\n    await displayAutocomplete()\n  }\n  if (barOptions.editable) {\n    // creationArea.appendChild(await renderAutoComplete(dom, barOptions, autoCompleteDone)) wait for searchButton\n    creationArea.style.width = '100%'\n    if (barOptions.manualURIEntry) {\n      const plus = creationArea.appendChild(widgets.button(dom, GREEN_PLUS, barOptions.idNoun, greenButtonHandler))\n      widgets.makeDropTarget(plus, droppedURIHandler, undefined)\n    }\n    if (barOptions.dbLookup && !acOptions.currentObject && !acOptions.permanent) {\n      creationArea.appendChild(widgets.button(dom, SEARCH_ICON, barOptions.idNoun, searchButtonHandler))\n    }\n  }\n  syncEditingStatus()\n  return creationArea\n} // renderAutocompleteControl\n\n// ends\n","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nfunction _toConsumableArray(r) {\n  return arrayWithoutHoles(r) || iterableToArray(r) || unsupportedIterableToArray(r) || nonIterableSpread();\n}\nexport { _toConsumableArray as default };","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return arrayLikeToArray(r);\n}\nexport { _arrayWithoutHoles as default };","function _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nexport { _iterableToArray as default };","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nexport { _nonIterableSpread as default };","/*\n * BASED ON:\n * IconicMultiSelect v0.7.0\n * Licence:  MIT\n * (c) 2021 Sidney Wimart.\n * repo & configuration: https://github.com/sidneywm/iconic-multiselect\n */\n\n/**\n * @version IconicMultiSelect v0.7.0\n * @licence  MIT\n */\nexport const style = {\n\n  multiselect__container: `\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n        background-color: #fff;\n        border-radius: 2px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n                box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        min-height: 36px;\n        padding: 4px 8px 0 8px;\n        position: relative;\n        width: 354px;\n        margin-bottom: 5px;\n        font-size: 100%\n    `,\n\n  /*\n    multiselect__container:after: `\n        content: '';\n        min-height:inherit;\n        font-size:0;\n    `,\n\n    multiselect__container > *: `\n    color: #656565;\n    font-size: 14px;\n    `,\n*/\n  multiselect__wrapper: `\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -ms-flex-wrap: wrap;\n            flex-wrap: wrap;\n        height: 100%;\n        width: 100%;\n    `,\n\n  multiselect__clear_btn: `\n        cursor: pointer;\n        align-items: center;\n        margin-bottom: 4px;\n        margin-left: 4px;\n    `,\n\n  multiselect__options: `\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n    `,\n\n  multiselect__options_visible: `\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n        max-height: 200px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        opacity: 1;\n        transition: max-height 0.2s ease;\n    `,\n\n  multiselect__options_ul: `\n        list-style: none;\n        margin: 0;\n        padding: 2px 0;\n        max-height: 200px;\n        overflow: auto;\n    `,\n\n  multiselect__options_ul_li: `\n        cursor: pointer;\n        padding: 4px 8px;\n    `,\n\n  // multiselect__options ul li:hover: `\n  multiselect__options_ul_li_hover: `\n        background-color: #dedede;\n    `,\n\n  /*\n    multiselect__options ul li *: `\n    pointer-events: none;\n    `,\n*/\n\n  multiselect__options_ul_p_multiselect__options_no_results: `\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    `,\n\n  multiselect__options_ul_p_multiselect__options_no_data: `\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    `,\n\n  // multiselect__options ul li.multiselect__options--selected: `\n  multiselect__options_ul_li_multiselect__options_selected: `\n        background-color: #656565;\n        color: #fff;\n    `,\n\n  // multiselect__options ul li.multiselect__options--selected:hover: `\n  multiselect__options_ul_li_multiselect__options_selected_hover: `\n    background-color: #656565;\n    `,\n\n  // multiselect__options ul li.arrow-selected: `\n  multiselect__options_ul_li_arrow_selected: `\n        border: 2px solid rgba(101, 101, 101, 0.5);\n    `,\n\n  multiselect__selected: `\n        background-color: #656565;\n        border-radius: 2px;\n        color: #fff;\n        margin-bottom: 4px;\n        margin-right: 4px;\n        padding: 4px 8px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n    `,\n\n  multiselect__selected_multiselect__remove_btn: `\n        cursor: pointer;\n        display: flex;\n        margin-left: 6px;\n    `,\n\n  multiselect__input: `\n        border: none;\n        -ms-flex-preferred-size: 40%;\n            flex-basis: 40%;\n        -webkit-box-flex: 1;\n            -ms-flex-positive: 1;\n                flex-grow: 1;\n        height: 5px;        \n        margin-bottom: 4px;\n        min-width: 40%;\n        outline: none;      \n    `\n}\n\nstyle.setStyle = function setStyle (ele, styleName) {\n  ele.style = style[styleName]\n}\n","/*\n * IconicMultiSelect v0.7.0\n * Licence:  MIT\n * (c) 2021 Sidney Wimart.\n * repo & configuration: https://github.com/sidneywm/iconic-multiselect\n */\n\n/**\n * @version IconicMultiSelect v0.7.0\n * @licence  MIT\n */\nimport { style } from '../style_multiSelect'\n\nexport class IconicMultiSelect {\n  _data\n  _domElements\n  _event = () => {}\n  _itemTemplate\n  _multiselect\n  _noData\n  _noResults\n  _options = []\n  _placeholder\n  _select\n  _selectContainer\n  _selectedOptions = []\n  _tagTemplate\n  _textField\n  _valueField\n  _cross = `\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n    `\n\n  /**\n   * Iconic Multiselect constructor.\n   * @param { Object[] } data - Array of objects.\n   * @param { string } noData - Defines the message when there is no data input.\n   * @param { string } noResults - Defines the message when there is no result if options are filtered.\n   * @param { string } placeholder -  Defines the placeholder's text.\n   * @param { string } select - DOM element to be selected. It must be a HTML Select tag - https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select\n   * @param { string } textField - Field to select in the object for the text.\n   * @param { string } valueField - Field to select in the object for the value.\n   */\n  constructor ({ data, itemTemplate, noData, noResults, placeholder, select, container, tagTemplate, textField, valueField }) {\n    this._data = data ?? []\n    this._itemTemplate = itemTemplate ?? null\n    this._noData = noData ?? 'No data found.'\n    this._noResults = noResults ?? 'No results found.'\n    this._placeholder = placeholder ?? 'Select...'\n    this._select = select\n    // Timea added a container here\n    this._selectContainer = container\n    this._tagTemplate = tagTemplate ?? null\n    this._textField = textField ?? null\n    this._valueField = valueField ?? null\n  }\n\n  /**\n   * Initialize the Iconic Multiselect component.\n   * @public\n   */\n  init () {\n    // Timea change to use this._select instead of this._selectContainer\n    if (this._select && this._select.nodeName === 'SELECT') {\n      if (this._itemTemplate && this._data.length === 0) { throw new Error('itemTemplate must be initialized with data from the component settings') }\n      if (this._tagTemplate && this._data.length === 0) { throw new Error('tagTemplate must be initialized with data from the component settings') }\n\n      this._options = this._data.length > 0 ? this._getDataFromSettings() : this._getDataFromSelectTag()\n\n      this._renderMultiselect()\n      this._renderOptionsList()\n\n      this._domElements = {\n        clear: this._multiselect.querySelector('.multiselect__clear-btn'),\n        input: this._multiselect.querySelector('.multiselect__input'),\n        optionsContainer: this._multiselect.querySelector('.multiselect__options'),\n        optionsContainerList: this._multiselect.querySelector('.multiselect__options > ul'),\n        options: {\n          list: this._multiselect.querySelectorAll('.multiselect__options > ul > li'),\n          find: function (callbackFn) {\n            for (let i = 0; i < this.list.length; i++) {\n              const node = this.list[i]\n              if (callbackFn(node)) return node\n            }\n            return undefined\n          },\n          some: function (callbackFn) {\n            for (let i = 0; i < this.list.length; i++) {\n              const node = this.list[i]\n              if (callbackFn(node, i)) return true\n            }\n            return false\n          }\n        }\n      }\n\n      this._enableEventListenners()\n      this._initSelectedList()\n    } else {\n      throw new Error(`The selector '${this._select}' did not select any valid select tag.`)\n    }\n  }\n\n  /**\n   * Subscribes to the emitted events.\n   * @param { Function } callback - Callback function which emits a custom event object.\n   * @public\n   */\n  subscribe (callback) {\n    if (typeof callback === 'function') {\n      this._event = callback\n    } else {\n      throw new Error('parameter in the subscribe method is not a function')\n    }\n  }\n\n  /**\n   * Add an option to the selection list.\n   * @param { Object: { text: string; value: string; }} option\n   * @private\n   */\n  _addOptionToList (option, index) {\n    const html = `<span class=\"multiselect__selected\" style=\"${style.multiselect__selected}\" data-value=\"${option.value}\">${\n      this._tagTemplate ? this._processTemplate(this._tagTemplate, index) : option.text\n    }<span class=\"multiselect__remove-btn\" style=\"${style.multiselect__remove_btn}\">${this._cross}</span></span>`\n\n    this._domElements.input.insertAdjacentHTML('beforebegin', html)\n\n    const { lastElementChild: removeBtn } = this._multiselect.querySelector(`span[data-value=\"${option.value}\"]`)\n    removeBtn.addEventListener('click', () => {\n      const target = this._domElements.options.find((el) => el.dataset.value === option.value)\n      this._handleOption(target)\n    })\n  }\n\n  /**\n   * Clears all selected options.\n   * @private\n   */\n  _clearSelection () {\n    for (let i = 0; i < this._selectedOptions.length; i++) {\n      const option = this._selectedOptions[i]\n      const target = this._domElements.options.find((el) => el.dataset.value === option.value)\n      target.classList.remove('multiselect__options--selected')\n      target.setAttribute('style', style.multiselect__options)\n      this._removeOptionFromList(target.dataset.value)\n    }\n    this._selectedOptions = []\n    this._handleClearSelectionBtn()\n    this._handlePlaceholder()\n    this._dispatchEvent({\n      action: 'CLEAR_ALL_OPTIONS',\n      selection: this._selectedOptions\n    })\n  }\n\n  /**\n   * Close the options container.\n   * @private\n   */\n  _closeList () {\n    this._domElements.input.value = ''\n    this._domElements.optionsContainer.classList.remove('visible')\n    this._domElements.optionsContainer.setAttribute('style', style.multiselect__options)\n    this._filterOptions('')\n    this._removeAllArrowSelected()\n  }\n\n  /**\n   * Dispatches new events.\n   * @param { object : { action: string; selection: { option: string; text: string; }[]; value?: string; } } event\n   * @private\n   */\n  _dispatchEvent (event) {\n    this._event(event)\n  }\n\n  /**\n   * Enables all main event listenners.\n   * @private\n   */\n  _enableEventListenners () {\n    document.addEventListener('mouseup', ({ target }) => {\n      if (!this._multiselect.contains(target)) {\n        this._filterOptions('')\n        this._closeList()\n        this._handlePlaceholder()\n      }\n    })\n\n    this._domElements.clear.addEventListener('click', () => {\n      this._clearSelection()\n    })\n\n    for (let i = 0; i < this._domElements.options.list.length; i++) {\n      const option = this._domElements.options.list[i]\n      option.addEventListener('click', ({ target }) => {\n        this._handleOption(target)\n        this._closeList()\n      })\n    }\n\n    this._domElements.input.addEventListener('focus', () => {\n      this._domElements.optionsContainer.classList.add('visible')\n      this._domElements.optionsContainer.setAttribute('style', style.multiselect__options_visible)\n    })\n\n    this._domElements.input.addEventListener('input', ({ target: { value } }) => {\n      if (this._domElements.options.list.length > 0) {\n        this._filterOptions(value)\n      }\n    })\n\n    this._domElements.input.addEventListener('keydown', (e) => {\n      this._handleArrows(e)\n      this._handleBackspace(e)\n      this._handleEnter(e)\n    })\n  }\n\n  /**\n   * Filters user input.\n   * @param { string } value\n   * @private\n   */\n  _filterOptions (value) {\n    const isOpen = this._domElements.optionsContainer.classList.contains('visible')\n    const valueLowerCase = value.toLowerCase()\n\n    if (!isOpen && value.length > 0) {\n      this._domElements.optionsContainer.classList.add('visible')\n      this._domElements.optionsContainer.setAttribute('style', style.multiselect__options_visible)\n    }\n\n    if (this._domElements.options.list.length > 0) {\n      for (let i = 0; i < this._domElements.options.list.length; i++) {\n        const el = this._domElements.options.list[i]\n        const text = this._itemTemplate ? this._data[i][this._textField] : el.textContent\n\n        if (text.toLowerCase().substring(0, valueLowerCase.length) === valueLowerCase) {\n          this._domElements.optionsContainerList.appendChild(el)\n        } else {\n          el.parentNode && el.parentNode.removeChild(el)\n        }\n      }\n\n      const hasResults = this._domElements.options.some(\n        (el, index) =>\n          (this._itemTemplate ? this._data[index][this._textField] : el.textContent)\n            .toLowerCase()\n            .substring(0, valueLowerCase.length) === valueLowerCase\n      )\n      this._showNoResults(!hasResults)\n    }\n  }\n\n  _generateId (length) {\n    let result = ''\n    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n    const charactersLength = characters.length\n    for (let i = 0; i < length; i++) {\n      result += characters.charAt(Math.floor(Math.random() * charactersLength))\n    }\n    return result\n  }\n\n  /**\n   * Gets data from select tag.\n   * @private\n   */\n  _getDataFromSelectTag () {\n    const arr = []\n    const { options } = this._select\n    for (let i = 0; i < options.length; i++) {\n      const item = options[i]\n      arr.push({\n        text: item.text,\n        value: item.value,\n        selected: item.hasAttribute('selected')\n      })\n    }\n    return arr\n  }\n\n  /**\n   * Gets data from settings.\n   * @private\n   */\n  _getDataFromSettings () {\n    if (this._data.length > 0 && this._valueField && this._textField) {\n      const isValueFieldValid = typeof this._valueField === 'string'\n      const isTextFieldValid = typeof this._textField === 'string'\n      const arr = []\n\n      if (!isValueFieldValid || !isTextFieldValid) {\n        throw new Error('textField and valueField must be of type string')\n      }\n\n      for (let i = 0; i < this._data.length; i++) {\n        const item = this._data[i]\n        arr.push({\n          value: item[this._valueField],\n          text: item[this._textField],\n          selected: typeof item.selected === 'boolean' ? item.selected : false\n        })\n      }\n      return arr\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Handles Arrow up & Down. Selection of an option is also possible with these keys.\n   * @param { Event } event\n   * @private\n   */\n  _handleArrows (event) {\n    if (event.keyCode === 40 || event.keyCode === 38) {\n      event.preventDefault()\n      const isOpen = this._domElements.optionsContainer.classList.contains('visible')\n      // An updated view of the container is needed because of the filtering option\n      const optionsContainerList = this._multiselect.querySelector('.multiselect__options > ul')\n\n      if (!isOpen) {\n        this._domElements.optionsContainer.classList.add('visible')\n        this._domElements.optionsContainer.setAttribute('style', style.multiselect__options_visible)\n        optionsContainerList.firstElementChild.classList.add('arrow-selected')\n        optionsContainerList.firstElementChild.setAttribute('style', style.multiselect__options_ul_li_arrow_selected)\n        optionsContainerList.firstElementChild.scrollIntoView(false)\n      } else {\n        let selected = this._multiselect.querySelector('.multiselect__options ul li.arrow-selected')\n        const action = {\n          ArrowUp: 'previous',\n          Up: 'previous',\n          ArrowDown: 'next',\n          Down: 'next'\n        }\n\n        if (!selected) {\n          optionsContainerList.firstElementChild.classList.add('arrow-selected')\n          optionsContainerList.firstElementChild.setAttribute('style', style.multiselect__options_ul_li_arrow_selected)\n          optionsContainerList.firstElementChild.scrollIntoView(false)\n          return\n        }\n\n        selected.classList.remove('arrow-selected')\n        selected.setAttribute('style', style.multiselect__options_ul_li)\n\n        selected = selected[action[event.key] + 'ElementSibling']\n\n        // Go to start or end of the popup list\n        if (!selected) {\n          selected =\n          optionsContainerList.children[action[event.key] === 'next' ? 0 : optionsContainerList.children.length - 1]\n          selected.classList.add('arrow-selected')\n          selected.setAttribute('style', style.multiselect__options_ul_li_arrow_selected)\n          this._scrollIntoView(optionsContainerList, selected)\n          return\n        }\n\n        selected.classList.add('arrow-selected')\n        selected.setAttribute('style', style.multiselect__options_ul_li_arrow_selected)\n        this._scrollIntoView(optionsContainerList, selected)\n      }\n    }\n  }\n\n  /**\n   * Handles the backspace key event - Deletes the preceding option in the selection list.\n   * @param { Event } e\n   * @private\n   */\n  _handleBackspace (e) {\n    if (e.keyCode === 8 && e.target.value === '') {\n      const lastSelectedOption =\n        this._selectedOptions.length > 0 ? this._selectedOptions[this._selectedOptions.length - 1] : null\n\n      if (lastSelectedOption) {\n        const targetLastSelectedOption = this._multiselect.querySelector(\n          `li[data-value=\"${lastSelectedOption.value}\"]`\n        )\n        this._handleOption(targetLastSelectedOption)\n\n        if (this._selectedOptions.length === 0) {\n          this._domElements.optionsContainer.classList.remove('visible')\n          this._domElements.optionsContainer.setAttribute('style', style.multiselect__options)\n        }\n      }\n    }\n  }\n\n  /**\n   * Shows clear selection button if some options are selected.\n   * @private\n   */\n  _handleClearSelectionBtn () {\n    if (this._selectedOptions.length > 0) {\n      this._domElements.clear.style.display = 'flex'\n    } else {\n      this._domElements.clear.style.display = 'none'\n    }\n  }\n\n  /**\n   * Handles the enter key event.\n   * @param { Event } event\n   * @private\n   */\n  _handleEnter (event) {\n    if (event.keyCode === 13) {\n      const selected = this._multiselect.querySelector('.multiselect__options ul li.arrow-selected')\n      if (selected) {\n        this._handleOption(selected)\n        this._closeList()\n      }\n    }\n  }\n\n  _handleOption (target, dispatchEvent = true) {\n    // Remove\n    for (let i = 0; i < this._selectedOptions.length; i++) {\n      const el = this._selectedOptions[i]\n      if (el.value === target.dataset.value) {\n        target.classList.remove('multiselect__options--selected')\n        target.setAttribute('style', style.multiselect__options)\n        this._selectedOptions.splice(i, 1)\n        this._removeOptionFromList(target.dataset.value)\n        this._handleClearSelectionBtn()\n        this._handlePlaceholder()\n\n        return (\n          dispatchEvent &&\n          this._dispatchEvent({\n            action: 'REMOVE_OPTION',\n            value: target.dataset.value,\n            selection: this._selectedOptions\n          })\n        )\n      }\n    }\n\n    // Add\n    for (let i = 0; i < this._options.length; i++) {\n      const option = this._options[i]\n      if (option.value === target.dataset.value) {\n        target.classList.add('multiselect__options--selected')\n        target.setAttribute('style', style.multiselect__options_selected)\n        this._selectedOptions = [...this._selectedOptions, option]\n        this._addOptionToList(option, i)\n        this._handleClearSelectionBtn()\n        this._handlePlaceholder()\n\n        return (\n          dispatchEvent &&\n          this._dispatchEvent({\n            action: 'ADD_OPTION',\n            value: target.dataset.value,\n            selection: this._selectedOptions\n          })\n        )\n      }\n    }\n  }\n\n  /**\n   * Shows the placeholder if no options are selected.\n   * @private\n   */\n  _handlePlaceholder () {\n    this._domElements.input.placeholder = this._placeholder\n  }\n\n  _initSelectedList () {\n    let hasItemsSelected = false\n\n    for (let i = 0; i < this._options.length; i++) {\n      const option = this._options[i]\n      if (option.selected) {\n        hasItemsSelected = true\n        const target = this._domElements.options.find((el) => el.dataset.value === option.value)\n        target.classList.add('multiselect__options--selected')\n        target.setAttribute('style', style.multiselect__options_selected)\n        this._selectedOptions = [...this._selectedOptions, option]\n        this._addOptionToList(option, i)\n      }\n    }\n\n    if (hasItemsSelected) { this._handleClearSelectionBtn() }\n    this._handlePlaceholder()\n  }\n\n  /**\n   * Process the custom template.\n   * @param { string } template\n   * @private\n   */\n  _processTemplate (template, index) {\n    let processedTemplate = template\n    const objAttr = template.match(/\\$\\{(\\w+)\\}/g).map((e) => e.replace(/\\$\\{|\\}/g, ''))\n\n    for (let i = 0; i < objAttr.length; i++) {\n      const attr = objAttr[i]\n      // eslint-disable-next-line no-useless-escape\n      processedTemplate = processedTemplate.replace(`\\$\\{${attr}\\}`, this._data[index][attr] ?? '')\n    }\n\n    return processedTemplate\n  }\n\n  _removeAllArrowSelected () {\n    const className = 'arrow-selected'\n    const target = this._domElements.options.find((el) => el.classList.contains(className))\n    target && target.classList.remove(className) && target.setAttribute('style', style.multiselect__options_ul_li)\n  }\n\n  /**\n   * Removes an option from the list.\n   * @param { string } value\n   * @private\n   */\n  _removeOptionFromList (value) {\n    const optionDom = this._multiselect.querySelector(`span[data-value=\"${value}\"]`)\n    optionDom && optionDom.parentNode && optionDom.parentNode.removeChild(optionDom)\n  }\n\n  /**\n   * Renders the multiselect options list view.\n   * @private\n   */\n  _renderOptionsList () {\n    const html = `\n        <div class=\"multiselect__options\" style=\"${style.multiselect__options}\">\n          <ul style=\"${style.multiselect__options_ul}\">\n          ${\n            this._options.length > 0 && !this._itemTemplate\n              ? this._options\n                  .map((option) => {\n                    return `\n              <li data-value=\"${option.value}\" style=\"${style.multiselect__options_ul_li}\">${option.text}</li>\n            `\n                  })\n                  .join('')\n              : ''\n          }\n\n          ${\n            this._options.length > 0 && this._itemTemplate\n              ? this._options\n                  .map((option, index) => {\n                    return `\n              <li data-value=\"${option.value}\" style=\"${style.multiselect__options_ul_li}\">${this._processTemplate(this._itemTemplate, index)}</li>\n            `\n                  })\n                  .join('')\n              : ''\n          }\n          ${this._showNoData(this._options.length === 0)}\n          </ul>\n        </div>\n      `\n\n    this._multiselect.insertAdjacentHTML('beforeend', html)\n  }\n\n  /**\n   * Renders the multiselect view.\n   * @private\n   */\n  _renderMultiselect () {\n    this._select.style.display = 'none'\n    const id = 'iconic-' + this._generateId(20)\n    // Timea created dedicated div element because previous code was not rendering\n    this._multiselect = document.createElement('div')\n    this._multiselect.setAttribute('id', id)\n    this._multiselect.setAttribute('class', 'multiselect__container')\n    this._multiselect.setAttribute('style', style.multiselect__container)\n    const html = `\n        <div class=\"multiselect__wrapper\" style=\"${style.multiselect__wrapper}\">\n          <input class=\"multiselect__input\" style=\"${style.multiselect__input}\" placeholder=\"${this._placeholder}\" />\n        </div>\n        <span style=\"display: none;\" class=\"multiselect__clear-btn\" style=\"${style.multiselect__clear_btn}\">${this._cross}</span>\n    `\n    this._multiselect.innerHTML = html\n    this._selectContainer.appendChild(this._multiselect)\n  }\n\n  /**\n   * ScrollIntoView - This small utility reproduces the behavior of .scrollIntoView({ block: \"nearest\", inline: \"nearest\" })\n   * This is for IE compatibility without a need of a polyfill\n   * @private\n   */\n  _scrollIntoView (parent, child) {\n    const rectParent = parent.getBoundingClientRect()\n    const rectChild = child.getBoundingClientRect()\n\n    // Detect if not visible at top and then scroll to the top\n    if (!(rectParent.top < rectChild.bottom - child.offsetHeight)) {\n      parent.scrollTop = child.clientHeight + (child.offsetTop - child.offsetHeight)\n    }\n\n    // Detect if not visible at bottom and then scroll to the bottom\n    if (!(rectParent.bottom > rectChild.top + child.offsetHeight)) {\n      parent.scrollTop =\n        child.clientHeight +\n        (child.offsetTop - child.offsetHeight) -\n        (parent.offsetHeight - (child.offsetHeight + (child.offsetHeight - child.clientHeight)))\n    }\n  }\n\n  /**\n   * Shows a no data message.\n   * @param { boolean } condition\n   * @private\n   */\n  _showNoData (condition) {\n    return condition ? `<p class=\"multiselect__options--no-data\" style=\"${style.multiselect__options_ul_p_multiselect__options_no_data}\">${this._noData}</p>` : ''\n  }\n\n  /**\n   * Shows a no results message.\n   * @param { boolean } condition\n   * @private\n   */\n  _showNoResults (condition) {\n    const dom = this._multiselect.querySelector('.multiselect__options--no-results')\n    if (condition) {\n      const html = `<p class=\"multiselect__options--no-results\" style=\"${style.multiselect__options_ul_p_multiselect__options_no_results}\">${this._noResults}</p>`\n      !dom && this._domElements.optionsContainerList.insertAdjacentHTML('beforeend', html)\n    } else {\n      dom && dom.parentNode && dom.parentNode.removeChild(dom)\n    }\n  }\n}\n","/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n\n/* global alert */\n\nimport * as buttons from './buttons'\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport { setFieldStyle } from './forms/formStyle'\nimport * as debug from '../debug'\nimport { errorMessageBlock } from './error'\nimport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic'\nimport { autocompleteField } from './forms/autocomplete/autocompleteField'\nimport { style } from '../style'\nimport styleConstants from '../styleConstants'\n\nimport { icons } from '../iconBase'\nimport * as log from '../log'\nimport ns from '../ns'\nimport * as $rdf from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { IconicMultiSelect } from './multiSelect'\nimport * as widgets from '../widgets'\nexport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic' // Note default export\n\nexport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nexport { fieldParams } from './forms/fieldParams'\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\nconst kb = store\n\nfield[ns.ui('AutocompleteField').uri] = autocompleteField\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nfunction refreshOpionsSubfieldinGroup (dom, already, subject, dataDoc, callbackFunction, groupDiv, subfields) {\n  const eles = groupDiv.children\n  for (let j = 0; j < subfields.length; j++) {\n    // This is really messy.\n    const field = subfields[j]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ns.ui('Options').uri) {\n      const optionsRender = fieldFunction(dom, field)\n      const newOne = optionsRender(\n        dom,\n        null,\n        already,\n        subject,\n        field,\n        dataDoc,\n        callbackFunction\n      )\n      debug.log('Refreshing Options field by replacing it.') // better to support actual refresh\n      groupDiv.insertBefore(newOne, eles[j])\n      groupDiv.removeChild(eles[j + 1]) // Remove the old one\n    }\n  }\n}\n\nfield[ns.ui('Form').uri] = field[ns.ui('Group').uri] =\n    function (dom, container, already, subject, form, dataDoc, callbackFunction) {\n      const box = dom.createElement('div')\n      const ui = ns.ui\n      if (container) container.appendChild(box)\n\n      // Prevent loops\n      if (!form) return\n      const key = subject.toNT() + '|' + form.toNT()\n      if (already[key]) {\n        // been there done that\n        box.appendChild(dom.createTextNode('Group: see above ' + key))\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        // const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n        // dom.outlineManager.appendPropertyTRs(box, plist)\n        // dom.appendChild(plist)\n        return box\n      }\n      const already2 = {}\n      for (const x in already) already2[x] = 1\n      already2[key] = 1\n      const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n      const weight0 = kb.any(form, ui('weight'), null, formDoc) // Say 0-3\n      const weight = weight0 ? Number(weight0.value) : 1\n      if (weight > 3 || weight < 0) return box.appendChild(errorMessageBlock(dom, `Form Group weight ${weight} should be 0-3`))\n\n      box.setAttribute('style', style.formGroupStyle[weight]) // Indent a group\n      box.style.display = 'flex'\n      box.style.flexDirection = 'column'\n      box.class = 'form-weight-' + weight\n\n      let parts = kb.any(form, ui('parts'), null, formDoc)\n      let subfields\n      if (parts) {\n        subfields = parts.elements\n      } else {\n        parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n        subfields = sortBySequence(parts)\n      }\n      if (!parts) {\n        return box.appendChild(errorMessageBlock(dom, 'No parts to form! '))\n      }\n\n      for (let i = 0; i < subfields.length; i++) {\n        const field = subfields[i]\n        const subFieldFunction = fieldFunction(dom, field) //\n\n        const itemChanged = function (ok, body) {\n          if (ok && body && body.widget && body.widget === 'select') {\n            refreshOpionsSubfieldinGroup(dom, already, subject, dataDoc, callbackFunction, box, subfields)\n          }\n          callbackFunction(ok, { widget: 'group', change: body })\n        }\n        box.appendChild(subFieldFunction(dom, null, already2, subject, field, dataDoc, itemChanged))\n      }\n      return box\n    }\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nfield[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = Object.keys(kb.findTypeURIs(subject)).map(uri => $rdf.sym(uri)) // Use RDF-S inference\n  } else {\n    values = kb.each(subject, dependingOn)\n  }\n\n  for (let i = 0; i < cases.length; i++) {\n    const c = cases[i]\n    const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n    let match = false\n    for (let j = 0; j < tests.length; j++) {\n      for (const value of values) {\n        const test = tests[j]\n        if (value.sameTerm(tests) ||\n          (value.termType === test.termType && value.value === test.value)) {\n          match = true\n        }\n      }\n    }\n    if (match) {\n      const field = kb.the(c, ui('use'))\n      if (!field) {\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            'No \"use\" part for case in form ' + form\n          )\n        )\n        return box\n      } else {\n        appendForm(\n          dom,\n          box,\n          already,\n          subject,\n          field,\n          dataDoc,\n          callbackFunction\n        )\n      }\n      break\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n **\n ** Form properties:\n **      @param {Boolean} reverse Make e reverse arc in the data OPS not SPO\n **      @param {NamedNode} property The property to be written in the data\n **      @param {Boolean} ordered Is the list an ordered one where the user defined the order\n */\nfield[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem () {\n    const object = newThing(dataDoc) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      const toBeInserted = reverse ? [$rdf.st(object, property, subject, dataDoc)] : [$rdf.st(subject, property, object, dataDoc)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh()\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, dataDoc)) {\n          const del = [$rdf.st(subject, property, object, dataDoc)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (ok, message) {\n      debug.log(`Item done callback for item ${object.toString()}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      }\n      callbackFunction(ok, message)\n    }\n\n    log.debug('Multiple: render object: ' + object)\n\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, dataDoc, itemDone) // subfields was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(dataDoc.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, multipleUIlabel, deleteThisItem)\n      if (ordered) { // Add controsl in a frame\n        const frame = dom.createElement('div')\n        frame.style.display = 'grid'\n        frame.style.gridTemplateColumns = 'auto 3em'\n        frame.style.gridTemplateRows = '50% 50%'\n        const moveUpButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369237.svg', 'Move Up',\n          async event => moveThisItem(event, true))\n        const moveDownButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369241.svg', 'Move Down',\n          async event => moveThisItem(event, false))\n        const shim = dom.createElement('div')\n        shim.appendChild(subField) // Subfield has its own layout\n        frame.appendChild(shim)\n\n        frame.appendChild(moveUpButton)\n        frame.appendChild(moveDownButton)\n        moveUpButton.style.gridColumn = 2\n        moveDownButton.style.gridColumn = 2\n        moveUpButton.style.gridRow = 1\n        moveDownButton.style.padding = '0em' // don't take too much space\n        moveUpButton.style.padding = '0em'\n\n        moveDownButton.style.gridRow = 2\n        shim.style.gridColumn = 1\n        shim.style.gridRowStart = 'span 2' // Cover both rows\n        // shim.style.gridRowEnd = 2 // Cover both rows\n        return frame\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of Multiple form field implementation\n\n  const plusIconURI = icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = (dom.createElement('div'))\n  const shim = box // no  shim\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return shim\n  }\n  let multipleUIlabel = kb.any(form, ui('label'))\n  if (!multipleUIlabel) multipleUIlabel = utils.label(property)\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n\n  const element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return shim\n  }\n\n  const body = box.appendChild(dom.createElement('div'))\n  body.style.display = 'flex'\n\n  body.style.flexDirection = 'column'\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(dataDoc.uri)) {\n    const tail = box.appendChild(dom.createElement('div'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add another ' + multipleUIlabel\n    const prompt = dom.createElement('span')\n    prompt.textContent =\n      (values.length === 0 ? 'Add another ' : 'Add ') +\n      multipleUIlabel\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n    tail.appendChild(prompt)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, dataDoc)\n      } else {\n        kb.add(subject, property, list, dataDoc)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(dataDoc)\n    } catch (err) {\n      box.appendChild(\n        errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, dataDoc) : kb.the(subject, property, null, dataDoc)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return shim\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nfield[ns.ui('PhoneField').uri] = basicField\nfield[ns.ui('EmailField').uri] = basicField\nfield[ns.ui('ColorField').uri] = basicField\nfield[ns.ui('DateField').uri] = basicField\nfield[ns.ui('DateTimeField').uri] = basicField\nfield[ns.ui('TimeField').uri] = basicField\nfield[ns.ui('NumericField').uri] = basicField\nfield[ns.ui('IntegerField').uri] = basicField\nfield[ns.ui('DecimalField').uri] = basicField\nfield[ns.ui('FloatField').uri] = basicField\nfield[ns.ui('TextField').uri] = basicField\nfield[ns.ui('SingleLineTextField').uri] = basicField\nfield[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nfield[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const left = box.appendChild(dom.createElement('div'))\n  left.style.width = styleConstants.formFieldNameBoxWidth\n  const right = box.appendChild(dom.createElement('div'))\n\n  left.appendChild(fieldLabel(dom, property, form))\n  dataDoc = fieldStore(subject, property, dataDoc)\n\n  const text = kb.anyJS(subject, property, null, dataDoc) || ''\n  const editable = kb.updater.editable(dataDoc.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    dataDoc,\n    callbackFunction\n  )\n  right.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction,\n  tristate\n) {\n  const ui = ns.ui\n  const kb = store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  dataDoc = fieldStore(subject, property, dataDoc)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  const ins = $rdf.st(subject, property, true, dataDoc)\n  const del = $rdf.st(subject, property, false, dataDoc)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, dataDoc, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nfield[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    false\n  )\n}\n\nfield[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nfield[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const ui = ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  log.debug('Classifier: dataDoc=' + dataDoc)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    return callbackFunction(ok, body)\n  }\n  const box = makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Generates a subForm based on a ui:use form\n **  Will look like:\n ** <div id=dropDownDiv>\n **   <div id=labelOfDropDown>\n **   <div id=selectDiv>\n **     <select id=dropDownSelect>\n **       <option> ....\n **     <subForm>\n **  Alternative implementatons could be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** TODO: according to ontology ui:choice can also have ns.ui('default') - this is not implemented yet\n */\n\nfield[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  let p\n  const box = dom.createElement('div')\n  box.setAttribute('class', 'choiceBox')\n  // Set flexDirection column?\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName choiceBox-label')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue choiceBox-selectBox')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return box.appendChild(errorMessageBlock(dom, 'No property for Choice: ' + form))\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uiFrom = kb.any(form, ui('from'))\n  if (!uiFrom) {\n    return errorMessageBlock(dom, 'No \\'from\\' for Choice: ' + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  // const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n\n  const opts = { form, subForm, disambiguate: false }\n\n  function getSelectorOptions (dataSource) {\n    let possible = []\n    let possibleProperties\n    possible = kb.each(undefined, ns.rdf('type'), uiFrom, formDoc)\n    for (const x in findMembersNT(kb, uiFrom, dataSource)) {\n      possible.push(kb.fromNT(x))\n    } // Use rdfs\n\n    if (uiFrom.sameTerm(ns.rdfs('Class'))) {\n      for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n      // log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n    } else if (uiFrom.sameTerm(ns.rdf('Property'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true // This is a big class, and the labels won't be enough.\n    } else if (uiFrom.sameTerm(ns.owl('ObjectProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    } else if (uiFrom.sameTerm(ns.owl('DatatypeProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    }\n\n    return possible\n    // return sortByLabel(possible)\n  }\n\n  // TODO: this checks for any occurrence, regardless of true or false setting\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* Create new *' // @@ could be better\n  }\n\n  const multiSelect = kb.any(form, ui('multiselect')) // Optional\n  if (multiSelect) opts.multiSelect = true\n\n  // by default searches the dataDoc graph or optionally the full store\n  const dataSource = kb.each(form, ui('search-full-store')).length ? null : dataDoc // optional\n\n  let selector\n  rhs.refresh = function () {\n    // from ui:property\n    let selectedOptions = kb.each(subject, property, null, dataDoc).map(object => object.value)\n    // from ui:from + ui:property\n    let possibleOptions = getSelectorOptions(dataSource)\n    possibleOptions.push(selectedOptions)\n    possibleOptions = sortByLabel(possibleOptions)\n\n    selector = makeSelectForChoice(\n      dom,\n      rhs,\n      kb,\n      subject,\n      property,\n      possibleOptions,\n      selectedOptions,\n      uiFrom,\n      opts,\n      dataDoc,\n      callbackFunction\n    )\n    rhs.innerHTML = ''\n    rhs.appendChild(selector)\n    if (multiSelect) {\n      const multiSelectDiv = new IconicMultiSelect({\n        placeholder: selector.selected,\n        select: selector,\n        container: rhs,\n        textField: 'textField',\n        valueField: 'valueField'\n      })\n      multiSelectDiv.init()\n      multiSelectDiv.subscribe(function (event) {\n        if (event.action === 'REMOVE_OPTION') {\n          selectedOptions = selectedOptions.filter(function (value) {\n            return value !== event.value\n          })\n        }\n        if (event.action === 'CLEAR_ALL_OPTIONS') {\n          selectedOptions = []\n        }\n        if (event.action === 'ADD_OPTION') {\n          const stringValue = event.value + ''\n          if (stringValue.includes('Create new')) {\n            const newObject = newThing(dataDoc)\n            const is = []\n            is.push($rdf.st(subject, property, kb.sym(newObject), dataDoc))\n            if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n            if (subForm) {\n              addSubFormChoice(dom, rhs, {}, $rdf.sym(newObject), subForm, dataDoc, function (ok, body) {\n                if (ok) {\n                  kb.updater.update([], is, function (uri, success, errorBody) {\n                    if (!success) rhs.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n                  })\n                  selectedOptions.push(newObject)\n                  if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n                } else {\n                  rhs.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n                }\n              })\n            }\n          } else selectedOptions.push(event.value)\n        }\n        selector.update(selectedOptions)\n      })\n    }\n  }\n\n  rhs.refresh()\n  if (selector && selector.refresh) selector.refresh()\n\n  return box\n}\n\nfunction addSubFormChoice (dom, selectDiv, already, subject, subForm, dataDoc, callbackFunction) {\n  fieldFunction(dom, subForm)(\n    dom,\n    selectDiv,\n    already,\n    subject,\n    subForm,\n    dataDoc,\n    callbackFunction\n  )\n}\n\n//          Documentation - non-interactive fields\n//\n\nfield[ns.ui('Comment').uri] = field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  _callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  const params = fieldParams[uri] || {}\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  setFieldStyle(p, form)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = kb.updater.editable(dataDoc.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nexport function editFormButton (\n  dom,\n  container,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        dataDoc,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nexport function appendForm (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nexport function propertiesForClass (kb, c) {\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The quad store\n* @param cla - the URI of the class\n* @param prop\n*/\nexport function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    const lists = kb.each(c, prop)\n    log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nexport function formsFor (subject) {\n  const kb = store\n\n  log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nexport function sortBySequence (list) {\n  const subfields = list.map(function (p) {\n    const k = kb.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  subfields.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\nexport function sortByLabel (list) {\n  const subfields = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  subfields.sort()\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param dataDoc - optional dataDoc else will prompt for one (unimplemented)\n*/\nexport function newButton (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          dataDoc,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nexport function promptForNew (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = findClosest(kb, theClass.uri, ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        ' but I don\\'t know enough information about those to ask you.'\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${styleConstants.formBorderColor}; color: ${styleConstants.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = newThing(dataDoc)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, dataDoc)) {\n      insertMe.push($rdf.st(subject, predicate, object, dataDoc))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, dataDoc)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, dataDoc))\n    }\n    if (insertMe.length) {\n      kb.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(buttons.linkButton(dom, object))\n    }\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, dataDoc, itemDone)\n  const rb = buttons.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nexport function makeDescription (\n  dom,\n  kb,\n  subject,\n  predicate,\n  dataDoc,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, dataDoc) || ''\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\" @@ possibly: add prompt which disappears\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, dataDoc)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.style.color = styleConstants.textInputColorPending\n    const ds = kb.statementsMatching(subject, predicate, null, dataDoc)\n    const is = $rdf.st(subject, predicate, field.value, dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.style.color = styleConstants.textInputColor\n        field.disabled = false\n      } else {\n        group.appendChild(\n          errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + dataDoc.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const editable = kb.updater.editable(dataDoc.uri)\n  let submit\n  if (editable) {\n    submit = widgets.continueButton(dom, saveChange)\n    submit.disabled = true // until the filled has been modified\n    submit.style.visibility = 'hidden'\n    submit.style.float = 'right'\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.style.color = 'green' // setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.style.visibility = '' // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = styleConstants.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiple - Boolean - Whether more than one at a time is allowed\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForClassifierOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForClassifierOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      'Can\\'t do selector with no options, subject= ' +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForClassifierOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        actual[x.uri] = true\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, newObject, dataDoc))\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    function doneNew (ok, _body) {\n      callbackFunction(ok, { widget: 'select', event: 'new' })\n    }\n    log.info('makeSelectForClassifierOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n        if (newObject) {\n          const fn = fieldFunction(dom, options.subForm)\n          fn(\n            dom,\n            select.parentNode,\n            {},\n            newObject,\n            options.subForm,\n            dataDoc,\n            doneNew\n          )\n        }\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectStyle)\n  if (options.multiple) select.setAttribute('multiple', 'true')\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n  if (select.currentURI == null && !options.multiple) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForClassifierOptions\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0) {\n    return errorMessageBlock(\n      dom,\n      'Can\\'t do selector with no options, subject= ' +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        if (x.uri) {\n          actual[x.uri] = true\n        }\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectStyle)\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (!select.currentURI) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nexport function makeSelectForCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  let multiple = false\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n    multiple = true\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n  if (subs.length === 0) {\n    return errorMessageBlock(\n      dom,\n      'Can\\'t do ' +\n        (multiple ? 'multiple ' : '') +\n        'selector with no subclasses of category: ' +\n        category\n    )\n  }\n  if (subs.length === 1) {\n    return errorMessageBlock(\n      dom,\n      'Can\\'t do ' +\n        (multiple ? 'multiple ' : '') +\n        'selector with only 1 subclass of category: ' +\n        category +\n        ':' +\n        subs[1]\n    )\n  }\n  return makeSelectForClassifierOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { multiple, nullLabel: '* Select type *' },\n    dataDoc,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForNestedCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  function update () {\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        dataDoc,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n\n  const container = dom.createElement('span') // Container\n  let child = null\n\n  function onChange (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  const select = makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    onChange\n  )\n  container.appendChild(select)\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nexport function buildCheckboxForm (dom, kb, lab, del, ins, form, dataDoc, tristate) {\n  const box = dom.createElement('div')\n  const rhs = renderNameValuePair(dom, kb, box, form, lab)\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  const input = dom.createElement('button')\n  const colorCarrier = input\n  input.style = style.checkboxInputStyle\n  rhs.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = dataDoc // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in dataDoc!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    colorCarrier.style.color = '#bbb' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    kb.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        colorCarrier.style.color = '#000'\n        colorCarrier.style.backgroundColor = '#fee'\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            `Checkbox: Error updating dataDoc from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        colorCarrier.style.color = '#000'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\n/*\nexport function fieldLabel (dom, property, form) {\n  let lab = kb.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', style.fieldLabelStyle) // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nexport function fieldStore (subject, predicate, def) {\n  const sts = kb.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    kb.updater.editable(sts[0].why.uri)\n  ) {\n    return kb.sym(sts[0].why.uri)\n  }\n  return def\n}\n*/\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nexport function newThing (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForChoice (\n  dom,\n  container,\n  kb,\n  subject,\n  predicate,\n  inputPossibleOptions,\n  selectedOptions,\n  uiFrom,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  const optionsFromClassUIfrom = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < inputPossibleOptions.length; i++) {\n    const sub = inputPossibleOptions[i] // @@ Maybe; make this so it works with blank nodes too\n    // if (!sub.uri) debug.warn(`makeSelectForChoice: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in optionsFromClassUIfrom) continue\n    optionsFromClassUIfrom[sub.uri] = true\n  }\n  const isEmpty = Object.keys(optionsFromClassUIfrom).length === 0\n  if (isEmpty && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      'Can\\'t do selector with no options, subject= ' +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForChoice: dataDoc=' + dataDoc)\n\n  function createDefaultSelectOptionText () {\n    let firstSelectOptionText = '--- choice ---'\n\n    if (predicate && !(predicate.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for property: ' + utils.label(predicate) + ' *'\n    }\n\n    if (subject && !(subject.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for ' + utils.label(subject, true) + ' *'\n    }\n    return firstSelectOptionText\n  }\n\n  function createDefaultSelectOption () {\n    const option = dom.createElement('option')\n    option.appendChild(dom.createTextNode(createDefaultSelectOptionText()))\n    option.disabled = true\n    option.value = true\n    option.hidden = true\n    option.selected = true\n\n    return option\n  }\n\n  const onChange = function (_e) {\n    container.removeChild(container.lastChild)\n    select.refresh()\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectStyle)\n  select.setAttribute('id', 'formSelect')\n  select.currentURI = null\n\n  for (const uri in optionsFromClassUIfrom) {\n    select.appendChild(createOption(uri))\n  }\n\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n\n  if (select.children.length === 0) select.insertBefore(createDefaultSelectOption(), select.firstChild)\n\n  select.update = function (newSelectedOptions) {\n    selectedOptions = newSelectedOptions\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n\n    const addValue = function (t) {\n      if (!kb.holds(subject, predicate, t, dataDoc)) {\n        is.push($rdf.st(subject, predicate, t, dataDoc))\n        // console.log(\"----value added \" + t)\n      }\n      if (uiFrom && (!kb.holds(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))) {\n        is.push($rdf.st(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n        // console.log(\"----added type to value \" + uiFrom)\n      }\n    }\n\n    const existingValues = kb.each(subject, predicate, null, dataDoc).map(object => object.value)\n    for (const value of existingValues) {\n      if (!containsObject(value, selectedOptions)) removeValue($rdf.sym(value))\n    }\n    for (const value of selectedOptions) {\n      if (!(value in existingValues)) addValue($rdf.sym(value))\n    }\n\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (!ok) return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      select.refresh()\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  select.refresh = function () {\n    select.disabled = true // unlocked any conflict we had got into\n    let is = []\n\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            uiFrom,\n            options.subForm,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, kb.sym(newObject), dataDoc))\n        if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n        select.currentURI = newObject\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && containsObject(opt.AJAR_uri, selectedOptions)) {\n        select.currentURI = opt.AJAR_uri\n      }\n      if (!containsObject(opt.AJAR_uri, selectedOptions)) opt.removeAttribute('selected')\n      if (containsObject(opt.AJAR_uri, selectedOptions)) opt.setAttribute('selected', 'true')\n    }\n\n    log.info('selectForOptions: data doc = ' + dataDoc)\n\n    if (select.currentURI && options.subForm && !options.multiSelect) {\n      addSubFormChoice(dom, container, {}, $rdf.sym(select.currentURI), options.subForm, dataDoc, function (ok, body) {\n        if (ok) {\n          kb.updater.update([], is, function (uri, success, errorBody) {\n            if (!success) container.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n          })\n          if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n        } else {\n          container.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n        }\n      })\n    }\n    select.disabled = false\n  }\n\n  function createOption (uri) {\n    const option = dom.createElement('option')\n    const c = kb.sym(uri)\n    let label\n    if (options.disambiguate) {\n      label = utils.labelWithOntology(c, true) // Init. cap\n    } else {\n      label = utils.label(c, true)\n    }\n    option.appendChild(dom.createTextNode(label)) // Init.\n    option.setAttribute('value', uri)\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (containsObject(c.value, selectedOptions)) {\n      option.setAttribute('selected', 'true')\n    }\n    return option\n  }\n\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n\n  return select\n} // makeSelectForChoice\n\nfunction containsObject (obj, list) {\n  let i\n  for (i = 0; i < list.length; i++) {\n    if (list[i] === obj) {\n      return true\n    }\n  }\n\n  return false\n}\n\n// This functions replaces the findMembersNT (thisClass) from rdflib until we fix: https://github.com/linkeddata/rdflib.js/issues/565\n/**\n * For anything which has thisClass (or any subclass) as its type,\n * or is the object of something which has thisClass (or any subclass) as its range,\n * or subject of something which has thisClass (or any subclass) as its domain\n * We don't bother doing subproperty (yet?) as it doesn't seem to be used\n * much.\n * Get all the Classes of which we can RDFS-infer the subject is a member\n * @return a hash of URIs\n */\nfunction findMembersNT (store, thisClass, quad) {\n  let len2\n  let len4\n  let m\n  let pred\n  let ref1\n  let ref2\n  let ref3\n  let ref4\n  let ref5\n  let st\n  let u\n  const seeds = {}\n  seeds[thisClass.toNT()] = true\n  const members = {}\n  const ref = store.transitiveClosure(seeds, store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#subClassOf'), true)\n  for (const t in ref) {\n    ref1 = store.statementsMatching(null,\n      store.rdfFactory.namedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#type'),\n      store.fromNT(t),\n      quad)\n    for (let i = 0, len = ref1.length; i < len; i++) {\n      st = ref1[i]\n      members[st.subject.toNT()] = st\n    }\n    ref2 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#domain'),\n      store.fromNT(t),\n      quad)\n    for (let l = 0, len1 = ref2.length; l < len1; l++) {\n      pred = ref2[l]\n      ref3 = store.statementsMatching(null, pred, null, quad)\n      for (m = 0, len2 = ref3.length; m < len2; m++) {\n        st = ref3[m]\n        members[st.subject.toNT()] = st\n      }\n    }\n    ref4 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#range'),\n      store.fromNT(t),\n      quad)\n    for (let q = 0, len3 = ref4.length; q < len3; q++) {\n      pred = ref4[q]\n      ref5 = store.statementsMatching(null, pred, null, quad)\n      for (u = 0, len4 = ref5.length; u < len4; u++) {\n        st = ref5[u]\n        members[st.object.toNT()] = st\n      }\n    }\n  }\n\n  return members\n}\n","/* Form field for doing autocompleete\n */\nimport ns from '../../../ns'\nimport { store } from 'solid-logic'\nimport * as widgets from '../../../widgets'\nimport { style } from '../../../style'\nimport { renderAutocompleteControl } from './autocompleteBar'\nimport { QueryParameters } from './publicData'\nimport { NamedNode, BlankNode, Literal, Variable, st } from 'rdflib'\nimport { AutocompleteOptions } from './autocompletePicker'\n/**\n  * Render a autocomplete form field\n  *\n  * The autocomplete form searches for an object in a definitive public database,\n  * and allows the user to search for it by name, displaying a list of objects whose names match\n  * the input to date, and letting  the user either click on one of the list,\n  * or just go on untill there is only one.  The process then returns two values,\n  * the URiI of the object and its name.\n  *\n  * @param dom The HTML Document object aka Document Object Model\n  * @param container  If present, the created widget will be appended to this\n  * @param already A hash table of (form, subject) kept to prevent recursive forms looping\n  * @param subject The thing about which the form displays/edits data\n  * @param form The form or field to be rendered\n  * @param doc The web document in which the data is\n  * @param callbackFunction Called when data is changed so other parts can be refreshed.\n  *\n  * Form properties:\n  * @param ui:property  The property to store the object itself\n  * @param ui:labelProperty The property used to store the name of the object\n  * @param ui:category The class of objects to be searched, if fixed (else dep on class of subject)\n  *\n  * @returns The HTML widget created\n */\n\nexport function autocompleteField (\n  dom: HTMLDocument,\n  container: HTMLElement | undefined,\n  already,\n  subject: NamedNode | BlankNode | Variable,\n  form: NamedNode,\n  doc: NamedNode | undefined,\n  callbackFunction: (_ok: boolean, _errorMessage: string) => void\n): HTMLElement {\n  async function addOneIdAndRefresh (result:NamedNode | Literal, name: Literal) {\n    if (!name) {\n      throw new Error('autocompleteField:  No name set.')\n    }\n    const oldValue = kb.the(subject, property as any, null, doc)\n    if (oldValue) {\n      const oldName = kb.any(oldValue as any, labelProperty as any, null, doc)\n      if (oldValue.equals(result) && oldName && oldName.sameTerm(name)) {\n        // console.log('No change: same values.')\n        return\n      }\n    }\n    const deletables = oldValue\n      ? kb.statementsMatching(subject, property as any, oldValue, doc)\n        .concat(kb.statementsMatching(oldValue as any, labelProperty as any, null, doc))\n      : []\n    // console.log('autocompleteField Deletables ' + deletables.map(st => st.toNT()))\n    const insertables = [st(subject, property as any, result, doc),\n      st(result as any, labelProperty as any, name, doc)] // @@ track the language of the  name too!\n    // console.log(`AC form: ${deletables.length} to delete and ${insertables.length} to insert`)\n    try {\n      // console.log('@@@ AC updating ', deletables, insertables)\n      await kb.updater?.updateMany(deletables, insertables)\n    } catch (err) {\n      callbackFunction(false, err)\n      box.appendChild(widgets.errorMessageBlock(dom, 'Autocomplete form data update error:' + err, null, err))\n      return\n    }\n    callbackFunction(true, '')\n  }\n\n  async function deleteOne (_result:NamedNode | Literal, _name: Literal) {\n    const oldValue = kb.the(subject, property as any, null, doc)\n    if (!oldValue) {\n      callbackFunction(false, 'NO data to elete')\n      box.appendChild(widgets.errorMessageBlock(dom, 'Autocomplete delete: no old data!'))\n      return\n    }\n    // const oldName = kb.any(oldValue as any, labelProperty as any, null, doc)\n    const deletables = kb.statementsMatching(subject, property as any, oldValue, doc)\n      .concat(kb.statementsMatching(oldValue as any, labelProperty as any, null, doc))\n    // console.log('autocompleteField Deletables ' + deletables.map(st => st.toNT()))\n    const insertables = []\n    // console.log(`AC form delete: ${deletables.length} to delete and ${insertables.length} to insert`)\n    try {\n      // console.log('@@@ AC updating ', deletables, insertables)\n      await kb.updater?.updateMany(deletables, insertables)\n    } catch (err) {\n      const e2 = new Error('Autocomplete form data delete error:' + err)\n      callbackFunction(false, err)\n      box.appendChild(widgets.errorMessageBlock(dom, e2, null, err))\n      return\n    }\n    callbackFunction(true, '') // changed\n  }\n\n  if (subject.termType !== 'NamedNode') {\n    throw new Error('Sorry this field only works on NamedNode subjects (for editable)')\n  }\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName')\n  lhs.setAttribute('style', style.formFieldNameBoxStyle)\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue')\n  box.appendChild(rhs)\n\n  const property = kb.any(form, ns.ui('property'))\n  if (!property) {\n    return box.appendChild(\n      widgets.errorMessageBlock(dom, 'Error: No property given for autocomplete field: ' + form)\n    )\n  }\n  const labelProperty = kb.any(form, ns.ui('labelProperty')) || ns.schema('name')\n\n  // Parse the data source into query options\n\n  const dataSource = kb.any(form, ns.ui('dataSource')) as NamedNode | undefined\n  if (!dataSource) {\n    // console.log('@@ connectedStatements ACF ', kb.connectedStatements(form).map(x => x.toNT()).join('\\n'))\n    return box.appendChild(\n      widgets.errorMessageBlock(dom, 'Error: No data source given for autocomplete field: ' + form)\n    )\n  }\n  const queryParams:QueryParameters = {\n    // targetClass: kb.any(dataSource, ns.ui('targetClass'), null, dataSource.doc()) as NamedNode | undefined,\n    label: kb.anyJS(dataSource, ns.schema('name'), null, dataSource.doc()),\n    logo: (kb.any(dataSource, ns.schema('logo'), null, dataSource.doc())) as NamedNode | undefined\n  }\n\n  // @@ Should we pass the target class in from the data source definition or use a current type of the subject\n  const targetClass = (kb.any(form, ns.ui('targetClass'), null, form.doc()) || // class in form takes pecedence\n      kb.any(dataSource, ns.ui('targetClass'), null, dataSource.doc())) as NamedNode | undefined\n  if (targetClass) {\n    queryParams.targetClass = targetClass\n  }\n\n  queryParams.objectURIBase = (kb.any(dataSource, ns.ui('objectURIBase'), null, dataSource.doc()) || undefined) as NamedNode | undefined\n\n  /*\n  if (!queryParams.targetClass) {\n    const klass = kb.any(subject, ns.rdf('type')) as NamedNode | undefined\n    // @@ be more selective of which class if many\n    // @@ todo: Take ALL classes,  and compare them with those the data source knows about\n    // with translation where necessary.  Find most specific of the classes for the search.\n    if (!klass) throw new Error('Autocomplete: No class specified or is current type of' + subject)\n    queryParams.targetClass = klass\n  }\n  */\n  const endpoint = kb.anyJS(dataSource, ns.ui('endpoint'), null, dataSource.doc()) as string | undefined\n  if (endpoint) { // SPARQL\n    queryParams.endpoint = endpoint\n\n    queryParams.searchByNameQuery = kb.anyJS(dataSource, ns.ui('searchByNameQuery'), null, dataSource.doc())\n    if (!queryParams.searchByNameQuery) {\n      return box.appendChild(\n        widgets.errorMessageBlock(dom, 'Error: No searchByNameQuery given for endpoint data Source: ' + form))\n    }\n    queryParams.insitituteDetailsQuery = kb.anyJS(dataSource, ns.ui('insitituteDetailsQuery'), null, dataSource.doc())\n  } else {\n    // return box.appendChild(\n    //  widgets.errorMessageBlock(dom, 'Error: No SPARQL endpoint given for autocomplete field: ' + form))\n    const searchByNameURI = kb.anyJS(dataSource, ns.ui('searchByNameURI'))\n    if (!searchByNameURI) {\n      return box.appendChild(\n        widgets.errorMessageBlock(dom, 'Error: No searchByNameURI OR sparql endpoint given for dataSource: ' + dataSource)\n      )\n    }\n    queryParams.searchByNameURI = searchByNameURI\n  }\n  // It can be cleaner to just remove empty fields if you can't edit them anyway\n  const suppressEmptyUneditable = kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n  const editable = kb.updater?.editable((doc as NamedNode).uri)\n\n  const autocompleteOptions:AutocompleteOptions = { // cancelButton?: HTMLElement,\n    permanent: true,\n    targetClass: queryParams.targetClass, // @@ simplify?\n    queryParams\n  }\n\n  autocompleteOptions.size = kb.anyJS(form, ns.ui('size'), null, formDoc) || undefined\n\n  let obj = kb.any(subject, property as any, undefined, doc)\n  if (!obj) {\n    obj = kb.any(form, ns.ui('default'))\n    if (obj) {\n      autocompleteOptions.currentObject = obj as NamedNode\n      autocompleteOptions.currentName = kb.any(autocompleteOptions.currentObject, labelProperty, null, doc) as Literal\n    } else { // No data or default. Should we suprress the whole field?\n      if (suppressEmptyUneditable && !editable) {\n        box.style.display = 'none' // clutter removal\n        return box\n      }\n    }\n  } else { // get object and name from target data:\n    autocompleteOptions.currentObject = obj as NamedNode\n    autocompleteOptions.currentName = kb.any(autocompleteOptions.currentObject, labelProperty, null, doc) as Literal\n  }\n\n  lhs.appendChild(widgets.fieldLabel(dom, property as any, form))\n\n  const barOptions = {\n    editable,\n    dbLookup: true\n  }\n\n  renderAutocompleteControl(dom, subject as NamedNode, barOptions, autocompleteOptions, addOneIdAndRefresh, deleteOne).then((control) => {\n    rhs.appendChild(control)\n  }, (err) => {\n    rhs.appendChild(widgets.errorMessageBlock(dom, `Error rendering autocomplete ${form}: ${err}`, '#fee', err)) //\n  })\n  return box\n}\n\n// ends\n","/* eslint-disable camelcase */\n/**\n * Signing in, signing up, profile and preferences reloading\n * Type index management\n *\n * Many functions in this module take a context object which\n * holds various RDF symbols, add to it, and return a promise of it.\n *\n * * `me`                RDF symbol for the user's WebID\n * * `publicProfile`     The user's public profile, iff loaded\n * * `preferencesFile`   The user's personal preference file, iff loaded\n * * `index.public`      The user's public type index file\n * * `index.private`     The user's private type index file\n *\n * Not RDF symbols:\n * * `noun`            A string in english for the type of thing -- like \"address book\"\n * * `instance`        An array of nodes which are existing instances\n * * `containers`      An array of nodes of containers of instances\n * * `div`             A DOM element where UI can be displayed\n * * `statusArea`      A DOM element (opt) progress stuff can be displayed, or error messages\n * *\n * * Vocabulary:  \"load\" loads a file if it exists;\n * *  'Ensure\" CREATES the file if it does not exist (if it can) and then loads it.\n * @packageDocumentation\n */\nimport { PaneDefinition } from 'pane-registry'\nimport { BlankNode, NamedNode, st } from 'rdflib'\n\nimport { Quad_Object } from 'rdflib/lib/tf-types'\nimport {\n  AppDetails,\n  AuthenticationContext,\n  authn,\n  authSession,\n  CrossOriginForbiddenError,\n  FetchError,\n  getSuggestedIssuers,\n  NotEditableError,\n  offlineTestID,\n  SameOriginForbiddenError,\n  solidLogicSingleton,\n  UnauthorizedError,\n  WebOperationError\n} from 'solid-logic'\nimport * as debug from '../debug'\nimport { style } from '../style'\nimport { alert } from '../log'\nimport ns from '../ns'\nimport { Signup } from '../signup/signup.js'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\n\nconst store = solidLogicSingleton.store\n\nconst {\n  loadPreferences,\n  loadProfile\n} = solidLogicSingleton.profile\n\nconst {\n  getScopedAppInstances,\n  getRegistrations,\n  loadAllTypeIndexes,\n  getScopedAppsFromIndex,\n  deleteTypeIndexRegistration\n} = solidLogicSingleton.typeIndex\n\n/**\n * Resolves with the logged in user's WebID\n *\n * @param context\n */\n// used to be logIn\nexport function ensureLoggedIn (context: AuthenticationContext): Promise<AuthenticationContext> {\n  const me = authn.currentUser()\n  if (me) {\n    authn.saveUser(me, context)\n    return Promise.resolve(context)\n  }\n\n  return new Promise((resolve) => {\n    authn.checkUser().then((webId) => {\n      // Already logged in?\n      if (webId) {\n        debug.log(`logIn: Already logged in as ${webId}`)\n        return resolve(context)\n      }\n      if (!context.div || !context.dom) {\n        return resolve(context)\n      }\n      const box = loginStatusBox(context.dom, (webIdUri) => {\n        authn.saveUser(webIdUri, context)\n        resolve(context) // always pass growing context\n      })\n      context.div.appendChild(box)\n    })\n  })\n}\n\n/**\n * Loads preference file\n * Do this after having done log in and load profile\n *\n * @private\n *\n * @param context\n */\n// used to be logInLoadPreferences\nexport async function ensureLoadedPreferences (\n  context: AuthenticationContext\n): Promise<AuthenticationContext> {\n  if (context.preferencesFile) return Promise.resolve(context) // already done\n\n  // const statusArea = context.statusArea || context.div || null\n  let progressDisplay\n  /* COMPLAIN FUNCTION NOT USED/TAKING IT OUT FOR NOW\n    function complain (message) {\n    message = `ensureLoadedPreferences: ${message}`\n    if (statusArea) {\n      // statusArea.innerHTML = ''\n      statusArea.appendChild(widgets.errorMessageBlock(context.dom, message))\n    }\n    debug.log(message)\n    // reject(new Error(message))\n  } */\n  try {\n    context = await ensureLoadedProfile(context)\n\n    // console.log('back in Solid UI after logInLoadProfile', context)\n    const preferencesFile = await loadPreferences(context.me as NamedNode)\n    if (progressDisplay) {\n      progressDisplay.parentNode.removeChild(progressDisplay)\n    }\n    context.preferencesFile = preferencesFile\n  } catch (err) {\n    let m2: string\n    if (err instanceof UnauthorizedError) {\n      m2 =\n        'Oops  you are not authenticated (properly logged in), so SolidOS cannot read your preferences file. Try logging out and then logging back in.'\n      alert(m2)\n    } else if (err instanceof CrossOriginForbiddenError) {\n      m2 = `Unauthorized: Assuming preference file blocked for origin ${window.location.origin}`\n      context.preferencesFileError = m2\n      return context\n    } else if (err instanceof SameOriginForbiddenError) {\n      m2 =\n        'You are not authorized to read your preference file. This may be because you are using an untrusted web app.'\n      debug.warn(m2)\n      return context\n    } else if (err instanceof NotEditableError) {\n      m2 =\n        'You are not authorized to edit your preference file. This may be because you are using an untrusted web app.'\n      debug.warn(m2)\n      return context\n    } else if (err instanceof WebOperationError) {\n      m2 =\n        'You are not authorized to edit your preference file. This may be because you are using an untrusted web app.'\n      debug.warn(m2)\n    } else if (err instanceof FetchError) {\n      m2 = `Strange: Error ${err.status} trying to read your preference file.${err.message}`\n      alert(m2)\n    } else {\n      throw new Error(`(via loadPrefs) ${err}`)\n    }\n  }\n  return context\n}\n\n/**\n * Logs the user in and loads their WebID profile document into the store\n *\n * @param context\n *\n * @returns Resolves with the context after login / fetch\n */\n// used to be logInLoadProfile\nexport async function ensureLoadedProfile (\n  context: AuthenticationContext\n): Promise<AuthenticationContext> {\n  if (context.publicProfile) {\n    return context\n  } // already done\n  try {\n    const logInContext = await ensureLoggedIn(context)\n    if (!logInContext.me) {\n      throw new Error('Could not log in')\n    }\n    context.publicProfile = await loadProfile(logInContext.me)\n  } catch (err) {\n    if (context.div && context.dom) {\n      context.div.appendChild(widgets.errorMessageBlock(context.dom, err.message))\n    }\n    throw new Error(`Can't log in: ${err}`)\n  }\n  return context\n}\n\n/**\n  * Returns promise of context with arrays of symbols\n  *\n  * leaving the `isPublic` param undefined will bring in community index things, too\n  */\nexport async function findAppInstances (\n  context: AuthenticationContext,\n  theClass: NamedNode,\n  isPublic?: boolean\n): Promise<AuthenticationContext> {\n  let items = context.me ? await getScopedAppInstances(theClass, context.me) : []\n  if (isPublic === true) { // old API - not recommended!\n    items = items.filter(item => item.scope.label === 'public')\n  } else if (isPublic === false) {\n    items = items.filter(item => item.scope.label === 'private')\n  }\n  context.instances = items.map(item => item.instance)\n  return context\n}\n\nexport function scopeLabel (context, scope) {\n  const mine = context.me && context.me.sameTerm(scope.agent)\n  const name = mine ? '' : utils.label(scope.agent) + ' '\n  return `${name}${scope.label}`\n}\n/**\n * UI to control registration of instance\n */\nexport async function registrationControl (\n  context: AuthenticationContext,\n  instance,\n  theClass\n): Promise<AuthenticationContext | void> {\n  function registrationStatements (index) {\n    const registrations = getRegistrations(instance, theClass)\n    const reg = registrations.length ? registrations[0] : widgets.newThing(index)\n    return [\n      st(reg, ns.solid('instance'), instance, index),\n      st(reg, ns.solid('forClass'), theClass, index)\n    ]\n  }\n\n  function renderScopeCheckbox (scope) {\n    const statements = registrationStatements(scope.index)\n    const name = scopeLabel(context, scope)\n    const label = `${name} link to this ${context.noun}`\n    return widgets.buildCheckboxForm(\n      context.dom,\n      solidLogicSingleton.store,\n      label,\n      null,\n      statements,\n      form,\n      scope.index\n    )\n  }\n  /// / body of registrationControl\n  const dom = context.dom\n  if (!dom || !context.div) {\n    throw new Error('registrationControl: need dom and div')\n  }\n  const box = dom.createElement('div')\n  context.div.appendChild(box)\n  context.me = authn.currentUser() // @@\n  const me = context.me\n  if (!me) {\n    box.innerHTML = '<p style=\"margin:2em;\">(Log in to save a link to this)</p>'\n    return context\n  }\n\n  let scopes // @@ const\n  try {\n    scopes = await loadAllTypeIndexes(me)\n  } catch (e) {\n    let msg\n    if (context.div && context.preferencesFileError) {\n      msg = '(Lists of stuff not available)'\n      context.div.appendChild(dom.createElement('p')).textContent = msg\n    } else if (context.div) {\n      msg = `registrationControl: Type indexes not available: ${e}`\n      context.div.appendChild(widgets.errorMessageBlock(context.dom, e))\n    }\n    debug.log(msg)\n    return context\n  }\n\n  box.innerHTML = '<table><tbody></tbody></table>' // tbody will be inserted anyway\n  box.setAttribute('style', 'font-size: 120%; text-align: right; padding: 1em; border: solid gray 0.05em;')\n  const tbody = box.children[0].children[0]\n  const form = new BlankNode() // @@ say for now\n\n  for (const scope of scopes) {\n    const row = tbody.appendChild(dom.createElement('tr'))\n    row.appendChild(renderScopeCheckbox(scope)) // @@ index\n  }\n  return context\n}\n\nexport function renderScopeHeadingRow (context, store, scope) {\n  const backgroundColor = { private: '#fee', public: '#efe' }\n  const { dom } = context\n  const name = scopeLabel(context, scope)\n  const row = dom.createElement('tr')\n  const cell = row.appendChild(dom.createElement('td'))\n  cell.setAttribute('colspan', '3')\n  cell.style.backgoundColor = backgroundColor[scope.label] || 'white'\n  const header = cell.appendChild(dom.createElement('h3'))\n  header.textContent = name + ' links'\n  header.style.textAlign = 'left'\n  return row\n}\n/**\n  * UI to List at all registered things\n  */\nexport async function registrationList (context: AuthenticationContext, options: {\n  private?: boolean\n  public?: boolean\n  type?: NamedNode\n}): Promise<AuthenticationContext> {\n  const dom = context.dom as HTMLDocument\n  const div = context.div as HTMLElement\n\n  const box = dom.createElement('div')\n  div.appendChild(box)\n  context.me = authn.currentUser() // @@\n  if (!context.me) {\n    box.innerHTML = '<p style=\"margin:2em;\">(Log in list your stuff)</p>'\n    return context\n  }\n\n  const scopes = await loadAllTypeIndexes(context.me) // includes community indexes\n\n  // console.log('@@ registrationList ', scopes)\n  box.innerHTML = '<table><tbody></tbody></table>' // tbody will be inserted anyway\n  box.setAttribute('style', 'font-size: 120%; text-align: right; padding: 1em; border: solid #eee 0.5em;')\n  const table = box.firstChild as HTMLElement\n  const tbody = table.firstChild as HTMLElement\n\n  for (const scope of scopes) { // need some predicate for listing/adding agents\n    const headingRow = renderScopeHeadingRow(context, store, scope)\n    tbody.appendChild(headingRow)\n    const items = await getScopedAppsFromIndex(scope, options.type || null) // any class\n    if (items.length === 0) headingRow.style.display = 'none'\n    // console.log(`registrationList: @@ instance items for class ${options.type || 'undefined' }:`, items)\n    for (const item of items) {\n      const row = widgets.personTR(dom, ns.solid('instance'), item.instance, {\n        deleteFunction: async () => {\n          await deleteTypeIndexRegistration(item)\n          tbody.removeChild(row)\n        }\n      })\n      row.children[0].style.paddingLeft = '3em'\n\n      tbody.appendChild(row)\n    }\n  }\n  return context\n} // registrationList\n\n/**\n * Bootstrapping identity\n * (Called by `loginStatusBox()`)\n *\n * @param dom\n * @param setUserCallback\n *\n * @returns\n */\nfunction signInOrSignUpBox (\n  dom: HTMLDocument,\n  setUserCallback: (user: string) => void,\n  options: {\n    buttonStyle?: string;\n  } = {}\n): HTMLElement {\n  options = options || {}\n  const signInButtonStyle = options.buttonStyle || style.signInAndUpButtonStyle\n\n  const box: any = dom.createElement('div')\n  const magicClassName = 'SolidSignInOrSignUpBox'\n  debug.log('widgets.signInOrSignUpBox')\n  box.setUserCallback = setUserCallback\n  box.setAttribute('class', magicClassName)\n  box.setAttribute('style', 'display:flex;')\n\n  // Sign in button with PopUP\n  const signInPopUpButton = dom.createElement('input') // multi\n  box.appendChild(signInPopUpButton)\n  signInPopUpButton.setAttribute('type', 'button')\n  signInPopUpButton.setAttribute('value', 'Log in')\n  signInPopUpButton.setAttribute('style', `${signInButtonStyle}${style.headerBannerLoginInput}` + style.signUpBackground)\n\n  authSession.events.on('login', () => {\n    const me = authn.currentUser()\n    // const sessionInfo = authSession.info\n    // if (sessionInfo && sessionInfo.isLoggedIn) {\n    if (me) {\n      // const webIdURI = sessionInfo.webId\n      const webIdURI = me.uri\n      // setUserCallback(webIdURI)\n      const divs = dom.getElementsByClassName(magicClassName)\n      debug.log(`Logged in, ${divs.length} panels to be serviced`)\n      // At the same time, satisfy all the other login boxes\n      for (let i = 0; i < divs.length; i++) {\n        const div: any = divs[i]\n        // @@ TODO Remove the need to manipulate HTML elements\n        if (div.setUserCallback) {\n          try {\n            div.setUserCallback(webIdURI)\n            const parent = div.parentNode\n            if (parent) {\n              parent.removeChild(div)\n            }\n          } catch (e) {\n            debug.log(`## Error satisfying login box: ${e}`)\n            div.appendChild(widgets.errorMessageBlock(dom, e))\n          }\n        }\n      }\n    }\n  })\n\n  signInPopUpButton.addEventListener(\n    'click',\n    () => {\n      const offline = offlineTestID()\n      if (offline) return setUserCallback(offline.uri)\n\n      renderSignInPopup(dom)\n    },\n    false\n  )\n\n  // Sign up button\n  const signupButton = dom.createElement('input')\n  box.appendChild(signupButton)\n  signupButton.setAttribute('type', 'button')\n  signupButton.setAttribute('value', 'Sign Up for Solid')\n  signupButton.setAttribute('style', `${signInButtonStyle}${style.headerBannerLoginInput}` + style.signInBackground)\n\n  signupButton.addEventListener(\n    'click',\n    function (_event) {\n      const signupMgr = new Signup()\n      signupMgr.signup().then(function (uri) {\n        debug.log('signInOrSignUpBox signed up ' + uri)\n        setUserCallback(uri)\n      })\n    },\n    false\n  )\n  return box\n}\n\nexport function renderSignInPopup (dom: HTMLDocument) {\n  /**\n   * Issuer Menu\n   */\n  const issuerPopup = dom.createElement('div')\n  issuerPopup.setAttribute(\n    'style',\n    'position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center;'\n  )\n  dom.body.appendChild(issuerPopup)\n  const issuerPopupBox = dom.createElement('div')\n  issuerPopupBox.setAttribute(\n    'style',\n    `\n      background-color: white;\n      box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -webkit-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -moz-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -o-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n      min-width: 400px;\n      padding: 10px;\n      z-index : 10;\n    `\n  )\n  issuerPopup.appendChild(issuerPopupBox)\n  const issuerPopupBoxTopMenu = dom.createElement('div')\n  issuerPopupBoxTopMenu.setAttribute(\n    'style',\n    `\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: space-between;\n    `\n  )\n  issuerPopupBox.appendChild(issuerPopupBoxTopMenu)\n  const issuerPopupBoxLabel = dom.createElement('label')\n  issuerPopupBoxLabel.setAttribute('style', 'margin-right: 5px; font-weight: 800')\n  issuerPopupBoxLabel.innerText = 'Select an identity provider'\n  const issuerPopupBoxCloseButton = dom.createElement('button')\n  issuerPopupBoxCloseButton.innerHTML =\n    '<img src=\"https://solidos.github.io/solid-ui/src/icons/noun_1180156.svg\" style=\"width: 2em; height: 2em;\" title=\"Cancel\">'\n  issuerPopupBoxCloseButton.setAttribute('style', 'background-color: transparent; border: none;')\n  issuerPopupBoxCloseButton.addEventListener('click', () => {\n    issuerPopup.remove()\n  })\n  issuerPopupBoxTopMenu.appendChild(issuerPopupBoxLabel)\n  issuerPopupBoxTopMenu.appendChild(issuerPopupBoxCloseButton)\n\n  const loginToIssuer = async (issuerUri: string) => {\n    try {\n      // clear authorization metadata from store\n      solidLogicSingleton.store.updater.flagAuthorizationMetadata() as any\n      // Save hash\n      const preLoginRedirectHash = new URL(window.location.href).hash\n      if (preLoginRedirectHash) {\n        window.localStorage.setItem('preLoginRedirectHash', preLoginRedirectHash)\n      }\n      window.localStorage.setItem('loginIssuer', issuerUri)\n      // Login\n      const locationUrl = new URL(window.location.href)\n      locationUrl.hash = '' // remove hash part\n      await authSession.login({\n        redirectUrl: locationUrl.href,\n        oidcIssuer: issuerUri\n      })\n    } catch (err) {\n      alert(err.message)\n    }\n  }\n\n  /**\n   * Text-based idp selection\n   */\n  const issuerTextContainer = dom.createElement('div')\n  issuerTextContainer.setAttribute(\n    'style',\n    `\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    `\n  )\n  const issuerTextInputContainer = dom.createElement('div')\n  issuerTextInputContainer.setAttribute(\n    'style',\n    `\n      display: flex;\n      flex-direction: row;\n    `\n  )\n  const issuerTextLabel = dom.createElement('label')\n  issuerTextLabel.innerText = 'Enter the URL of your identity provider:'\n  issuerTextLabel.setAttribute('style', 'color: #888')\n  const issuerTextInput = dom.createElement('input')\n  issuerTextInput.setAttribute('type', 'text')\n  issuerTextInput.setAttribute(\n    'style',\n    'margin-left: 0 !important; flex: 1; margin-right: 5px !important'\n  )\n  issuerTextInput.setAttribute('placeholder', 'https://example.com')\n  issuerTextInput.value = localStorage.getItem('loginIssuer') || ''\n  const issuerTextGoButton = dom.createElement('button')\n  issuerTextGoButton.innerText = 'Go'\n  issuerTextGoButton.setAttribute('style', 'margin-top: 12px; margin-bottom: 12px;')\n  issuerTextGoButton.addEventListener('click', () => {\n    loginToIssuer(issuerTextInput.value)\n  })\n  issuerTextContainer.appendChild(issuerTextLabel)\n  issuerTextInputContainer.appendChild(issuerTextInput)\n  issuerTextInputContainer.appendChild(issuerTextGoButton)\n  issuerTextContainer.appendChild(issuerTextInputContainer)\n  issuerPopupBox.appendChild(issuerTextContainer)\n\n  /**\n   * Button-based idp selection\n   */\n  const issuerButtonContainer = dom.createElement('div')\n  issuerButtonContainer.setAttribute(\n    'style',\n    `\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    `\n  )\n  const issuerBottonLabel = dom.createElement('label')\n  issuerBottonLabel.innerText = 'Or pick an identity provider from the list below:'\n  issuerBottonLabel.setAttribute('style', 'color: #888')\n  issuerButtonContainer.appendChild(issuerBottonLabel)\n  getSuggestedIssuers().forEach((issuerInfo) => {\n    const issuerButton = dom.createElement('button')\n    issuerButton.innerText = issuerInfo.name\n    issuerButton.setAttribute('style', 'height: 38px; margin-top: 10px')\n    issuerButton.addEventListener('click', () => {\n      loginToIssuer(issuerInfo.uri)\n    })\n    issuerButtonContainer.appendChild(issuerButton)\n  })\n  issuerPopupBox.appendChild(issuerButtonContainer)\n}\n\n/**\n * Login status box\n *\n * A big sign-up/sign in box or a logout box depending on the state\n *\n * @param dom\n * @param listener\n *\n * @returns\n */\nexport function loginStatusBox (\n  dom: HTMLDocument,\n  listener: ((uri: string | null) => void) | null = null,\n  options: {\n    buttonStyle?: string;\n  } = {}\n): HTMLElement {\n  // 20190630\n  let me = offlineTestID()\n  // @@ TODO Remove the need to cast HTML element to any\n  const box: any = dom.createElement('div')\n\n  function setIt (newidURI) {\n    if (!newidURI) {\n      return\n    }\n\n    // const uri = newidURI.uri || newidURI\n    // me = sym(uri)\n    me = authn.saveUser(newidURI)\n    box.refresh()\n    if (listener) listener(me!.uri)\n  }\n\n  function logoutButtonHandler (_event) {\n    const oldMe = me\n    authSession.logout().then(\n      function () {\n        const message = `Your WebID was ${oldMe}. It has been forgotten.`\n        me = null\n        try {\n          alert(message)\n        } catch (_e) {\n          window.alert(message)\n        }\n        box.refresh()\n        if (listener) listener(null)\n      },\n      (err) => {\n        alert('Fail to log out:' + err)\n      }\n    )\n  }\n\n  function logoutButton (me, options) {\n    const signInButtonStyle = options.buttonStyle || style.signInAndUpButtonStyle\n    let logoutLabel = 'WebID logout'\n    if (me) {\n      const nick =\n        solidLogicSingleton.store.any(me, ns.foaf('nick')) ||\n        solidLogicSingleton.store.any(me, ns.foaf('name'))\n      if (nick) {\n        logoutLabel = 'Logout ' + nick.value\n      }\n    }\n    const signOutButton = dom.createElement('input')\n    // signOutButton.className = 'WebIDCancelButton'\n    signOutButton.setAttribute('type', 'button')\n    signOutButton.setAttribute('value', logoutLabel)\n    signOutButton.setAttribute('style', `${signInButtonStyle}`)\n    signOutButton.addEventListener('click', logoutButtonHandler, false)\n    return signOutButton\n  }\n\n  box.refresh = function () {\n    const sessionInfo = authSession.info\n    if (sessionInfo && sessionInfo.webId && sessionInfo.isLoggedIn) {\n      me = solidLogicSingleton.store.sym(sessionInfo.webId)\n    } else {\n      me = null\n    }\n    if ((me && box.me !== me.uri) || (!me && box.me)) {\n      widgets.clearElement(box)\n      if (me) {\n        box.appendChild(logoutButton(me, options))\n      } else {\n        box.appendChild(signInOrSignUpBox(dom, setIt, options))\n      }\n    }\n    box.me = me ? me.uri : null\n  }\n  box.refresh()\n\n  function trackSession () {\n    me = authn.currentUser()\n    box.refresh()\n  }\n  trackSession()\n\n  authSession.events.on('login', trackSession)\n  authSession.events.on('logout', trackSession)\n  box.me = '99999' // Force refresh\n  box.refresh()\n  return box\n}\n\nauthSession.events.on('logout', async () => {\n  const issuer = window.localStorage.getItem('loginIssuer')\n  if (issuer) {\n    try {\n      // clear authorization metadata from store\n      solidLogicSingleton.store.updater.flagAuthorizationMetadata() as any\n\n      const wellKnownUri = new URL(issuer)\n      wellKnownUri.pathname = '/.well-known/openid-configuration'\n      const wellKnownResult = await fetch(wellKnownUri.toString())\n      if (wellKnownResult.status === 200) {\n        const openidConfiguration = await wellKnownResult.json()\n        if (openidConfiguration && openidConfiguration.end_session_endpoint) {\n          await fetch(openidConfiguration.end_session_endpoint, { credentials: 'include' })\n        }\n      }\n    } catch (_err) {\n      // Do nothing\n    }\n  }\n  window.location.reload()\n})\n\n/**\n * Workspace selection etc\n * See https://github.com/solidos/userguide/issues/16\n */\n\n/**\n * Returns a UI object which, if it selects a workspace,\n * will callback(workspace, newBase).\n * See https://github.com/solidos/userguide/issues/16 for more info on workspaces.\n *\n * If necessary, will get an account, preference file, etc. In sequence:\n *\n *   - If not logged in, log in.\n *   - Load preference file\n *   - Prompt user for workspaces\n *   - Allows the user to just type in a URI by hand\n *\n * Calls back with the workspace and the base URI\n *\n * @param dom\n * @param appDetails\n * @param callbackWS\n */\nexport function selectWorkspace (\n  dom: HTMLDocument,\n  appDetails: AppDetails,\n  callbackWS: (workspace: string | null, newBase: string) => void\n): HTMLElement {\n  const noun = appDetails.noun\n  const appPathSegment = appDetails.appPathSegment\n\n  const me = offlineTestID()\n  const box = dom.createElement('div')\n  const context: AuthenticationContext = { me, dom, div: box }\n\n  function say (s, background) {\n    box.appendChild(widgets.errorMessageBlock(dom, s, background))\n  }\n\n  function figureOutBase (ws) {\n    const newBaseNode: NamedNode = solidLogicSingleton.store.any(\n      ws,\n      ns.space('uriPrefix')\n    ) as NamedNode\n    let newBaseString: string\n    if (!newBaseNode) {\n      newBaseString = ws.uri.split('#')[0]\n    } else {\n      newBaseString = newBaseNode.value\n    }\n    if (newBaseString.slice(-1) !== '/') {\n      debug.log(`${appPathSegment}: No / at end of uriPrefix ${newBaseString}`) // @@ paramater?\n      newBaseString = `${newBaseString}/`\n    }\n    const now = new Date()\n    newBaseString += `${appPathSegment}/id${now.getTime()}/` // unique id\n    return newBaseString\n  }\n\n  function displayOptions (context) {\n    // console.log('displayOptions!', context)\n    async function makeNewWorkspace (_event) {\n      const row = table.appendChild(dom.createElement('tr'))\n      const cell = row.appendChild(dom.createElement('td'))\n      cell.setAttribute('colspan', '3')\n      cell.style.padding = '0.5em'\n      const newBase = encodeURI(\n        await widgets.askName(\n          dom,\n          solidLogicSingleton.store,\n          cell,\n          ns.solid('URL'),\n          ns.space('Workspace'),\n          'Workspace'\n        )\n      )\n      const newWs = widgets.newThing(context.preferencesFile)\n      const newData = [\n        st(context.me, ns.space('workspace'), newWs, context.preferencesFile),\n\n        st(\n          newWs,\n          ns.space('uriPrefix'),\n          newBase as unknown as Quad_Object,\n          context.preferencesFile\n        )\n      ]\n      if (!solidLogicSingleton.store.updater) {\n        throw new Error('store has no updater')\n      }\n      await solidLogicSingleton.store.updater.update([], newData)\n      // @@ now refresh list of workspaces\n    }\n\n    // const status = ''\n    const id = context.me\n    const preferencesFile = context.preferencesFile\n    let newBase: any = null\n\n    // A workspace specifically defined in the private preference file:\n    let w: any = solidLogicSingleton.store.each(\n      id,\n      ns.space('workspace'),\n      undefined,\n      preferencesFile\n    ) // Only trust preference file here\n\n    // A workspace in a storage in the public profile:\n    const storages = solidLogicSingleton.store.each(id, ns.space('storage')) // @@ No provenance requirement at the moment\n    if (w.length === 0 && storages) {\n      say(\n        `You don't seem to have any workspaces. You have ${storages.length} storage spaces.`,\n        'white'\n      )\n      storages\n        .map(function (s: any) {\n          w = w.concat(solidLogicSingleton.store.each(s, ns.ldp('contains')))\n          return w\n        })\n        .filter((file) => {\n          return file.id ? ['public', 'private'].includes(file.id().toLowerCase()) : ''\n        })\n    }\n\n    if (w.length === 1) {\n      say(`Workspace used: ${w[0].uri}`, 'white') // @@ allow user to see URI\n      newBase = figureOutBase(w[0])\n      // callbackWS(w[0], newBase)\n      // } else if (w.length === 0) {\n    }\n\n    // Prompt for ws selection or creation\n    // say( w.length + \" workspaces for \" + id + \"Choose one.\");\n    const table = dom.createElement('table')\n    table.setAttribute('style', 'border-collapse:separate; border-spacing: 0.5em;')\n\n    // const popup = window.open(undefined, '_blank', { height: 300, width:400 }, false)\n    box.appendChild(table)\n\n    //  Add a field for directly adding the URI yourself\n\n    // const hr = box.appendChild(dom.createElement('hr')) // @@\n    box.appendChild(dom.createElement('hr')) // @@\n\n    const p = box.appendChild(dom.createElement('p'))\n    p.setAttribute('style', style.commentStyle)\n    p.textContent = `Where would you like to store the data for the ${noun}?\n    Give the URL of the folder where you would like the data stored.\n    It can be anywhere in solid world - this URI is just an idea.`\n    // @@ TODO Remove the need to cast baseField to any\n    const baseField: any = box.appendChild(dom.createElement('input'))\n    baseField.setAttribute('type', 'text')\n    baseField.setAttribute('style', style.textInputStyle)\n    baseField.size = 80 // really a string\n    baseField.label = 'base URL'\n    baseField.autocomplete = 'on'\n    if (newBase) {\n      // set to default\n      baseField.value = newBase\n    }\n\n    context.baseField = baseField\n\n    box.appendChild(dom.createElement('br')) // @@\n\n    const button = box.appendChild(dom.createElement('button'))\n    button.setAttribute('style', style.buttonStyle)\n    button.textContent = `Start new ${noun} at this URI`\n    button.addEventListener('click', function (_event) {\n      let newBase = baseField.value.replace(' ', '%20') // do not re-encode in general, as % encodings may exist\n      if (newBase.slice(-1) !== '/') {\n        newBase += '/'\n      }\n      callbackWS(null, newBase)\n    })\n\n    // Now go set up the table of spaces\n\n    // const row = 0\n    w = w.filter(function (x) {\n      return !solidLogicSingleton.store.holds(\n        x,\n        ns.rdf('type'), // Ignore master workspaces\n        ns.space('MasterWorkspace')\n      )\n    })\n    let col1, col2, col3, tr, ws, localStyle, comment\n    const cellStyle = 'height: 3em; margin: 1em; padding: 1em white; border-radius: 0.3em;'\n    const deselectedStyle = `${cellStyle}border: 0px;`\n    // const selectedStyle = cellStyle + 'border: 1px solid black;'\n    for (let i = 0; i < w.length; i++) {\n      ws = w[i]\n      tr = dom.createElement('tr')\n      if (i === 0) {\n        col1 = dom.createElement('td')\n        col1.setAttribute('rowspan', `${w.length}`)\n        col1.textContent = 'Choose a workspace for this:'\n        col1.setAttribute('style', 'vertical-align:middle;')\n        tr.appendChild(col1)\n      }\n      col2 = dom.createElement('td')\n      localStyle = solidLogicSingleton.store.anyValue(ws, ns.ui('style'))\n      if (!localStyle) {\n        // Otherwise make up arbitrary colour\n        const hash = function (x) {\n          return x.split('').reduce(function (a, b) {\n            a = (a << 5) - a + b.charCodeAt(0)\n            return a & a\n          }, 0)\n        }\n        const bgcolor = `#${((hash(ws.uri) & 0xffffff) | 0xc0c0c0).toString(16)}` // c0c0c0  forces pale\n        localStyle = `color: black ; background-color: ${bgcolor};`\n      }\n      col2.setAttribute('style', deselectedStyle + localStyle)\n      tr.target = ws.uri\n      let label = solidLogicSingleton.store.any(ws, ns.rdfs('label'))\n      if (!label) {\n        label = ws.uri.split('/').slice(-1)[0] || ws.uri.split('/').slice(-2)[0]\n      }\n      col2.textContent = label || '???'\n      tr.appendChild(col2)\n      if (i === 0) {\n        col3 = dom.createElement('td')\n        col3.setAttribute('rowspan', `${w.length}1`)\n        // col3.textContent = '@@@@@ remove';\n        col3.setAttribute('style', 'width:50%;')\n        tr.appendChild(col3)\n      }\n      table.appendChild(tr)\n\n      comment = solidLogicSingleton.store.any(ws, ns.rdfs('comment'))\n      comment = comment ? comment.value : 'Use this workspace'\n      col2.addEventListener(\n        'click',\n        function (_event) {\n          col3.textContent = comment ? comment.value : ''\n          col3.setAttribute('style', deselectedStyle + localStyle)\n          const button = dom.createElement('button')\n          button.textContent = 'Continue'\n          // button.setAttribute('style', style);\n          const newBase = figureOutBase(ws)\n          baseField.value = newBase // show user proposed URI\n\n          button.addEventListener(\n            'click',\n            function (_event) {\n              button.disabled = true\n              callbackWS(ws, newBase)\n              button.textContent = '---->'\n            },\n            true\n          ) // capture vs bubble\n          col3.appendChild(button)\n        },\n        true\n      ) // capture vs bubble\n    }\n\n    // last line with \"Make new workspace\"\n    const trLast = dom.createElement('tr')\n    col2 = dom.createElement('td')\n    col2.setAttribute('style', cellStyle)\n    col2.textContent = '+ Make a new workspace'\n    col2.addEventListener('click', makeNewWorkspace)\n    trLast.appendChild(col2)\n    table.appendChild(trLast)\n  } // displayOptions\n\n  // console.log('kicking off async operation')\n  ensureLoadedPreferences(context) // kick off async operation\n    .then(displayOptions)\n    .catch((err) => {\n      // console.log(\"err from async op\")\n      box.appendChild(widgets.errorMessageBlock(context.dom, err))\n    })\n\n  return box // return the box element, while login proceeds\n} // selectWorkspace\n\n/**\n * Creates a new instance of an app.\n *\n * An instance of an app could be e.g. an issue tracker for a given project,\n * or a chess game, or calendar, or a health/fitness record for a person.\n *\n * Note that this use of the term 'app' refers more to entries in the user's\n * type index than to actual software applications that use the personal data\n * to which these entries point.\n *\n * @param dom\n * @param appDetails\n * @param callback\n *\n * @returns A div with a button in it for making a new app instance\n */\nexport function newAppInstance (\n  dom: HTMLDocument,\n  appDetails: AppDetails,\n  callback: (workspace: string | null, newBase: string) => void\n): HTMLElement {\n  const gotWS = function (ws, base) {\n    // log.debug(\"newAppInstance: Selected workspace = \" + (ws? ws.uri : 'none'))\n    callback(ws, base)\n  }\n  const div = dom.createElement('div')\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  div.appendChild(b)\n  b.innerHTML = `Make new ${appDetails.noun}`\n  b.addEventListener(\n    'click',\n    (_event) => {\n      div.appendChild(selectWorkspace(dom, appDetails, gotWS))\n    },\n    false\n  )\n  div.appendChild(b)\n  return div\n}\n/**\n * Retrieves whether the currently logged in user is a power user\n * and/or a developer\n */\nexport async function getUserRoles (): Promise<Array<NamedNode>> {\n  try {\n    const { me, preferencesFile, preferencesFileError } = await ensureLoadedPreferences({})\n    if (!preferencesFile || preferencesFileError) {\n      throw new Error(preferencesFileError)\n    }\n    return solidLogicSingleton.store.each(\n      me,\n      ns.rdf('type'),\n      null,\n      preferencesFile.doc()\n    ) as NamedNode[]\n  } catch (error) {\n    debug.warn('Unable to fetch your preferences - this was the error: ', error)\n  }\n  return []\n}\n\n/**\n * Filters which panes should be available, based on the result of [[getUserRoles]]\n */\nexport async function filterAvailablePanes (\n  panes: Array<PaneDefinition>\n): Promise<Array<PaneDefinition>> {\n  const userRoles = await getUserRoles()\n  return panes.filter((pane) => isMatchingAudience(pane, userRoles))\n}\n\nfunction isMatchingAudience (pane: PaneDefinition, userRoles: Array<NamedNode>): boolean {\n  const audience = pane.audience || []\n  return audience.reduce(\n    (isMatch, audienceRole) => isMatch && !!userRoles.find((role) => role.equals(audienceRole)),\n    true as boolean\n  )\n}\n","/**\n * Contains the [[AddAgentButtons]] class\n * @packageDocumentation\n */\n\nimport { NamedNode, Store } from 'rdflib'\nimport { AuthenticationContext } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile } from '../login/login'\nimport ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { style } from '../style'\nimport { AccessGroups } from './access-groups'\n\n/**\n * Renders the Sharing pane's \"+\" button and the menus behind it,\n * see https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md#add\n */\nexport class AddAgentButtons {\n  private readonly rootElement: HTMLElement\n  private readonly barElement: HTMLElement\n  private isExpanded: boolean = false\n\n  constructor (private groupList: AccessGroups) {\n    this.rootElement = groupList.controller.dom.createElement('div')\n    this.barElement = groupList.controller.dom.createElement('div')\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    this.rootElement.appendChild(this.renderAddButton())\n    this.rootElement.appendChild(this.barElement)\n    return this.rootElement\n  }\n\n  private renderAddButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_34653_green.svg`,\n      'Add ...',\n      () => {\n        this.toggleBar()\n        this.renderBar()\n      }\n    )\n  }\n\n  private renderBar (): void {\n    this.barElement.innerHTML = ''\n    if (!this.isExpanded) {\n      return\n    }\n    this.barElement.appendChild(this.renderPersonButton())\n    this.barElement.appendChild(this.renderGroupButton())\n    this.barElement.appendChild(this.renderPublicButton())\n    this.barElement.appendChild(this.renderAuthenticatedAgentButton())\n    this.barElement.appendChild(this.renderBotButton())\n    this.barElement.appendChild(this.renderAppsButton())\n  }\n\n  private renderSimplifiedBar (button: EventTarget | null) {\n    Array.from(this.barElement.children)\n      .filter(element => element !== button)\n      .forEach(element => this.barElement.removeChild(element))\n  }\n\n  private renderPersonButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Individual'],\n      'Add Person',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Individual'), 'person')\n          .then(name => this.addPerson(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderGroupButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Group'],\n      'Add Group',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Group'), 'group')\n          .then(name => this.addGroup(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderNameForm (type: NamedNode, noun: string): Promise<string | undefined> {\n    return widgets.askName(\n      this.groupList.controller.dom,\n      this.groupList.store,\n      this.barElement,\n      ns.vcard('URI'),\n      type,\n      noun\n    )\n  }\n\n  private renderPublicButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['foaf:Agent'],\n      'Add Everyone',\n      () => this.addAgent(ns.foaf('Agent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding the general public to those who can read. Drag the globe to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderAuthenticatedAgentButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_99101.svg`,\n      'Anyone logged In',\n      () => this.addAgent(ns.acl('AuthenticatedAgent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderBotButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + 'noun_Robot_849764.svg',\n      'A Software Agent (bot)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.schema('Application'), 'bot')\n          .then(name => this.addBot(name))\n          .then(() => this.renderCleanup())\n      })\n  }\n\n  private renderAppsButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_15177.svg`,\n      'A Web App (origin)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        const eventContext = {\n          div: this.barElement,\n          dom: this.groupList.controller.dom\n        }\n        const existingApps = this.renderAppsTable(eventContext)\n          .catch(error => this.groupList.controller.renderStatus(error))\n        this.renderAppsView()\n        const newApp = this.renderNameForm(ns.schema('WebApplication'), 'webapp domain')\n          .then(name => this.getOriginFromName(name))\n        Promise.race([\n          existingApps,\n          newApp\n        ])\n          .then(origin => {\n            if (origin) {\n              this.groupList.addNewURI(origin)\n            }\n          })\n          .then(() => this.renderCleanup())\n      }\n    )\n  }\n\n  private renderAppsView (): void {\n    const trustedApplications = this.groupList.controller.context.session.paneRegistry.byName('trustedApplications')\n    if (trustedApplications) {\n      const trustedApplicationsElement = trustedApplications.render(null, this.groupList.controller.context)\n      trustedApplicationsElement.setAttribute('style', style.trustedAppController)\n\n      const cancelButton = widgets.cancelButton(this.groupList.controller.dom, () => this.renderCleanup())\n      cancelButton.setAttribute('style', style.trustedAppCancelButton)\n      trustedApplicationsElement.insertBefore(cancelButton, trustedApplicationsElement.firstChild)\n\n      this.barElement.appendChild(trustedApplicationsElement)\n    }\n  }\n\n  private async renderAppsTable (eventContext: AuthenticationContext): Promise<string> {\n    await ensureLoadedProfile(eventContext)\n    const trustedApps = (this.groupList.store as Store).each(eventContext.me, ns.acl('trustedApp')) as Array<NamedNode> // @@ TODO fix as\n    const trustedOrigins = trustedApps.flatMap(app => (this.groupList.store as Store).each(app, ns.acl('origin'))) // @@ TODO fix as\n\n    this.barElement.appendChild(this.groupList.controller.dom.createElement('p')).textContent = `You have ${trustedOrigins.length} selected web apps.`\n    return new Promise((resolve, reject) => {\n      const appsTable = this.barElement.appendChild(this.groupList.controller.dom.createElement('table'))\n      appsTable.setAttribute('style', style.trustedAppAddApplicationsTable)\n      trustedApps.forEach(app => {\n        const origin = (this.groupList.store as Store).any(app, ns.acl('origin')) // @@ TODO fix as\n        if (!origin) {\n          reject(new Error(`Unable to pick app: ${app.value}`))\n        }\n        const thingTR = widgets.personTR(this.groupList.controller.dom, ns.acl('origin'), origin, {})\n        const innerTable = this.groupList.controller.dom.createElement('table')\n        const innerRow = innerTable.appendChild(this.groupList.controller.dom.createElement('tr'))\n\n        const innerLeftColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerLeftColumn.appendChild(thingTR)\n\n        const innerMiddleColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerMiddleColumn.textContent = `Give access to ${this.groupList.controller.noun} ${utils.label(this.groupList.controller.subject)}?`\n\n        const innerRightColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerRightColumn.appendChild(widgets.continueButton(this.groupList.controller.dom, () => resolve(origin!.value)))\n\n        appsTable.appendChild(innerTable)\n      })\n    })\n  }\n\n  private renderCleanup (): void {\n    this.renderBar()\n    this.groupList.render()\n  }\n\n  private async addPerson (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a person and has an owner who agrees they own it\n    debug.log(`Adding to ACL person: ${name}`)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addGroup (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a group and has an owner who agrees they own it\n    debug.log('Adding to ACL group: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addAgent (agentUri: string): Promise<void> {\n    await this.groupList.addNewURI(agentUri)\n    this.toggleBar()\n  }\n\n  private async addBot (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a bot and has an owner who agrees they own it\n    debug.log('Adding to ACL bot: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async getOriginFromName (name?: string): Promise<string | void> {\n    if (!name) return Promise.resolve() // user cancelled\n    const domainNameRegexp = /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i\n    // https://www.oreilly.com/library/view/regular-expressions-cookbook/9781449327453/ch08s15.html\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a domain name'))\n    }\n    const origin = 'https://' + name\n    debug.log('Adding to ACL origin: ' + origin)\n    this.toggleBar()\n    return origin\n  }\n\n  private toggleBar (): void {\n    this.isExpanded = !this.isExpanded\n  }\n}\n","/**\n * Contains the [[AccessGroups]]\n * and [[AccessGroupsOptions]] classes\n * @packageDocumentation\n */\n\nimport { NamedNode, sym, Store } from 'rdflib'\nimport { ACLbyCombination, readACL } from './acl'\nimport * as widgets from '../widgets'\nimport ns from '../ns'\nimport { AccessController } from './access-controller'\nimport { AgentMapMap, ComboList, PartialAgentTriple } from './types'\nimport { AddAgentButtons } from './add-agent-buttons'\nimport * as debug from '../debug'\nimport { style } from '../style'\n\nconst ACL = ns.acl\n\nconst COLLOQUIAL = {\n  13: 'Owners',\n  9: 'Owners (write locked)',\n  5: 'Editors',\n  3: 'Posters',\n  2: 'Submitters',\n  1: 'Viewers'\n}\n\nconst RECOMMENDED = {\n  13: true,\n  5: true,\n  3: true,\n  2: true,\n  1: true\n}\n\nconst EXPLANATION = {\n  13: 'can read, write, and control sharing.',\n  9: 'can read and control sharing, currently write-locked.',\n  5: 'can read and change information',\n  3: 'can add new information, and read but not change existing information',\n  2: 'can add new information but not read any',\n  1: 'can read but not change information'\n}\n\n/**\n * Type for the options parameter of [[AccessGroups]]\n */\nexport interface AccessGroupsOptions {\n  defaults?: boolean\n}\n\n/**\n * Renders the table of Owners, Editors, Posters, Submitters, Viewers\n * for https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md\n */\nexport class AccessGroups {\n  private readonly defaults: boolean\n  public byCombo: ComboList\n  public aclMap: AgentMapMap\n  private readonly addAgentButton: AddAgentButtons\n  private readonly rootElement: HTMLElement\n  private _store: Store // @@ was LiveStore but does not need to be connected to web\n\n  constructor (\n    private doc: NamedNode,\n    private aclDoc: NamedNode,\n    public controller: AccessController,\n    store: Store, // @@ was LiveStore\n    private _options: AccessGroupsOptions = {}\n  ) {\n    this.defaults = this._options.defaults || false\n    this._store = store\n    this.aclMap = readACL(doc, aclDoc, store, this.defaults)\n    this.byCombo = ACLbyCombination(this.aclMap)\n    this.addAgentButton = new AddAgentButtons(this)\n    this.rootElement = this.controller.dom.createElement('div')\n    this.rootElement.setAttribute('style', style.accessGroupList)\n  }\n\n  public get store () {\n    return this._store\n  }\n\n  public set store (store) {\n    this._store = store\n    this.aclMap = readACL(this.doc, this.aclDoc, store, this.defaults)\n    this.byCombo = ACLbyCombination(this.aclMap)\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    this.renderGroups().forEach(group => this.rootElement.appendChild(group))\n    if (this.controller.isEditable) {\n      this.rootElement.appendChild(this.addAgentButton.render())\n    }\n    return this.rootElement\n  }\n\n  private renderGroups (): HTMLElement[] {\n    const groupElements: HTMLElement[] = []\n    for (let comboIndex = 15; comboIndex > 0; comboIndex--) {\n      const combo = kToCombo(comboIndex)\n      if ((this.controller.isEditable && RECOMMENDED[comboIndex]) || this.byCombo[combo]) {\n        groupElements.push(this.renderGroup(comboIndex, combo))\n      }\n    }\n    return groupElements\n  }\n\n  private renderGroup (comboIndex: number, combo: string): HTMLElement {\n    const groupRow = this.controller.dom.createElement('div')\n    groupRow.setAttribute('style', style.accessGroupListItem)\n    widgets.makeDropTarget(groupRow, (uris) => this.handleDroppedUris(uris, combo)\n      .then(() => this.controller.render())\n      .catch(error => this.controller.renderStatus(error)))\n    const groupColumns = this.renderGroupElements(comboIndex, combo)\n    groupColumns.forEach(column => groupRow.appendChild(column))\n    return groupRow\n  }\n\n  private renderGroupElements (comboIndex, combo): HTMLElement[] {\n    const groupNameColumn = this.controller.dom.createElement('div')\n    groupNameColumn.setAttribute('style', style.group)\n    if (this.controller.isEditable) {\n      switch (comboIndex) {\n        case 1:\n          groupNameColumn.setAttribute('style', style.group1)\n          break\n        case 2:\n          groupNameColumn.setAttribute('style', style.group2)\n          break\n        case 3:\n          groupNameColumn.setAttribute('style', style.group3)\n          break\n        case 5:\n          groupNameColumn.setAttribute('style', style.group5)\n          break\n        case 9:\n          groupNameColumn.setAttribute('style', style.group9)\n          break\n        case 13:\n          groupNameColumn.setAttribute('style', style.group13)\n          break\n        default:\n          groupNameColumn.setAttribute('style', style.group)\n      }\n    }\n    groupNameColumn.innerText = COLLOQUIAL[comboIndex] || ktToList(comboIndex)\n\n    const groupAgentsColumn = this.controller.dom.createElement('div')\n    groupAgentsColumn.setAttribute('style', style.group)\n    if (this.controller.isEditable) {\n      switch (comboIndex) {\n        case 1:\n          groupAgentsColumn.setAttribute('style', style.group1)\n          break\n        case 2:\n          groupAgentsColumn.setAttribute('style', style.group2)\n          break\n        case 3:\n          groupAgentsColumn.setAttribute('style', style.group3)\n          break\n        case 5:\n          groupAgentsColumn.setAttribute('style', style.group5)\n          break\n        case 9:\n          groupAgentsColumn.setAttribute('style', style.group9)\n          break\n        case 13:\n          groupAgentsColumn.setAttribute('style', style.group13)\n          break\n        default:\n          groupAgentsColumn.setAttribute('style', style.group)\n      }\n    }\n    const groupAgentsTable = groupAgentsColumn.appendChild(this.controller.dom.createElement('table'))\n    const combos = this.byCombo[combo] || []\n    combos\n      .map(([pred, obj]) => this.renderAgent(groupAgentsTable, combo, pred, obj))\n      .forEach(agentElement => groupAgentsTable.appendChild(agentElement))\n\n    const groupDescriptionElement = this.controller.dom.createElement('div')\n    groupDescriptionElement.setAttribute('style', style.group)\n    if (this.controller.isEditable) {\n      switch (comboIndex) {\n        case 1:\n          groupDescriptionElement.setAttribute('style', style.group1)\n          break\n        case 2:\n          groupDescriptionElement.setAttribute('style', style.group2)\n          break\n        case 3:\n          groupDescriptionElement.setAttribute('style', style.group3)\n          break\n        case 5:\n          groupDescriptionElement.setAttribute('style', style.group5)\n          break\n        case 9:\n          groupDescriptionElement.setAttribute('style', style.group9)\n          break\n        case 13:\n          groupDescriptionElement.setAttribute('style', style.group13)\n          break\n        default:\n          groupDescriptionElement.setAttribute('style', style.group)\n      }\n    }\n    groupDescriptionElement.innerText = EXPLANATION[comboIndex] || 'Unusual combination'\n\n    return [groupNameColumn, groupAgentsColumn, groupDescriptionElement]\n  }\n\n  private renderAgent (groupAgentsTable, combo, pred, obj): HTMLElement {\n    const personRow = widgets.personTR(this.controller.dom, ACL(pred), sym(obj), this.controller.isEditable\n      ? {\n          deleteFunction: () => this.deleteAgent(combo, pred, obj)\n            .then(() => groupAgentsTable.removeChild(personRow))\n            .catch(error => this.controller.renderStatus(error))\n        }\n      : {})\n    return personRow\n  }\n\n  private async deleteAgent (combo, pred, obj): Promise<void> {\n    const combos = this.byCombo[combo] || []\n    const comboToRemove = combos.find(([comboPred, comboObj]) => comboPred === pred && comboObj === obj)\n    if (comboToRemove) {\n      combos.splice(combos.indexOf(comboToRemove), 1)\n    }\n    await this.controller.save()\n  }\n\n  public async addNewURI (uri: string): Promise<void> {\n    await this.handleDroppedUri(uri, kToCombo(1))\n    await this.controller.save()\n  }\n\n  private async handleDroppedUris (uris: string[], combo: string): Promise<void> {\n    try {\n      await Promise.all(uris.map(uri => this.handleDroppedUri(uri, combo)))\n      await this.controller.save()\n    } catch (error) {\n      return Promise.reject(error)\n    }\n  }\n\n  private async handleDroppedUri (uri: string, combo: string, secondAttempt: boolean = false): Promise<void> {\n    const agent = findAgent(uri, this.store) // eg 'agent', 'origin', agentClass'\n    const thing = sym(uri)\n    if (!agent && !secondAttempt) {\n      debug.log(`   Not obvious: looking up dropped thing ${thing}`)\n      try {\n        await this._store?.fetcher?.load(thing.doc())\n      } catch (error) {\n        const message = `Ignore error looking up dropped thing: ${error}`\n        debug.error(message)\n        return Promise.reject(new Error(message))\n      }\n      return this.handleDroppedUri(uri, combo, true)\n    } else if (!agent) {\n      const error = `   Error: Drop fails to drop appropriate thing! ${uri}`\n      debug.error(error)\n      return Promise.reject(new Error(error))\n    }\n    this.setACLCombo(combo, uri, agent, this.controller.subject)\n  }\n\n  private setACLCombo (combo: string, uri: string, res: PartialAgentTriple, subject: NamedNode): void {\n    if (!(combo in this.byCombo)) {\n      this.byCombo[combo] = []\n    }\n    this.removeAgentFromCombos(uri) // Combos are mutually distinct\n    this.byCombo[combo].push([res.pred, res.obj.uri])\n    debug.log(`ACL: setting access to ${subject} by ${res.pred}: ${res.obj}`)\n  }\n\n  private removeAgentFromCombos (uri: string): void {\n    for (let k = 0; k < 16; k++) {\n      const combos = this.byCombo[kToCombo(k)]\n      if (combos) {\n        for (let i = 0; i < combos.length; i++) {\n          while (i < combos.length && combos[i][1] === uri) {\n            combos.splice(i, 1)\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction kToCombo (k: number): string {\n  const y = ['Read', 'Append', 'Write', 'Control']\n  const combo: string[] = []\n  for (let i = 0; i < 4; i++) {\n    if (k & (1 << i)) {\n      combo.push('http://www.w3.org/ns/auth/acl#' + y[i])\n    }\n  }\n  combo.sort()\n  return combo.join('\\n')\n}\n\nfunction ktToList (k: number): string {\n  let list = ''\n  const y = ['Read', 'Append', 'Write', 'Control']\n  for (let i = 0; i < 4; i++) {\n    if (k & (1 << i)) {\n      list += y[i]\n    }\n  }\n  return list\n}\n\nfunction findAgent (uri, kb): PartialAgentTriple | null {\n  const obj = sym(uri)\n  const types = kb.findTypeURIs(obj)\n  for (const ty in types) {\n    debug.log('    drop object type includes: ' + ty)\n  }\n  // An Origin URI is one like https://fred.github.io eith no trailing slash\n  if (uri.startsWith('http') && uri.split('/').length === 3) {\n    // there is no third slash\n    return { pred: 'origin', obj } // The only way to know an origin alas\n  }\n  // @@ This is an almighty kludge needed because drag and drop adds extra slashes to origins\n  if (\n    uri.startsWith('http') &&\n    uri.split('/').length === 4 &&\n    uri.endsWith('/')\n  ) {\n    // there  IS third slash\n    debug.log('Assuming final slash on dragged origin URI was unintended!')\n    return { pred: 'origin', obj: sym(uri.slice(0, -1)) } // Fix a URI where the drag and drop system has added a spurious slash\n  }\n\n  if (ns.vcard('WebID').uri in types) return { pred: 'agent', obj }\n\n  if (ns.vcard('Group').uri in types) {\n    return { pred: 'agentGroup', obj } // @@ note vcard membership not RDFs\n  }\n  if (\n    obj.sameTerm(ns.foaf('Agent')) ||\n    obj.sameTerm(ns.acl('AuthenticatedAgent')) || // AuthenticatedAgent\n    obj.sameTerm(ns.rdf('Resource')) ||\n    obj.sameTerm(ns.owl('Thing'))\n  ) {\n    return { pred: 'agentClass', obj }\n  }\n  if (\n    ns.vcard('Individual').uri in types ||\n    ns.foaf('Person').uri in types ||\n    ns.foaf('Agent').uri in types\n  ) {\n    const pref = kb.any(obj, ns.foaf('preferredURI'))\n    if (pref) return { pred: 'agent', obj: sym(pref) }\n    return { pred: 'agent', obj }\n  }\n  if (ns.solid('AppProvider').uri in types) {\n    return { pred: 'origin', obj }\n  }\n  if (ns.solid('AppProviderClass').uri in types) {\n    return { pred: 'originClass', obj }\n  }\n  debug.log('    Triage fails for ' + uri)\n  return null\n}\n","/**\n * Contains the [[AccessController]] class\n * @packageDocumentation\n */\n\nimport { adoptACLDefault, getProspectiveHolder, makeACLGraphbyCombo, sameACL } from './acl'\nimport { fetcher, graph, NamedNode, UpdateManager } from 'rdflib'\nimport { AccessGroups } from './access-groups'\nimport { DataBrowserContext } from 'pane-registry'\nimport { shortNameForFolder } from './acl-control'\nimport * as utils from '../utils'\nimport * as debug from '../debug'\nimport { style } from '../style'\n\n/**\n * Rendered HTML component used in the databrowser's Sharing pane.\n */\nexport class AccessController {\n  public mainCombo: AccessGroups\n  public defaultsCombo: AccessGroups | null\n  private readonly isContainer: boolean\n  private defaultsDiffer: boolean\n  private readonly rootElement: HTMLDivElement\n  private isUsingDefaults: boolean\n\n  constructor (\n    public subject: NamedNode,\n    public noun: string,\n    public context: DataBrowserContext,\n    private statusElement: HTMLElement,\n    public targetIsProtected: boolean,\n    private targetDoc: NamedNode,\n    private targetACLDoc: NamedNode,\n    private defaultHolder: NamedNode | null,\n    private defaultACLDoc: NamedNode | null,\n    private prospectiveDefaultHolder: NamedNode | undefined,\n    public store,\n    public dom: HTMLDocument\n  ) {\n    this.rootElement = dom.createElement('div')\n    this.rootElement.setAttribute('style', style.aclGroupContent)\n    this.isContainer = targetDoc.uri.slice(-1) === '/' // Give default for all directories\n    if (defaultHolder && defaultACLDoc) {\n      this.isUsingDefaults = true\n      const aclDefaultStore = adoptACLDefault(this.targetDoc, targetACLDoc, defaultHolder, defaultACLDoc)\n      this.mainCombo = new AccessGroups(targetDoc, targetACLDoc, this, aclDefaultStore, { defaults: this.isContainer })\n      this.defaultsCombo = null\n      this.defaultsDiffer = false\n    } else {\n      this.isUsingDefaults = false\n      this.mainCombo = new AccessGroups(targetDoc, targetACLDoc, this, store)\n      this.defaultsCombo = new AccessGroups(targetDoc, targetACLDoc, this, store, { defaults: this.isContainer })\n      this.defaultsDiffer = !sameACL(this.mainCombo.aclMap, this.defaultsCombo.aclMap)\n    }\n  }\n\n  public get isEditable (): boolean {\n    return !this.isUsingDefaults\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    if (this.isUsingDefaults) {\n      this.renderStatus(`The sharing for this ${this.noun} is the default for folder `)\n      if (this.defaultHolder) {\n        const defaultHolderLink = this.statusElement.appendChild(this.dom.createElement('a'))\n        defaultHolderLink.href = this.defaultHolder.uri\n        defaultHolderLink.innerText = shortNameForFolder(this.defaultHolder)\n      }\n    } else if (!this.defaultsDiffer && this.isContainer) {\n      this.renderStatus('This is also the default for things in this folder.')\n    } else {\n      this.renderStatus('')\n    }\n    this.rootElement.appendChild(this.mainCombo.render())\n    if (this.defaultsCombo && this.defaultsDiffer) {\n      this.rootElement.appendChild(this.renderRemoveDefaultsController())\n      this.rootElement.appendChild(this.defaultsCombo.render())\n    } else if (this.isEditable && this.isContainer) {\n      this.rootElement.appendChild(this.renderAddDefaultsController())\n    }\n    if (!this.targetIsProtected && this.isUsingDefaults) {\n      this.rootElement.appendChild(this.renderAddAclsController())\n    } else if (!this.targetIsProtected) {\n      this.rootElement.appendChild(this.renderRemoveAclsController())\n    }\n    return this.rootElement\n  }\n\n  private renderRemoveAclsController (): HTMLElement {\n    const useDefaultButton = this.dom.createElement('button')\n    useDefaultButton.innerText = `Remove custom sharing settings for this ${this.noun} -- just use default${this.prospectiveDefaultHolder ? ` for ${utils.label(this.prospectiveDefaultHolder)}` : ''}`\n    useDefaultButton.setAttribute('style', style.bigButton)\n    useDefaultButton.addEventListener('click', () => this.removeAcls()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return useDefaultButton\n  }\n\n  private renderAddAclsController (): HTMLElement {\n    const addAclButton = this.dom.createElement('button')\n    addAclButton.innerText = `Set specific sharing for this ${this.noun}`\n    addAclButton.setAttribute('style', style.bigButton)\n    addAclButton.addEventListener('click', () => this.addAcls()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return addAclButton\n  }\n\n  private renderAddDefaultsController (): HTMLElement {\n    const containerElement = this.dom.createElement('div')\n    containerElement.setAttribute('style', style.defaultsController)\n\n    const noticeElement = containerElement.appendChild(this.dom.createElement('div'))\n    noticeElement.innerText = 'Sharing for things within the folder currently tracks sharing for the folder.'\n    noticeElement.setAttribute('style', style.defaultsControllerNotice)\n\n    const button = containerElement.appendChild(this.dom.createElement('button'))\n    button.innerText = 'Set the sharing of folder contents separately from the sharing for the folder'\n    button.setAttribute('style', style.bigButton)\n    button.addEventListener('click', () => this.addDefaults()\n      .then(() => this.render()))\n    return containerElement\n  }\n\n  private renderRemoveDefaultsController (): HTMLElement {\n    const containerElement = this.dom.createElement('div')\n    containerElement.setAttribute('style', style.defaultsController)\n\n    const noticeElement = containerElement.appendChild(this.dom.createElement('div'))\n    noticeElement.innerText = 'Access to things within this folder:'\n    noticeElement.setAttribute('style', style.defaultsControllerNotice)\n\n    const button = containerElement.appendChild(this.dom.createElement('button'))\n    button.innerText = 'Set default for folder contents to just track the sharing for the folder'\n    button.setAttribute('style', style.bigButton)\n    button.addEventListener('click', () => this.removeDefaults()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return containerElement\n  }\n\n  public renderTemporaryStatus (message: string): void {\n    // @@ TODO Introduce better system for error notification to user https://github.com/solidos/mashlib/issues/87\n    this.statusElement.setAttribute('style', style.aclControlBoxStatusRevealed)\n    this.statusElement.innerText = message\n    this.statusElement.setAttribute('style', style.temporaryStatusInit)\n    setTimeout(() => {\n      this.statusElement.setAttribute('style', style.temporaryStatusEnd)\n    })\n    setTimeout(() => {\n      this.statusElement.innerText = ''\n    }, 5000)\n  }\n\n  public renderStatus (message: string): void {\n    // @@ TODO Introduce better system for error notification to user https://github.com/solidos/mashlib/issues/87\n    if (!message) {\n      this.statusElement.setAttribute('style', style.aclControlBoxStatusRevealed)\n    }\n    this.statusElement.innerText = message\n  }\n\n  private async addAcls (): Promise<void> {\n    if (!this.defaultHolder || !this.defaultACLDoc) {\n      const message = 'Unable to find defaults to copy'\n      debug.error(message)\n      return Promise.reject(message)\n    }\n    const aclGraph = adoptACLDefault(this.targetDoc, this.targetACLDoc, this.defaultHolder, this.defaultACLDoc)\n    aclGraph.statements.forEach(st => this.store.add(st.subject, st.predicate, st.object, this.targetACLDoc))\n    try {\n      await this.store.fetcher.putBack(this.targetACLDoc)\n      this.isUsingDefaults = false\n      return Promise.resolve()\n    } catch (error) {\n      const message = ` Error writing back access control file! ${error}`\n      debug.error(message)\n      return Promise.reject(message)\n    }\n  }\n\n  private async addDefaults (): Promise<void> {\n    this.defaultsCombo = new AccessGroups(this.targetDoc, this.targetACLDoc, this, this.store, { defaults: true })\n    this.defaultsDiffer = true\n  }\n\n  private async removeAcls (): Promise<void> {\n    try {\n      await this.store.fetcher.delete(this.targetACLDoc.uri, {})\n      this.isUsingDefaults = true\n      try {\n        this.prospectiveDefaultHolder = await getProspectiveHolder(this.targetDoc.uri)\n      } catch (error) {\n        // No need to show this error in status, but good to warn about it in console\n        debug.warn(error)\n      }\n    } catch (error) {\n      const message = `Error deleting access control file: ${this.targetACLDoc}: ${error}`\n      debug.error(message)\n      return Promise.reject(message)\n    }\n  }\n\n  private async removeDefaults (): Promise<void> {\n    const fallbackCombo = this.defaultsCombo\n    try {\n      this.defaultsCombo = null\n      this.defaultsDiffer = false\n      await this.save()\n    } catch (error) {\n      this.defaultsCombo = fallbackCombo\n      this.defaultsDiffer = true\n      debug.error(error)\n      return Promise.reject(error)\n    }\n  }\n\n  public save (): Promise<void> {\n    // build graph\n    const newAClGraph = graph()\n    if (!this.isContainer) {\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true)\n    } else if (this.defaultsCombo && this.defaultsDiffer) {\n      // Pair of controls\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true)\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.defaultsCombo.byCombo, this.targetACLDoc, false, true)\n    } else {\n      // Linked controls\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true, true)\n    }\n\n    // add authenticated fetcher\n    newAClGraph.fetcher = fetcher(newAClGraph, { fetch: this.store.fetcher._fetch })\n    const updater = newAClGraph.updater || new UpdateManager(newAClGraph)\n\n    // save ACL resource\n    return new Promise((resolve, reject) => {\n      updater.put(\n        this.targetACLDoc,\n        newAClGraph.statementsMatching(undefined, undefined, undefined, this.targetACLDoc),\n        'text/turtle',\n        (uri, ok, message) => {\n          if (!ok) {\n            return reject(new Error(`ACL file save failed: ${message}`))\n          }\n          this.store.fetcher.unload(this.targetACLDoc)\n          this.store.add(newAClGraph.statements)\n          this.store.fetcher.requested[this.targetACLDoc.uri] = 'done' // missing: save headers\n          this.mainCombo.store = this.store\n          if (this.defaultsCombo) {\n            this.defaultsCombo.store = this.store\n          }\n          this.defaultsDiffer = !!this.defaultsCombo && !sameACL(this.mainCombo.aclMap, this.defaultsCombo.aclMap)\n          debug.log('ACL modification: success!')\n          resolve()\n        }\n      )\n    })\n  }\n}\n","/**\n * Functions for rendering the ACL User Interface.\n * See https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md#view\n * for a screenshot.\n * @packageDocumentation\n */\n\nimport ns from '../ns'\nimport * as utils from '../utils'\nimport { getACLorDefault, getProspectiveHolder } from './acl'\nimport { Store, NamedNode } from 'rdflib'\nimport { DataBrowserContext } from 'pane-registry'\nimport { AccessController } from './access-controller'\nimport { style } from '../style'\nimport { log, warn } from '../debug'\n\nlet global: Window = window\nconst preventBrowserDropEventsDone = Symbol('prevent double triggering of drop event')\n\n/**\n * See https://coshx.com/preventing-drag-and-drop-disasters-with-a-chrome-userscript\n * Without this dropping anything onto a browser page will cause chrome etc to jump to diff page\n * throwing away all the user's work.\n *\n * In apps which may use drag and drop, this utility takes care of the fact\n * by default in a browser, an uncaught user drop into a browser window\n * causes the browser to lose all its work in that window and navigate to another page\n *\n * @param document  The DOM\n * @returns void\n */\nexport function preventBrowserDropEvents (document: HTMLDocument): void {\n  log('preventBrowserDropEvents called.')\n  if (typeof global !== 'undefined') {\n    if (global[preventBrowserDropEventsDone]) return\n    global[preventBrowserDropEventsDone] = true\n  }\n\n  document.addEventListener('drop', handleDrop, false)\n  document.addEventListener('dragenter', preventDrag, false)\n  document.addEventListener('dragover', preventDrag, false)\n}\n\n/** @internal */\nexport function preventDrag (e) {\n  e.stopPropagation()\n  e.preventDefault()\n}\n\n/** @internal */\nexport function handleDrop (e) {\n  if (e.dataTransfer.files.length > 0) {\n    if (\n      !global.confirm('Are you sure you want to drop this file here? (Cancel opens it in a new tab)')\n    ) {\n      e.stopPropagation()\n      e.preventDefault()\n      log('@@@@ document-level DROP suppressed: ' + e.dataTransfer.dropEffect\n      )\n    }\n  }\n}\n\n/**\n * Get a folder's own filename in the directory tree. Also works for\n * domain names; the URL protocol ('https://') acts as the tree root\n * with short name '/' (see also test/unit/acl/acl-control.test.ts).\n *\n * ```typescript\n * shortNameForFolder($rdf.namedNode('http://example.com/some/folder/'))\n * // 'folder'\n *\n * shortNameForFolder($rdf.namedNode('http://example.com/some/folder'))\n * // 'folder'\n *\n * shortNameForFolder($rdf.namedNode('http://example.com/'))\n * // 'example.com'\n *\n * shortNameForFolder($rdf.namedNode('http://example.com'))\n * // 'example.com'\n *\n * shortNameForFolder($rdf.namedNode('http://'))\n * // '/'\n * ```\n *\n * It also works with relative URLs:\n * ```typescript\n * shortNameForFolder($rdf.namedNode('../folder/'))\n * // 'folder'\n * ```\n *\n * @param x  RDF Node for the folder URL\n * @returns  Short name for the folder\n */\nexport function shortNameForFolder (x: NamedNode): string {\n  let str = x.uri\n\n  // Strip the trailing slash\n  if (str.slice(-1) === '/') {\n    str = str.slice(0, -1)\n  }\n\n  // Remove the path if present, keeping only the part\n  // after the last slash.\n  const slash = str.lastIndexOf('/')\n  if (slash >= 0) {\n    str = str.slice(slash + 1)\n  }\n  // Return the folder's filename, or '/' if nothing found\n  // (but see https://github.com/solidos/solid-ui/issues/196\n  // regarding whether this happens at the domain root or\n  // not)\n  return str || '/'\n}\n\n/**\n * A wrapper that retrieves ACL data and uses it\n * to render an [[AccessController]] component.\n * Presumably the '5' is a version number of some sort,\n * but all we know is it was already called ACLControlBox5\n * when it was introduced into solid-ui in\n * https://github.com/solidos/solid-ui/commit/948b874bd93e7bf5160e6e224821b888f07d15f3#diff-4192a29f38a0ababd563b36b47eba5bbR54\n */\nexport function ACLControlBox5 (\n  subject: NamedNode,\n  context: DataBrowserContext,\n  noun: string,\n  kb: Store\n): HTMLElement {\n  const dom = context.dom\n  const doc = subject.doc() // The ACL is actually to the doc describing the thing\n\n  const container = dom.createElement('div')\n  container.setAttribute('style', style.aclControlBoxContainer)\n\n  const header = container.appendChild(dom.createElement('h1'))\n  header.textContent = `Sharing for ${noun} ${utils.label(subject)}`\n  header.setAttribute('style', style.aclControlBoxHeader)\n\n  const status = container.appendChild(dom.createElement('div'))\n  status.setAttribute('style', style.aclControlBoxStatus)\n\n  try {\n    loadController(doc, kb, subject, noun, context, dom, status)\n      .then(controller => container.appendChild(controller.render()))\n  } catch (error) {\n    status.innerText = error\n  }\n\n  return container\n}\n\nasync function loadController (\n  doc: NamedNode,\n  kb: Store,\n  subject: NamedNode,\n  noun: string,\n  context: DataBrowserContext,\n  dom: HTMLDocument,\n  status: HTMLElement\n): Promise<AccessController> {\n  return new Promise((resolve, reject) => getACLorDefault(doc, async (\n    ok,\n    isDirectACL,\n    targetDoc,\n    targetACLDoc,\n    defaultHolder,\n    defaultACLDoc\n  ) => {\n    if (!ok) {\n      return reject(new Error(`Error reading ${isDirectACL ? '' : ' default '}ACL. status ${targetDoc}: ${targetACLDoc}`))\n    }\n    const targetDirectory = getDirectory(targetDoc as NamedNode)\n    const targetIsProtected = isStorage(targetDoc as NamedNode, targetACLDoc as NamedNode, kb) || hasProtectedAcl(targetDoc as NamedNode)\n    if (!targetIsProtected && targetDirectory) {\n      try {\n        const prospectiveDefaultHolder = await getProspectiveHolder(targetDirectory)\n        return resolve(getController(prospectiveDefaultHolder))\n      } catch (error) {\n        // No need to show this error in status, but good to warn about it in console\n        warn(error)\n      }\n    }\n    return resolve(getController())\n\n    function getController (prospectiveDefaultHolder?: NamedNode) {\n      return new AccessController(subject, noun, context, status, targetIsProtected, targetDoc as NamedNode, targetACLDoc as NamedNode, defaultHolder as NamedNode,\n        defaultACLDoc as NamedNode, prospectiveDefaultHolder, kb, dom as HTMLDocument)\n    }\n  }))\n}\n\nfunction getDirectory (doc: NamedNode): string | null {\n  const str = doc.uri.split('#')[0]\n  const p = str.slice(0, -1).lastIndexOf('/')\n  const q = str.indexOf('//')\n  return (q >= 0 && p < q + 2) || p < 0 ? null : str.slice(0, p + 1)\n}\n\nfunction isStorage (doc: NamedNode, aclDoc: NamedNode, store: Store): boolean {\n  // @@ TODO: The methods used for targetIsStorage are HACKs - it should not be relied upon, and work is\n  // @@ underway to standardize a behavior that does not rely upon this hack\n  // @@ hopefully fixed as part of https://github.com/solidos/data-interoperability-panel/issues/10\n  return store.holds(doc, ns.rdf('type'), ns.space('Storage'), aclDoc)\n}\n\nfunction hasProtectedAcl (targetDoc: NamedNode): boolean {\n  // @@ TODO: This is hacky way of knowing whether or not a certain ACL file can be removed\n  // Hopefully we'll find a better, standardized solution to this - https://github.com/solidos/specification/issues/37\n  return targetDoc.uri === targetDoc.site().uri\n}\n\n/** @internal */\nexport function setGlobalWindow (window: Window) {\n  global = window\n}\n","/**\n * Re-exports all the exports from the various files in the src/acl/ folder\n * @packageDocumentation\n */\n\nimport {\n  ACLbyCombination,\n  ACLToString,\n  ACLunion,\n  adoptACLDefault,\n  comboToString,\n  fixIndividualACL,\n  fixIndividualCardACL,\n  getACL,\n  getACLorDefault,\n  loadUnionACL,\n  makeACLGraph,\n  makeACLGraphbyCombo,\n  makeACLString,\n  putACLbyCombo,\n  putACLObject,\n  readACL,\n  sameACL,\n  setACL\n} from './acl'\nimport {\n  ACLControlBox5,\n  preventBrowserDropEvents,\n  shortNameForFolder\n} from './acl-control'\n\nexport const acl = {\n  adoptACLDefault,\n  readACL,\n  sameACL,\n  ACLunion,\n  loadUnionACL,\n  ACLbyCombination,\n  makeACLGraph,\n  makeACLGraphbyCombo,\n  ACLToString,\n  comboToString,\n  makeACLString,\n  putACLObject,\n  putACLbyCombo,\n  fixIndividualCardACL,\n  fixIndividualACL,\n  setACL,\n  getACLorDefault,\n  getACL\n}\n\nexport const aclControl = {\n  preventBrowserDropEvents,\n  shortNameForFolder,\n  ACLControlBox5\n}\n","/*   create.js     UI to craete new objects in the solid-app-set world\n **\n */\n\nimport { DataBrowserContext, NewPaneOptions, PaneDefinition } from 'pane-registry'\nimport { solidLogicSingleton } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile, selectWorkspace } from '../login/login'\nimport ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { CreateContext, NewAppInstanceOptions } from './types'\n\nconst kb = solidLogicSingleton.store\n\n/*  newThingUI -- return UI for user to select a new object, folder, etc\n **\n ** context must include:  dom, div,\n **     optional:   folder: NamedNode -- the folder where the thing is bring put\n **                (suppresses asking for a full URI or workspace)\n **\n */\nexport function newThingUI (\n  createContext: CreateContext,\n  dataBrowserContext: DataBrowserContext,\n  thePanes: Array<PaneDefinition>\n): void {\n  const dom = createContext.dom\n  const div = createContext.div\n  if (createContext.me && !createContext.me.uri) {\n    throw new Error('newThingUI:  Invalid userid: ' + createContext.me)\n  }\n\n  const iconStyle = 'padding: 0.7em; width: 2em; height: 2em;' // was: 'padding: 1em; width: 3em; height: 3em;'\n  const star = div.appendChild(dom.createElement('img'))\n  let visible = false // the inividual tools tools\n  //   noun_272948.svg = black star\n  // noun_34653_green.svg = green plus\n  star.setAttribute('src', icons.iconBase + 'noun_34653_green.svg')\n  star.setAttribute('style', iconStyle)\n  star.setAttribute('title', 'Add another tool')\n\n  const complain = function complain (message) {\n    const pre = div.appendChild(dom.createElement('pre'))\n    pre.setAttribute('style', 'background-color: pink')\n    pre.appendChild(dom.createTextNode(message))\n  }\n\n  function styleTheIcons (style) {\n    for (let i = 0; i < iconArray.length; i++) {\n      let st = iconStyle + style\n      if (iconArray[i].disabled) {\n        // @@ unused\n        st += 'opacity: 0.3;'\n      }\n      iconArray[i].setAttribute('style', st) // eg 'background-color: #ccc;'\n    }\n  }\n\n  function selectTool (icon) {\n    styleTheIcons('display: none;') // 'background-color: #ccc;'\n    icon.setAttribute('style', iconStyle + 'background-color: yellow;')\n  }\n\n  function selectNewTool (_event?) {\n    visible = !visible\n    star.setAttribute(\n      'style',\n      iconStyle + (visible ? 'background-color: yellow;' : '')\n    )\n    styleTheIcons(visible ? '' : 'display: none;')\n  }\n\n  star.addEventListener('click', selectNewTool)\n\n  function makeNewAppInstance (options: NewAppInstanceOptions) {\n    return new Promise(function (resolve, reject) {\n      let selectUI // , selectUIParent\n      function callbackWS (ws, newBase) {\n        ensureLoadedProfile(createContext).then(\n          _context => {\n            const newPaneOptions: NewPaneOptions = Object.assign({\n              newBase,\n              folder: options.folder || undefined,\n              workspace: ws\n            }, options)\n            for (const opt in options) {\n              // get div, dom, me, folder, pane, refreshTable\n              newPaneOptions[opt] = options[opt]\n            }\n            debug.log(`newThingUI: Minting new ${newPaneOptions.pane.name} at ${newPaneOptions.newBase}`)\n            options.pane\n              .mintNew!(dataBrowserContext, newPaneOptions)\n              .then(function (newPaneOptions) {\n                if (!newPaneOptions || !newPaneOptions.newInstance) {\n                  throw new Error('Cannot mint new - missing newInstance')\n                }\n                if (newPaneOptions.folder) {\n                  const tail = newPaneOptions.newInstance.uri.slice(\n                    newPaneOptions.folder.uri.length\n                  )\n                  const isPackage = tail.includes('/')\n                  debug.log('  new thing is packge? ' + isPackage)\n                  if (isPackage) {\n                    kb.add(\n                      newPaneOptions.folder,\n                      ns.ldp('contains'),\n                      kb.sym(newPaneOptions.newBase),\n                      newPaneOptions.folder.doc()\n                    )\n                  } else {\n                    // single file\n                    kb.add(\n                      newPaneOptions.folder,\n                      ns.ldp('contains'),\n                      newPaneOptions.newInstance,\n                      newPaneOptions.folder.doc()\n                    ) // Ping the patch system?\n                  }\n                  // @ts-ignore @@ TODO check whether refresh can exist here. Either fix type or remove unreachable code\n                  if (newPaneOptions.refreshTarget && newPaneOptions.refreshTarget.refresh) {\n                    // @@ TODO Remove the need to cast as any\n                    ;(newPaneOptions.refreshTarget as any).refresh() // Refresh the containing display\n                  }\n                  // selectUI.parentNode.removeChild(selectUI) It removes itself\n                } else {\n                  const p = options.div.appendChild(dom.createElement('p'))\n                  p.setAttribute('style', 'font-size: 120%;')\n                  // Make link to new thing\n                  p.innerHTML =\n                    'Your <a target=\\'_blank\\' href=\\'' +\n                    newPaneOptions.newInstance.uri +\n                    '\\'><b>new ' +\n                    options.noun +\n                    '</b></a> is ready to be set up. ' +\n                    '<br/><br/><a target=\\'_blank\\' href=\\'' +\n                    newPaneOptions.newInstance.uri +\n                    '\\'>Go to your new ' +\n                    options.noun +\n                    '.</a>'\n                  // selectUI.parentNode.removeChild(selectUI) // Clean up\n                  // selectUIParent.removeChild(selectUI) // Clean up\n                }\n                selectNewTool() // toggle star to plain and menu vanish again\n              })\n              .catch(function (err) {\n                complain(err)\n                reject(err)\n              })\n          },\n          err => {\n            // login fails\n            complain('Error logging on: ' + err)\n          }\n        )\n      } // callbackWS\n\n      const pa = options.pane\n      // options.appPathSegment = pa.name // was 'edu.mit.solid.pane.'\n      options.noun = pa.mintClass ? utils.label(pa.mintClass) : pa.name\n      options.appPathSegment = options.noun.slice(0, 1).toUpperCase() + options.noun.slice(1)\n\n      if (!options.folder) {\n        // No folder given? Ask user for full URI\n        selectUI = selectWorkspace(dom, {\n          noun: options.noun,\n          appPathSegment: options.appPathSegment\n        }, callbackWS)\n        options.div.appendChild(selectUI)\n        // selectUIParent = options.div\n      } else {\n        const gotName = function (name) {\n          if (!name) {\n            // selectUIParent.removeChild(selectUI)   itremves itself if cancelled\n            selectNewTool() // toggle star to plain and menu vanish again\n          } else {\n            let uri = options.folder!.uri\n            if (!uri.endsWith('/')) {\n              uri = uri + '/'\n            }\n            uri = uri + encodeURIComponent(name) + '/'\n            callbackWS(null, uri)\n          }\n        }\n        widgets\n          .askName(\n            dom,\n            kb,\n            options.div,\n            ns.foaf('name'),\n            null,\n            options.noun\n          )\n          .then(gotName)\n        // selectUI = getNameForm(dom, kb, options.noun, gotName)\n        // options.div.appendChild(selectUI)\n        // selectUIParent = options.div\n      }\n    })\n  } // makeNewAppInstance\n\n  const iconArray: Array<any> = []\n  const mintingPanes = Object.values(thePanes).filter(pane => pane.mintNew)\n  const mintingClassMap = mintingPanes.reduce((classMap, pane) => {\n    if (pane.mintClass) {\n      classMap[pane.mintClass.uri] = (classMap[pane.mintClass.uri] || 0) + 1\n    }\n    return classMap\n  }, {})\n  mintingPanes.forEach(pane => {\n    // @@ TODO Remove the need to cast to any\n    const icon: any = createContext.div.appendChild(dom.createElement('img'))\n    icon.setAttribute('src', pane.icon)\n    const noun = pane.mintClass\n      ? mintingClassMap[pane.mintClass.uri] > 1\n        ? `${utils.label(pane.mintClass)} (using ${pane.name} pane)`\n        : utils.label(pane.mintClass)\n      : pane.name + ' @@'\n    icon.setAttribute('title', 'Make new ' + noun)\n    icon.setAttribute('style', iconStyle + 'display: none;')\n    iconArray.push(icon)\n    if (!icon.disabled) {\n      icon.addEventListener('click', function (e) {\n        selectTool(icon)\n        makeNewAppInstance({\n          event: e,\n          folder: createContext.folder || null,\n          iconEle: icon,\n          pane,\n          noun,\n          noIndexHTML: true, // do NOT @@ for now write a HTML file\n          div: createContext.div,\n          me: createContext.me,\n          dom: createContext.dom,\n          refreshTarget: createContext.refreshTarget\n        })\n      })\n    }\n  })\n}\n\n// Form to get the name of a new thing before we create it\n//\n// Used in contacts for new groups, individuals.\n//\n/*\nfunction getNameForm (dom, kb, classLabel, gotNameCallback) {\n  const form = dom.createElement('div') // form is broken as HTML behaviour can resurface on js error\n  form.innerHTML = '<p>Name of new ' + classLabel + ':</p>'\n  const namefield = dom.createElement('input')\n  namefield.setAttribute('type', 'text')\n  namefield.setAttribute('size', '30')\n  namefield.setAttribute('style', style.textInputStyle)\n  namefield.setAttribute('maxLength', '2048') // No arbitrary limits\n  namefield.select() // focus next user input\n\n  const gotName = function () {\n    namefield.setAttribute('class', 'pendingedit')\n    namefield.disabled = true\n    continueButton.disabled = true\n    cancel.disabled = true\n    gotNameCallback(true, namefield.value)\n  }\n\n  namefield.addEventListener('keyup', function (e) {\n    if (e.keyCode === 13) {\n      gotName()\n    }\n  }, false)\n  form.appendChild(namefield)\n\n  form.appendChild(dom.createElement('br'))\n\n  const cancel = form.appendChild(widgets.cancelButton(dom))\n  cancel.addEventListener('click', function (e) {\n    form.parentNode.removeChild(form)\n    gotNameCallback(false)\n  }, false)\n\n  const continueButton = form.appendChild(widgets.continueButton(dom))\n  continueButton.addEventListener('click', function (e) {\n    gotName()\n  }, false)\n\n  return form\n}\n*/\n","import {\n  newThingUI\n} from './create'\n\nexport const create = {\n  newThingUI\n}\n","//      Build a 2D matrix of values\n//\n//  dom      AKA document\n//  query    a Query object of rdflib.js with a valid pattern\n//  vx       A variable object, the one to be used for the X variable (horiz)\n//  vy       A variable object, the one to be used for the Y variable (vertical)\n//  vvalue       A variable object, the one to be used for the cell value\n//  returns  A DOM element with the matrix in it, which has a .refresh() function.\n//\n// Options:\n//     cellFunction(td, x, y, value)  fill the TD element of a single cell\n//     xDecreasing  set true for x axis to be in decreasing order.\n//     yDecreasing  set true for y axis to be in decreasing order.\n//     set_x        array of X values to be define initial rows (order irrelevant)\n//     set_y        array of Y values to be define initial columns\n//\n// Features:\n//   Header row at top (x axis) and left (y-axis) generated automatically.\n//   Extra rows and columns are inserted as needed to hold new data points\n//   matrix.refresh() will re-run the query and adjust the display\n\nimport * as utils from '../utils'\nimport * as $rdf from 'rdflib'\nimport { MatrixOptions } from './types'\nimport { solidLogicSingleton } from 'solid-logic'\n\nconst kb = solidLogicSingleton.store\n\nexport function matrixForQuery (\n  dom: HTMLDocument,\n  query: $rdf.Query,\n  vx: $rdf.Variable,\n  vy: $rdf.Variable,\n  vvalue: $rdf.Variable,\n  options: MatrixOptions,\n  whenDone: () => void\n) {\n  // @@ TODO Remove need to cast to any\n  const matrix: any = dom.createElement('table')\n  const header = dom.createElement('tr')\n  const corner = header.appendChild(dom.createElement('td'))\n  corner.setAttribute('class', 'MatrixCorner')\n  matrix.appendChild(header) // just one for now\n  matrix.lastHeader = header // Element before data\n  let columns: any[] = [] // Vector\n  const rows: any[] = [] // Associative array\n\n  const setCell = function (cell, x, y, value) {\n    while (cell.firstChild) {\n      // Empty any previous\n      cell.removeChild(cell.firstChild)\n    }\n    cell.setAttribute('style', '')\n    cell.style.textAlign = 'center'\n\n    if (options.cellFunction) {\n      options.cellFunction(cell, x, y, value)\n    } else {\n      cell.textContent = utils.label(value)\n      cell.setAttribute('style', 'padding: 0.3em')\n    }\n    delete cell.old\n  }\n\n  const rowFor = function (y1) {\n    const y = y1.toNT()\n    if (rows[y]) return rows[y]\n    // @@ TODO Remove need for casting to any\n    const tr: any = dom.createElement('tr')\n    const header = tr.appendChild(dom.createElement('td'))\n    header.setAttribute('style', 'padding: 0.3em;')\n    header.textContent = utils.label(y1) // first approximation\n    if (y1.termType === 'NamedNode') {\n      kb.fetcher!.nowOrWhenFetched(y1.uri.split('#')[0], undefined, function (\n        ok,\n        _body,\n        _response\n      ) {\n        if (ok) header.textContent = utils.label(y1)\n      })\n    }\n    for (let i = 0; i < columns.length; i++) {\n      setCell(\n        tr.appendChild(dom.createElement('td')),\n        $rdf.fromNT(columns[i]),\n        y1,\n        null\n      )\n    }\n    tr.dataValueNT = y\n    rows[y] = tr\n    for (let ele = matrix.lastHeader.nextSibling; ele; ele = ele.nextSibling) {\n      // skip header\n      if (\n        (y > ele.dataValueNT && options && options.yDecreasing) ||\n        (y < ele.dataValueNT && !(options && options.yDecreasing))\n      ) {\n        return matrix.insertBefore(tr, ele) // return the tr\n      }\n    }\n    return matrix.appendChild(tr) // return the tr\n  }\n\n  const columnNumberFor = function (x1): number {\n    const xNT: any = x1.toNT() // xNT is a NT string\n    let col: any = null\n    // These are data columns (not headings)\n    for (let i = 0; i < columns.length; i++) {\n      if (columns[i] === xNT) {\n        return i\n      }\n\n      if (\n        (xNT > columns[i] && options.xDecreasing) ||\n        (xNT < columns[i] && !options.xDecreasing)\n      ) {\n        columns = columns\n          .slice(0, i)\n          .concat([xNT])\n          .concat(columns.slice(i))\n        col = i\n        break\n      }\n    }\n\n    if (col === null) {\n      col = columns.length\n      columns.push(xNT)\n    }\n\n    // col is the number of the new column, starting from 0\n    for (let row = matrix.firstChild; row; row = row.nextSibling) {\n      // For every row header or not\n      const y = row.dataValueNT\n      const td = dom.createElement('td') // Add a new cell\n      td.style.textAlign = 'center'\n      if (row === matrix.firstChild) {\n        td.textContent = utils.label(x1)\n      } else {\n        setCell(td, x1, $rdf.fromNT(y), null)\n      }\n      if (col === columns.length - 1) {\n        row.appendChild(td)\n      } else {\n        let t = row.firstChild\n        for (let j = 0; j < col + 1; j++) {\n          // Skip header col too\n          t = t.nextSibling\n        }\n        row.insertBefore(td, t)\n      }\n    }\n    return col\n  }\n\n  const markOldCells = function () {\n    for (let i = 1; i < matrix.children.length; i++) {\n      const row = matrix.children[i]\n      for (let j = 1; j < row.children.length; j++) {\n        row.children[j].old = true\n      }\n    }\n  }\n\n  const clearOldCells = function () {\n    let row, cell\n    const colsUsed: any[] = []\n    const rowsUsed: any[] = []\n\n    if (options.set_y) {\n      // Knows y values create rows\n      for (let k = 0; k < options.set_y.length; k++) {\n        rowsUsed[options.set_y[k]] = true\n      }\n    }\n    if (options.set_x) {\n      for (let k = 0; k < options.set_x.length; k++) {\n        colsUsed[columnNumberFor(options.set_x[k]) + 1] = true\n      }\n    }\n\n    for (let i = 1; i < matrix.children.length; i++) {\n      row = matrix.children[i]\n      for (let j = 1; j < row.children.length; j++) {\n        cell = row.children[j]\n        if (cell.old) {\n          const y = $rdf.fromNT(row.dataValueNT)\n          const x = $rdf.fromNT(columns[j - 1])\n          setCell(cell, x, y, null)\n        } else {\n          rowsUsed[row.dataValueNT] = true\n          colsUsed[j] = true\n        }\n      }\n    }\n\n    for (let i = 0; i < matrix.children.length; i++) {\n      row = matrix.children[i]\n      if (i > 0 && !rowsUsed[row.dataValueNT]) {\n        delete rows[row.dataValueNT]\n        matrix.removeChild(row)\n      } else {\n        for (let j = row.children.length - 1; j > 0; j--) {\n          // backwards\n          const cell = row.children[j]\n          if (!colsUsed[j]) {\n            row.removeChild(cell)\n          }\n        }\n      }\n    }\n    const newcolumns: any[] = []\n    for (let j = 0; j < columns.length; j++) {\n      if (colsUsed[j + 1]) {\n        newcolumns.push(columns[j])\n      }\n    }\n    columns = newcolumns\n  }\n\n  matrix.refresh = function () {\n    markOldCells()\n    kb.query(query, addCellFromBindings, undefined, clearOldCells)\n  }\n\n  const addCellFromBindings = function (bindings) {\n    const x = bindings[vx.toString()]\n    const y = bindings[vy.toString()]\n    const value = bindings[(vvalue.toString())]\n    const row = rowFor(y)\n    const colNo = columnNumberFor(x)\n    const cell = row.children[colNo + 1] // number of Y axis headings\n    setCell(cell, x, y, value)\n  }\n\n  if (options.set_y) {\n    // Knows y values create rows\n    for (let k = 0; k < options.set_y.length; k++) {\n      rowFor(options.set_y[k])\n    }\n  }\n  if (options.set_x) {\n    for (let k = 0; k < options.set_x.length; k++) {\n      columnNumberFor(options.set_x[k])\n    }\n  }\n\n  kb.query(query, addCellFromBindings, undefined, whenDone) // Populate the matrix\n  return matrix\n}\n","import {\n  matrixForQuery\n} from './matrix'\n\nexport const matrix = {\n  matrixForQuery\n}\n","//\n//   Media input widget\n//\n//\n// Workflow:\n// The HTML5 functionality (on mobile) is to prompt for either\n// a realtime camera capture, OR a selection from images already on the device\n// (eg camera roll).\n//\n// The solid alternative is to either take a photo\n// or access camera roll (etc) OR to access solid cloud storage of favorite photo albums.\n// (Especially latest taken ones)\n//\nimport * as debug from '../debug'\n\n/** @module mediaCapture */\n\nimport { icons } from '../iconBase'\nimport { style } from '../style'\nimport * as widgets from '../widgets'\nimport { IndexedFormula, NamedNode } from 'rdflib'\n\nconst cameraIcon = icons.iconBase + 'noun_Camera_1618446_000000.svg' // Get it from github\nconst retakeIcon = icons.iconBase + 'noun_479395.svg' // Get it from github\n\nconst contentType = 'image/png'\n\n/** A control to capture a picture using camera\n * @param {Docuemnt} dom - The Document object\n * @param {IndexedForumla} store - The quadstore to store data in\n * @param {NamedNode} getImageDoc() - NN of the image file to be created\n * @param {function} doneCallback - Called when a picture has been taken\n */\nexport function cameraCaptureControl (\n  dom: HTMLDocument,\n  store: IndexedFormula,\n  getImageDoc: () => NamedNode,\n  doneCallback: (imageDoc) => Promise<void>\n) {\n  const div = dom.createElement('div')\n  let destination, imageBlob, player, canvas\n\n  const table = div.appendChild(dom.createElement('table'))\n  const mainTR = table.appendChild(dom.createElement('tr'))\n  const main = mainTR.appendChild(dom.createElement('td'))\n  main.setAttribute('colspan', '4')\n\n  const buttons = table.appendChild(dom.createElement('tr'))\n\n  buttons\n    .appendChild(dom.createElement('td')) // Cancel button\n    .appendChild(widgets.cancelButton(dom))\n    .addEventListener('click', _event => {\n      stopVideo()\n      doneCallback(null)\n    })\n\n  const retakeButton = buttons\n    .appendChild(dom.createElement('td')) // Retake button\n    .appendChild(widgets.button(dom, retakeIcon, 'Retake'))\n  retakeButton.addEventListener('click', _event => {\n    retake()\n  })\n  retakeButton.style.visibility = 'collapse' // Hide for now\n\n  const shutterButton = buttons\n    .appendChild(dom.createElement('td')) // Trigger capture button\n    .appendChild(\n      widgets.button(dom, icons.iconBase + 'noun_10636.svg', 'Snap')\n    )\n  shutterButton.addEventListener('click', grabCanvas)\n  shutterButton.style.visibility = 'collapse' // Hide for now\n\n  const sendButton = buttons\n    .appendChild(dom.createElement('td')) // Confirm and save button\n    .appendChild(widgets.continueButton(dom)) // @@ or send icon??\n  sendButton.addEventListener('click', _event => {\n    saveBlob(imageBlob, destination)\n  })\n  sendButton.style.visibility = 'collapse' // Hide for now\n\n  function displayPlayer () {\n    player = main.appendChild(dom.createElement('video'))\n    player.setAttribute('controls', '1')\n    player.setAttribute('autoplay', '1')\n    player.setAttribute('style', style.controlStyle)\n    if (!navigator.mediaDevices) {\n      throw new Error('navigator.mediaDevices not available')\n    }\n    navigator.mediaDevices.getUserMedia(constraints).then(stream => {\n      player.srcObject = stream\n      shutterButton.style.visibility = 'visible' // Enable\n      sendButton.style.visibility = 'collapse'\n      retakeButton.style.visibility = 'collapse'\n    })\n  }\n\n  const constraints = {\n    video: true\n  }\n\n  function retake () {\n    main.removeChild(canvas)\n    displayPlayer() // Make new one as old one is stuck black\n  }\n\n  function grabCanvas () {\n    // Draw the video frame to the canvas.\n    canvas = dom.createElement('canvas')\n    canvas.setAttribute('width', style.canvasWidth)\n    canvas.setAttribute('height', style.canvasHeight)\n    canvas.setAttribute('style', style.controlStyle)\n    main.appendChild(canvas)\n\n    const context = canvas.getContext('2d')\n    context.drawImage(player, 0, 0, canvas.width, canvas.height)\n\n    player.parentNode.removeChild(player)\n\n    canvas.toBlob(blob => {\n      const msg = `got blob type ${blob.type} size ${blob.size}`\n      debug.log(msg)\n      destination = getImageDoc()\n      imageBlob = blob // save for review\n      reviewImage()\n      // alert(msg)\n    }, contentType) // toBlob\n  }\n\n  function reviewImage () {\n    sendButton.style.visibility = 'visible'\n    retakeButton.style.visibility = 'visible'\n    shutterButton.style.visibility = 'collapse' // Hide for now\n  }\n\n  function stopVideo () {\n    if (player && player.srcObject) {\n      player.srcObject.getVideoTracks().forEach(track => track.stop())\n    }\n  }\n  function saveBlob (blob, destination) {\n    const contentType = blob.type\n    // if (!confirm('Save picture to ' + destination + ' ?')) return\n    debug.log(\n      'Putting ' + blob.size + ' bytes of ' + contentType + ' to ' + destination\n    )\n    // @@ TODO Remove casting\n    ;(store as any).fetcher\n      .webOperation('PUT', destination.uri, {\n        data: blob,\n        contentType\n      })\n      .then(\n        _resp => {\n          debug.log('ok saved ' + destination)\n          stopVideo()\n          doneCallback(destination)\n        },\n        err => {\n          stopVideo()\n          alert(err)\n        }\n      )\n  }\n\n  // Attach the video stream to the video element and autoplay.\n  displayPlayer()\n  return div\n}\n\n/** A button to capture a picture using camera\n * @param {Docuemnt} dom - The Document object\n * @param {IndexedForumla} store - The quadstore to store data in\n * @param {fuunction} getImageDoc - returns NN of the image file to be created\n * @param {function<Node>} doneCallback - called with the image taken\n * @returns {DomElement} - A div element with the button in it\n *\n * This expands the button to a large control when it is pressed\n */\n\nexport function cameraButton (\n  dom: HTMLDocument,\n  store: IndexedFormula,\n  getImageDoc: () => NamedNode,\n  doneCallback: (imageDoc) => Promise<void>\n): HTMLElement {\n  const div = dom.createElement('div')\n  const but = widgets.button(dom, cameraIcon, 'Take picture')\n  let control\n  async function restoreButton (imageDoc) {\n    div.removeChild(control)\n    div.appendChild(but)\n    doneCallback(imageDoc)\n  }\n  div.appendChild(but)\n  but.addEventListener('click', _event => {\n    div.removeChild(but)\n    control = cameraCaptureControl(\n      dom,\n      store,\n      getImageDoc,\n      restoreButton\n    )\n    div.appendChild(control)\n  })\n  return div\n}\n","import {\n  cameraCaptureControl,\n  cameraButton\n} from './media-capture'\n\nexport const media = {\n  cameraCaptureControl,\n  cameraButton\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n","/**\n *\n * People Picker Pane\n *\n * This pane offers a mechanism for selecting a set of individuals, groups, or\n * organizations to take some action on.\n *\n * Assumptions\n *   - Assumes that the user has a type index entry for vcard:AddressBook. @@ bad assuption\n *\n */\nimport escape from 'escape-html'\nimport { v4 as uuidv4 } from 'uuid'\nimport * as rdf from 'rdflib'\nimport * as debug from '../debug'\n\nimport { makeDropTarget } from './dragAndDrop'\nimport { errorMessageBlock } from './error'\nimport { iconBase } from '../iconBase'\nimport ns from '../ns'\nimport { solidLogicSingleton } from 'solid-logic'\n\nconst kb = solidLogicSingleton.store\n\nexport class PeoplePicker {\n  constructor (element, typeIndex, groupPickedCb, options) { // @@ can't expect typeindex to be passed\n    this.options = options || {}\n    this.element = element\n    this.typeIndex = typeIndex\n    this.groupPickedCb = groupPickedCb\n    this.selectedgroup = this.options.selectedgroup // current selected group if any\n    this.onSelectGroup = this.onSelectGroup.bind(this)\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.style.maxWidth = '350px'\n    container.style.minHeight = '200px'\n    container.style.outline = '1px solid black'\n    container.style.display = 'flex'\n\n    if (this.selectedgroup) {\n      container.style.flexDirection = 'column'\n      const selectedGroup = document.createElement('div')\n      new Group(selectedGroup, this.selectedgroup).render()\n      const changeGroupButton = document.createElement('button')\n      changeGroupButton.textContent = escape('Change group')\n      changeGroupButton.addEventListener('click', _event => {\n        this.selectedgroup = null\n        this.render()\n      })\n      container.appendChild(selectedGroup)\n      container.appendChild(changeGroupButton)\n    } else {\n      this.findAddressBook(this.typeIndex)\n        .then(({ book }) => {\n          const chooseExistingGroupButton = document.createElement('button')\n          chooseExistingGroupButton.textContent = escape(\n            'Pick an existing group'\n          )\n          chooseExistingGroupButton.style.margin = 'auto'\n          chooseExistingGroupButton.addEventListener('click', _event => {\n            new GroupPicker(container, book, this.onSelectGroup).render()\n          })\n\n          const createNewGroupButton = document.createElement('button')\n          createNewGroupButton.textContent = escape('Create a new group')\n          createNewGroupButton.style.margin = 'auto'\n          createNewGroupButton.addEventListener('click', _event => {\n            this.createNewGroup(book, this.options.defaultNewGroupName)\n              .then(({ group }) => {\n                new GroupBuilder(\n                  this.element,\n                  book,\n                  group,\n                  this.onSelectGroup\n                ).render()\n              })\n              .catch(errorBody => {\n                this.element.appendChild(\n                  errorMessageBlock(\n                    document,\n                    escape(`Error creating a new group. (${errorBody})`)\n                  )\n                )\n              })\n          })\n\n          container.appendChild(chooseExistingGroupButton)\n          container.appendChild(createNewGroupButton)\n\n          this.element.innerHTML = ''\n          this.element.appendChild(container)\n        })\n        .catch(err => {\n          this.element.appendChild(\n            errorMessageBlock(\n              document,\n              escape(`Could find your groups. (${err})`)\n            )\n          )\n        })\n    }\n\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n\n  findAddressBook (typeIndex) {\n    return new Promise((resolve, reject) => {\n      kb.fetcher.nowOrWhenFetched(typeIndex, (ok, err) => {\n        if (!ok) {\n          return reject(err)\n        }\n        const bookRegistration = kb.any(\n          null,\n          ns.solid('forClass'),\n          ns.vcard('AddressBook')\n        )\n        if (!bookRegistration) {\n          return reject(\n            new Error(\n              'no address book registered in the solid type index ' + typeIndex\n            )\n          )\n        }\n        const book = kb.any(bookRegistration, ns.solid('instance'))\n        if (!book) {\n          return reject(new Error('incomplete address book registration'))\n        }\n        kb.fetcher\n          .load(book)\n          .then(function (_xhr) {\n            return resolve({ book })\n          })\n          .catch(function (errr) {\n            return reject(new Error('Could not load address book ' + errr))\n          })\n      })\n    })\n  }\n\n  createNewGroup (book, defaultNewGroupName) {\n    const { groupIndex, groupContainer } = indexes(book)\n    const group = rdf.sym(\n      `${groupContainer.uri}${uuidv4().slice(0, 8)}.ttl#this`\n    )\n    const name = defaultNewGroupName || 'Untitled Group'\n\n    // NOTE that order matters here.  Unfortunately this type of update is\n    // non-atomic in that solid requires us to send two PATCHes, either of which\n    // might fail.\n    const patchPromises = [group.doc(), groupIndex].map(doc => {\n      const typeStatement = rdf.st(group, ns.rdf('type'), ns.vcard('Group'), doc)\n      const nameStatement = rdf.st(group, ns.vcard('fn'), name, group.doc(), doc)\n      const includesGroupStatement = rdf.st(\n        book,\n        ns.vcard('includesGroup'),\n        group,\n        doc\n      )\n      const toIns = doc.equals(groupIndex)\n        ? [typeStatement, nameStatement, includesGroupStatement]\n        : [typeStatement, nameStatement]\n      return patch(doc.uri, { toIns }).then(() => {\n        toIns.forEach(st => {\n          kb.add(st)\n        })\n      })\n    })\n    return Promise.all(patchPromises)\n      .then(() => ({ group }))\n      .catch(err => {\n        debug.log('Could not create new group.  PATCH failed ' + err)\n        throw new Error(\n          `Couldn't create new group.  PATCH failed for (${\n          err.xhr ? err.xhr.responseURL : ''\n          } )`\n        )\n      })\n  }\n\n  onSelectGroup (group) {\n    this.selectedgroup = group\n    this.groupPickedCb(group)\n    this.render()\n  }\n}\n\nexport class GroupPicker {\n  constructor (element, book, onSelectGroup) {\n    this.element = element\n    this.book = book\n    this.onSelectGroup = onSelectGroup\n  }\n\n  render () {\n    this.loadGroups()\n      .then(groups => {\n        // render the groups\n        const container = document.createElement('div')\n        container.style.display = 'flex'\n        container.style.flexDirection = 'column'\n        groups.forEach(group => {\n          const groupButton = document.createElement('button')\n          groupButton.addEventListener('click', this.handleClickGroup(group))\n          new Group(groupButton, group).render()\n          container.appendChild(groupButton)\n        })\n        this.element.innerHTML = ''\n        this.element.appendChild(container)\n      })\n      .catch(err => {\n        this.element.appendChild(\n          errorMessageBlock(\n            document,\n            escape(`There was an error loading your groups. (${err})`)\n          )\n        )\n      })\n    return this\n  }\n\n  loadGroups () {\n    return new Promise((resolve, reject) => {\n      const { groupIndex } = indexes(this.book)\n      kb.fetcher.nowOrWhenFetched(groupIndex, (ok, err) => {\n        if (!ok) {\n          return reject(err)\n        }\n        const groups = kb.each(this.book, ns.vcard('includesGroup'))\n        return resolve(groups)\n      })\n    })\n  }\n\n  handleClickGroup (group) {\n    return _event => {\n      this.onSelectGroup(group)\n    }\n  }\n}\n\nexport class Group {\n  constructor (element, group) {\n    this.element = element\n    this.group = group\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.textContent = escape(\n      // @@@@@ need to escape??\n      getWithDefault(this.group, ns.vcard('fn'), `[${this.group.value}]`)\n    )\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n}\n\nexport class GroupBuilder {\n  constructor (element, book, group, doneBuildingCb, groupChangedCb) {\n    this.element = element\n    this.book = book\n    this.group = group\n    this.onGroupChanged = (err, changeType, agent) => {\n      if (groupChangedCb) {\n        groupChangedCb(err, changeType, agent)\n      }\n    }\n    this.groupChangedCb = groupChangedCb\n    this.doneBuildingCb = doneBuildingCb\n  }\n\n  refresh () {\n    // TODO: implement\n  }\n\n  render () {\n    const dropContainer = document.createElement('div')\n    dropContainer.style.maxWidth = '350px'\n    dropContainer.style.minHeight = '200px'\n    dropContainer.style.outline = '1px solid black'\n    dropContainer.style.display = 'flex'\n    dropContainer.style.flexDirection = 'column'\n\n    makeDropTarget(dropContainer, uris => {\n      uris.forEach(uri => {\n        this.add(uri).catch(err => {\n          this.element.appendChild(\n            errorMessageBlock(\n              document,\n              escape(`Could not add the given WebId. (${err})`)\n            )\n          )\n        })\n      })\n    })\n\n    const groupNameInput = document.createElement('input')\n    groupNameInput.type = 'text'\n    groupNameInput.value = getWithDefault(\n      this.group,\n      ns.vcard('fn'),\n      'Untitled Group'\n    )\n    groupNameInput.addEventListener('change', event => {\n      this.setGroupName(event.target.value).catch(err => {\n        this.element.appendChild(\n          errorMessageBlock(document, `Error changing group name. (${err})`)\n        )\n      })\n    })\n    const groupNameLabel = document.createElement('label')\n    groupNameLabel.textContent = escape('Group Name:')\n    groupNameLabel.appendChild(groupNameInput)\n    dropContainer.appendChild(groupNameLabel)\n\n    if (kb.any(this.group, ns.vcard('hasMember'))) {\n      kb.match(this.group, ns.vcard('hasMember')).forEach(statement => {\n        const webIdNode = statement.object\n        const personDiv = document.createElement('div')\n        new Person(personDiv, webIdNode, this.handleRemove(webIdNode)).render()\n        dropContainer.appendChild(personDiv)\n      })\n    } else {\n      const copy = document.createElement('p')\n      copy.textContent = escape`\n        To add someone to this group, drag and drop their WebID URL onto the box.\n      `\n      dropContainer.appendChild(copy)\n    }\n\n    const doneBuildingButton = document.createElement('button')\n    doneBuildingButton.textContent = escape('Done')\n    doneBuildingButton.addEventListener('click', _event => {\n      this.doneBuildingCb(this.group)\n    })\n    dropContainer.appendChild(doneBuildingButton)\n\n    this.element.innerHTML = ''\n    this.element.appendChild(dropContainer)\n    return this\n  }\n\n  add (webId) {\n    return new Promise((resolve, reject) => {\n      kb.fetcher.nowOrWhenFetched(webId, (ok, err) => {\n        if (!ok) {\n          this.onGroupChanged(err)\n          return reject(err)\n        }\n        // make sure it's a valid person, group, or entity (for now just handle\n        // webId)\n        const webIdNode = rdf.namedNode(webId)\n        const rdfClass = kb.any(webIdNode, ns.rdf('type'))\n        if (!rdfClass || !rdfClass.equals(ns.foaf('Person'))) {\n          return reject(\n            new Error(\n              `Only people supported right now. (tried to add something of type ${rdfClass.value})`\n            )\n          )\n        }\n        return resolve(webIdNode)\n      })\n    }).then(webIdNode => {\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\n      if (kb.holdsStatement(statement)) {\n        return webIdNode\n      }\n      return patch(this.group.doc().uri, { toIns: [statement] }).then(() => {\n        statement.why = this.group.doc()\n        kb.add(statement)\n        this.onGroupChanged(null, 'added', webIdNode)\n        this.render()\n      })\n    })\n  }\n\n  handleRemove (webIdNode) {\n    return _event => {\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\n      return patch(this.group.doc().uri, { toDel: [statement] })\n        .then(() => {\n          kb.remove(statement)\n          this.onGroupChanged(null, 'removed', webIdNode)\n          this.render()\n          return true\n        })\n        .catch(err => {\n          const name = kb.any(webIdNode, ns.foaf('name'))\n          const errorMessage =\n            name && name.value\n              ? `Could not remove ${name.value}. (${err})`\n              : `Could not remove ${webIdNode.value}. (${err})`\n          throw new Error(errorMessage)\n        })\n    }\n  }\n\n  setGroupName (name) {\n    const { groupIndex } = indexes(this.book)\n    const updatePromises = [this.group.doc(), groupIndex].map(namedGraph => {\n      const oldNameStatements = kb.match(\n        this.group,\n        ns.vcard('fn'),\n        null,\n        namedGraph\n      )\n      const newNameStatement = rdf.st(\n        this.group,\n        ns.vcard('fn'),\n        rdf.literal(name)\n      )\n      return patch(namedGraph.value, {\n        toDel: oldNameStatements,\n        toIns: [newNameStatement]\n      }).then(_solidResponse => {\n        kb.removeStatements(oldNameStatements)\n        newNameStatement.why = namedGraph\n        kb.add(newNameStatement)\n      })\n    })\n    return Promise.all(updatePromises)\n  }\n}\n// @ignore exporting this only for the unit test\n// @@ TODO maybe I should move this down at end, but for\n// now I will leave it where it was\nexport class Person {\n  constructor (element, webIdNode, handleRemove) {\n    this.webIdNode = webIdNode\n    this.element = element\n    this.handleRemove = handleRemove\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.style.display = 'flex'\n\n    // TODO: take a look at UI.widgets.setName\n    const imgSrc = getWithDefault(\n      this.webIdNode,\n      ns.foaf('img'),\n      iconBase + 'noun_15059.svg'\n    )\n    const profileImg = document.createElement('img')\n    profileImg.src = escape(imgSrc)\n    profileImg.width = '50'\n    profileImg.height = '50'\n    profileImg.style.margin = '5px'\n\n    // TODO: take a look at UI.widgets.setImage\n    const name = getWithDefault(\n      this.webIdNode,\n      ns.foaf('name'),\n      `[${this.webIdNode}]`\n    )\n    const nameSpan = document.createElement('span')\n    nameSpan.innerHTML = escape(name)\n    nameSpan.style.flexGrow = '1'\n    nameSpan.style.margin = 'auto 0'\n\n    const removeButton = document.createElement('button')\n    removeButton.textContent = 'Remove'\n    removeButton.addEventListener('click', _event =>\n      this.handleRemove().catch(err => {\n        this.element.appendChild(errorMessageBlock(document, escape(`${err}`)))\n      })\n    )\n    removeButton.style.margin = '5px'\n\n    container.appendChild(profileImg)\n    container.appendChild(nameSpan)\n    container.appendChild(removeButton)\n\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n}\n\nfunction getWithDefault (subject, predicate, defaultValue) {\n  const object = kb.any(subject, predicate)\n  return object ? object.value : defaultValue\n}\n\nfunction patch (url, { toDel, toIns }) {\n  return new Promise((resolve, reject) => {\n    kb.updater.update(toDel, toIns, (uri, success, errorMessage) => {\n      if (!success) {\n        return reject(\n          new Error(`PATCH failed for resource <${uri}>: ${errorMessage}`)\n        )\n      }\n      resolve()\n    })\n  })\n  // return webClient.patch(url, toDel, toIns)\n  //   .then(solidResponse => {\n  //     const status = solidResponse.xhr.status\n  //     if (status < 200 || status >= 400) {\n  //       const err = new Error(`PATCH failed for resource <${solidResponse.url}>`)\n  //       err.solidResponse = solidResponse\n  //       throw err\n  //     }\n  //   })\n}\n\nfunction indexes (book) {\n  return {\n    // bookIndex: book,\n    groupIndex: kb.any(book, ns.vcard('groupIndex')),\n    groupContainer: kb.sym(book.dir().uri + 'Group/')\n  }\n}\n","function _taggedTemplateLiteral(e, t) {\n  return t || (t = e.slice(0)), Object.freeze(Object.defineProperties(e, {\n    raw: {\n      value: Object.freeze(t)\n    }\n  }));\n}\nexport { _taggedTemplateLiteral as default };","//  Common code for a discussion are a of messages about something\n//\n\nimport { icons } from './iconBase'\nimport * as login from './login/login'\nimport { solidLogicSingleton } from 'solid-logic'\nimport ns from './ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\nimport { style } from './style'\nimport * as utils from './utils'\nimport * as widgets from './widgets'\n\nconst UI = { icons, ns, rdf, style, widgets }\n\nexport function messageArea (dom, kb, subject, messageStore, options) {\n  kb = kb || solidLogicSingleton.store\n  messageStore = messageStore.doc() // No hash\n  const ns = UI.ns\n  const WF = rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n  const DCT = rdf.Namespace('http://purl.org/dc/terms/')\n\n  options = options || {}\n\n  const newestFirst = !!options.newestFirst\n\n  const messageBodyStyle =\n    'white-space: pre-wrap; width: 90%; font-size:100%; border: 0.07em solid #eee; padding: .2em 0.5em; margin: 0.1em 1em 0.1em 1em;'\n  // 'font-size: 100%; margin: 0.1em 1em 0.1em 1em;  background-color: white; white-space: pre-wrap; padding: 0.1em;'\n\n  const div = dom.createElement('div')\n  // eslint-disable-next-line prefer-const\n  let messageTable // Shared by initial build and addMessageFromBindings\n\n  let me\n\n  const updater = solidLogicSingleton.store.updater\n\n  const anchor = function (text, term) {\n    // If there is no link return an element anyway\n    const a = dom.createElement('a')\n    if (term && term.uri) {\n      a.setAttribute('href', term.uri)\n      a.addEventListener('click', UI.widgets.openHrefInOutlineMode, true)\n      a.setAttribute('style', 'color: #3B5998; text-decoration: none; ') // font-weight: bold\n    }\n    a.textContent = text\n    return a\n  }\n\n  const mention = function mention (message, style) {\n    const pre = dom.createElement('pre')\n    pre.setAttribute('style', style || 'color: grey')\n    div.appendChild(pre)\n    pre.appendChild(dom.createTextNode(message))\n    return pre\n  }\n\n  const announce = {\n    log: function (message) {\n      mention(message, 'color: #111;')\n    },\n    warn: function (message) {\n      mention(message, 'color: #880;')\n    },\n    error: function (message) {\n      mention(message, 'color: #800;')\n    }\n  }\n\n  //       Form for a new message\n  //\n  const newMessageForm = function () {\n    const form = dom.createElement('tr')\n    const lhs = dom.createElement('td')\n    const middle = dom.createElement('td')\n    const rhs = dom.createElement('td')\n    form.appendChild(lhs)\n    form.appendChild(middle)\n    form.appendChild(rhs)\n    form.AJAR_date = '9999-01-01T00:00:00Z' // ISO format for field sort\n\n    const sendMessage = function () {\n      // titlefield.setAttribute('class','pendingedit')\n      // titlefield.disabled = true\n      field.setAttribute('class', 'pendingedit')\n      field.disabled = true\n      const sts = []\n      const now = new Date()\n      const timestamp = '' + now.getTime()\n      const dateStamp = rdf.term(now)\n      // http://www.w3schools.com/jsref/jsref_obj_date.asp\n      const message = kb.sym(messageStore.uri + '#' + 'Msg' + timestamp)\n\n      sts.push(\n        new rdf.Statement(subject, ns.wf('message'), message, messageStore)\n      )\n      sts.push(\n        new rdf.Statement(\n          message,\n          ns.sioc('content'),\n          kb.literal(field.value),\n          messageStore\n        )\n      )\n      sts.push(\n        new rdf.Statement(message, DCT('created'), dateStamp, messageStore)\n      )\n      if (me) {\n        sts.push(\n          new rdf.Statement(message, ns.foaf('maker'), me, messageStore)\n        )\n      }\n\n      const sendComplete = function (uri, success, body) {\n        if (!success) {\n          form.appendChild(\n            UI.widgets.errorMessageBlock(dom, 'Error writing message: ' + body)\n          )\n        } else {\n          const bindings = {\n            '?msg': message,\n            '?content': kb.literal(field.value),\n            '?date': dateStamp,\n            '?creator': me\n          }\n          renderMessage(bindings, false) // not green\n\n          field.value = '' // clear from out for reuse\n          field.setAttribute('class', '')\n          field.disabled = false\n        }\n      }\n      updater.update([], sts, sendComplete)\n    }\n    form.appendChild(dom.createElement('br'))\n\n    let field, sendButton\n    const turnOnInput = function () {\n      creatorAndDate(lhs, me, '', null)\n\n      field = dom.createElement('textarea')\n      middle.innerHTML = ''\n      middle.appendChild(field)\n      field.rows = 3\n      // field.cols = 40\n      field.setAttribute('style', messageBodyStyle + 'background-color: #eef;')\n\n      field.addEventListener(\n        'keyup',\n        function (e) {\n          // User preference?\n          if (e.keyCode === 13) {\n            if (!e.altKey) {\n              // Alt-Enter just adds a new line\n              sendMessage()\n            }\n          }\n        },\n        false\n      )\n\n      rhs.innerHTML = ''\n      sendButton = UI.widgets.button(\n        dom,\n        UI.icons.iconBase + 'noun_383448.svg',\n        'Send'\n      )\n      sendButton.setAttribute('style', UI.style.buttonStyle + 'float: right;')\n      sendButton.addEventListener('click', sendMessage, false)\n      rhs.appendChild(sendButton)\n    }\n\n    const context = { div: middle, dom }\n    login.ensureLoggedIn(context).then(context => {\n      me = context.me\n      turnOnInput()\n    })\n\n    return form\n  }\n\n  function nick (person) {\n    const s = solidLogicSingleton.store.any(person, UI.ns.foaf('nick'))\n    if (s) return '' + s.value\n    return '' + utils.label(person)\n  }\n\n  function creatorAndDate (td1, creator, date, message) {\n    const nickAnchor = td1.appendChild(anchor(nick(creator), creator))\n    if (creator.uri) {\n      solidLogicSingleton.store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n        _ok,\n        _body\n      ) {\n        nickAnchor.textContent = nick(creator)\n      })\n    }\n    td1.appendChild(dom.createElement('br'))\n    td1.appendChild(anchor(date, message))\n  }\n\n  // ///////////////////////////////////////////////////////////////////////\n\n  function syncMessages (about, messageTable) {\n    const displayed = {}\n    let ele, ele2\n    for (ele = messageTable.firstChild; ele; ele = ele.nextSibling) {\n      if (ele.AJAR_subject) {\n        displayed[ele.AJAR_subject.uri] = true\n      }\n    }\n    const messages = kb.each(about, ns.wf('message'))\n    const stored = {}\n    messages.forEach(function (m) {\n      stored[m.uri] = true\n      if (!displayed[m.uri]) {\n        addMessage(m)\n      }\n    })\n\n    for (ele = messageTable.firstChild; ele;) {\n      ele2 = ele.nextSibling\n      if (ele.AJAR_subject && !stored[ele.AJAR_subject.uri]) {\n        messageTable.removeChild(ele)\n      }\n      ele = ele2\n    }\n  }\n\n  const deleteMessage = function (message) {\n    const deletions = kb\n      .statementsMatching(message)\n      .concat(kb.statementsMatching(undefined, undefined, message))\n    updater.update(deletions, [], function (uri, ok, body) {\n      if (!ok) {\n        announce.error('Cant delete messages:' + body)\n      } else {\n        syncMessages(subject, messageTable)\n      }\n    })\n  }\n\n  const addMessage = function (message) {\n    const bindings = {\n      '?msg': message,\n      '?creator': kb.any(message, ns.foaf('maker')),\n      '?date': kb.any(message, DCT('created')),\n      '?content': kb.any(message, ns.sioc('content'))\n    }\n    renderMessage(bindings, true) // fresh from elsewhere\n  }\n\n  const renderMessage = function (bindings, fresh) {\n    const creator = bindings['?creator']\n    const message = bindings['?msg']\n    const date = bindings['?date']\n    const content = bindings['?content']\n\n    const dateString = date.value\n    const tr = dom.createElement('tr')\n    tr.AJAR_date = dateString\n    tr.AJAR_subject = message\n\n    let done = false\n    for (let ele = messageTable.firstChild; ; ele = ele.nextSibling) {\n      if (!ele) {\n        // empty\n        break\n      }\n      if (\n        (dateString > ele.AJAR_date && newestFirst) ||\n        (dateString < ele.AJAR_date && !newestFirst)\n      ) {\n        messageTable.insertBefore(tr, ele)\n        done = true\n        break\n      }\n    }\n    if (!done) {\n      messageTable.appendChild(tr)\n    }\n\n    const td1 = dom.createElement('td')\n    tr.appendChild(td1)\n    creatorAndDate(td1, creator, UI.widgets.shortDate(dateString), message)\n\n    const td2 = dom.createElement('td')\n    tr.appendChild(td2)\n    const pre = dom.createElement('p')\n    pre.setAttribute(\n      'style',\n      messageBodyStyle +\n        (fresh ? 'background-color: #e8ffe8;' : 'background-color: #white;')\n    )\n    td2.appendChild(pre)\n    pre.textContent = content.value\n\n    const td3 = dom.createElement('td')\n    tr.appendChild(td3)\n\n    const delButton = dom.createElement('button')\n    td3.appendChild(delButton)\n    delButton.textContent = '-'\n\n    tr.setAttribute('class', 'hoverControl') // See tabbedtab.css (sigh global CSS)\n    delButton.setAttribute('class', 'hoverControlHide')\n    delButton.setAttribute('style', 'color: red;')\n    delButton.addEventListener(\n      'click',\n      function (_event) {\n        td3.removeChild(delButton) // Ask -- are you sure?\n        const cancelButton = dom.createElement('button')\n        cancelButton.textContent = 'cancel'\n        td3.appendChild(cancelButton).addEventListener(\n          'click',\n          function (_event) {\n            td3.removeChild(sureButton)\n            td3.removeChild(cancelButton)\n            td3.appendChild(delButton)\n          },\n          false\n        )\n        const sureButton = dom.createElement('button')\n        sureButton.textContent = 'Delete message'\n        td3.appendChild(sureButton).addEventListener(\n          'click',\n          function (_event) {\n            td3.removeChild(sureButton)\n            td3.removeChild(cancelButton)\n            deleteMessage(message)\n          },\n          false\n        )\n      },\n      false\n    )\n  }\n\n  // Messages with date, author etc\n\n  messageTable = dom.createElement('table')\n  messageTable.fresh = false\n  div.appendChild(messageTable)\n  messageTable.setAttribute('style', 'width: 100%;') // fill that div!\n\n  const tr = newMessageForm()\n  if (newestFirst) {\n    messageTable.insertBefore(tr, messageTable.firstChild) // If newestFirst\n  } else {\n    messageTable.appendChild(tr) // not newestFirst\n  }\n\n  let query\n  // Do this with a live query to pull in messages from web\n  if (options.query) {\n    query = options.query\n  } else {\n    query = new rdf.Query('Messages')\n    const v = {} // semicolon needed\n    const vs = ['msg', 'date', 'creator', 'content']\n    vs.forEach(function (x) {\n      query.vars.push((v[x] = rdf.variable(x)))\n    })\n    query.pat.add(subject, WF('message'), v.msg)\n    query.pat.add(v.msg, ns.dct('created'), v.date)\n    query.pat.add(v.msg, ns.foaf('maker'), v.creator)\n    query.pat.add(v.msg, ns.sioc('content'), v.content)\n  }\n  function doneQuery () {\n    messageTable.fresh = true // any new are fresh and so will be greenish\n  }\n  kb.query(query, renderMessage, undefined, doneQuery)\n  div.refresh = function () {\n    syncMessages(subject, messageTable)\n  }\n  // syncMessages(subject, messageTable) // no the query will do this async\n  return div\n}\n","/**\n * Contains the [[DateFolder]] class\n * This tracks data stored in dated folders and sub-folders\n *\n */\nimport * as debug from '../debug'\nimport { store } from 'solid-logic'\nimport ns from '../ns'\nimport * as $rdf from 'rdflib' // pull in first avoid cross-refs\n\nexport async function emptyLeaf (leafDocument) {\n  await store.fetcher.load(leafDocument)\n  // files can have seealso links. skip ones with no leafObjects with a date\n  return !(\n    store.statementsMatching(null, ns.dct('created'), null, leafDocument)\n      .length > 0\n  )\n}\n\n/**\n * Track back through the YYYY/MM/DD tree to find the previous/next day\n */\nexport class DateFolder {\n  constructor (rootThing, leafFileName, membershipProperty) {\n    this.root = rootThing\n    this.rootFolder = rootThing.dir()\n    this.leafFileName = leafFileName || 'index.ttl' // typically chat.ttl\n    this.membershipProperty = membershipProperty || ns.wf('leafObject')\n  }\n\n  /* Generate the leaf document (rdf object) from date\n   * @returns: <NamedNode> - document\n   */\n  leafDocumentFromDate (date) {\n    // debug.log('incoming date: ' + date)\n    const isoDate = date.toISOString() // Like \"2018-05-07T17:42:46.576Z\"\n    let path = isoDate.split('T')[0].replace(/-/g, '/') //  Like \"2018/05/07\"\n    path = this.root.dir().uri + path + '/' + this.leafFileName\n    return store.sym(path)\n  }\n\n  /* Generate a date object from the leaf file name\n   */\n  dateFromLeafDocument (doc) {\n    const head = this.rootFolder.uri.length\n    const str = doc.uri.slice(head, head + 10).replace(/\\//g, '-')\n    // let date = new Date(str + 'Z') // GMT - but fails in FF - invalid format :-(\n    const date = new Date(str) // not explicitly UTC but is assumed so in spec\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse\n    // debug.log('Date for ' + doc + ':' + date.toISOString())\n    return date\n  }\n\n  async loadPrevious (date, backwards) {\n    async function previousPeriod (file, level) {\n      function younger (x) {\n        if (backwards ? x.uri >= file.uri : x.uri <= file.uri) return false // later than we want or same -- looking for different\n        return true\n      }\n      function suitable (x) {\n        const tail = x.uri\n          .slice(0, -1)\n          .split('/')\n          .slice(-1)[0]\n        if (!'0123456789'.includes(tail[0])) return false // not numeric\n        return true\n      }\n\n      function lastOrFirst (siblings) {\n        siblings = siblings.filter(suitable)\n        siblings.sort() // chronological order\n        if (!backwards) siblings.reverse()\n        return siblings.pop() // date folder\n      }\n      // debug.log('  previousPeriod level' + level + ' file ' + file)\n      const parent = file.dir()\n      try {\n        await store.fetcher.load(parent)\n        let siblings = store.each(parent, ns.ldp('contains'))\n        siblings = siblings.filter(younger)\n        const folder = lastOrFirst(siblings)\n        if (folder) return folder\n        // debug.log(' parent no suitable offspring ' + parent)\n      } catch (err) {\n        if (err.response && err.response.status && err.response.status === 404) {\n          debug.log('Error 404 for chat parent file ' + parent)\n        } else {\n          debug.log('*** Error NON 404 for chat parent file ' + parent)\n          // statusTR.appendChild(widgets.errorMessageBlock(dom, err, 'pink'))\n          throw (new Error(`*** ${err.message} for chat folder ${parent}`))\n        }\n      }\n      if (level === 0) {\n        // debug.log('loadPrevious:  returning as level is zero')\n        return null // 3:day, 2:month, 1: year  0: no\n      }\n\n      const uncle = await previousPeriod(parent, level - 1)\n      if (!uncle) {\n        // debug.log('   previousPeriod: nothing left before. ', parent)\n        return null // reached first ever\n      }\n      await store.fetcher.load(uncle)\n      const cousins = store.each(uncle, ns.ldp('contains'))\n      const result = lastOrFirst(cousins)\n      // debug.log('   previousPeriod: returning cousins at level ' + level, cousins)\n      // debug.log('   previousPeriod: returning result at level ' + level, result)\n\n      return result\n    } // previousPeriod\n\n    let folder = this.leafDocumentFromDate(date).dir()\n    while (true) {\n      const found = await previousPeriod(folder, 3)\n      if (found) {\n        const leafDocument = store.sym(found.uri + this.leafFileName)\n        const nextDate = this.dateFromLeafDocument(leafDocument)\n        if (!await emptyLeaf(leafDocument)) {\n          return nextDate\n        } else {\n          // debug.log('  loadPrevious: skipping empty ' + leafDocument)\n          date = nextDate\n          folder = this.leafDocumentFromDate(date).dir()\n          // debug.log('    loadPrevious: moved back to ' + folder)\n        }\n      } else {\n        return null // no more left\n      }\n    }\n  } // loadPrevious\n\n  async firstLeaf (backwards) {\n    // backwards -> last leafObject\n    const folderStore = $rdf.graph()\n    const folderFetcher = new $rdf.Fetcher(folderStore)\n    async function earliestSubfolder (parent) {\n      function suitable (x) {\n        const tail = x.uri\n          .slice(0, -1)\n          .split('/')\n          .slice(-1)[0]\n        if (!'0123456789'.includes(tail[0])) return false // not numeric\n        return true\n      }\n      // debug.log('            parent ' + parent)\n      delete folderFetcher.requested[parent.uri]\n      // try {\n      await folderFetcher.load(parent, { force: true }) // Force fetch as will have changed\n      // }catch (err) {\n      // }\n\n      let kids = folderStore.each(parent, ns.ldp('contains'))\n      kids = kids.filter(suitable)\n      if (kids.length === 0) {\n        throw new Error(' @@@  No children to         parent2 ' + parent)\n      }\n\n      kids.sort()\n      if (backwards) kids.reverse()\n      return kids[0]\n    }\n    const y = await earliestSubfolder(this.root.dir())\n    const month = await earliestSubfolder(y)\n    const d = await earliestSubfolder(month)\n    const leafDocument = $rdf.sym(d.uri + 'chat.ttl')\n    await folderFetcher.load(leafDocument)\n    const leafObjects = folderStore.each(\n      this.root,\n      this.membershipProperty,\n      null,\n      leafDocument\n    )\n    if (leafObjects.length === 0) {\n      const msg =\n        '  INCONSISTENCY -- no chat leafObject in file ' + leafDocument\n      debug.trace(msg)\n      throw new Error(msg)\n    }\n    const sortMe = leafObjects.map(leafObject => [\n      folderStore.any(leafObject, ns.dct('created')),\n      leafObject\n    ])\n    sortMe.sort()\n    if (backwards) sortMe.reverse()\n    /* debug.log(\n      (backwards ? 'Latest' : 'Earliest') + ' leafObject is ' + sortMe[0][1]\n    ) */\n    return sortMe[0][1]\n  } // firstleafObject\n} // class\n","export const crypto = typeof globalThis === 'object' && 'crypto' in globalThis ? globalThis.crypto : undefined;\n//# sourceMappingURL=crypto.js.map","/**\n * Utilities for hex, bytes, CSPRNG.\n * @module\n */\n/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */\n// We use WebCrypto aka globalThis.crypto, which exists in browsers and node.js 16+.\n// node.js versions earlier than v19 don't declare it in global scope.\n// For node.js, package.json#exports field mapping rewrites import\n// from `crypto` to `cryptoNode`, which imports native module.\n// Makes the utils un-importable in browsers without a bundler.\n// Once node.js 18 is deprecated (2025-04-30), we can just drop the import.\nimport { crypto } from '@noble/hashes/crypto';\n/** Checks if something is Uint8Array. Be careful: nodejs Buffer will return true. */\nexport function isBytes(a) {\n    return a instanceof Uint8Array || (ArrayBuffer.isView(a) && a.constructor.name === 'Uint8Array');\n}\n/** Asserts something is positive integer. */\nexport function anumber(n) {\n    if (!Number.isSafeInteger(n) || n < 0)\n        throw new Error('positive integer expected, got ' + n);\n}\n/** Asserts something is Uint8Array. */\nexport function abytes(b, ...lengths) {\n    if (!isBytes(b))\n        throw new Error('Uint8Array expected');\n    if (lengths.length > 0 && !lengths.includes(b.length))\n        throw new Error('Uint8Array expected of length ' + lengths + ', got length=' + b.length);\n}\n/** Asserts something is hash */\nexport function ahash(h) {\n    if (typeof h !== 'function' || typeof h.create !== 'function')\n        throw new Error('Hash should be wrapped by utils.createHasher');\n    anumber(h.outputLen);\n    anumber(h.blockLen);\n}\n/** Asserts a hash instance has not been destroyed / finished */\nexport function aexists(instance, checkFinished = true) {\n    if (instance.destroyed)\n        throw new Error('Hash instance has been destroyed');\n    if (checkFinished && instance.finished)\n        throw new Error('Hash#digest() has already been called');\n}\n/** Asserts output is properly-sized byte array */\nexport function aoutput(out, instance) {\n    abytes(out);\n    const min = instance.outputLen;\n    if (out.length < min) {\n        throw new Error('digestInto() expects output buffer of length at least ' + min);\n    }\n}\n/** Cast u8 / u16 / u32 to u8. */\nexport function u8(arr) {\n    return new Uint8Array(arr.buffer, arr.byteOffset, arr.byteLength);\n}\n/** Cast u8 / u16 / u32 to u32. */\nexport function u32(arr) {\n    return new Uint32Array(arr.buffer, arr.byteOffset, Math.floor(arr.byteLength / 4));\n}\n/** Zeroize a byte array. Warning: JS provides no guarantees. */\nexport function clean(...arrays) {\n    for (let i = 0; i < arrays.length; i++) {\n        arrays[i].fill(0);\n    }\n}\n/** Create DataView of an array for easy byte-level manipulation. */\nexport function createView(arr) {\n    return new DataView(arr.buffer, arr.byteOffset, arr.byteLength);\n}\n/** The rotate right (circular right shift) operation for uint32 */\nexport function rotr(word, shift) {\n    return (word << (32 - shift)) | (word >>> shift);\n}\n/** The rotate left (circular left shift) operation for uint32 */\nexport function rotl(word, shift) {\n    return (word << shift) | ((word >>> (32 - shift)) >>> 0);\n}\n/** Is current platform little-endian? Most are. Big-Endian platform: IBM */\nexport const isLE = /* @__PURE__ */ (() => new Uint8Array(new Uint32Array([0x11223344]).buffer)[0] === 0x44)();\n/** The byte swap operation for uint32 */\nexport function byteSwap(word) {\n    return (((word << 24) & 0xff000000) |\n        ((word << 8) & 0xff0000) |\n        ((word >>> 8) & 0xff00) |\n        ((word >>> 24) & 0xff));\n}\n/** Conditionally byte swap if on a big-endian platform */\nexport const swap8IfBE = isLE\n    ? (n) => n\n    : (n) => byteSwap(n);\n/** @deprecated */\nexport const byteSwapIfBE = swap8IfBE;\n/** In place byte swap for Uint32Array */\nexport function byteSwap32(arr) {\n    for (let i = 0; i < arr.length; i++) {\n        arr[i] = byteSwap(arr[i]);\n    }\n    return arr;\n}\nexport const swap32IfBE = isLE\n    ? (u) => u\n    : byteSwap32;\n// Built-in hex conversion https://caniuse.com/mdn-javascript_builtins_uint8array_fromhex\nconst hasHexBuiltin = /* @__PURE__ */ (() => \n// @ts-ignore\ntypeof Uint8Array.from([]).toHex === 'function' && typeof Uint8Array.fromHex === 'function')();\n// Array where index 0xf0 (240) is mapped to string 'f0'\nconst hexes = /* @__PURE__ */ Array.from({ length: 256 }, (_, i) => i.toString(16).padStart(2, '0'));\n/**\n * Convert byte array to hex string. Uses built-in function, when available.\n * @example bytesToHex(Uint8Array.from([0xca, 0xfe, 0x01, 0x23])) // 'cafe0123'\n */\nexport function bytesToHex(bytes) {\n    abytes(bytes);\n    // @ts-ignore\n    if (hasHexBuiltin)\n        return bytes.toHex();\n    // pre-caching improves the speed 6x\n    let hex = '';\n    for (let i = 0; i < bytes.length; i++) {\n        hex += hexes[bytes[i]];\n    }\n    return hex;\n}\n// We use optimized technique to convert hex string to byte array\nconst asciis = { _0: 48, _9: 57, A: 65, F: 70, a: 97, f: 102 };\nfunction asciiToBase16(ch) {\n    if (ch >= asciis._0 && ch <= asciis._9)\n        return ch - asciis._0; // '2' => 50-48\n    if (ch >= asciis.A && ch <= asciis.F)\n        return ch - (asciis.A - 10); // 'B' => 66-(65-10)\n    if (ch >= asciis.a && ch <= asciis.f)\n        return ch - (asciis.a - 10); // 'b' => 98-(97-10)\n    return;\n}\n/**\n * Convert hex string to byte array. Uses built-in function, when available.\n * @example hexToBytes('cafe0123') // Uint8Array.from([0xca, 0xfe, 0x01, 0x23])\n */\nexport function hexToBytes(hex) {\n    if (typeof hex !== 'string')\n        throw new Error('hex string expected, got ' + typeof hex);\n    // @ts-ignore\n    if (hasHexBuiltin)\n        return Uint8Array.fromHex(hex);\n    const hl = hex.length;\n    const al = hl / 2;\n    if (hl % 2)\n        throw new Error('hex string expected, got unpadded hex of length ' + hl);\n    const array = new Uint8Array(al);\n    for (let ai = 0, hi = 0; ai < al; ai++, hi += 2) {\n        const n1 = asciiToBase16(hex.charCodeAt(hi));\n        const n2 = asciiToBase16(hex.charCodeAt(hi + 1));\n        if (n1 === undefined || n2 === undefined) {\n            const char = hex[hi] + hex[hi + 1];\n            throw new Error('hex string expected, got non-hex character \"' + char + '\" at index ' + hi);\n        }\n        array[ai] = n1 * 16 + n2; // multiply first octet, e.g. 'a3' => 10*16+3 => 160 + 3 => 163\n    }\n    return array;\n}\n/**\n * There is no setImmediate in browser and setTimeout is slow.\n * Call of async fn will return Promise, which will be fullfiled only on\n * next scheduler queue processing step and this is exactly what we need.\n */\nexport const nextTick = async () => { };\n/** Returns control to thread each 'tick' ms to avoid blocking. */\nexport async function asyncLoop(iters, tick, cb) {\n    let ts = Date.now();\n    for (let i = 0; i < iters; i++) {\n        cb(i);\n        // Date.now() is not monotonic, so in case if clock goes backwards we return return control too\n        const diff = Date.now() - ts;\n        if (diff >= 0 && diff < tick)\n            continue;\n        await nextTick();\n        ts += diff;\n    }\n}\n/**\n * Converts string to bytes using UTF8 encoding.\n * @example utf8ToBytes('abc') // Uint8Array.from([97, 98, 99])\n */\nexport function utf8ToBytes(str) {\n    if (typeof str !== 'string')\n        throw new Error('string expected');\n    return new Uint8Array(new TextEncoder().encode(str)); // https://bugzil.la/1681809\n}\n/**\n * Converts bytes to string using UTF8 encoding.\n * @example bytesToUtf8(Uint8Array.from([97, 98, 99])) // 'abc'\n */\nexport function bytesToUtf8(bytes) {\n    return new TextDecoder().decode(bytes);\n}\n/**\n * Normalizes (non-hex) string or Uint8Array to Uint8Array.\n * Warning: when Uint8Array is passed, it would NOT get copied.\n * Keep in mind for future mutable operations.\n */\nexport function toBytes(data) {\n    if (typeof data === 'string')\n        data = utf8ToBytes(data);\n    abytes(data);\n    return data;\n}\n/**\n * Helper for KDFs: consumes uint8array or string.\n * When string is passed, does utf8 decoding, using TextDecoder.\n */\nexport function kdfInputToBytes(data) {\n    if (typeof data === 'string')\n        data = utf8ToBytes(data);\n    abytes(data);\n    return data;\n}\n/** Copies several Uint8Arrays into one. */\nexport function concatBytes(...arrays) {\n    let sum = 0;\n    for (let i = 0; i < arrays.length; i++) {\n        const a = arrays[i];\n        abytes(a);\n        sum += a.length;\n    }\n    const res = new Uint8Array(sum);\n    for (let i = 0, pad = 0; i < arrays.length; i++) {\n        const a = arrays[i];\n        res.set(a, pad);\n        pad += a.length;\n    }\n    return res;\n}\nexport function checkOpts(defaults, opts) {\n    if (opts !== undefined && {}.toString.call(opts) !== '[object Object]')\n        throw new Error('options should be object or undefined');\n    const merged = Object.assign(defaults, opts);\n    return merged;\n}\n/** For runtime check if class implements interface */\nexport class Hash {\n}\n/** Wraps hash function, creating an interface on top of it */\nexport function createHasher(hashCons) {\n    const hashC = (msg) => hashCons().update(toBytes(msg)).digest();\n    const tmp = hashCons();\n    hashC.outputLen = tmp.outputLen;\n    hashC.blockLen = tmp.blockLen;\n    hashC.create = () => hashCons();\n    return hashC;\n}\nexport function createOptHasher(hashCons) {\n    const hashC = (msg, opts) => hashCons(opts).update(toBytes(msg)).digest();\n    const tmp = hashCons({});\n    hashC.outputLen = tmp.outputLen;\n    hashC.blockLen = tmp.blockLen;\n    hashC.create = (opts) => hashCons(opts);\n    return hashC;\n}\nexport function createXOFer(hashCons) {\n    const hashC = (msg, opts) => hashCons(opts).update(toBytes(msg)).digest();\n    const tmp = hashCons({});\n    hashC.outputLen = tmp.outputLen;\n    hashC.blockLen = tmp.blockLen;\n    hashC.create = (opts) => hashCons(opts);\n    return hashC;\n}\nexport const wrapConstructor = createHasher;\nexport const wrapConstructorWithOpts = createOptHasher;\nexport const wrapXOFConstructorWithOpts = createXOFer;\n/** Cryptographically secure PRNG. Uses internal OS-level `crypto.getRandomValues`. */\nexport function randomBytes(bytesLength = 32) {\n    if (crypto && typeof crypto.getRandomValues === 'function') {\n        return crypto.getRandomValues(new Uint8Array(bytesLength));\n    }\n    // Legacy Node.js compatibility\n    if (crypto && typeof crypto.randomBytes === 'function') {\n        return Uint8Array.from(crypto.randomBytes(bytesLength));\n    }\n    throw new Error('crypto.getRandomValues must be defined');\n}\n//# sourceMappingURL=utils.js.map","/**\n * Internal Merkle-Damgard hash utils.\n * @module\n */\nimport { Hash, abytes, aexists, aoutput, clean, createView, toBytes } from \"./utils.js\";\n/** Polyfill for Safari 14. https://caniuse.com/mdn-javascript_builtins_dataview_setbiguint64 */\nexport function setBigUint64(view, byteOffset, value, isLE) {\n    if (typeof view.setBigUint64 === 'function')\n        return view.setBigUint64(byteOffset, value, isLE);\n    const _32n = BigInt(32);\n    const _u32_max = BigInt(0xffffffff);\n    const wh = Number((value >> _32n) & _u32_max);\n    const wl = Number(value & _u32_max);\n    const h = isLE ? 4 : 0;\n    const l = isLE ? 0 : 4;\n    view.setUint32(byteOffset + h, wh, isLE);\n    view.setUint32(byteOffset + l, wl, isLE);\n}\n/** Choice: a ? b : c */\nexport function Chi(a, b, c) {\n    return (a & b) ^ (~a & c);\n}\n/** Majority function, true if any two inputs is true. */\nexport function Maj(a, b, c) {\n    return (a & b) ^ (a & c) ^ (b & c);\n}\n/**\n * Merkle-Damgard hash construction base class.\n * Could be used to create MD5, RIPEMD, SHA1, SHA2.\n */\nexport class HashMD extends Hash {\n    constructor(blockLen, outputLen, padOffset, isLE) {\n        super();\n        this.finished = false;\n        this.length = 0;\n        this.pos = 0;\n        this.destroyed = false;\n        this.blockLen = blockLen;\n        this.outputLen = outputLen;\n        this.padOffset = padOffset;\n        this.isLE = isLE;\n        this.buffer = new Uint8Array(blockLen);\n        this.view = createView(this.buffer);\n    }\n    update(data) {\n        aexists(this);\n        data = toBytes(data);\n        abytes(data);\n        const { view, buffer, blockLen } = this;\n        const len = data.length;\n        for (let pos = 0; pos < len;) {\n            const take = Math.min(blockLen - this.pos, len - pos);\n            // Fast path: we have at least one block in input, cast it to view and process\n            if (take === blockLen) {\n                const dataView = createView(data);\n                for (; blockLen <= len - pos; pos += blockLen)\n                    this.process(dataView, pos);\n                continue;\n            }\n            buffer.set(data.subarray(pos, pos + take), this.pos);\n            this.pos += take;\n            pos += take;\n            if (this.pos === blockLen) {\n                this.process(view, 0);\n                this.pos = 0;\n            }\n        }\n        this.length += data.length;\n        this.roundClean();\n        return this;\n    }\n    digestInto(out) {\n        aexists(this);\n        aoutput(out, this);\n        this.finished = true;\n        // Padding\n        // We can avoid allocation of buffer for padding completely if it\n        // was previously not allocated here. But it won't change performance.\n        const { buffer, view, blockLen, isLE } = this;\n        let { pos } = this;\n        // append the bit '1' to the message\n        buffer[pos++] = 0b10000000;\n        clean(this.buffer.subarray(pos));\n        // we have less than padOffset left in buffer, so we cannot put length in\n        // current block, need process it and pad again\n        if (this.padOffset > blockLen - pos) {\n            this.process(view, 0);\n            pos = 0;\n        }\n        // Pad until full block byte with zeros\n        for (let i = pos; i < blockLen; i++)\n            buffer[i] = 0;\n        // Note: sha512 requires length to be 128bit integer, but length in JS will overflow before that\n        // You need to write around 2 exabytes (u64_max / 8 / (1024**6)) for this to happen.\n        // So we just write lowest 64 bits of that value.\n        setBigUint64(view, blockLen - 8, BigInt(this.length * 8), isLE);\n        this.process(view, 0);\n        const oview = createView(out);\n        const len = this.outputLen;\n        // NOTE: we do division by 4 later, which should be fused in single op with modulo by JIT\n        if (len % 4)\n            throw new Error('_sha2: outputLen should be aligned to 32bit');\n        const outLen = len / 4;\n        const state = this.get();\n        if (outLen > state.length)\n            throw new Error('_sha2: outputLen bigger than state');\n        for (let i = 0; i < outLen; i++)\n            oview.setUint32(4 * i, state[i], isLE);\n    }\n    digest() {\n        const { buffer, outputLen } = this;\n        this.digestInto(buffer);\n        const res = buffer.slice(0, outputLen);\n        this.destroy();\n        return res;\n    }\n    _cloneInto(to) {\n        to || (to = new this.constructor());\n        to.set(...this.get());\n        const { blockLen, buffer, length, finished, destroyed, pos } = this;\n        to.destroyed = destroyed;\n        to.finished = finished;\n        to.length = length;\n        to.pos = pos;\n        if (length % blockLen)\n            to.buffer.set(buffer);\n        return to;\n    }\n    clone() {\n        return this._cloneInto();\n    }\n}\n/**\n * Initial SHA-2 state: fractional parts of square roots of first 16 primes 2..53.\n * Check out `test/misc/sha2-gen-iv.js` for recomputation guide.\n */\n/** Initial SHA256 state. Bits 0..32 of frac part of sqrt of primes 2..19 */\nexport const SHA256_IV = /* @__PURE__ */ Uint32Array.from([\n    0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19,\n]);\n/** Initial SHA224 state. Bits 32..64 of frac part of sqrt of primes 23..53 */\nexport const SHA224_IV = /* @__PURE__ */ Uint32Array.from([\n    0xc1059ed8, 0x367cd507, 0x3070dd17, 0xf70e5939, 0xffc00b31, 0x68581511, 0x64f98fa7, 0xbefa4fa4,\n]);\n/** Initial SHA384 state. Bits 0..64 of frac part of sqrt of primes 23..53 */\nexport const SHA384_IV = /* @__PURE__ */ Uint32Array.from([\n    0xcbbb9d5d, 0xc1059ed8, 0x629a292a, 0x367cd507, 0x9159015a, 0x3070dd17, 0x152fecd8, 0xf70e5939,\n    0x67332667, 0xffc00b31, 0x8eb44a87, 0x68581511, 0xdb0c2e0d, 0x64f98fa7, 0x47b5481d, 0xbefa4fa4,\n]);\n/** Initial SHA512 state. Bits 0..64 of frac part of sqrt of primes 2..19 */\nexport const SHA512_IV = /* @__PURE__ */ Uint32Array.from([\n    0x6a09e667, 0xf3bcc908, 0xbb67ae85, 0x84caa73b, 0x3c6ef372, 0xfe94f82b, 0xa54ff53a, 0x5f1d36f1,\n    0x510e527f, 0xade682d1, 0x9b05688c, 0x2b3e6c1f, 0x1f83d9ab, 0xfb41bd6b, 0x5be0cd19, 0x137e2179,\n]);\n//# sourceMappingURL=_md.js.map","/**\n * Internal helpers for u64. BigUint64Array is too slow as per 2025, so we implement it using Uint32Array.\n * @todo re-check https://issues.chromium.org/issues/42212588\n * @module\n */\nconst U32_MASK64 = /* @__PURE__ */ BigInt(2 ** 32 - 1);\nconst _32n = /* @__PURE__ */ BigInt(32);\nfunction fromBig(n, le = false) {\n    if (le)\n        return { h: Number(n & U32_MASK64), l: Number((n >> _32n) & U32_MASK64) };\n    return { h: Number((n >> _32n) & U32_MASK64) | 0, l: Number(n & U32_MASK64) | 0 };\n}\nfunction split(lst, le = false) {\n    const len = lst.length;\n    let Ah = new Uint32Array(len);\n    let Al = new Uint32Array(len);\n    for (let i = 0; i < len; i++) {\n        const { h, l } = fromBig(lst[i], le);\n        [Ah[i], Al[i]] = [h, l];\n    }\n    return [Ah, Al];\n}\nconst toBig = (h, l) => (BigInt(h >>> 0) << _32n) | BigInt(l >>> 0);\n// for Shift in [0, 32)\nconst shrSH = (h, _l, s) => h >>> s;\nconst shrSL = (h, l, s) => (h << (32 - s)) | (l >>> s);\n// Right rotate for Shift in [1, 32)\nconst rotrSH = (h, l, s) => (h >>> s) | (l << (32 - s));\nconst rotrSL = (h, l, s) => (h << (32 - s)) | (l >>> s);\n// Right rotate for Shift in (32, 64), NOTE: 32 is special case.\nconst rotrBH = (h, l, s) => (h << (64 - s)) | (l >>> (s - 32));\nconst rotrBL = (h, l, s) => (h >>> (s - 32)) | (l << (64 - s));\n// Right rotate for shift===32 (just swaps l&h)\nconst rotr32H = (_h, l) => l;\nconst rotr32L = (h, _l) => h;\n// Left rotate for Shift in [1, 32)\nconst rotlSH = (h, l, s) => (h << s) | (l >>> (32 - s));\nconst rotlSL = (h, l, s) => (l << s) | (h >>> (32 - s));\n// Left rotate for Shift in (32, 64), NOTE: 32 is special case.\nconst rotlBH = (h, l, s) => (l << (s - 32)) | (h >>> (64 - s));\nconst rotlBL = (h, l, s) => (h << (s - 32)) | (l >>> (64 - s));\n// JS uses 32-bit signed integers for bitwise operations which means we cannot\n// simple take carry out of low bit sum by shift, we need to use division.\nfunction add(Ah, Al, Bh, Bl) {\n    const l = (Al >>> 0) + (Bl >>> 0);\n    return { h: (Ah + Bh + ((l / 2 ** 32) | 0)) | 0, l: l | 0 };\n}\n// Addition with more than 2 elements\nconst add3L = (Al, Bl, Cl) => (Al >>> 0) + (Bl >>> 0) + (Cl >>> 0);\nconst add3H = (low, Ah, Bh, Ch) => (Ah + Bh + Ch + ((low / 2 ** 32) | 0)) | 0;\nconst add4L = (Al, Bl, Cl, Dl) => (Al >>> 0) + (Bl >>> 0) + (Cl >>> 0) + (Dl >>> 0);\nconst add4H = (low, Ah, Bh, Ch, Dh) => (Ah + Bh + Ch + Dh + ((low / 2 ** 32) | 0)) | 0;\nconst add5L = (Al, Bl, Cl, Dl, El) => (Al >>> 0) + (Bl >>> 0) + (Cl >>> 0) + (Dl >>> 0) + (El >>> 0);\nconst add5H = (low, Ah, Bh, Ch, Dh, Eh) => (Ah + Bh + Ch + Dh + Eh + ((low / 2 ** 32) | 0)) | 0;\n// prettier-ignore\nexport { add, add3H, add3L, add4H, add4L, add5H, add5L, fromBig, rotlBH, rotlBL, rotlSH, rotlSL, rotr32H, rotr32L, rotrBH, rotrBL, rotrSH, rotrSL, shrSH, shrSL, split, toBig };\n// prettier-ignore\nconst u64 = {\n    fromBig, split, toBig,\n    shrSH, shrSL,\n    rotrSH, rotrSL, rotrBH, rotrBL,\n    rotr32H, rotr32L,\n    rotlSH, rotlSL, rotlBH, rotlBL,\n    add, add3L, add3H, add4L, add4H, add5H, add5L,\n};\nexport default u64;\n//# sourceMappingURL=_u64.js.map","/**\n * SHA2 hash function. A.k.a. sha256, sha384, sha512, sha512_224, sha512_256.\n * SHA256 is the fastest hash implementable in JS, even faster than Blake3.\n * Check out [RFC 4634](https://datatracker.ietf.org/doc/html/rfc4634) and\n * [FIPS 180-4](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf).\n * @module\n */\nimport { Chi, HashMD, Maj, SHA224_IV, SHA256_IV, SHA384_IV, SHA512_IV } from \"./_md.js\";\nimport * as u64 from \"./_u64.js\";\nimport { clean, createHasher, rotr } from \"./utils.js\";\n/**\n * Round constants:\n * First 32 bits of fractional parts of the cube roots of the first 64 primes 2..311)\n */\n// prettier-ignore\nconst SHA256_K = /* @__PURE__ */ Uint32Array.from([\n    0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n    0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n    0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n    0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n    0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n    0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n    0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n    0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n]);\n/** Reusable temporary buffer. \"W\" comes straight from spec. */\nconst SHA256_W = /* @__PURE__ */ new Uint32Array(64);\nexport class SHA256 extends HashMD {\n    constructor(outputLen = 32) {\n        super(64, outputLen, 8, false);\n        // We cannot use array here since array allows indexing by variable\n        // which means optimizer/compiler cannot use registers.\n        this.A = SHA256_IV[0] | 0;\n        this.B = SHA256_IV[1] | 0;\n        this.C = SHA256_IV[2] | 0;\n        this.D = SHA256_IV[3] | 0;\n        this.E = SHA256_IV[4] | 0;\n        this.F = SHA256_IV[5] | 0;\n        this.G = SHA256_IV[6] | 0;\n        this.H = SHA256_IV[7] | 0;\n    }\n    get() {\n        const { A, B, C, D, E, F, G, H } = this;\n        return [A, B, C, D, E, F, G, H];\n    }\n    // prettier-ignore\n    set(A, B, C, D, E, F, G, H) {\n        this.A = A | 0;\n        this.B = B | 0;\n        this.C = C | 0;\n        this.D = D | 0;\n        this.E = E | 0;\n        this.F = F | 0;\n        this.G = G | 0;\n        this.H = H | 0;\n    }\n    process(view, offset) {\n        // Extend the first 16 words into the remaining 48 words w[16..63] of the message schedule array\n        for (let i = 0; i < 16; i++, offset += 4)\n            SHA256_W[i] = view.getUint32(offset, false);\n        for (let i = 16; i < 64; i++) {\n            const W15 = SHA256_W[i - 15];\n            const W2 = SHA256_W[i - 2];\n            const s0 = rotr(W15, 7) ^ rotr(W15, 18) ^ (W15 >>> 3);\n            const s1 = rotr(W2, 17) ^ rotr(W2, 19) ^ (W2 >>> 10);\n            SHA256_W[i] = (s1 + SHA256_W[i - 7] + s0 + SHA256_W[i - 16]) | 0;\n        }\n        // Compression function main loop, 64 rounds\n        let { A, B, C, D, E, F, G, H } = this;\n        for (let i = 0; i < 64; i++) {\n            const sigma1 = rotr(E, 6) ^ rotr(E, 11) ^ rotr(E, 25);\n            const T1 = (H + sigma1 + Chi(E, F, G) + SHA256_K[i] + SHA256_W[i]) | 0;\n            const sigma0 = rotr(A, 2) ^ rotr(A, 13) ^ rotr(A, 22);\n            const T2 = (sigma0 + Maj(A, B, C)) | 0;\n            H = G;\n            G = F;\n            F = E;\n            E = (D + T1) | 0;\n            D = C;\n            C = B;\n            B = A;\n            A = (T1 + T2) | 0;\n        }\n        // Add the compressed chunk to the current hash value\n        A = (A + this.A) | 0;\n        B = (B + this.B) | 0;\n        C = (C + this.C) | 0;\n        D = (D + this.D) | 0;\n        E = (E + this.E) | 0;\n        F = (F + this.F) | 0;\n        G = (G + this.G) | 0;\n        H = (H + this.H) | 0;\n        this.set(A, B, C, D, E, F, G, H);\n    }\n    roundClean() {\n        clean(SHA256_W);\n    }\n    destroy() {\n        this.set(0, 0, 0, 0, 0, 0, 0, 0);\n        clean(this.buffer);\n    }\n}\nexport class SHA224 extends SHA256 {\n    constructor() {\n        super(28);\n        this.A = SHA224_IV[0] | 0;\n        this.B = SHA224_IV[1] | 0;\n        this.C = SHA224_IV[2] | 0;\n        this.D = SHA224_IV[3] | 0;\n        this.E = SHA224_IV[4] | 0;\n        this.F = SHA224_IV[5] | 0;\n        this.G = SHA224_IV[6] | 0;\n        this.H = SHA224_IV[7] | 0;\n    }\n}\n// SHA2-512 is slower than sha256 in js because u64 operations are slow.\n// Round contants\n// First 32 bits of the fractional parts of the cube roots of the first 80 primes 2..409\n// prettier-ignore\nconst K512 = /* @__PURE__ */ (() => u64.split([\n    '0x428a2f98d728ae22', '0x7137449123ef65cd', '0xb5c0fbcfec4d3b2f', '0xe9b5dba58189dbbc',\n    '0x3956c25bf348b538', '0x59f111f1b605d019', '0x923f82a4af194f9b', '0xab1c5ed5da6d8118',\n    '0xd807aa98a3030242', '0x12835b0145706fbe', '0x243185be4ee4b28c', '0x550c7dc3d5ffb4e2',\n    '0x72be5d74f27b896f', '0x80deb1fe3b1696b1', '0x9bdc06a725c71235', '0xc19bf174cf692694',\n    '0xe49b69c19ef14ad2', '0xefbe4786384f25e3', '0x0fc19dc68b8cd5b5', '0x240ca1cc77ac9c65',\n    '0x2de92c6f592b0275', '0x4a7484aa6ea6e483', '0x5cb0a9dcbd41fbd4', '0x76f988da831153b5',\n    '0x983e5152ee66dfab', '0xa831c66d2db43210', '0xb00327c898fb213f', '0xbf597fc7beef0ee4',\n    '0xc6e00bf33da88fc2', '0xd5a79147930aa725', '0x06ca6351e003826f', '0x142929670a0e6e70',\n    '0x27b70a8546d22ffc', '0x2e1b21385c26c926', '0x4d2c6dfc5ac42aed', '0x53380d139d95b3df',\n    '0x650a73548baf63de', '0x766a0abb3c77b2a8', '0x81c2c92e47edaee6', '0x92722c851482353b',\n    '0xa2bfe8a14cf10364', '0xa81a664bbc423001', '0xc24b8b70d0f89791', '0xc76c51a30654be30',\n    '0xd192e819d6ef5218', '0xd69906245565a910', '0xf40e35855771202a', '0x106aa07032bbd1b8',\n    '0x19a4c116b8d2d0c8', '0x1e376c085141ab53', '0x2748774cdf8eeb99', '0x34b0bcb5e19b48a8',\n    '0x391c0cb3c5c95a63', '0x4ed8aa4ae3418acb', '0x5b9cca4f7763e373', '0x682e6ff3d6b2b8a3',\n    '0x748f82ee5defb2fc', '0x78a5636f43172f60', '0x84c87814a1f0ab72', '0x8cc702081a6439ec',\n    '0x90befffa23631e28', '0xa4506cebde82bde9', '0xbef9a3f7b2c67915', '0xc67178f2e372532b',\n    '0xca273eceea26619c', '0xd186b8c721c0c207', '0xeada7dd6cde0eb1e', '0xf57d4f7fee6ed178',\n    '0x06f067aa72176fba', '0x0a637dc5a2c898a6', '0x113f9804bef90dae', '0x1b710b35131c471b',\n    '0x28db77f523047d84', '0x32caab7b40c72493', '0x3c9ebe0a15c9bebc', '0x431d67c49c100d4c',\n    '0x4cc5d4becb3e42b6', '0x597f299cfc657e2a', '0x5fcb6fab3ad6faec', '0x6c44198c4a475817'\n].map(n => BigInt(n))))();\nconst SHA512_Kh = /* @__PURE__ */ (() => K512[0])();\nconst SHA512_Kl = /* @__PURE__ */ (() => K512[1])();\n// Reusable temporary buffers\nconst SHA512_W_H = /* @__PURE__ */ new Uint32Array(80);\nconst SHA512_W_L = /* @__PURE__ */ new Uint32Array(80);\nexport class SHA512 extends HashMD {\n    constructor(outputLen = 64) {\n        super(128, outputLen, 16, false);\n        // We cannot use array here since array allows indexing by variable\n        // which means optimizer/compiler cannot use registers.\n        // h -- high 32 bits, l -- low 32 bits\n        this.Ah = SHA512_IV[0] | 0;\n        this.Al = SHA512_IV[1] | 0;\n        this.Bh = SHA512_IV[2] | 0;\n        this.Bl = SHA512_IV[3] | 0;\n        this.Ch = SHA512_IV[4] | 0;\n        this.Cl = SHA512_IV[5] | 0;\n        this.Dh = SHA512_IV[6] | 0;\n        this.Dl = SHA512_IV[7] | 0;\n        this.Eh = SHA512_IV[8] | 0;\n        this.El = SHA512_IV[9] | 0;\n        this.Fh = SHA512_IV[10] | 0;\n        this.Fl = SHA512_IV[11] | 0;\n        this.Gh = SHA512_IV[12] | 0;\n        this.Gl = SHA512_IV[13] | 0;\n        this.Hh = SHA512_IV[14] | 0;\n        this.Hl = SHA512_IV[15] | 0;\n    }\n    // prettier-ignore\n    get() {\n        const { Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl } = this;\n        return [Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl];\n    }\n    // prettier-ignore\n    set(Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl) {\n        this.Ah = Ah | 0;\n        this.Al = Al | 0;\n        this.Bh = Bh | 0;\n        this.Bl = Bl | 0;\n        this.Ch = Ch | 0;\n        this.Cl = Cl | 0;\n        this.Dh = Dh | 0;\n        this.Dl = Dl | 0;\n        this.Eh = Eh | 0;\n        this.El = El | 0;\n        this.Fh = Fh | 0;\n        this.Fl = Fl | 0;\n        this.Gh = Gh | 0;\n        this.Gl = Gl | 0;\n        this.Hh = Hh | 0;\n        this.Hl = Hl | 0;\n    }\n    process(view, offset) {\n        // Extend the first 16 words into the remaining 64 words w[16..79] of the message schedule array\n        for (let i = 0; i < 16; i++, offset += 4) {\n            SHA512_W_H[i] = view.getUint32(offset);\n            SHA512_W_L[i] = view.getUint32((offset += 4));\n        }\n        for (let i = 16; i < 80; i++) {\n            // s0 := (w[i-15] rightrotate 1) xor (w[i-15] rightrotate 8) xor (w[i-15] rightshift 7)\n            const W15h = SHA512_W_H[i - 15] | 0;\n            const W15l = SHA512_W_L[i - 15] | 0;\n            const s0h = u64.rotrSH(W15h, W15l, 1) ^ u64.rotrSH(W15h, W15l, 8) ^ u64.shrSH(W15h, W15l, 7);\n            const s0l = u64.rotrSL(W15h, W15l, 1) ^ u64.rotrSL(W15h, W15l, 8) ^ u64.shrSL(W15h, W15l, 7);\n            // s1 := (w[i-2] rightrotate 19) xor (w[i-2] rightrotate 61) xor (w[i-2] rightshift 6)\n            const W2h = SHA512_W_H[i - 2] | 0;\n            const W2l = SHA512_W_L[i - 2] | 0;\n            const s1h = u64.rotrSH(W2h, W2l, 19) ^ u64.rotrBH(W2h, W2l, 61) ^ u64.shrSH(W2h, W2l, 6);\n            const s1l = u64.rotrSL(W2h, W2l, 19) ^ u64.rotrBL(W2h, W2l, 61) ^ u64.shrSL(W2h, W2l, 6);\n            // SHA256_W[i] = s0 + s1 + SHA256_W[i - 7] + SHA256_W[i - 16];\n            const SUMl = u64.add4L(s0l, s1l, SHA512_W_L[i - 7], SHA512_W_L[i - 16]);\n            const SUMh = u64.add4H(SUMl, s0h, s1h, SHA512_W_H[i - 7], SHA512_W_H[i - 16]);\n            SHA512_W_H[i] = SUMh | 0;\n            SHA512_W_L[i] = SUMl | 0;\n        }\n        let { Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl } = this;\n        // Compression function main loop, 80 rounds\n        for (let i = 0; i < 80; i++) {\n            // S1 := (e rightrotate 14) xor (e rightrotate 18) xor (e rightrotate 41)\n            const sigma1h = u64.rotrSH(Eh, El, 14) ^ u64.rotrSH(Eh, El, 18) ^ u64.rotrBH(Eh, El, 41);\n            const sigma1l = u64.rotrSL(Eh, El, 14) ^ u64.rotrSL(Eh, El, 18) ^ u64.rotrBL(Eh, El, 41);\n            //const T1 = (H + sigma1 + Chi(E, F, G) + SHA256_K[i] + SHA256_W[i]) | 0;\n            const CHIh = (Eh & Fh) ^ (~Eh & Gh);\n            const CHIl = (El & Fl) ^ (~El & Gl);\n            // T1 = H + sigma1 + Chi(E, F, G) + SHA512_K[i] + SHA512_W[i]\n            // prettier-ignore\n            const T1ll = u64.add5L(Hl, sigma1l, CHIl, SHA512_Kl[i], SHA512_W_L[i]);\n            const T1h = u64.add5H(T1ll, Hh, sigma1h, CHIh, SHA512_Kh[i], SHA512_W_H[i]);\n            const T1l = T1ll | 0;\n            // S0 := (a rightrotate 28) xor (a rightrotate 34) xor (a rightrotate 39)\n            const sigma0h = u64.rotrSH(Ah, Al, 28) ^ u64.rotrBH(Ah, Al, 34) ^ u64.rotrBH(Ah, Al, 39);\n            const sigma0l = u64.rotrSL(Ah, Al, 28) ^ u64.rotrBL(Ah, Al, 34) ^ u64.rotrBL(Ah, Al, 39);\n            const MAJh = (Ah & Bh) ^ (Ah & Ch) ^ (Bh & Ch);\n            const MAJl = (Al & Bl) ^ (Al & Cl) ^ (Bl & Cl);\n            Hh = Gh | 0;\n            Hl = Gl | 0;\n            Gh = Fh | 0;\n            Gl = Fl | 0;\n            Fh = Eh | 0;\n            Fl = El | 0;\n            ({ h: Eh, l: El } = u64.add(Dh | 0, Dl | 0, T1h | 0, T1l | 0));\n            Dh = Ch | 0;\n            Dl = Cl | 0;\n            Ch = Bh | 0;\n            Cl = Bl | 0;\n            Bh = Ah | 0;\n            Bl = Al | 0;\n            const All = u64.add3L(T1l, sigma0l, MAJl);\n            Ah = u64.add3H(All, T1h, sigma0h, MAJh);\n            Al = All | 0;\n        }\n        // Add the compressed chunk to the current hash value\n        ({ h: Ah, l: Al } = u64.add(this.Ah | 0, this.Al | 0, Ah | 0, Al | 0));\n        ({ h: Bh, l: Bl } = u64.add(this.Bh | 0, this.Bl | 0, Bh | 0, Bl | 0));\n        ({ h: Ch, l: Cl } = u64.add(this.Ch | 0, this.Cl | 0, Ch | 0, Cl | 0));\n        ({ h: Dh, l: Dl } = u64.add(this.Dh | 0, this.Dl | 0, Dh | 0, Dl | 0));\n        ({ h: Eh, l: El } = u64.add(this.Eh | 0, this.El | 0, Eh | 0, El | 0));\n        ({ h: Fh, l: Fl } = u64.add(this.Fh | 0, this.Fl | 0, Fh | 0, Fl | 0));\n        ({ h: Gh, l: Gl } = u64.add(this.Gh | 0, this.Gl | 0, Gh | 0, Gl | 0));\n        ({ h: Hh, l: Hl } = u64.add(this.Hh | 0, this.Hl | 0, Hh | 0, Hl | 0));\n        this.set(Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl);\n    }\n    roundClean() {\n        clean(SHA512_W_H, SHA512_W_L);\n    }\n    destroy() {\n        clean(this.buffer);\n        this.set(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\n    }\n}\nexport class SHA384 extends SHA512 {\n    constructor() {\n        super(48);\n        this.Ah = SHA384_IV[0] | 0;\n        this.Al = SHA384_IV[1] | 0;\n        this.Bh = SHA384_IV[2] | 0;\n        this.Bl = SHA384_IV[3] | 0;\n        this.Ch = SHA384_IV[4] | 0;\n        this.Cl = SHA384_IV[5] | 0;\n        this.Dh = SHA384_IV[6] | 0;\n        this.Dl = SHA384_IV[7] | 0;\n        this.Eh = SHA384_IV[8] | 0;\n        this.El = SHA384_IV[9] | 0;\n        this.Fh = SHA384_IV[10] | 0;\n        this.Fl = SHA384_IV[11] | 0;\n        this.Gh = SHA384_IV[12] | 0;\n        this.Gl = SHA384_IV[13] | 0;\n        this.Hh = SHA384_IV[14] | 0;\n        this.Hl = SHA384_IV[15] | 0;\n    }\n}\n/**\n * Truncated SHA512/256 and SHA512/224.\n * SHA512_IV is XORed with 0xa5a5a5a5a5a5a5a5, then used as \"intermediary\" IV of SHA512/t.\n * Then t hashes string to produce result IV.\n * See `test/misc/sha2-gen-iv.js`.\n */\n/** SHA512/224 IV */\nconst T224_IV = /* @__PURE__ */ Uint32Array.from([\n    0x8c3d37c8, 0x19544da2, 0x73e19966, 0x89dcd4d6, 0x1dfab7ae, 0x32ff9c82, 0x679dd514, 0x582f9fcf,\n    0x0f6d2b69, 0x7bd44da8, 0x77e36f73, 0x04c48942, 0x3f9d85a8, 0x6a1d36c8, 0x1112e6ad, 0x91d692a1,\n]);\n/** SHA512/256 IV */\nconst T256_IV = /* @__PURE__ */ Uint32Array.from([\n    0x22312194, 0xfc2bf72c, 0x9f555fa3, 0xc84c64c2, 0x2393b86b, 0x6f53b151, 0x96387719, 0x5940eabd,\n    0x96283ee2, 0xa88effe3, 0xbe5e1e25, 0x53863992, 0x2b0199fc, 0x2c85b8aa, 0x0eb72ddc, 0x81c52ca2,\n]);\nexport class SHA512_224 extends SHA512 {\n    constructor() {\n        super(28);\n        this.Ah = T224_IV[0] | 0;\n        this.Al = T224_IV[1] | 0;\n        this.Bh = T224_IV[2] | 0;\n        this.Bl = T224_IV[3] | 0;\n        this.Ch = T224_IV[4] | 0;\n        this.Cl = T224_IV[5] | 0;\n        this.Dh = T224_IV[6] | 0;\n        this.Dl = T224_IV[7] | 0;\n        this.Eh = T224_IV[8] | 0;\n        this.El = T224_IV[9] | 0;\n        this.Fh = T224_IV[10] | 0;\n        this.Fl = T224_IV[11] | 0;\n        this.Gh = T224_IV[12] | 0;\n        this.Gl = T224_IV[13] | 0;\n        this.Hh = T224_IV[14] | 0;\n        this.Hl = T224_IV[15] | 0;\n    }\n}\nexport class SHA512_256 extends SHA512 {\n    constructor() {\n        super(32);\n        this.Ah = T256_IV[0] | 0;\n        this.Al = T256_IV[1] | 0;\n        this.Bh = T256_IV[2] | 0;\n        this.Bl = T256_IV[3] | 0;\n        this.Ch = T256_IV[4] | 0;\n        this.Cl = T256_IV[5] | 0;\n        this.Dh = T256_IV[6] | 0;\n        this.Dl = T256_IV[7] | 0;\n        this.Eh = T256_IV[8] | 0;\n        this.El = T256_IV[9] | 0;\n        this.Fh = T256_IV[10] | 0;\n        this.Fl = T256_IV[11] | 0;\n        this.Gh = T256_IV[12] | 0;\n        this.Gl = T256_IV[13] | 0;\n        this.Hh = T256_IV[14] | 0;\n        this.Hl = T256_IV[15] | 0;\n    }\n}\n/**\n * SHA2-256 hash function from RFC 4634.\n *\n * It is the fastest JS hash, even faster than Blake3.\n * To break sha256 using birthday attack, attackers need to try 2^128 hashes.\n * BTC network is doing 2^70 hashes/sec (2^95 hashes/year) as per 2025.\n */\nexport const sha256 = /* @__PURE__ */ createHasher(() => new SHA256());\n/** SHA2-224 hash function from RFC 4634 */\nexport const sha224 = /* @__PURE__ */ createHasher(() => new SHA224());\n/** SHA2-512 hash function from RFC 4634. */\nexport const sha512 = /* @__PURE__ */ createHasher(() => new SHA512());\n/** SHA2-384 hash function from RFC 4634. */\nexport const sha384 = /* @__PURE__ */ createHasher(() => new SHA384());\n/**\n * SHA2-512/256 \"truncated\" hash function, with improved resistance to length extension attacks.\n * See the paper on [truncated SHA512](https://eprint.iacr.org/2010/548.pdf).\n */\nexport const sha512_256 = /* @__PURE__ */ createHasher(() => new SHA512_256());\n/**\n * SHA2-512/224 \"truncated\" hash function, with improved resistance to length extension attacks.\n * See the paper on [truncated SHA512](https://eprint.iacr.org/2010/548.pdf).\n */\nexport const sha512_224 = /* @__PURE__ */ createHasher(() => new SHA512_224());\n//# sourceMappingURL=sha2.js.map","/**\n * HMAC: RFC2104 message authentication code.\n * @module\n */\nimport { abytes, aexists, ahash, clean, Hash, toBytes } from \"./utils.js\";\nexport class HMAC extends Hash {\n    constructor(hash, _key) {\n        super();\n        this.finished = false;\n        this.destroyed = false;\n        ahash(hash);\n        const key = toBytes(_key);\n        this.iHash = hash.create();\n        if (typeof this.iHash.update !== 'function')\n            throw new Error('Expected instance of class which extends utils.Hash');\n        this.blockLen = this.iHash.blockLen;\n        this.outputLen = this.iHash.outputLen;\n        const blockLen = this.blockLen;\n        const pad = new Uint8Array(blockLen);\n        // blockLen can be bigger than outputLen\n        pad.set(key.length > blockLen ? hash.create().update(key).digest() : key);\n        for (let i = 0; i < pad.length; i++)\n            pad[i] ^= 0x36;\n        this.iHash.update(pad);\n        // By doing update (processing of first block) of outer hash here we can re-use it between multiple calls via clone\n        this.oHash = hash.create();\n        // Undo internal XOR && apply outer XOR\n        for (let i = 0; i < pad.length; i++)\n            pad[i] ^= 0x36 ^ 0x5c;\n        this.oHash.update(pad);\n        clean(pad);\n    }\n    update(buf) {\n        aexists(this);\n        this.iHash.update(buf);\n        return this;\n    }\n    digestInto(out) {\n        aexists(this);\n        abytes(out, this.outputLen);\n        this.finished = true;\n        this.iHash.digestInto(out);\n        this.oHash.update(out);\n        this.oHash.digestInto(out);\n        this.destroy();\n    }\n    digest() {\n        const out = new Uint8Array(this.oHash.outputLen);\n        this.digestInto(out);\n        return out;\n    }\n    _cloneInto(to) {\n        // Create new instance without calling constructor since key already in state and we don't know it.\n        to || (to = Object.create(Object.getPrototypeOf(this), {}));\n        const { oHash, iHash, finished, destroyed, blockLen, outputLen } = this;\n        to = to;\n        to.finished = finished;\n        to.destroyed = destroyed;\n        to.blockLen = blockLen;\n        to.outputLen = outputLen;\n        to.oHash = oHash._cloneInto(to.oHash);\n        to.iHash = iHash._cloneInto(to.iHash);\n        return to;\n    }\n    clone() {\n        return this._cloneInto();\n    }\n    destroy() {\n        this.destroyed = true;\n        this.oHash.destroy();\n        this.iHash.destroy();\n    }\n}\n/**\n * HMAC: RFC2104 message authentication code.\n * @param hash - function that would be used e.g. sha256\n * @param key - message key\n * @param message - message data\n * @example\n * import { hmac } from '@noble/hashes/hmac';\n * import { sha256 } from '@noble/hashes/sha2';\n * const mac1 = hmac(sha256, 'key', 'message');\n */\nexport const hmac = (hash, key, message) => new HMAC(hash, key).update(message).digest();\nhmac.create = (hash, key) => new HMAC(hash, key);\n//# sourceMappingURL=hmac.js.map","/**\n * Hex, bytes and number utilities.\n * @module\n */\n/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */\nimport { abytes as abytes_, bytesToHex as bytesToHex_, concatBytes as concatBytes_, hexToBytes as hexToBytes_, isBytes as isBytes_, } from '@noble/hashes/utils.js';\nexport { abytes, anumber, bytesToHex, bytesToUtf8, concatBytes, hexToBytes, isBytes, randomBytes, utf8ToBytes, } from '@noble/hashes/utils.js';\nconst _0n = /* @__PURE__ */ BigInt(0);\nconst _1n = /* @__PURE__ */ BigInt(1);\nexport function abool(title, value) {\n    if (typeof value !== 'boolean')\n        throw new Error(title + ' boolean expected, got ' + value);\n}\n// tmp name until v2\nexport function _abool2(value, title = '') {\n    if (typeof value !== 'boolean') {\n        const prefix = title && `\"${title}\"`;\n        throw new Error(prefix + 'expected boolean, got type=' + typeof value);\n    }\n    return value;\n}\n// tmp name until v2\n/** Asserts something is Uint8Array. */\nexport function _abytes2(value, length, title = '') {\n    const bytes = isBytes_(value);\n    const len = value?.length;\n    const needsLen = length !== undefined;\n    if (!bytes || (needsLen && len !== length)) {\n        const prefix = title && `\"${title}\" `;\n        const ofLen = needsLen ? ` of length ${length}` : '';\n        const got = bytes ? `length=${len}` : `type=${typeof value}`;\n        throw new Error(prefix + 'expected Uint8Array' + ofLen + ', got ' + got);\n    }\n    return value;\n}\n// Used in weierstrass, der\nexport function numberToHexUnpadded(num) {\n    const hex = num.toString(16);\n    return hex.length & 1 ? '0' + hex : hex;\n}\nexport function hexToNumber(hex) {\n    if (typeof hex !== 'string')\n        throw new Error('hex string expected, got ' + typeof hex);\n    return hex === '' ? _0n : BigInt('0x' + hex); // Big Endian\n}\n// BE: Big Endian, LE: Little Endian\nexport function bytesToNumberBE(bytes) {\n    return hexToNumber(bytesToHex_(bytes));\n}\nexport function bytesToNumberLE(bytes) {\n    abytes_(bytes);\n    return hexToNumber(bytesToHex_(Uint8Array.from(bytes).reverse()));\n}\nexport function numberToBytesBE(n, len) {\n    return hexToBytes_(n.toString(16).padStart(len * 2, '0'));\n}\nexport function numberToBytesLE(n, len) {\n    return numberToBytesBE(n, len).reverse();\n}\n// Unpadded, rarely used\nexport function numberToVarBytesBE(n) {\n    return hexToBytes_(numberToHexUnpadded(n));\n}\n/**\n * Takes hex string or Uint8Array, converts to Uint8Array.\n * Validates output length.\n * Will throw error for other types.\n * @param title descriptive title for an error e.g. 'secret key'\n * @param hex hex string or Uint8Array\n * @param expectedLength optional, will compare to result array's length\n * @returns\n */\nexport function ensureBytes(title, hex, expectedLength) {\n    let res;\n    if (typeof hex === 'string') {\n        try {\n            res = hexToBytes_(hex);\n        }\n        catch (e) {\n            throw new Error(title + ' must be hex string or Uint8Array, cause: ' + e);\n        }\n    }\n    else if (isBytes_(hex)) {\n        // Uint8Array.from() instead of hash.slice() because node.js Buffer\n        // is instance of Uint8Array, and its slice() creates **mutable** copy\n        res = Uint8Array.from(hex);\n    }\n    else {\n        throw new Error(title + ' must be hex string or Uint8Array');\n    }\n    const len = res.length;\n    if (typeof expectedLength === 'number' && len !== expectedLength)\n        throw new Error(title + ' of length ' + expectedLength + ' expected, got ' + len);\n    return res;\n}\n// Compares 2 u8a-s in kinda constant time\nexport function equalBytes(a, b) {\n    if (a.length !== b.length)\n        return false;\n    let diff = 0;\n    for (let i = 0; i < a.length; i++)\n        diff |= a[i] ^ b[i];\n    return diff === 0;\n}\n/**\n * Copies Uint8Array. We can't use u8a.slice(), because u8a can be Buffer,\n * and Buffer#slice creates mutable copy. Never use Buffers!\n */\nexport function copyBytes(bytes) {\n    return Uint8Array.from(bytes);\n}\n/**\n * Decodes 7-bit ASCII string to Uint8Array, throws on non-ascii symbols\n * Should be safe to use for things expected to be ASCII.\n * Returns exact same result as utf8ToBytes for ASCII or throws.\n */\nexport function asciiToBytes(ascii) {\n    return Uint8Array.from(ascii, (c, i) => {\n        const charCode = c.charCodeAt(0);\n        if (c.length !== 1 || charCode > 127) {\n            throw new Error(`string contains non-ASCII character \"${ascii[i]}\" with code ${charCode} at position ${i}`);\n        }\n        return charCode;\n    });\n}\n/**\n * @example utf8ToBytes('abc') // new Uint8Array([97, 98, 99])\n */\n// export const utf8ToBytes: typeof utf8ToBytes_ = utf8ToBytes_;\n/**\n * Converts bytes to string using UTF8 encoding.\n * @example bytesToUtf8(Uint8Array.from([97, 98, 99])) // 'abc'\n */\n// export const bytesToUtf8: typeof bytesToUtf8_ = bytesToUtf8_;\n// Is positive bigint\nconst isPosBig = (n) => typeof n === 'bigint' && _0n <= n;\nexport function inRange(n, min, max) {\n    return isPosBig(n) && isPosBig(min) && isPosBig(max) && min <= n && n < max;\n}\n/**\n * Asserts min <= n < max. NOTE: It's < max and not <= max.\n * @example\n * aInRange('x', x, 1n, 256n); // would assume x is in (1n..255n)\n */\nexport function aInRange(title, n, min, max) {\n    // Why min <= n < max and not a (min < n < max) OR b (min <= n <= max)?\n    // consider P=256n, min=0n, max=P\n    // - a for min=0 would require -1:          `inRange('x', x, -1n, P)`\n    // - b would commonly require subtraction:  `inRange('x', x, 0n, P - 1n)`\n    // - our way is the cleanest:               `inRange('x', x, 0n, P)\n    if (!inRange(n, min, max))\n        throw new Error('expected valid ' + title + ': ' + min + ' <= n < ' + max + ', got ' + n);\n}\n// Bit operations\n/**\n * Calculates amount of bits in a bigint.\n * Same as `n.toString(2).length`\n * TODO: merge with nLength in modular\n */\nexport function bitLen(n) {\n    let len;\n    for (len = 0; n > _0n; n >>= _1n, len += 1)\n        ;\n    return len;\n}\n/**\n * Gets single bit at position.\n * NOTE: first bit position is 0 (same as arrays)\n * Same as `!!+Array.from(n.toString(2)).reverse()[pos]`\n */\nexport function bitGet(n, pos) {\n    return (n >> BigInt(pos)) & _1n;\n}\n/**\n * Sets single bit at position.\n */\nexport function bitSet(n, pos, value) {\n    return n | ((value ? _1n : _0n) << BigInt(pos));\n}\n/**\n * Calculate mask for N bits. Not using ** operator with bigints because of old engines.\n * Same as BigInt(`0b${Array(i).fill('1').join('')}`)\n */\nexport const bitMask = (n) => (_1n << BigInt(n)) - _1n;\n/**\n * Minimal HMAC-DRBG from NIST 800-90 for RFC6979 sigs.\n * @returns function that will call DRBG until 2nd arg returns something meaningful\n * @example\n *   const drbg = createHmacDRBG<Key>(32, 32, hmac);\n *   drbg(seed, bytesToKey); // bytesToKey must return Key or undefined\n */\nexport function createHmacDrbg(hashLen, qByteLen, hmacFn) {\n    if (typeof hashLen !== 'number' || hashLen < 2)\n        throw new Error('hashLen must be a number');\n    if (typeof qByteLen !== 'number' || qByteLen < 2)\n        throw new Error('qByteLen must be a number');\n    if (typeof hmacFn !== 'function')\n        throw new Error('hmacFn must be a function');\n    // Step B, Step C: set hashLen to 8*ceil(hlen/8)\n    const u8n = (len) => new Uint8Array(len); // creates Uint8Array\n    const u8of = (byte) => Uint8Array.of(byte); // another shortcut\n    let v = u8n(hashLen); // Minimal non-full-spec HMAC-DRBG from NIST 800-90 for RFC6979 sigs.\n    let k = u8n(hashLen); // Steps B and C of RFC6979 3.2: set hashLen, in our case always same\n    let i = 0; // Iterations counter, will throw when over 1000\n    const reset = () => {\n        v.fill(1);\n        k.fill(0);\n        i = 0;\n    };\n    const h = (...b) => hmacFn(k, v, ...b); // hmac(k)(v, ...values)\n    const reseed = (seed = u8n(0)) => {\n        // HMAC-DRBG reseed() function. Steps D-G\n        k = h(u8of(0x00), seed); // k = hmac(k || v || 0x00 || seed)\n        v = h(); // v = hmac(k || v)\n        if (seed.length === 0)\n            return;\n        k = h(u8of(0x01), seed); // k = hmac(k || v || 0x01 || seed)\n        v = h(); // v = hmac(k || v)\n    };\n    const gen = () => {\n        // HMAC-DRBG generate() function\n        if (i++ >= 1000)\n            throw new Error('drbg: tried 1000 values');\n        let len = 0;\n        const out = [];\n        while (len < qByteLen) {\n            v = h();\n            const sl = v.slice();\n            out.push(sl);\n            len += v.length;\n        }\n        return concatBytes_(...out);\n    };\n    const genUntil = (seed, pred) => {\n        reset();\n        reseed(seed); // Steps D-G\n        let res = undefined; // Step H: grind until k is in [1..n-1]\n        while (!(res = pred(gen())))\n            reseed();\n        reset();\n        return res;\n    };\n    return genUntil;\n}\n// Validating curves and fields\nconst validatorFns = {\n    bigint: (val) => typeof val === 'bigint',\n    function: (val) => typeof val === 'function',\n    boolean: (val) => typeof val === 'boolean',\n    string: (val) => typeof val === 'string',\n    stringOrUint8Array: (val) => typeof val === 'string' || isBytes_(val),\n    isSafeInteger: (val) => Number.isSafeInteger(val),\n    array: (val) => Array.isArray(val),\n    field: (val, object) => object.Fp.isValid(val),\n    hash: (val) => typeof val === 'function' && Number.isSafeInteger(val.outputLen),\n};\n// type Record<K extends string | number | symbol, T> = { [P in K]: T; }\nexport function validateObject(object, validators, optValidators = {}) {\n    const checkField = (fieldName, type, isOptional) => {\n        const checkVal = validatorFns[type];\n        if (typeof checkVal !== 'function')\n            throw new Error('invalid validator function');\n        const val = object[fieldName];\n        if (isOptional && val === undefined)\n            return;\n        if (!checkVal(val, object)) {\n            throw new Error('param ' + String(fieldName) + ' is invalid. Expected ' + type + ', got ' + val);\n        }\n    };\n    for (const [fieldName, type] of Object.entries(validators))\n        checkField(fieldName, type, false);\n    for (const [fieldName, type] of Object.entries(optValidators))\n        checkField(fieldName, type, true);\n    return object;\n}\n// validate type tests\n// const o: { a: number; b: number; c: number } = { a: 1, b: 5, c: 6 };\n// const z0 = validateObject(o, { a: 'isSafeInteger' }, { c: 'bigint' }); // Ok!\n// // Should fail type-check\n// const z1 = validateObject(o, { a: 'tmp' }, { c: 'zz' });\n// const z2 = validateObject(o, { a: 'isSafeInteger' }, { c: 'zz' });\n// const z3 = validateObject(o, { test: 'boolean', z: 'bug' });\n// const z4 = validateObject(o, { a: 'boolean', z: 'bug' });\nexport function isHash(val) {\n    return typeof val === 'function' && Number.isSafeInteger(val.outputLen);\n}\nexport function _validateObject(object, fields, optFields = {}) {\n    if (!object || typeof object !== 'object')\n        throw new Error('expected valid options object');\n    function checkField(fieldName, expectedType, isOpt) {\n        const val = object[fieldName];\n        if (isOpt && val === undefined)\n            return;\n        const current = typeof val;\n        if (current !== expectedType || val === null)\n            throw new Error(`param \"${fieldName}\" is invalid: expected ${expectedType}, got ${current}`);\n    }\n    Object.entries(fields).forEach(([k, v]) => checkField(k, v, false));\n    Object.entries(optFields).forEach(([k, v]) => checkField(k, v, true));\n}\n/**\n * throws not implemented error\n */\nexport const notImplemented = () => {\n    throw new Error('not implemented');\n};\n/**\n * Memoizes (caches) computation result.\n * Uses WeakMap: the value is going auto-cleaned by GC after last reference is removed.\n */\nexport function memoized(fn) {\n    const map = new WeakMap();\n    return (arg, ...args) => {\n        const val = map.get(arg);\n        if (val !== undefined)\n            return val;\n        const computed = fn(arg, ...args);\n        map.set(arg, computed);\n        return computed;\n    };\n}\n//# sourceMappingURL=utils.js.map","/**\n * Utils for modular division and fields.\n * Field over 11 is a finite (Galois) field is integer number operations `mod 11`.\n * There is no division: it is replaced by modular multiplicative inverse.\n * @module\n */\n/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */\nimport { _validateObject, anumber, bitMask, bytesToNumberBE, bytesToNumberLE, ensureBytes, numberToBytesBE, numberToBytesLE, } from \"../utils.js\";\n// prettier-ignore\nconst _0n = BigInt(0), _1n = BigInt(1), _2n = /* @__PURE__ */ BigInt(2), _3n = /* @__PURE__ */ BigInt(3);\n// prettier-ignore\nconst _4n = /* @__PURE__ */ BigInt(4), _5n = /* @__PURE__ */ BigInt(5), _7n = /* @__PURE__ */ BigInt(7);\n// prettier-ignore\nconst _8n = /* @__PURE__ */ BigInt(8), _9n = /* @__PURE__ */ BigInt(9), _16n = /* @__PURE__ */ BigInt(16);\n// Calculates a modulo b\nexport function mod(a, b) {\n    const result = a % b;\n    return result >= _0n ? result : b + result;\n}\n/**\n * Efficiently raise num to power and do modular division.\n * Unsafe in some contexts: uses ladder, so can expose bigint bits.\n * @example\n * pow(2n, 6n, 11n) // 64n % 11n == 9n\n */\nexport function pow(num, power, modulo) {\n    return FpPow(Field(modulo), num, power);\n}\n/** Does `x^(2^power)` mod p. `pow2(30, 4)` == `30^(2^4)` */\nexport function pow2(x, power, modulo) {\n    let res = x;\n    while (power-- > _0n) {\n        res *= res;\n        res %= modulo;\n    }\n    return res;\n}\n/**\n * Inverses number over modulo.\n * Implemented using [Euclidean GCD](https://brilliant.org/wiki/extended-euclidean-algorithm/).\n */\nexport function invert(number, modulo) {\n    if (number === _0n)\n        throw new Error('invert: expected non-zero number');\n    if (modulo <= _0n)\n        throw new Error('invert: expected positive modulus, got ' + modulo);\n    // Fermat's little theorem \"CT-like\" version inv(n) = n^(m-2) mod m is 30x slower.\n    let a = mod(number, modulo);\n    let b = modulo;\n    // prettier-ignore\n    let x = _0n, y = _1n, u = _1n, v = _0n;\n    while (a !== _0n) {\n        // JIT applies optimization if those two lines follow each other\n        const q = b / a;\n        const r = b % a;\n        const m = x - u * q;\n        const n = y - v * q;\n        // prettier-ignore\n        b = a, a = r, x = u, y = v, u = m, v = n;\n    }\n    const gcd = b;\n    if (gcd !== _1n)\n        throw new Error('invert: does not exist');\n    return mod(x, modulo);\n}\nfunction assertIsSquare(Fp, root, n) {\n    if (!Fp.eql(Fp.sqr(root), n))\n        throw new Error('Cannot find square root');\n}\n// Not all roots are possible! Example which will throw:\n// const NUM =\n// n = 72057594037927816n;\n// Fp = Field(BigInt('0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab'));\nfunction sqrt3mod4(Fp, n) {\n    const p1div4 = (Fp.ORDER + _1n) / _4n;\n    const root = Fp.pow(n, p1div4);\n    assertIsSquare(Fp, root, n);\n    return root;\n}\nfunction sqrt5mod8(Fp, n) {\n    const p5div8 = (Fp.ORDER - _5n) / _8n;\n    const n2 = Fp.mul(n, _2n);\n    const v = Fp.pow(n2, p5div8);\n    const nv = Fp.mul(n, v);\n    const i = Fp.mul(Fp.mul(nv, _2n), v);\n    const root = Fp.mul(nv, Fp.sub(i, Fp.ONE));\n    assertIsSquare(Fp, root, n);\n    return root;\n}\n// Based on RFC9380, Kong algorithm\n// prettier-ignore\nfunction sqrt9mod16(P) {\n    const Fp_ = Field(P);\n    const tn = tonelliShanks(P);\n    const c1 = tn(Fp_, Fp_.neg(Fp_.ONE)); //  1. c1 = sqrt(-1) in F, i.e., (c1^2) == -1 in F\n    const c2 = tn(Fp_, c1); //  2. c2 = sqrt(c1) in F, i.e., (c2^2) == c1 in F\n    const c3 = tn(Fp_, Fp_.neg(c1)); //  3. c3 = sqrt(-c1) in F, i.e., (c3^2) == -c1 in F\n    const c4 = (P + _7n) / _16n; //  4. c4 = (q + 7) / 16        # Integer arithmetic\n    return (Fp, n) => {\n        let tv1 = Fp.pow(n, c4); //  1. tv1 = x^c4\n        let tv2 = Fp.mul(tv1, c1); //  2. tv2 = c1 * tv1\n        const tv3 = Fp.mul(tv1, c2); //  3. tv3 = c2 * tv1\n        const tv4 = Fp.mul(tv1, c3); //  4. tv4 = c3 * tv1\n        const e1 = Fp.eql(Fp.sqr(tv2), n); //  5.  e1 = (tv2^2) == x\n        const e2 = Fp.eql(Fp.sqr(tv3), n); //  6.  e2 = (tv3^2) == x\n        tv1 = Fp.cmov(tv1, tv2, e1); //  7. tv1 = CMOV(tv1, tv2, e1)  # Select tv2 if (tv2^2) == x\n        tv2 = Fp.cmov(tv4, tv3, e2); //  8. tv2 = CMOV(tv4, tv3, e2)  # Select tv3 if (tv3^2) == x\n        const e3 = Fp.eql(Fp.sqr(tv2), n); //  9.  e3 = (tv2^2) == x\n        const root = Fp.cmov(tv1, tv2, e3); // 10.  z = CMOV(tv1, tv2, e3)   # Select sqrt from tv1 & tv2\n        assertIsSquare(Fp, root, n);\n        return root;\n    };\n}\n/**\n * Tonelli-Shanks square root search algorithm.\n * 1. https://eprint.iacr.org/2012/685.pdf (page 12)\n * 2. Square Roots from 1; 24, 51, 10 to Dan Shanks\n * @param P field order\n * @returns function that takes field Fp (created from P) and number n\n */\nexport function tonelliShanks(P) {\n    // Initialization (precomputation).\n    // Caching initialization could boost perf by 7%.\n    if (P < _3n)\n        throw new Error('sqrt is not defined for small field');\n    // Factor P - 1 = Q * 2^S, where Q is odd\n    let Q = P - _1n;\n    let S = 0;\n    while (Q % _2n === _0n) {\n        Q /= _2n;\n        S++;\n    }\n    // Find the first quadratic non-residue Z >= 2\n    let Z = _2n;\n    const _Fp = Field(P);\n    while (FpLegendre(_Fp, Z) === 1) {\n        // Basic primality test for P. After x iterations, chance of\n        // not finding quadratic non-residue is 2^x, so 2^1000.\n        if (Z++ > 1000)\n            throw new Error('Cannot find square root: probably non-prime P');\n    }\n    // Fast-path; usually done before Z, but we do \"primality test\".\n    if (S === 1)\n        return sqrt3mod4;\n    // Slow-path\n    // TODO: test on Fp2 and others\n    let cc = _Fp.pow(Z, Q); // c = z^Q\n    const Q1div2 = (Q + _1n) / _2n;\n    return function tonelliSlow(Fp, n) {\n        if (Fp.is0(n))\n            return n;\n        // Check if n is a quadratic residue using Legendre symbol\n        if (FpLegendre(Fp, n) !== 1)\n            throw new Error('Cannot find square root');\n        // Initialize variables for the main loop\n        let M = S;\n        let c = Fp.mul(Fp.ONE, cc); // c = z^Q, move cc from field _Fp into field Fp\n        let t = Fp.pow(n, Q); // t = n^Q, first guess at the fudge factor\n        let R = Fp.pow(n, Q1div2); // R = n^((Q+1)/2), first guess at the square root\n        // Main loop\n        // while t != 1\n        while (!Fp.eql(t, Fp.ONE)) {\n            if (Fp.is0(t))\n                return Fp.ZERO; // if t=0 return R=0\n            let i = 1;\n            // Find the smallest i >= 1 such that t^(2^i)  1 (mod P)\n            let t_tmp = Fp.sqr(t); // t^(2^1)\n            while (!Fp.eql(t_tmp, Fp.ONE)) {\n                i++;\n                t_tmp = Fp.sqr(t_tmp); // t^(2^2)...\n                if (i === M)\n                    throw new Error('Cannot find square root');\n            }\n            // Calculate the exponent for b: 2^(M - i - 1)\n            const exponent = _1n << BigInt(M - i - 1); // bigint is important\n            const b = Fp.pow(c, exponent); // b = 2^(M - i - 1)\n            // Update variables\n            M = i;\n            c = Fp.sqr(b); // c = b^2\n            t = Fp.mul(t, c); // t = (t * b^2)\n            R = Fp.mul(R, b); // R = R*b\n        }\n        return R;\n    };\n}\n/**\n * Square root for a finite field. Will try optimized versions first:\n *\n * 1. P  3 (mod 4)\n * 2. P  5 (mod 8)\n * 3. P  9 (mod 16)\n * 4. Tonelli-Shanks algorithm\n *\n * Different algorithms can give different roots, it is up to user to decide which one they want.\n * For example there is FpSqrtOdd/FpSqrtEven to choice root based on oddness (used for hash-to-curve).\n */\nexport function FpSqrt(P) {\n    // P  3 (mod 4) => n = n^((P+1)/4)\n    if (P % _4n === _3n)\n        return sqrt3mod4;\n    // P  5 (mod 8) => Atkin algorithm, page 10 of https://eprint.iacr.org/2012/685.pdf\n    if (P % _8n === _5n)\n        return sqrt5mod8;\n    // P  9 (mod 16) => Kong algorithm, page 11 of https://eprint.iacr.org/2012/685.pdf (algorithm 4)\n    if (P % _16n === _9n)\n        return sqrt9mod16(P);\n    // Tonelli-Shanks algorithm\n    return tonelliShanks(P);\n}\n// Little-endian check for first LE bit (last BE bit);\nexport const isNegativeLE = (num, modulo) => (mod(num, modulo) & _1n) === _1n;\n// prettier-ignore\nconst FIELD_FIELDS = [\n    'create', 'isValid', 'is0', 'neg', 'inv', 'sqrt', 'sqr',\n    'eql', 'add', 'sub', 'mul', 'pow', 'div',\n    'addN', 'subN', 'mulN', 'sqrN'\n];\nexport function validateField(field) {\n    const initial = {\n        ORDER: 'bigint',\n        MASK: 'bigint',\n        BYTES: 'number',\n        BITS: 'number',\n    };\n    const opts = FIELD_FIELDS.reduce((map, val) => {\n        map[val] = 'function';\n        return map;\n    }, initial);\n    _validateObject(field, opts);\n    // const max = 16384;\n    // if (field.BYTES < 1 || field.BYTES > max) throw new Error('invalid field');\n    // if (field.BITS < 1 || field.BITS > 8 * max) throw new Error('invalid field');\n    return field;\n}\n// Generic field functions\n/**\n * Same as `pow` but for Fp: non-constant-time.\n * Unsafe in some contexts: uses ladder, so can expose bigint bits.\n */\nexport function FpPow(Fp, num, power) {\n    if (power < _0n)\n        throw new Error('invalid exponent, negatives unsupported');\n    if (power === _0n)\n        return Fp.ONE;\n    if (power === _1n)\n        return num;\n    let p = Fp.ONE;\n    let d = num;\n    while (power > _0n) {\n        if (power & _1n)\n            p = Fp.mul(p, d);\n        d = Fp.sqr(d);\n        power >>= _1n;\n    }\n    return p;\n}\n/**\n * Efficiently invert an array of Field elements.\n * Exception-free. Will return `undefined` for 0 elements.\n * @param passZero map 0 to 0 (instead of undefined)\n */\nexport function FpInvertBatch(Fp, nums, passZero = false) {\n    const inverted = new Array(nums.length).fill(passZero ? Fp.ZERO : undefined);\n    // Walk from first to last, multiply them by each other MOD p\n    const multipliedAcc = nums.reduce((acc, num, i) => {\n        if (Fp.is0(num))\n            return acc;\n        inverted[i] = acc;\n        return Fp.mul(acc, num);\n    }, Fp.ONE);\n    // Invert last element\n    const invertedAcc = Fp.inv(multipliedAcc);\n    // Walk from last to first, multiply them by inverted each other MOD p\n    nums.reduceRight((acc, num, i) => {\n        if (Fp.is0(num))\n            return acc;\n        inverted[i] = Fp.mul(acc, inverted[i]);\n        return Fp.mul(acc, num);\n    }, invertedAcc);\n    return inverted;\n}\n// TODO: remove\nexport function FpDiv(Fp, lhs, rhs) {\n    return Fp.mul(lhs, typeof rhs === 'bigint' ? invert(rhs, Fp.ORDER) : Fp.inv(rhs));\n}\n/**\n * Legendre symbol.\n * Legendre constant is used to calculate Legendre symbol (a | p)\n * which denotes the value of a^((p-1)/2) (mod p).\n *\n * * (a | p)  1    if a is a square (mod p), quadratic residue\n * * (a | p)  -1   if a is not a square (mod p), quadratic non residue\n * * (a | p)  0    if a  0 (mod p)\n */\nexport function FpLegendre(Fp, n) {\n    // We can use 3rd argument as optional cache of this value\n    // but seems unneeded for now. The operation is very fast.\n    const p1mod2 = (Fp.ORDER - _1n) / _2n;\n    const powered = Fp.pow(n, p1mod2);\n    const yes = Fp.eql(powered, Fp.ONE);\n    const zero = Fp.eql(powered, Fp.ZERO);\n    const no = Fp.eql(powered, Fp.neg(Fp.ONE));\n    if (!yes && !zero && !no)\n        throw new Error('invalid Legendre symbol result');\n    return yes ? 1 : zero ? 0 : -1;\n}\n// This function returns True whenever the value x is a square in the field F.\nexport function FpIsSquare(Fp, n) {\n    const l = FpLegendre(Fp, n);\n    return l === 1;\n}\n// CURVE.n lengths\nexport function nLength(n, nBitLength) {\n    // Bit size, byte size of CURVE.n\n    if (nBitLength !== undefined)\n        anumber(nBitLength);\n    const _nBitLength = nBitLength !== undefined ? nBitLength : n.toString(2).length;\n    const nByteLength = Math.ceil(_nBitLength / 8);\n    return { nBitLength: _nBitLength, nByteLength };\n}\n/**\n * Creates a finite field. Major performance optimizations:\n * * 1. Denormalized operations like mulN instead of mul.\n * * 2. Identical object shape: never add or remove keys.\n * * 3. `Object.freeze`.\n * Fragile: always run a benchmark on a change.\n * Security note: operations don't check 'isValid' for all elements for performance reasons,\n * it is caller responsibility to check this.\n * This is low-level code, please make sure you know what you're doing.\n *\n * Note about field properties:\n * * CHARACTERISTIC p = prime number, number of elements in main subgroup.\n * * ORDER q = similar to cofactor in curves, may be composite `q = p^m`.\n *\n * @param ORDER field order, probably prime, or could be composite\n * @param bitLen how many bits the field consumes\n * @param isLE (default: false) if encoding / decoding should be in little-endian\n * @param redef optional faster redefinitions of sqrt and other methods\n */\nexport function Field(ORDER, bitLenOrOpts, // TODO: use opts only in v2?\nisLE = false, opts = {}) {\n    if (ORDER <= _0n)\n        throw new Error('invalid field: expected ORDER > 0, got ' + ORDER);\n    let _nbitLength = undefined;\n    let _sqrt = undefined;\n    let modFromBytes = false;\n    let allowedLengths = undefined;\n    if (typeof bitLenOrOpts === 'object' && bitLenOrOpts != null) {\n        if (opts.sqrt || isLE)\n            throw new Error('cannot specify opts in two arguments');\n        const _opts = bitLenOrOpts;\n        if (_opts.BITS)\n            _nbitLength = _opts.BITS;\n        if (_opts.sqrt)\n            _sqrt = _opts.sqrt;\n        if (typeof _opts.isLE === 'boolean')\n            isLE = _opts.isLE;\n        if (typeof _opts.modFromBytes === 'boolean')\n            modFromBytes = _opts.modFromBytes;\n        allowedLengths = _opts.allowedLengths;\n    }\n    else {\n        if (typeof bitLenOrOpts === 'number')\n            _nbitLength = bitLenOrOpts;\n        if (opts.sqrt)\n            _sqrt = opts.sqrt;\n    }\n    const { nBitLength: BITS, nByteLength: BYTES } = nLength(ORDER, _nbitLength);\n    if (BYTES > 2048)\n        throw new Error('invalid field: expected ORDER of <= 2048 bytes');\n    let sqrtP; // cached sqrtP\n    const f = Object.freeze({\n        ORDER,\n        isLE,\n        BITS,\n        BYTES,\n        MASK: bitMask(BITS),\n        ZERO: _0n,\n        ONE: _1n,\n        allowedLengths: allowedLengths,\n        create: (num) => mod(num, ORDER),\n        isValid: (num) => {\n            if (typeof num !== 'bigint')\n                throw new Error('invalid field element: expected bigint, got ' + typeof num);\n            return _0n <= num && num < ORDER; // 0 is valid element, but it's not invertible\n        },\n        is0: (num) => num === _0n,\n        // is valid and invertible\n        isValidNot0: (num) => !f.is0(num) && f.isValid(num),\n        isOdd: (num) => (num & _1n) === _1n,\n        neg: (num) => mod(-num, ORDER),\n        eql: (lhs, rhs) => lhs === rhs,\n        sqr: (num) => mod(num * num, ORDER),\n        add: (lhs, rhs) => mod(lhs + rhs, ORDER),\n        sub: (lhs, rhs) => mod(lhs - rhs, ORDER),\n        mul: (lhs, rhs) => mod(lhs * rhs, ORDER),\n        pow: (num, power) => FpPow(f, num, power),\n        div: (lhs, rhs) => mod(lhs * invert(rhs, ORDER), ORDER),\n        // Same as above, but doesn't normalize\n        sqrN: (num) => num * num,\n        addN: (lhs, rhs) => lhs + rhs,\n        subN: (lhs, rhs) => lhs - rhs,\n        mulN: (lhs, rhs) => lhs * rhs,\n        inv: (num) => invert(num, ORDER),\n        sqrt: _sqrt ||\n            ((n) => {\n                if (!sqrtP)\n                    sqrtP = FpSqrt(ORDER);\n                return sqrtP(f, n);\n            }),\n        toBytes: (num) => (isLE ? numberToBytesLE(num, BYTES) : numberToBytesBE(num, BYTES)),\n        fromBytes: (bytes, skipValidation = true) => {\n            if (allowedLengths) {\n                if (!allowedLengths.includes(bytes.length) || bytes.length > BYTES) {\n                    throw new Error('Field.fromBytes: expected ' + allowedLengths + ' bytes, got ' + bytes.length);\n                }\n                const padded = new Uint8Array(BYTES);\n                // isLE add 0 to right, !isLE to the left.\n                padded.set(bytes, isLE ? 0 : padded.length - bytes.length);\n                bytes = padded;\n            }\n            if (bytes.length !== BYTES)\n                throw new Error('Field.fromBytes: expected ' + BYTES + ' bytes, got ' + bytes.length);\n            let scalar = isLE ? bytesToNumberLE(bytes) : bytesToNumberBE(bytes);\n            if (modFromBytes)\n                scalar = mod(scalar, ORDER);\n            if (!skipValidation)\n                if (!f.isValid(scalar))\n                    throw new Error('invalid field element: outside of range 0..ORDER');\n            // NOTE: we don't validate scalar here, please use isValid. This done such way because some\n            // protocol may allow non-reduced scalar that reduced later or changed some other way.\n            return scalar;\n        },\n        // TODO: we don't need it here, move out to separate fn\n        invertBatch: (lst) => FpInvertBatch(f, lst),\n        // We can't move this out because Fp6, Fp12 implement it\n        // and it's unclear what to return in there.\n        cmov: (a, b, c) => (c ? b : a),\n    });\n    return Object.freeze(f);\n}\n// Generic random scalar, we can do same for other fields if via Fp2.mul(Fp2.ONE, Fp2.random)?\n// This allows unsafe methods like ignore bias or zero. These unsafe, but often used in different protocols (if deterministic RNG).\n// which mean we cannot force this via opts.\n// Not sure what to do with randomBytes, we can accept it inside opts if wanted.\n// Probably need to export getMinHashLength somewhere?\n// random(bytes?: Uint8Array, unsafeAllowZero = false, unsafeAllowBias = false) {\n//   const LEN = !unsafeAllowBias ? getMinHashLength(ORDER) : BYTES;\n//   if (bytes === undefined) bytes = randomBytes(LEN); // _opts.randomBytes?\n//   const num = isLE ? bytesToNumberLE(bytes) : bytesToNumberBE(bytes);\n//   // `mod(x, 11)` can sometimes produce 0. `mod(x, 10) + 1` is the same, but no 0\n//   const reduced = unsafeAllowZero ? mod(num, ORDER) : mod(num, ORDER - _1n) + _1n;\n//   return reduced;\n// },\nexport function FpSqrtOdd(Fp, elm) {\n    if (!Fp.isOdd)\n        throw new Error(\"Field doesn't have isOdd\");\n    const root = Fp.sqrt(elm);\n    return Fp.isOdd(root) ? root : Fp.neg(root);\n}\nexport function FpSqrtEven(Fp, elm) {\n    if (!Fp.isOdd)\n        throw new Error(\"Field doesn't have isOdd\");\n    const root = Fp.sqrt(elm);\n    return Fp.isOdd(root) ? Fp.neg(root) : root;\n}\n/**\n * \"Constant-time\" private key generation utility.\n * Same as mapKeyToField, but accepts less bytes (40 instead of 48 for 32-byte field).\n * Which makes it slightly more biased, less secure.\n * @deprecated use `mapKeyToField` instead\n */\nexport function hashToPrivateScalar(hash, groupOrder, isLE = false) {\n    hash = ensureBytes('privateHash', hash);\n    const hashLen = hash.length;\n    const minLen = nLength(groupOrder).nByteLength + 8;\n    if (minLen < 24 || hashLen < minLen || hashLen > 1024)\n        throw new Error('hashToPrivateScalar: expected ' + minLen + '-1024 bytes of input, got ' + hashLen);\n    const num = isLE ? bytesToNumberLE(hash) : bytesToNumberBE(hash);\n    return mod(num, groupOrder - _1n) + _1n;\n}\n/**\n * Returns total number of bytes consumed by the field element.\n * For example, 32 bytes for usual 256-bit weierstrass curve.\n * @param fieldOrder number of field elements, usually CURVE.n\n * @returns byte length of field\n */\nexport function getFieldBytesLength(fieldOrder) {\n    if (typeof fieldOrder !== 'bigint')\n        throw new Error('field order must be bigint');\n    const bitLength = fieldOrder.toString(2).length;\n    return Math.ceil(bitLength / 8);\n}\n/**\n * Returns minimal amount of bytes that can be safely reduced\n * by field order.\n * Should be 2^-128 for 128-bit curve such as P256.\n * @param fieldOrder number of field elements, usually CURVE.n\n * @returns byte length of target hash\n */\nexport function getMinHashLength(fieldOrder) {\n    const length = getFieldBytesLength(fieldOrder);\n    return length + Math.ceil(length / 2);\n}\n/**\n * \"Constant-time\" private key generation utility.\n * Can take (n + n/2) or more bytes of uniform input e.g. from CSPRNG or KDF\n * and convert them into private scalar, with the modulo bias being negligible.\n * Needs at least 48 bytes of input for 32-byte private key.\n * https://research.kudelskisecurity.com/2020/07/28/the-definitive-guide-to-modulo-bias-and-how-to-avoid-it/\n * FIPS 186-5, A.2 https://csrc.nist.gov/publications/detail/fips/186/5/final\n * RFC 9380, https://www.rfc-editor.org/rfc/rfc9380#section-5\n * @param hash hash output from SHA3 or a similar function\n * @param groupOrder size of subgroup - (e.g. secp256k1.CURVE.n)\n * @param isLE interpret hash bytes as LE num\n * @returns valid private scalar\n */\nexport function mapHashToField(key, fieldOrder, isLE = false) {\n    const len = key.length;\n    const fieldLen = getFieldBytesLength(fieldOrder);\n    const minLen = getMinHashLength(fieldOrder);\n    // No small numbers: need to understand bias story. No huge numbers: easier to detect JS timings.\n    if (len < 16 || len < minLen || len > 1024)\n        throw new Error('expected ' + minLen + '-1024 bytes of input, got ' + len);\n    const num = isLE ? bytesToNumberLE(key) : bytesToNumberBE(key);\n    // `mod(x, 11)` can sometimes produce 0. `mod(x, 10) + 1` is the same, but no 0\n    const reduced = mod(num, fieldOrder - _1n) + _1n;\n    return isLE ? numberToBytesLE(reduced, fieldLen) : numberToBytesBE(reduced, fieldLen);\n}\n//# sourceMappingURL=modular.js.map","/**\n * Methods for elliptic curve multiplication by scalars.\n * Contains wNAF, pippenger.\n * @module\n */\n/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */\nimport { bitLen, bitMask, validateObject } from \"../utils.js\";\nimport { Field, FpInvertBatch, nLength, validateField } from \"./modular.js\";\nconst _0n = BigInt(0);\nconst _1n = BigInt(1);\nexport function negateCt(condition, item) {\n    const neg = item.negate();\n    return condition ? neg : item;\n}\n/**\n * Takes a bunch of Projective Points but executes only one\n * inversion on all of them. Inversion is very slow operation,\n * so this improves performance massively.\n * Optimization: converts a list of projective points to a list of identical points with Z=1.\n */\nexport function normalizeZ(c, points) {\n    const invertedZs = FpInvertBatch(c.Fp, points.map((p) => p.Z));\n    return points.map((p, i) => c.fromAffine(p.toAffine(invertedZs[i])));\n}\nfunction validateW(W, bits) {\n    if (!Number.isSafeInteger(W) || W <= 0 || W > bits)\n        throw new Error('invalid window size, expected [1..' + bits + '], got W=' + W);\n}\nfunction calcWOpts(W, scalarBits) {\n    validateW(W, scalarBits);\n    const windows = Math.ceil(scalarBits / W) + 1; // W=8 33. Not 32, because we skip zero\n    const windowSize = 2 ** (W - 1); // W=8 128. Not 256, because we skip zero\n    const maxNumber = 2 ** W; // W=8 256\n    const mask = bitMask(W); // W=8 255 == mask 0b11111111\n    const shiftBy = BigInt(W); // W=8 8\n    return { windows, windowSize, mask, maxNumber, shiftBy };\n}\nfunction calcOffsets(n, window, wOpts) {\n    const { windowSize, mask, maxNumber, shiftBy } = wOpts;\n    let wbits = Number(n & mask); // extract W bits.\n    let nextN = n >> shiftBy; // shift number by W bits.\n    // What actually happens here:\n    // const highestBit = Number(mask ^ (mask >> 1n));\n    // let wbits2 = wbits - 1; // skip zero\n    // if (wbits2 & highestBit) { wbits2 ^= Number(mask); // (~);\n    // split if bits > max: +224 => 256-32\n    if (wbits > windowSize) {\n        // we skip zero, which means instead of `>= size-1`, we do `> size`\n        wbits -= maxNumber; // -32, can be maxNumber - wbits, but then we need to set isNeg here.\n        nextN += _1n; // +256 (carry)\n    }\n    const offsetStart = window * windowSize;\n    const offset = offsetStart + Math.abs(wbits) - 1; // -1 because we skip zero\n    const isZero = wbits === 0; // is current window slice a 0?\n    const isNeg = wbits < 0; // is current window slice negative?\n    const isNegF = window % 2 !== 0; // fake random statement for noise\n    const offsetF = offsetStart; // fake offset for noise\n    return { nextN, offset, isZero, isNeg, isNegF, offsetF };\n}\nfunction validateMSMPoints(points, c) {\n    if (!Array.isArray(points))\n        throw new Error('array expected');\n    points.forEach((p, i) => {\n        if (!(p instanceof c))\n            throw new Error('invalid point at index ' + i);\n    });\n}\nfunction validateMSMScalars(scalars, field) {\n    if (!Array.isArray(scalars))\n        throw new Error('array of scalars expected');\n    scalars.forEach((s, i) => {\n        if (!field.isValid(s))\n            throw new Error('invalid scalar at index ' + i);\n    });\n}\n// Since points in different groups cannot be equal (different object constructor),\n// we can have single place to store precomputes.\n// Allows to make points frozen / immutable.\nconst pointPrecomputes = new WeakMap();\nconst pointWindowSizes = new WeakMap();\nfunction getW(P) {\n    // To disable precomputes:\n    // return 1;\n    return pointWindowSizes.get(P) || 1;\n}\nfunction assert0(n) {\n    if (n !== _0n)\n        throw new Error('invalid wNAF');\n}\n/**\n * Elliptic curve multiplication of Point by scalar. Fragile.\n * Table generation takes **30MB of ram and 10ms on high-end CPU**,\n * but may take much longer on slow devices. Actual generation will happen on\n * first call of `multiply()`. By default, `BASE` point is precomputed.\n *\n * Scalars should always be less than curve order: this should be checked inside of a curve itself.\n * Creates precomputation tables for fast multiplication:\n * - private scalar is split by fixed size windows of W bits\n * - every window point is collected from window's table & added to accumulator\n * - since windows are different, same point inside tables won't be accessed more than once per calc\n * - each multiplication is 'Math.ceil(CURVE_ORDER / ) + 1' point additions (fixed for any scalar)\n * - +1 window is neccessary for wNAF\n * - wNAF reduces table size: 2x less memory + 2x faster generation, but 10% slower multiplication\n *\n * @todo Research returning 2d JS array of windows, instead of a single window.\n * This would allow windows to be in different memory locations\n */\nexport class wNAF {\n    // Parametrized with a given Point class (not individual point)\n    constructor(Point, bits) {\n        this.BASE = Point.BASE;\n        this.ZERO = Point.ZERO;\n        this.Fn = Point.Fn;\n        this.bits = bits;\n    }\n    // non-const time multiplication ladder\n    _unsafeLadder(elm, n, p = this.ZERO) {\n        let d = elm;\n        while (n > _0n) {\n            if (n & _1n)\n                p = p.add(d);\n            d = d.double();\n            n >>= _1n;\n        }\n        return p;\n    }\n    /**\n     * Creates a wNAF precomputation window. Used for caching.\n     * Default window size is set by `utils.precompute()` and is equal to 8.\n     * Number of precomputed points depends on the curve size:\n     * 2^(1) * (Math.ceil( / ) + 1), where:\n     * -  is the window size\n     * -  is the bitlength of the curve order.\n     * For a 256-bit curve and window size 8, the number of precomputed points is 128 * 33 = 4224.\n     * @param point Point instance\n     * @param W window size\n     * @returns precomputed point tables flattened to a single array\n     */\n    precomputeWindow(point, W) {\n        const { windows, windowSize } = calcWOpts(W, this.bits);\n        const points = [];\n        let p = point;\n        let base = p;\n        for (let window = 0; window < windows; window++) {\n            base = p;\n            points.push(base);\n            // i=1, bc we skip 0\n            for (let i = 1; i < windowSize; i++) {\n                base = base.add(p);\n                points.push(base);\n            }\n            p = base.double();\n        }\n        return points;\n    }\n    /**\n     * Implements ec multiplication using precomputed tables and w-ary non-adjacent form.\n     * More compact implementation:\n     * https://github.com/paulmillr/noble-secp256k1/blob/47cb1669b6e506ad66b35fe7d76132ae97465da2/index.ts#L502-L541\n     * @returns real and fake (for const-time) points\n     */\n    wNAF(W, precomputes, n) {\n        // Scalar should be smaller than field order\n        if (!this.Fn.isValid(n))\n            throw new Error('invalid scalar');\n        // Accumulators\n        let p = this.ZERO;\n        let f = this.BASE;\n        // This code was first written with assumption that 'f' and 'p' will never be infinity point:\n        // since each addition is multiplied by 2 ** W, it cannot cancel each other. However,\n        // there is negate now: it is possible that negated element from low value\n        // would be the same as high element, which will create carry into next window.\n        // It's not obvious how this can fail, but still worth investigating later.\n        const wo = calcWOpts(W, this.bits);\n        for (let window = 0; window < wo.windows; window++) {\n            // (n === _0n) is handled and not early-exited. isEven and offsetF are used for noise\n            const { nextN, offset, isZero, isNeg, isNegF, offsetF } = calcOffsets(n, window, wo);\n            n = nextN;\n            if (isZero) {\n                // bits are 0: add garbage to fake point\n                // Important part for const-time getPublicKey: add random \"noise\" point to f.\n                f = f.add(negateCt(isNegF, precomputes[offsetF]));\n            }\n            else {\n                // bits are 1: add to result point\n                p = p.add(negateCt(isNeg, precomputes[offset]));\n            }\n        }\n        assert0(n);\n        // Return both real and fake points: JIT won't eliminate f.\n        // At this point there is a way to F be infinity-point even if p is not,\n        // which makes it less const-time: around 1 bigint multiply.\n        return { p, f };\n    }\n    /**\n     * Implements ec unsafe (non const-time) multiplication using precomputed tables and w-ary non-adjacent form.\n     * @param acc accumulator point to add result of multiplication\n     * @returns point\n     */\n    wNAFUnsafe(W, precomputes, n, acc = this.ZERO) {\n        const wo = calcWOpts(W, this.bits);\n        for (let window = 0; window < wo.windows; window++) {\n            if (n === _0n)\n                break; // Early-exit, skip 0 value\n            const { nextN, offset, isZero, isNeg } = calcOffsets(n, window, wo);\n            n = nextN;\n            if (isZero) {\n                // Window bits are 0: skip processing.\n                // Move to next window.\n                continue;\n            }\n            else {\n                const item = precomputes[offset];\n                acc = acc.add(isNeg ? item.negate() : item); // Re-using acc allows to save adds in MSM\n            }\n        }\n        assert0(n);\n        return acc;\n    }\n    getPrecomputes(W, point, transform) {\n        // Calculate precomputes on a first run, reuse them after\n        let comp = pointPrecomputes.get(point);\n        if (!comp) {\n            comp = this.precomputeWindow(point, W);\n            if (W !== 1) {\n                // Doing transform outside of if brings 15% perf hit\n                if (typeof transform === 'function')\n                    comp = transform(comp);\n                pointPrecomputes.set(point, comp);\n            }\n        }\n        return comp;\n    }\n    cached(point, scalar, transform) {\n        const W = getW(point);\n        return this.wNAF(W, this.getPrecomputes(W, point, transform), scalar);\n    }\n    unsafe(point, scalar, transform, prev) {\n        const W = getW(point);\n        if (W === 1)\n            return this._unsafeLadder(point, scalar, prev); // For W=1 ladder is ~x2 faster\n        return this.wNAFUnsafe(W, this.getPrecomputes(W, point, transform), scalar, prev);\n    }\n    // We calculate precomputes for elliptic curve point multiplication\n    // using windowed method. This specifies window size and\n    // stores precomputed values. Usually only base point would be precomputed.\n    createCache(P, W) {\n        validateW(W, this.bits);\n        pointWindowSizes.set(P, W);\n        pointPrecomputes.delete(P);\n    }\n    hasCache(elm) {\n        return getW(elm) !== 1;\n    }\n}\n/**\n * Endomorphism-specific multiplication for Koblitz curves.\n * Cost: 128 dbl, 0-256 adds.\n */\nexport function mulEndoUnsafe(Point, point, k1, k2) {\n    let acc = point;\n    let p1 = Point.ZERO;\n    let p2 = Point.ZERO;\n    while (k1 > _0n || k2 > _0n) {\n        if (k1 & _1n)\n            p1 = p1.add(acc);\n        if (k2 & _1n)\n            p2 = p2.add(acc);\n        acc = acc.double();\n        k1 >>= _1n;\n        k2 >>= _1n;\n    }\n    return { p1, p2 };\n}\n/**\n * Pippenger algorithm for multi-scalar multiplication (MSM, Pa + Qb + Rc + ...).\n * 30x faster vs naive addition on L=4096, 10x faster than precomputes.\n * For N=254bit, L=1, it does: 1024 ADD + 254 DBL. For L=5: 1536 ADD + 254 DBL.\n * Algorithmically constant-time (for same L), even when 1 point + scalar, or when scalar = 0.\n * @param c Curve Point constructor\n * @param fieldN field over CURVE.N - important that it's not over CURVE.P\n * @param points array of L curve points\n * @param scalars array of L scalars (aka secret keys / bigints)\n */\nexport function pippenger(c, fieldN, points, scalars) {\n    // If we split scalars by some window (let's say 8 bits), every chunk will only\n    // take 256 buckets even if there are 4096 scalars, also re-uses double.\n    // TODO:\n    // - https://eprint.iacr.org/2024/750.pdf\n    // - https://tches.iacr.org/index.php/TCHES/article/view/10287\n    // 0 is accepted in scalars\n    validateMSMPoints(points, c);\n    validateMSMScalars(scalars, fieldN);\n    const plength = points.length;\n    const slength = scalars.length;\n    if (plength !== slength)\n        throw new Error('arrays of points and scalars must have equal length');\n    // if (plength === 0) throw new Error('array must be of length >= 2');\n    const zero = c.ZERO;\n    const wbits = bitLen(BigInt(plength));\n    let windowSize = 1; // bits\n    if (wbits > 12)\n        windowSize = wbits - 3;\n    else if (wbits > 4)\n        windowSize = wbits - 2;\n    else if (wbits > 0)\n        windowSize = 2;\n    const MASK = bitMask(windowSize);\n    const buckets = new Array(Number(MASK) + 1).fill(zero); // +1 for zero array\n    const lastBits = Math.floor((fieldN.BITS - 1) / windowSize) * windowSize;\n    let sum = zero;\n    for (let i = lastBits; i >= 0; i -= windowSize) {\n        buckets.fill(zero);\n        for (let j = 0; j < slength; j++) {\n            const scalar = scalars[j];\n            const wbits = Number((scalar >> BigInt(i)) & MASK);\n            buckets[wbits] = buckets[wbits].add(points[j]);\n        }\n        let resI = zero; // not using this will do small speed-up, but will lose ct\n        // Skip first bucket, because it is zero\n        for (let j = buckets.length - 1, sumI = zero; j > 0; j--) {\n            sumI = sumI.add(buckets[j]);\n            resI = resI.add(sumI);\n        }\n        sum = sum.add(resI);\n        if (i !== 0)\n            for (let j = 0; j < windowSize; j++)\n                sum = sum.double();\n    }\n    return sum;\n}\n/**\n * Precomputed multi-scalar multiplication (MSM, Pa + Qb + Rc + ...).\n * @param c Curve Point constructor\n * @param fieldN field over CURVE.N - important that it's not over CURVE.P\n * @param points array of L curve points\n * @returns function which multiplies points with scaars\n */\nexport function precomputeMSMUnsafe(c, fieldN, points, windowSize) {\n    /**\n     * Performance Analysis of Window-based Precomputation\n     *\n     * Base Case (256-bit scalar, 8-bit window):\n     * - Standard precomputation requires:\n     *   - 31 additions per scalar  256 scalars = 7,936 ops\n     *   - Plus 255 summary additions = 8,191 total ops\n     *   Note: Summary additions can be optimized via accumulator\n     *\n     * Chunked Precomputation Analysis:\n     * - Using 32 chunks requires:\n     *   - 255 additions per chunk\n     *   - 256 doublings\n     *   - Total: (255  32) + 256 = 8,416 ops\n     *\n     * Memory Usage Comparison:\n     * Window Size | Standard Points | Chunked Points\n     * ------------|-----------------|---------------\n     *     4-bit   |     520         |      15\n     *     8-bit   |    4,224        |     255\n     *    10-bit   |   13,824        |   1,023\n     *    16-bit   |  557,056        |  65,535\n     *\n     * Key Advantages:\n     * 1. Enables larger window sizes due to reduced memory overhead\n     * 2. More efficient for smaller scalar counts:\n     *    - 16 chunks: (16  255) + 256 = 4,336 ops\n     *    - ~2x faster than standard 8,191 ops\n     *\n     * Limitations:\n     * - Not suitable for plain precomputes (requires 256 constant doublings)\n     * - Performance degrades with larger scalar counts:\n     *   - Optimal for ~256 scalars\n     *   - Less efficient for 4096+ scalars (Pippenger preferred)\n     */\n    validateW(windowSize, fieldN.BITS);\n    validateMSMPoints(points, c);\n    const zero = c.ZERO;\n    const tableSize = 2 ** windowSize - 1; // table size (without zero)\n    const chunks = Math.ceil(fieldN.BITS / windowSize); // chunks of item\n    const MASK = bitMask(windowSize);\n    const tables = points.map((p) => {\n        const res = [];\n        for (let i = 0, acc = p; i < tableSize; i++) {\n            res.push(acc);\n            acc = acc.add(p);\n        }\n        return res;\n    });\n    return (scalars) => {\n        validateMSMScalars(scalars, fieldN);\n        if (scalars.length > points.length)\n            throw new Error('array of scalars must be smaller than array of points');\n        let res = zero;\n        for (let i = 0; i < chunks; i++) {\n            // No need to double if accumulator is still zero.\n            if (res !== zero)\n                for (let j = 0; j < windowSize; j++)\n                    res = res.double();\n            const shiftBy = BigInt(chunks * windowSize - (i + 1) * windowSize);\n            for (let j = 0; j < scalars.length; j++) {\n                const n = scalars[j];\n                const curr = Number((n >> shiftBy) & MASK);\n                if (!curr)\n                    continue; // skip zero scalars chunks\n                res = res.add(tables[j][curr - 1]);\n            }\n        }\n        return res;\n    };\n}\n// TODO: remove\n/** @deprecated */\nexport function validateBasic(curve) {\n    validateField(curve.Fp);\n    validateObject(curve, {\n        n: 'bigint',\n        h: 'bigint',\n        Gx: 'field',\n        Gy: 'field',\n    }, {\n        nBitLength: 'isSafeInteger',\n        nByteLength: 'isSafeInteger',\n    });\n    // Set defaults\n    return Object.freeze({\n        ...nLength(curve.n, curve.nBitLength),\n        ...curve,\n        ...{ p: curve.Fp.ORDER },\n    });\n}\nfunction createField(order, field, isLE) {\n    if (field) {\n        if (field.ORDER !== order)\n            throw new Error('Field.ORDER must match order: Fp == p, Fn == n');\n        validateField(field);\n        return field;\n    }\n    else {\n        return Field(order, { isLE });\n    }\n}\n/** Validates CURVE opts and creates fields */\nexport function _createCurveFields(type, CURVE, curveOpts = {}, FpFnLE) {\n    if (FpFnLE === undefined)\n        FpFnLE = type === 'edwards';\n    if (!CURVE || typeof CURVE !== 'object')\n        throw new Error(`expected valid ${type} CURVE object`);\n    for (const p of ['p', 'n', 'h']) {\n        const val = CURVE[p];\n        if (!(typeof val === 'bigint' && val > _0n))\n            throw new Error(`CURVE.${p} must be positive bigint`);\n    }\n    const Fp = createField(CURVE.p, curveOpts.Fp, FpFnLE);\n    const Fn = createField(CURVE.n, curveOpts.Fn, FpFnLE);\n    const _b = type === 'weierstrass' ? 'b' : 'd';\n    const params = ['Gx', 'Gy', 'a', _b];\n    for (const p of params) {\n        // @ts-ignore\n        if (!Fp.isValid(CURVE[p]))\n            throw new Error(`CURVE.${p} must be valid field element of CURVE.Fp`);\n    }\n    CURVE = Object.freeze(Object.assign({}, CURVE));\n    return { CURVE, Fp, Fn };\n}\n//# sourceMappingURL=curve.js.map","/**\n * Short Weierstrass curve methods. The formula is: y = x + ax + b.\n *\n * ### Design rationale for types\n *\n * * Interaction between classes from different curves should fail:\n *   `k256.Point.BASE.add(p256.Point.BASE)`\n * * For this purpose we want to use `instanceof` operator, which is fast and works during runtime\n * * Different calls of `curve()` would return different classes -\n *   `curve(params) !== curve(params)`: if somebody decided to monkey-patch their curve,\n *   it won't affect others\n *\n * TypeScript can't infer types for classes created inside a function. Classes is one instance\n * of nominative types in TypeScript and interfaces only check for shape, so it's hard to create\n * unique type for every function call.\n *\n * We can use generic types via some param, like curve opts, but that would:\n *     1. Enable interaction between `curve(params)` and `curve(params)` (curves of same params)\n *     which is hard to debug.\n *     2. Params can be generic and we can't enforce them to be constant value:\n *     if somebody creates curve from non-constant params,\n *     it would be allowed to interact with other curves with non-constant params\n *\n * @todo https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-7.html#unique-symbol\n * @module\n */\n/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */\nimport { hmac as nobleHmac } from '@noble/hashes/hmac.js';\nimport { ahash } from '@noble/hashes/utils';\nimport { _validateObject, _abool2 as abool, _abytes2 as abytes, aInRange, bitLen, bitMask, bytesToHex, bytesToNumberBE, concatBytes, createHmacDrbg, ensureBytes, hexToBytes, inRange, isBytes, memoized, numberToHexUnpadded, randomBytes as randomBytesWeb, } from \"../utils.js\";\nimport { _createCurveFields, mulEndoUnsafe, negateCt, normalizeZ, pippenger, wNAF, } from \"./curve.js\";\nimport { Field, FpInvertBatch, getMinHashLength, mapHashToField, nLength, validateField, } from \"./modular.js\";\n// We construct basis in such way that den is always positive and equals n, but num sign depends on basis (not on secret value)\nconst divNearest = (num, den) => (num + (num >= 0 ? den : -den) / _2n) / den;\n/**\n * Splits scalar for GLV endomorphism.\n */\nexport function _splitEndoScalar(k, basis, n) {\n    // Split scalar into two such that part is ~half bits: `abs(part) < sqrt(N)`\n    // Since part can be negative, we need to do this on point.\n    // TODO: verifyScalar function which consumes lambda\n    const [[a1, b1], [a2, b2]] = basis;\n    const c1 = divNearest(b2 * k, n);\n    const c2 = divNearest(-b1 * k, n);\n    // |k1|/|k2| is < sqrt(N), but can be negative.\n    // If we do `k1 mod N`, we'll get big scalar (`> sqrt(N)`): so, we do cheaper negation instead.\n    let k1 = k - c1 * a1 - c2 * a2;\n    let k2 = -c1 * b1 - c2 * b2;\n    const k1neg = k1 < _0n;\n    const k2neg = k2 < _0n;\n    if (k1neg)\n        k1 = -k1;\n    if (k2neg)\n        k2 = -k2;\n    // Double check that resulting scalar less than half bits of N: otherwise wNAF will fail.\n    // This should only happen on wrong basises. Also, math inside is too complex and I don't trust it.\n    const MAX_NUM = bitMask(Math.ceil(bitLen(n) / 2)) + _1n; // Half bits of N\n    if (k1 < _0n || k1 >= MAX_NUM || k2 < _0n || k2 >= MAX_NUM) {\n        throw new Error('splitScalar (endomorphism): failed, k=' + k);\n    }\n    return { k1neg, k1, k2neg, k2 };\n}\nfunction validateSigFormat(format) {\n    if (!['compact', 'recovered', 'der'].includes(format))\n        throw new Error('Signature format must be \"compact\", \"recovered\", or \"der\"');\n    return format;\n}\nfunction validateSigOpts(opts, def) {\n    const optsn = {};\n    for (let optName of Object.keys(def)) {\n        // @ts-ignore\n        optsn[optName] = opts[optName] === undefined ? def[optName] : opts[optName];\n    }\n    abool(optsn.lowS, 'lowS');\n    abool(optsn.prehash, 'prehash');\n    if (optsn.format !== undefined)\n        validateSigFormat(optsn.format);\n    return optsn;\n}\nexport class DERErr extends Error {\n    constructor(m = '') {\n        super(m);\n    }\n}\n/**\n * ASN.1 DER encoding utilities. ASN is very complex & fragile. Format:\n *\n *     [0x30 (SEQUENCE), bytelength, 0x02 (INTEGER), intLength, R, 0x02 (INTEGER), intLength, S]\n *\n * Docs: https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/, https://luca.ntop.org/Teaching/Appunti/asn1.html\n */\nexport const DER = {\n    // asn.1 DER encoding utils\n    Err: DERErr,\n    // Basic building block is TLV (Tag-Length-Value)\n    _tlv: {\n        encode: (tag, data) => {\n            const { Err: E } = DER;\n            if (tag < 0 || tag > 256)\n                throw new E('tlv.encode: wrong tag');\n            if (data.length & 1)\n                throw new E('tlv.encode: unpadded data');\n            const dataLen = data.length / 2;\n            const len = numberToHexUnpadded(dataLen);\n            if ((len.length / 2) & 128)\n                throw new E('tlv.encode: long form length too big');\n            // length of length with long form flag\n            const lenLen = dataLen > 127 ? numberToHexUnpadded((len.length / 2) | 128) : '';\n            const t = numberToHexUnpadded(tag);\n            return t + lenLen + len + data;\n        },\n        // v - value, l - left bytes (unparsed)\n        decode(tag, data) {\n            const { Err: E } = DER;\n            let pos = 0;\n            if (tag < 0 || tag > 256)\n                throw new E('tlv.encode: wrong tag');\n            if (data.length < 2 || data[pos++] !== tag)\n                throw new E('tlv.decode: wrong tlv');\n            const first = data[pos++];\n            const isLong = !!(first & 128); // First bit of first length byte is flag for short/long form\n            let length = 0;\n            if (!isLong)\n                length = first;\n            else {\n                // Long form: [longFlag(1bit), lengthLength(7bit), length (BE)]\n                const lenLen = first & 127;\n                if (!lenLen)\n                    throw new E('tlv.decode(long): indefinite length not supported');\n                if (lenLen > 4)\n                    throw new E('tlv.decode(long): byte length is too big'); // this will overflow u32 in js\n                const lengthBytes = data.subarray(pos, pos + lenLen);\n                if (lengthBytes.length !== lenLen)\n                    throw new E('tlv.decode: length bytes not complete');\n                if (lengthBytes[0] === 0)\n                    throw new E('tlv.decode(long): zero leftmost byte');\n                for (const b of lengthBytes)\n                    length = (length << 8) | b;\n                pos += lenLen;\n                if (length < 128)\n                    throw new E('tlv.decode(long): not minimal encoding');\n            }\n            const v = data.subarray(pos, pos + length);\n            if (v.length !== length)\n                throw new E('tlv.decode: wrong value length');\n            return { v, l: data.subarray(pos + length) };\n        },\n    },\n    // https://crypto.stackexchange.com/a/57734 Leftmost bit of first byte is 'negative' flag,\n    // since we always use positive integers here. It must always be empty:\n    // - add zero byte if exists\n    // - if next byte doesn't have a flag, leading zero is not allowed (minimal encoding)\n    _int: {\n        encode(num) {\n            const { Err: E } = DER;\n            if (num < _0n)\n                throw new E('integer: negative integers are not allowed');\n            let hex = numberToHexUnpadded(num);\n            // Pad with zero byte if negative flag is present\n            if (Number.parseInt(hex[0], 16) & 0b1000)\n                hex = '00' + hex;\n            if (hex.length & 1)\n                throw new E('unexpected DER parsing assertion: unpadded hex');\n            return hex;\n        },\n        decode(data) {\n            const { Err: E } = DER;\n            if (data[0] & 128)\n                throw new E('invalid signature integer: negative');\n            if (data[0] === 0x00 && !(data[1] & 128))\n                throw new E('invalid signature integer: unnecessary leading zero');\n            return bytesToNumberBE(data);\n        },\n    },\n    toSig(hex) {\n        // parse DER signature\n        const { Err: E, _int: int, _tlv: tlv } = DER;\n        const data = ensureBytes('signature', hex);\n        const { v: seqBytes, l: seqLeftBytes } = tlv.decode(0x30, data);\n        if (seqLeftBytes.length)\n            throw new E('invalid signature: left bytes after parsing');\n        const { v: rBytes, l: rLeftBytes } = tlv.decode(0x02, seqBytes);\n        const { v: sBytes, l: sLeftBytes } = tlv.decode(0x02, rLeftBytes);\n        if (sLeftBytes.length)\n            throw new E('invalid signature: left bytes after parsing');\n        return { r: int.decode(rBytes), s: int.decode(sBytes) };\n    },\n    hexFromSig(sig) {\n        const { _tlv: tlv, _int: int } = DER;\n        const rs = tlv.encode(0x02, int.encode(sig.r));\n        const ss = tlv.encode(0x02, int.encode(sig.s));\n        const seq = rs + ss;\n        return tlv.encode(0x30, seq);\n    },\n};\n// Be friendly to bad ECMAScript parsers by not using bigint literals\n// prettier-ignore\nconst _0n = BigInt(0), _1n = BigInt(1), _2n = BigInt(2), _3n = BigInt(3), _4n = BigInt(4);\nexport function _normFnElement(Fn, key) {\n    const { BYTES: expected } = Fn;\n    let num;\n    if (typeof key === 'bigint') {\n        num = key;\n    }\n    else {\n        let bytes = ensureBytes('private key', key);\n        try {\n            num = Fn.fromBytes(bytes);\n        }\n        catch (error) {\n            throw new Error(`invalid private key: expected ui8a of size ${expected}, got ${typeof key}`);\n        }\n    }\n    if (!Fn.isValidNot0(num))\n        throw new Error('invalid private key: out of range [1..N-1]');\n    return num;\n}\n/**\n * Creates weierstrass Point constructor, based on specified curve options.\n *\n * @example\n```js\nconst opts = {\n  p: BigInt('0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff'),\n  n: BigInt('0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551'),\n  h: BigInt(1),\n  a: BigInt('0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc'),\n  b: BigInt('0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b'),\n  Gx: BigInt('0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296'),\n  Gy: BigInt('0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5'),\n};\nconst p256_Point = weierstrass(opts);\n```\n */\nexport function weierstrassN(params, extraOpts = {}) {\n    const validated = _createCurveFields('weierstrass', params, extraOpts);\n    const { Fp, Fn } = validated;\n    let CURVE = validated.CURVE;\n    const { h: cofactor, n: CURVE_ORDER } = CURVE;\n    _validateObject(extraOpts, {}, {\n        allowInfinityPoint: 'boolean',\n        clearCofactor: 'function',\n        isTorsionFree: 'function',\n        fromBytes: 'function',\n        toBytes: 'function',\n        endo: 'object',\n        wrapPrivateKey: 'boolean',\n    });\n    const { endo } = extraOpts;\n    if (endo) {\n        // validateObject(endo, { beta: 'bigint', splitScalar: 'function' });\n        if (!Fp.is0(CURVE.a) || typeof endo.beta !== 'bigint' || !Array.isArray(endo.basises)) {\n            throw new Error('invalid endo: expected \"beta\": bigint and \"basises\": array');\n        }\n    }\n    const lengths = getWLengths(Fp, Fn);\n    function assertCompressionIsSupported() {\n        if (!Fp.isOdd)\n            throw new Error('compression is not supported: Field does not have .isOdd()');\n    }\n    // Implements IEEE P1363 point encoding\n    function pointToBytes(_c, point, isCompressed) {\n        const { x, y } = point.toAffine();\n        const bx = Fp.toBytes(x);\n        abool(isCompressed, 'isCompressed');\n        if (isCompressed) {\n            assertCompressionIsSupported();\n            const hasEvenY = !Fp.isOdd(y);\n            return concatBytes(pprefix(hasEvenY), bx);\n        }\n        else {\n            return concatBytes(Uint8Array.of(0x04), bx, Fp.toBytes(y));\n        }\n    }\n    function pointFromBytes(bytes) {\n        abytes(bytes, undefined, 'Point');\n        const { publicKey: comp, publicKeyUncompressed: uncomp } = lengths; // e.g. for 32-byte: 33, 65\n        const length = bytes.length;\n        const head = bytes[0];\n        const tail = bytes.subarray(1);\n        // No actual validation is done here: use .assertValidity()\n        if (length === comp && (head === 0x02 || head === 0x03)) {\n            const x = Fp.fromBytes(tail);\n            if (!Fp.isValid(x))\n                throw new Error('bad point: is not on curve, wrong x');\n            const y2 = weierstrassEquation(x); // y = x + ax + b\n            let y;\n            try {\n                y = Fp.sqrt(y2); // y = y ^ (p+1)/4\n            }\n            catch (sqrtError) {\n                const err = sqrtError instanceof Error ? ': ' + sqrtError.message : '';\n                throw new Error('bad point: is not on curve, sqrt error' + err);\n            }\n            assertCompressionIsSupported();\n            const isYOdd = Fp.isOdd(y); // (y & _1n) === _1n;\n            const isHeadOdd = (head & 1) === 1; // ECDSA-specific\n            if (isHeadOdd !== isYOdd)\n                y = Fp.neg(y);\n            return { x, y };\n        }\n        else if (length === uncomp && head === 0x04) {\n            // TODO: more checks\n            const L = Fp.BYTES;\n            const x = Fp.fromBytes(tail.subarray(0, L));\n            const y = Fp.fromBytes(tail.subarray(L, L * 2));\n            if (!isValidXY(x, y))\n                throw new Error('bad point: is not on curve');\n            return { x, y };\n        }\n        else {\n            throw new Error(`bad point: got length ${length}, expected compressed=${comp} or uncompressed=${uncomp}`);\n        }\n    }\n    const encodePoint = extraOpts.toBytes || pointToBytes;\n    const decodePoint = extraOpts.fromBytes || pointFromBytes;\n    function weierstrassEquation(x) {\n        const x2 = Fp.sqr(x); // x * x\n        const x3 = Fp.mul(x2, x); // x * x\n        return Fp.add(Fp.add(x3, Fp.mul(x, CURVE.a)), CURVE.b); // x + a * x + b\n    }\n    // TODO: move top-level\n    /** Checks whether equation holds for given x, y: y == x + ax + b */\n    function isValidXY(x, y) {\n        const left = Fp.sqr(y); // y\n        const right = weierstrassEquation(x); // x + ax + b\n        return Fp.eql(left, right);\n    }\n    // Validate whether the passed curve params are valid.\n    // Test 1: equation y = x + ax + b should work for generator point.\n    if (!isValidXY(CURVE.Gx, CURVE.Gy))\n        throw new Error('bad curve params: generator point');\n    // Test 2: discriminant  part should be non-zero: 4a + 27b != 0.\n    // Guarantees curve is genus-1, smooth (non-singular).\n    const _4a3 = Fp.mul(Fp.pow(CURVE.a, _3n), _4n);\n    const _27b2 = Fp.mul(Fp.sqr(CURVE.b), BigInt(27));\n    if (Fp.is0(Fp.add(_4a3, _27b2)))\n        throw new Error('bad curve params: a or b');\n    /** Asserts coordinate is valid: 0 <= n < Fp.ORDER. */\n    function acoord(title, n, banZero = false) {\n        if (!Fp.isValid(n) || (banZero && Fp.is0(n)))\n            throw new Error(`bad point coordinate ${title}`);\n        return n;\n    }\n    function aprjpoint(other) {\n        if (!(other instanceof Point))\n            throw new Error('ProjectivePoint expected');\n    }\n    function splitEndoScalarN(k) {\n        if (!endo || !endo.basises)\n            throw new Error('no endo');\n        return _splitEndoScalar(k, endo.basises, Fn.ORDER);\n    }\n    // Memoized toAffine / validity check. They are heavy. Points are immutable.\n    // Converts Projective point to affine (x, y) coordinates.\n    // Can accept precomputed Z^-1 - for example, from invertBatch.\n    // (X, Y, Z)  (x=X/Z, y=Y/Z)\n    const toAffineMemo = memoized((p, iz) => {\n        const { X, Y, Z } = p;\n        // Fast-path for normalized points\n        if (Fp.eql(Z, Fp.ONE))\n            return { x: X, y: Y };\n        const is0 = p.is0();\n        // If invZ was 0, we return zero point. However we still want to execute\n        // all operations, so we replace invZ with a random number, 1.\n        if (iz == null)\n            iz = is0 ? Fp.ONE : Fp.inv(Z);\n        const x = Fp.mul(X, iz);\n        const y = Fp.mul(Y, iz);\n        const zz = Fp.mul(Z, iz);\n        if (is0)\n            return { x: Fp.ZERO, y: Fp.ZERO };\n        if (!Fp.eql(zz, Fp.ONE))\n            throw new Error('invZ was invalid');\n        return { x, y };\n    });\n    // NOTE: on exception this will crash 'cached' and no value will be set.\n    // Otherwise true will be return\n    const assertValidMemo = memoized((p) => {\n        if (p.is0()) {\n            // (0, 1, 0) aka ZERO is invalid in most contexts.\n            // In BLS, ZERO can be serialized, so we allow it.\n            // (0, 0, 0) is invalid representation of ZERO.\n            if (extraOpts.allowInfinityPoint && !Fp.is0(p.Y))\n                return;\n            throw new Error('bad point: ZERO');\n        }\n        // Some 3rd-party test vectors require different wording between here & `fromCompressedHex`\n        const { x, y } = p.toAffine();\n        if (!Fp.isValid(x) || !Fp.isValid(y))\n            throw new Error('bad point: x or y not field elements');\n        if (!isValidXY(x, y))\n            throw new Error('bad point: equation left != right');\n        if (!p.isTorsionFree())\n            throw new Error('bad point: not in prime-order subgroup');\n        return true;\n    });\n    function finishEndo(endoBeta, k1p, k2p, k1neg, k2neg) {\n        k2p = new Point(Fp.mul(k2p.X, endoBeta), k2p.Y, k2p.Z);\n        k1p = negateCt(k1neg, k1p);\n        k2p = negateCt(k2neg, k2p);\n        return k1p.add(k2p);\n    }\n    /**\n     * Projective Point works in 3d / projective (homogeneous) coordinates:(X, Y, Z)  (x=X/Z, y=Y/Z).\n     * Default Point works in 2d / affine coordinates: (x, y).\n     * We're doing calculations in projective, because its operations don't require costly inversion.\n     */\n    class Point {\n        /** Does NOT validate if the point is valid. Use `.assertValidity()`. */\n        constructor(X, Y, Z) {\n            this.X = acoord('x', X);\n            this.Y = acoord('y', Y, true);\n            this.Z = acoord('z', Z);\n            Object.freeze(this);\n        }\n        static CURVE() {\n            return CURVE;\n        }\n        /** Does NOT validate if the point is valid. Use `.assertValidity()`. */\n        static fromAffine(p) {\n            const { x, y } = p || {};\n            if (!p || !Fp.isValid(x) || !Fp.isValid(y))\n                throw new Error('invalid affine point');\n            if (p instanceof Point)\n                throw new Error('projective point not allowed');\n            // (0, 0) would've produced (0, 0, 1) - instead, we need (0, 1, 0)\n            if (Fp.is0(x) && Fp.is0(y))\n                return Point.ZERO;\n            return new Point(x, y, Fp.ONE);\n        }\n        static fromBytes(bytes) {\n            const P = Point.fromAffine(decodePoint(abytes(bytes, undefined, 'point')));\n            P.assertValidity();\n            return P;\n        }\n        static fromHex(hex) {\n            return Point.fromBytes(ensureBytes('pointHex', hex));\n        }\n        get x() {\n            return this.toAffine().x;\n        }\n        get y() {\n            return this.toAffine().y;\n        }\n        /**\n         *\n         * @param windowSize\n         * @param isLazy true will defer table computation until the first multiplication\n         * @returns\n         */\n        precompute(windowSize = 8, isLazy = true) {\n            wnaf.createCache(this, windowSize);\n            if (!isLazy)\n                this.multiply(_3n); // random number\n            return this;\n        }\n        // TODO: return `this`\n        /** A point on curve is valid if it conforms to equation. */\n        assertValidity() {\n            assertValidMemo(this);\n        }\n        hasEvenY() {\n            const { y } = this.toAffine();\n            if (!Fp.isOdd)\n                throw new Error(\"Field doesn't support isOdd\");\n            return !Fp.isOdd(y);\n        }\n        /** Compare one point to another. */\n        equals(other) {\n            aprjpoint(other);\n            const { X: X1, Y: Y1, Z: Z1 } = this;\n            const { X: X2, Y: Y2, Z: Z2 } = other;\n            const U1 = Fp.eql(Fp.mul(X1, Z2), Fp.mul(X2, Z1));\n            const U2 = Fp.eql(Fp.mul(Y1, Z2), Fp.mul(Y2, Z1));\n            return U1 && U2;\n        }\n        /** Flips point to one corresponding to (x, -y) in Affine coordinates. */\n        negate() {\n            return new Point(this.X, Fp.neg(this.Y), this.Z);\n        }\n        // Renes-Costello-Batina exception-free doubling formula.\n        // There is 30% faster Jacobian formula, but it is not complete.\n        // https://eprint.iacr.org/2015/1060, algorithm 3\n        // Cost: 8M + 3S + 3*a + 2*b3 + 15add.\n        double() {\n            const { a, b } = CURVE;\n            const b3 = Fp.mul(b, _3n);\n            const { X: X1, Y: Y1, Z: Z1 } = this;\n            let X3 = Fp.ZERO, Y3 = Fp.ZERO, Z3 = Fp.ZERO; // prettier-ignore\n            let t0 = Fp.mul(X1, X1); // step 1\n            let t1 = Fp.mul(Y1, Y1);\n            let t2 = Fp.mul(Z1, Z1);\n            let t3 = Fp.mul(X1, Y1);\n            t3 = Fp.add(t3, t3); // step 5\n            Z3 = Fp.mul(X1, Z1);\n            Z3 = Fp.add(Z3, Z3);\n            X3 = Fp.mul(a, Z3);\n            Y3 = Fp.mul(b3, t2);\n            Y3 = Fp.add(X3, Y3); // step 10\n            X3 = Fp.sub(t1, Y3);\n            Y3 = Fp.add(t1, Y3);\n            Y3 = Fp.mul(X3, Y3);\n            X3 = Fp.mul(t3, X3);\n            Z3 = Fp.mul(b3, Z3); // step 15\n            t2 = Fp.mul(a, t2);\n            t3 = Fp.sub(t0, t2);\n            t3 = Fp.mul(a, t3);\n            t3 = Fp.add(t3, Z3);\n            Z3 = Fp.add(t0, t0); // step 20\n            t0 = Fp.add(Z3, t0);\n            t0 = Fp.add(t0, t2);\n            t0 = Fp.mul(t0, t3);\n            Y3 = Fp.add(Y3, t0);\n            t2 = Fp.mul(Y1, Z1); // step 25\n            t2 = Fp.add(t2, t2);\n            t0 = Fp.mul(t2, t3);\n            X3 = Fp.sub(X3, t0);\n            Z3 = Fp.mul(t2, t1);\n            Z3 = Fp.add(Z3, Z3); // step 30\n            Z3 = Fp.add(Z3, Z3);\n            return new Point(X3, Y3, Z3);\n        }\n        // Renes-Costello-Batina exception-free addition formula.\n        // There is 30% faster Jacobian formula, but it is not complete.\n        // https://eprint.iacr.org/2015/1060, algorithm 1\n        // Cost: 12M + 0S + 3*a + 3*b3 + 23add.\n        add(other) {\n            aprjpoint(other);\n            const { X: X1, Y: Y1, Z: Z1 } = this;\n            const { X: X2, Y: Y2, Z: Z2 } = other;\n            let X3 = Fp.ZERO, Y3 = Fp.ZERO, Z3 = Fp.ZERO; // prettier-ignore\n            const a = CURVE.a;\n            const b3 = Fp.mul(CURVE.b, _3n);\n            let t0 = Fp.mul(X1, X2); // step 1\n            let t1 = Fp.mul(Y1, Y2);\n            let t2 = Fp.mul(Z1, Z2);\n            let t3 = Fp.add(X1, Y1);\n            let t4 = Fp.add(X2, Y2); // step 5\n            t3 = Fp.mul(t3, t4);\n            t4 = Fp.add(t0, t1);\n            t3 = Fp.sub(t3, t4);\n            t4 = Fp.add(X1, Z1);\n            let t5 = Fp.add(X2, Z2); // step 10\n            t4 = Fp.mul(t4, t5);\n            t5 = Fp.add(t0, t2);\n            t4 = Fp.sub(t4, t5);\n            t5 = Fp.add(Y1, Z1);\n            X3 = Fp.add(Y2, Z2); // step 15\n            t5 = Fp.mul(t5, X3);\n            X3 = Fp.add(t1, t2);\n            t5 = Fp.sub(t5, X3);\n            Z3 = Fp.mul(a, t4);\n            X3 = Fp.mul(b3, t2); // step 20\n            Z3 = Fp.add(X3, Z3);\n            X3 = Fp.sub(t1, Z3);\n            Z3 = Fp.add(t1, Z3);\n            Y3 = Fp.mul(X3, Z3);\n            t1 = Fp.add(t0, t0); // step 25\n            t1 = Fp.add(t1, t0);\n            t2 = Fp.mul(a, t2);\n            t4 = Fp.mul(b3, t4);\n            t1 = Fp.add(t1, t2);\n            t2 = Fp.sub(t0, t2); // step 30\n            t2 = Fp.mul(a, t2);\n            t4 = Fp.add(t4, t2);\n            t0 = Fp.mul(t1, t4);\n            Y3 = Fp.add(Y3, t0);\n            t0 = Fp.mul(t5, t4); // step 35\n            X3 = Fp.mul(t3, X3);\n            X3 = Fp.sub(X3, t0);\n            t0 = Fp.mul(t3, t1);\n            Z3 = Fp.mul(t5, Z3);\n            Z3 = Fp.add(Z3, t0); // step 40\n            return new Point(X3, Y3, Z3);\n        }\n        subtract(other) {\n            return this.add(other.negate());\n        }\n        is0() {\n            return this.equals(Point.ZERO);\n        }\n        /**\n         * Constant time multiplication.\n         * Uses wNAF method. Windowed method may be 10% faster,\n         * but takes 2x longer to generate and consumes 2x memory.\n         * Uses precomputes when available.\n         * Uses endomorphism for Koblitz curves.\n         * @param scalar by which the point would be multiplied\n         * @returns New point\n         */\n        multiply(scalar) {\n            const { endo } = extraOpts;\n            if (!Fn.isValidNot0(scalar))\n                throw new Error('invalid scalar: out of range'); // 0 is invalid\n            let point, fake; // Fake point is used to const-time mult\n            const mul = (n) => wnaf.cached(this, n, (p) => normalizeZ(Point, p));\n            /** See docs for {@link EndomorphismOpts} */\n            if (endo) {\n                const { k1neg, k1, k2neg, k2 } = splitEndoScalarN(scalar);\n                const { p: k1p, f: k1f } = mul(k1);\n                const { p: k2p, f: k2f } = mul(k2);\n                fake = k1f.add(k2f);\n                point = finishEndo(endo.beta, k1p, k2p, k1neg, k2neg);\n            }\n            else {\n                const { p, f } = mul(scalar);\n                point = p;\n                fake = f;\n            }\n            // Normalize `z` for both points, but return only real one\n            return normalizeZ(Point, [point, fake])[0];\n        }\n        /**\n         * Non-constant-time multiplication. Uses double-and-add algorithm.\n         * It's faster, but should only be used when you don't care about\n         * an exposed secret key e.g. sig verification, which works over *public* keys.\n         */\n        multiplyUnsafe(sc) {\n            const { endo } = extraOpts;\n            const p = this;\n            if (!Fn.isValid(sc))\n                throw new Error('invalid scalar: out of range'); // 0 is valid\n            if (sc === _0n || p.is0())\n                return Point.ZERO;\n            if (sc === _1n)\n                return p; // fast-path\n            if (wnaf.hasCache(this))\n                return this.multiply(sc);\n            if (endo) {\n                const { k1neg, k1, k2neg, k2 } = splitEndoScalarN(sc);\n                const { p1, p2 } = mulEndoUnsafe(Point, p, k1, k2); // 30% faster vs wnaf.unsafe\n                return finishEndo(endo.beta, p1, p2, k1neg, k2neg);\n            }\n            else {\n                return wnaf.unsafe(p, sc);\n            }\n        }\n        multiplyAndAddUnsafe(Q, a, b) {\n            const sum = this.multiplyUnsafe(a).add(Q.multiplyUnsafe(b));\n            return sum.is0() ? undefined : sum;\n        }\n        /**\n         * Converts Projective point to affine (x, y) coordinates.\n         * @param invertedZ Z^-1 (inverted zero) - optional, precomputation is useful for invertBatch\n         */\n        toAffine(invertedZ) {\n            return toAffineMemo(this, invertedZ);\n        }\n        /**\n         * Checks whether Point is free of torsion elements (is in prime subgroup).\n         * Always torsion-free for cofactor=1 curves.\n         */\n        isTorsionFree() {\n            const { isTorsionFree } = extraOpts;\n            if (cofactor === _1n)\n                return true;\n            if (isTorsionFree)\n                return isTorsionFree(Point, this);\n            return wnaf.unsafe(this, CURVE_ORDER).is0();\n        }\n        clearCofactor() {\n            const { clearCofactor } = extraOpts;\n            if (cofactor === _1n)\n                return this; // Fast-path\n            if (clearCofactor)\n                return clearCofactor(Point, this);\n            return this.multiplyUnsafe(cofactor);\n        }\n        isSmallOrder() {\n            // can we use this.clearCofactor()?\n            return this.multiplyUnsafe(cofactor).is0();\n        }\n        toBytes(isCompressed = true) {\n            abool(isCompressed, 'isCompressed');\n            this.assertValidity();\n            return encodePoint(Point, this, isCompressed);\n        }\n        toHex(isCompressed = true) {\n            return bytesToHex(this.toBytes(isCompressed));\n        }\n        toString() {\n            return `<Point ${this.is0() ? 'ZERO' : this.toHex()}>`;\n        }\n        // TODO: remove\n        get px() {\n            return this.X;\n        }\n        get py() {\n            return this.X;\n        }\n        get pz() {\n            return this.Z;\n        }\n        toRawBytes(isCompressed = true) {\n            return this.toBytes(isCompressed);\n        }\n        _setWindowSize(windowSize) {\n            this.precompute(windowSize);\n        }\n        static normalizeZ(points) {\n            return normalizeZ(Point, points);\n        }\n        static msm(points, scalars) {\n            return pippenger(Point, Fn, points, scalars);\n        }\n        static fromPrivateKey(privateKey) {\n            return Point.BASE.multiply(_normFnElement(Fn, privateKey));\n        }\n    }\n    // base / generator point\n    Point.BASE = new Point(CURVE.Gx, CURVE.Gy, Fp.ONE);\n    // zero / infinity / identity point\n    Point.ZERO = new Point(Fp.ZERO, Fp.ONE, Fp.ZERO); // 0, 1, 0\n    // math field\n    Point.Fp = Fp;\n    // scalar field\n    Point.Fn = Fn;\n    const bits = Fn.BITS;\n    const wnaf = new wNAF(Point, extraOpts.endo ? Math.ceil(bits / 2) : bits);\n    Point.BASE.precompute(8); // Enable precomputes. Slows down first publicKey computation by 20ms.\n    return Point;\n}\n// Points start with byte 0x02 when y is even; otherwise 0x03\nfunction pprefix(hasEvenY) {\n    return Uint8Array.of(hasEvenY ? 0x02 : 0x03);\n}\n/**\n * Implementation of the Shallue and van de Woestijne method for any weierstrass curve.\n * TODO: check if there is a way to merge this with uvRatio in Edwards; move to modular.\n * b = True and y = sqrt(u / v) if (u / v) is square in F, and\n * b = False and y = sqrt(Z * (u / v)) otherwise.\n * @param Fp\n * @param Z\n * @returns\n */\nexport function SWUFpSqrtRatio(Fp, Z) {\n    // Generic implementation\n    const q = Fp.ORDER;\n    let l = _0n;\n    for (let o = q - _1n; o % _2n === _0n; o /= _2n)\n        l += _1n;\n    const c1 = l; // 1. c1, the largest integer such that 2^c1 divides q - 1.\n    // We need 2n ** c1 and 2n ** (c1-1). We can't use **; but we can use <<.\n    // 2n ** c1 == 2n << (c1-1)\n    const _2n_pow_c1_1 = _2n << (c1 - _1n - _1n);\n    const _2n_pow_c1 = _2n_pow_c1_1 * _2n;\n    const c2 = (q - _1n) / _2n_pow_c1; // 2. c2 = (q - 1) / (2^c1)  # Integer arithmetic\n    const c3 = (c2 - _1n) / _2n; // 3. c3 = (c2 - 1) / 2            # Integer arithmetic\n    const c4 = _2n_pow_c1 - _1n; // 4. c4 = 2^c1 - 1                # Integer arithmetic\n    const c5 = _2n_pow_c1_1; // 5. c5 = 2^(c1 - 1)                  # Integer arithmetic\n    const c6 = Fp.pow(Z, c2); // 6. c6 = Z^c2\n    const c7 = Fp.pow(Z, (c2 + _1n) / _2n); // 7. c7 = Z^((c2 + 1) / 2)\n    let sqrtRatio = (u, v) => {\n        let tv1 = c6; // 1. tv1 = c6\n        let tv2 = Fp.pow(v, c4); // 2. tv2 = v^c4\n        let tv3 = Fp.sqr(tv2); // 3. tv3 = tv2^2\n        tv3 = Fp.mul(tv3, v); // 4. tv3 = tv3 * v\n        let tv5 = Fp.mul(u, tv3); // 5. tv5 = u * tv3\n        tv5 = Fp.pow(tv5, c3); // 6. tv5 = tv5^c3\n        tv5 = Fp.mul(tv5, tv2); // 7. tv5 = tv5 * tv2\n        tv2 = Fp.mul(tv5, v); // 8. tv2 = tv5 * v\n        tv3 = Fp.mul(tv5, u); // 9. tv3 = tv5 * u\n        let tv4 = Fp.mul(tv3, tv2); // 10. tv4 = tv3 * tv2\n        tv5 = Fp.pow(tv4, c5); // 11. tv5 = tv4^c5\n        let isQR = Fp.eql(tv5, Fp.ONE); // 12. isQR = tv5 == 1\n        tv2 = Fp.mul(tv3, c7); // 13. tv2 = tv3 * c7\n        tv5 = Fp.mul(tv4, tv1); // 14. tv5 = tv4 * tv1\n        tv3 = Fp.cmov(tv2, tv3, isQR); // 15. tv3 = CMOV(tv2, tv3, isQR)\n        tv4 = Fp.cmov(tv5, tv4, isQR); // 16. tv4 = CMOV(tv5, tv4, isQR)\n        // 17. for i in (c1, c1 - 1, ..., 2):\n        for (let i = c1; i > _1n; i--) {\n            let tv5 = i - _2n; // 18.    tv5 = i - 2\n            tv5 = _2n << (tv5 - _1n); // 19.    tv5 = 2^tv5\n            let tvv5 = Fp.pow(tv4, tv5); // 20.    tv5 = tv4^tv5\n            const e1 = Fp.eql(tvv5, Fp.ONE); // 21.    e1 = tv5 == 1\n            tv2 = Fp.mul(tv3, tv1); // 22.    tv2 = tv3 * tv1\n            tv1 = Fp.mul(tv1, tv1); // 23.    tv1 = tv1 * tv1\n            tvv5 = Fp.mul(tv4, tv1); // 24.    tv5 = tv4 * tv1\n            tv3 = Fp.cmov(tv2, tv3, e1); // 25.    tv3 = CMOV(tv2, tv3, e1)\n            tv4 = Fp.cmov(tvv5, tv4, e1); // 26.    tv4 = CMOV(tv5, tv4, e1)\n        }\n        return { isValid: isQR, value: tv3 };\n    };\n    if (Fp.ORDER % _4n === _3n) {\n        // sqrt_ratio_3mod4(u, v)\n        const c1 = (Fp.ORDER - _3n) / _4n; // 1. c1 = (q - 3) / 4     # Integer arithmetic\n        const c2 = Fp.sqrt(Fp.neg(Z)); // 2. c2 = sqrt(-Z)\n        sqrtRatio = (u, v) => {\n            let tv1 = Fp.sqr(v); // 1. tv1 = v^2\n            const tv2 = Fp.mul(u, v); // 2. tv2 = u * v\n            tv1 = Fp.mul(tv1, tv2); // 3. tv1 = tv1 * tv2\n            let y1 = Fp.pow(tv1, c1); // 4. y1 = tv1^c1\n            y1 = Fp.mul(y1, tv2); // 5. y1 = y1 * tv2\n            const y2 = Fp.mul(y1, c2); // 6. y2 = y1 * c2\n            const tv3 = Fp.mul(Fp.sqr(y1), v); // 7. tv3 = y1^2; 8. tv3 = tv3 * v\n            const isQR = Fp.eql(tv3, u); // 9. isQR = tv3 == u\n            let y = Fp.cmov(y2, y1, isQR); // 10. y = CMOV(y2, y1, isQR)\n            return { isValid: isQR, value: y }; // 11. return (isQR, y) isQR ? y : y*c2\n        };\n    }\n    // No curves uses that\n    // if (Fp.ORDER % _8n === _5n) // sqrt_ratio_5mod8\n    return sqrtRatio;\n}\n/**\n * Simplified Shallue-van de Woestijne-Ulas Method\n * https://www.rfc-editor.org/rfc/rfc9380#section-6.6.2\n */\nexport function mapToCurveSimpleSWU(Fp, opts) {\n    validateField(Fp);\n    const { A, B, Z } = opts;\n    if (!Fp.isValid(A) || !Fp.isValid(B) || !Fp.isValid(Z))\n        throw new Error('mapToCurveSimpleSWU: invalid opts');\n    const sqrtRatio = SWUFpSqrtRatio(Fp, Z);\n    if (!Fp.isOdd)\n        throw new Error('Field does not have .isOdd()');\n    // Input: u, an element of F.\n    // Output: (x, y), a point on E.\n    return (u) => {\n        // prettier-ignore\n        let tv1, tv2, tv3, tv4, tv5, tv6, x, y;\n        tv1 = Fp.sqr(u); // 1.  tv1 = u^2\n        tv1 = Fp.mul(tv1, Z); // 2.  tv1 = Z * tv1\n        tv2 = Fp.sqr(tv1); // 3.  tv2 = tv1^2\n        tv2 = Fp.add(tv2, tv1); // 4.  tv2 = tv2 + tv1\n        tv3 = Fp.add(tv2, Fp.ONE); // 5.  tv3 = tv2 + 1\n        tv3 = Fp.mul(tv3, B); // 6.  tv3 = B * tv3\n        tv4 = Fp.cmov(Z, Fp.neg(tv2), !Fp.eql(tv2, Fp.ZERO)); // 7.  tv4 = CMOV(Z, -tv2, tv2 != 0)\n        tv4 = Fp.mul(tv4, A); // 8.  tv4 = A * tv4\n        tv2 = Fp.sqr(tv3); // 9.  tv2 = tv3^2\n        tv6 = Fp.sqr(tv4); // 10. tv6 = tv4^2\n        tv5 = Fp.mul(tv6, A); // 11. tv5 = A * tv6\n        tv2 = Fp.add(tv2, tv5); // 12. tv2 = tv2 + tv5\n        tv2 = Fp.mul(tv2, tv3); // 13. tv2 = tv2 * tv3\n        tv6 = Fp.mul(tv6, tv4); // 14. tv6 = tv6 * tv4\n        tv5 = Fp.mul(tv6, B); // 15. tv5 = B * tv6\n        tv2 = Fp.add(tv2, tv5); // 16. tv2 = tv2 + tv5\n        x = Fp.mul(tv1, tv3); // 17.   x = tv1 * tv3\n        const { isValid, value } = sqrtRatio(tv2, tv6); // 18. (is_gx1_square, y1) = sqrt_ratio(tv2, tv6)\n        y = Fp.mul(tv1, u); // 19.   y = tv1 * u  -> Z * u^3 * y1\n        y = Fp.mul(y, value); // 20.   y = y * y1\n        x = Fp.cmov(x, tv3, isValid); // 21.   x = CMOV(x, tv3, is_gx1_square)\n        y = Fp.cmov(y, value, isValid); // 22.   y = CMOV(y, y1, is_gx1_square)\n        const e1 = Fp.isOdd(u) === Fp.isOdd(y); // 23.  e1 = sgn0(u) == sgn0(y)\n        y = Fp.cmov(Fp.neg(y), y, e1); // 24.   y = CMOV(-y, y, e1)\n        const tv4_inv = FpInvertBatch(Fp, [tv4], true)[0];\n        x = Fp.mul(x, tv4_inv); // 25.   x = x / tv4\n        return { x, y };\n    };\n}\nfunction getWLengths(Fp, Fn) {\n    return {\n        secretKey: Fn.BYTES,\n        publicKey: 1 + Fp.BYTES,\n        publicKeyUncompressed: 1 + 2 * Fp.BYTES,\n        publicKeyHasPrefix: true,\n        signature: 2 * Fn.BYTES,\n    };\n}\n/**\n * Sometimes users only need getPublicKey, getSharedSecret, and secret key handling.\n * This helper ensures no signature functionality is present. Less code, smaller bundle size.\n */\nexport function ecdh(Point, ecdhOpts = {}) {\n    const { Fn } = Point;\n    const randomBytes_ = ecdhOpts.randomBytes || randomBytesWeb;\n    const lengths = Object.assign(getWLengths(Point.Fp, Fn), { seed: getMinHashLength(Fn.ORDER) });\n    function isValidSecretKey(secretKey) {\n        try {\n            return !!_normFnElement(Fn, secretKey);\n        }\n        catch (error) {\n            return false;\n        }\n    }\n    function isValidPublicKey(publicKey, isCompressed) {\n        const { publicKey: comp, publicKeyUncompressed } = lengths;\n        try {\n            const l = publicKey.length;\n            if (isCompressed === true && l !== comp)\n                return false;\n            if (isCompressed === false && l !== publicKeyUncompressed)\n                return false;\n            return !!Point.fromBytes(publicKey);\n        }\n        catch (error) {\n            return false;\n        }\n    }\n    /**\n     * Produces cryptographically secure secret key from random of size\n     * (groupLen + ceil(groupLen / 2)) with modulo bias being negligible.\n     */\n    function randomSecretKey(seed = randomBytes_(lengths.seed)) {\n        return mapHashToField(abytes(seed, lengths.seed, 'seed'), Fn.ORDER);\n    }\n    /**\n     * Computes public key for a secret key. Checks for validity of the secret key.\n     * @param isCompressed whether to return compact (default), or full key\n     * @returns Public key, full when isCompressed=false; short when isCompressed=true\n     */\n    function getPublicKey(secretKey, isCompressed = true) {\n        return Point.BASE.multiply(_normFnElement(Fn, secretKey)).toBytes(isCompressed);\n    }\n    function keygen(seed) {\n        const secretKey = randomSecretKey(seed);\n        return { secretKey, publicKey: getPublicKey(secretKey) };\n    }\n    /**\n     * Quick and dirty check for item being public key. Does not validate hex, or being on-curve.\n     */\n    function isProbPub(item) {\n        if (typeof item === 'bigint')\n            return false;\n        if (item instanceof Point)\n            return true;\n        const { secretKey, publicKey, publicKeyUncompressed } = lengths;\n        if (Fn.allowedLengths || secretKey === publicKey)\n            return undefined;\n        const l = ensureBytes('key', item).length;\n        return l === publicKey || l === publicKeyUncompressed;\n    }\n    /**\n     * ECDH (Elliptic Curve Diffie Hellman).\n     * Computes shared public key from secret key A and public key B.\n     * Checks: 1) secret key validity 2) shared key is on-curve.\n     * Does NOT hash the result.\n     * @param isCompressed whether to return compact (default), or full key\n     * @returns shared public key\n     */\n    function getSharedSecret(secretKeyA, publicKeyB, isCompressed = true) {\n        if (isProbPub(secretKeyA) === true)\n            throw new Error('first arg must be private key');\n        if (isProbPub(publicKeyB) === false)\n            throw new Error('second arg must be public key');\n        const s = _normFnElement(Fn, secretKeyA);\n        const b = Point.fromHex(publicKeyB); // checks for being on-curve\n        return b.multiply(s).toBytes(isCompressed);\n    }\n    const utils = {\n        isValidSecretKey,\n        isValidPublicKey,\n        randomSecretKey,\n        // TODO: remove\n        isValidPrivateKey: isValidSecretKey,\n        randomPrivateKey: randomSecretKey,\n        normPrivateKeyToScalar: (key) => _normFnElement(Fn, key),\n        precompute(windowSize = 8, point = Point.BASE) {\n            return point.precompute(windowSize, false);\n        },\n    };\n    return Object.freeze({ getPublicKey, getSharedSecret, keygen, Point, utils, lengths });\n}\n/**\n * Creates ECDSA signing interface for given elliptic curve `Point` and `hash` function.\n * We need `hash` for 2 features:\n * 1. Message prehash-ing. NOT used if `sign` / `verify` are called with `prehash: false`\n * 2. k generation in `sign`, using HMAC-drbg(hash)\n *\n * ECDSAOpts are only rarely needed.\n *\n * @example\n * ```js\n * const p256_Point = weierstrass(...);\n * const p256_sha256 = ecdsa(p256_Point, sha256);\n * const p256_sha224 = ecdsa(p256_Point, sha224);\n * const p256_sha224_r = ecdsa(p256_Point, sha224, { randomBytes: (length) => { ... } });\n * ```\n */\nexport function ecdsa(Point, hash, ecdsaOpts = {}) {\n    ahash(hash);\n    _validateObject(ecdsaOpts, {}, {\n        hmac: 'function',\n        lowS: 'boolean',\n        randomBytes: 'function',\n        bits2int: 'function',\n        bits2int_modN: 'function',\n    });\n    const randomBytes = ecdsaOpts.randomBytes || randomBytesWeb;\n    const hmac = ecdsaOpts.hmac ||\n        ((key, ...msgs) => nobleHmac(hash, key, concatBytes(...msgs)));\n    const { Fp, Fn } = Point;\n    const { ORDER: CURVE_ORDER, BITS: fnBits } = Fn;\n    const { keygen, getPublicKey, getSharedSecret, utils, lengths } = ecdh(Point, ecdsaOpts);\n    const defaultSigOpts = {\n        prehash: false,\n        lowS: typeof ecdsaOpts.lowS === 'boolean' ? ecdsaOpts.lowS : false,\n        format: undefined, //'compact' as ECDSASigFormat,\n        extraEntropy: false,\n    };\n    const defaultSigOpts_format = 'compact';\n    function isBiggerThanHalfOrder(number) {\n        const HALF = CURVE_ORDER >> _1n;\n        return number > HALF;\n    }\n    function validateRS(title, num) {\n        if (!Fn.isValidNot0(num))\n            throw new Error(`invalid signature ${title}: out of range 1..Point.Fn.ORDER`);\n        return num;\n    }\n    function validateSigLength(bytes, format) {\n        validateSigFormat(format);\n        const size = lengths.signature;\n        const sizer = format === 'compact' ? size : format === 'recovered' ? size + 1 : undefined;\n        return abytes(bytes, sizer, `${format} signature`);\n    }\n    /**\n     * ECDSA signature with its (r, s) properties. Supports compact, recovered & DER representations.\n     */\n    class Signature {\n        constructor(r, s, recovery) {\n            this.r = validateRS('r', r); // r in [1..N-1];\n            this.s = validateRS('s', s); // s in [1..N-1];\n            if (recovery != null)\n                this.recovery = recovery;\n            Object.freeze(this);\n        }\n        static fromBytes(bytes, format = defaultSigOpts_format) {\n            validateSigLength(bytes, format);\n            let recid;\n            if (format === 'der') {\n                const { r, s } = DER.toSig(abytes(bytes));\n                return new Signature(r, s);\n            }\n            if (format === 'recovered') {\n                recid = bytes[0];\n                format = 'compact';\n                bytes = bytes.subarray(1);\n            }\n            const L = Fn.BYTES;\n            const r = bytes.subarray(0, L);\n            const s = bytes.subarray(L, L * 2);\n            return new Signature(Fn.fromBytes(r), Fn.fromBytes(s), recid);\n        }\n        static fromHex(hex, format) {\n            return this.fromBytes(hexToBytes(hex), format);\n        }\n        addRecoveryBit(recovery) {\n            return new Signature(this.r, this.s, recovery);\n        }\n        recoverPublicKey(messageHash) {\n            const FIELD_ORDER = Fp.ORDER;\n            const { r, s, recovery: rec } = this;\n            if (rec == null || ![0, 1, 2, 3].includes(rec))\n                throw new Error('recovery id invalid');\n            // ECDSA recovery is hard for cofactor > 1 curves.\n            // In sign, `r = q.x mod n`, and here we recover q.x from r.\n            // While recovering q.x >= n, we need to add r+n for cofactor=1 curves.\n            // However, for cofactor>1, r+n may not get q.x:\n            // r+n*i would need to be done instead where i is unknown.\n            // To easily get i, we either need to:\n            // a. increase amount of valid recid values (4, 5...); OR\n            // b. prohibit non-prime-order signatures (recid > 1).\n            const hasCofactor = CURVE_ORDER * _2n < FIELD_ORDER;\n            if (hasCofactor && rec > 1)\n                throw new Error('recovery id is ambiguous for h>1 curve');\n            const radj = rec === 2 || rec === 3 ? r + CURVE_ORDER : r;\n            if (!Fp.isValid(radj))\n                throw new Error('recovery id 2 or 3 invalid');\n            const x = Fp.toBytes(radj);\n            const R = Point.fromBytes(concatBytes(pprefix((rec & 1) === 0), x));\n            const ir = Fn.inv(radj); // r^-1\n            const h = bits2int_modN(ensureBytes('msgHash', messageHash)); // Truncate hash\n            const u1 = Fn.create(-h * ir); // -hr^-1\n            const u2 = Fn.create(s * ir); // sr^-1\n            // (sr^-1)R-(hr^-1)G = -(hr^-1)G + (sr^-1). unsafe is fine: there is no private data.\n            const Q = Point.BASE.multiplyUnsafe(u1).add(R.multiplyUnsafe(u2));\n            if (Q.is0())\n                throw new Error('point at infinify');\n            Q.assertValidity();\n            return Q;\n        }\n        // Signatures should be low-s, to prevent malleability.\n        hasHighS() {\n            return isBiggerThanHalfOrder(this.s);\n        }\n        toBytes(format = defaultSigOpts_format) {\n            validateSigFormat(format);\n            if (format === 'der')\n                return hexToBytes(DER.hexFromSig(this));\n            const r = Fn.toBytes(this.r);\n            const s = Fn.toBytes(this.s);\n            if (format === 'recovered') {\n                if (this.recovery == null)\n                    throw new Error('recovery bit must be present');\n                return concatBytes(Uint8Array.of(this.recovery), r, s);\n            }\n            return concatBytes(r, s);\n        }\n        toHex(format) {\n            return bytesToHex(this.toBytes(format));\n        }\n        // TODO: remove\n        assertValidity() { }\n        static fromCompact(hex) {\n            return Signature.fromBytes(ensureBytes('sig', hex), 'compact');\n        }\n        static fromDER(hex) {\n            return Signature.fromBytes(ensureBytes('sig', hex), 'der');\n        }\n        normalizeS() {\n            return this.hasHighS() ? new Signature(this.r, Fn.neg(this.s), this.recovery) : this;\n        }\n        toDERRawBytes() {\n            return this.toBytes('der');\n        }\n        toDERHex() {\n            return bytesToHex(this.toBytes('der'));\n        }\n        toCompactRawBytes() {\n            return this.toBytes('compact');\n        }\n        toCompactHex() {\n            return bytesToHex(this.toBytes('compact'));\n        }\n    }\n    // RFC6979: ensure ECDSA msg is X bytes and < N. RFC suggests optional truncating via bits2octets.\n    // FIPS 186-4 4.6 suggests the leftmost min(nBitLen, outLen) bits, which matches bits2int.\n    // bits2int can produce res>N, we can do mod(res, N) since the bitLen is the same.\n    // int2octets can't be used; pads small msgs with 0: unacceptatble for trunc as per RFC vectors\n    const bits2int = ecdsaOpts.bits2int ||\n        function bits2int_def(bytes) {\n            // Our custom check \"just in case\", for protection against DoS\n            if (bytes.length > 8192)\n                throw new Error('input is too large');\n            // For curves with nBitLength % 8 !== 0: bits2octets(bits2octets(m)) !== bits2octets(m)\n            // for some cases, since bytes.length * 8 is not actual bitLength.\n            const num = bytesToNumberBE(bytes); // check for == u8 done here\n            const delta = bytes.length * 8 - fnBits; // truncate to nBitLength leftmost bits\n            return delta > 0 ? num >> BigInt(delta) : num;\n        };\n    const bits2int_modN = ecdsaOpts.bits2int_modN ||\n        function bits2int_modN_def(bytes) {\n            return Fn.create(bits2int(bytes)); // can't use bytesToNumberBE here\n        };\n    // Pads output with zero as per spec\n    const ORDER_MASK = bitMask(fnBits);\n    /** Converts to bytes. Checks if num in `[0..ORDER_MASK-1]` e.g.: `[0..2^256-1]`. */\n    function int2octets(num) {\n        // IMPORTANT: the check ensures working for case `Fn.BYTES != Fn.BITS * 8`\n        aInRange('num < 2^' + fnBits, num, _0n, ORDER_MASK);\n        return Fn.toBytes(num);\n    }\n    function validateMsgAndHash(message, prehash) {\n        abytes(message, undefined, 'message');\n        return prehash ? abytes(hash(message), undefined, 'prehashed message') : message;\n    }\n    /**\n     * Steps A, D of RFC6979 3.2.\n     * Creates RFC6979 seed; converts msg/privKey to numbers.\n     * Used only in sign, not in verify.\n     *\n     * Warning: we cannot assume here that message has same amount of bytes as curve order,\n     * this will be invalid at least for P521. Also it can be bigger for P224 + SHA256.\n     */\n    function prepSig(message, privateKey, opts) {\n        if (['recovered', 'canonical'].some((k) => k in opts))\n            throw new Error('sign() legacy options not supported');\n        const { lowS, prehash, extraEntropy } = validateSigOpts(opts, defaultSigOpts);\n        message = validateMsgAndHash(message, prehash); // RFC6979 3.2 A: h1 = H(m)\n        // We can't later call bits2octets, since nested bits2int is broken for curves\n        // with fnBits % 8 !== 0. Because of that, we unwrap it here as int2octets call.\n        // const bits2octets = (bits) => int2octets(bits2int_modN(bits))\n        const h1int = bits2int_modN(message);\n        const d = _normFnElement(Fn, privateKey); // validate secret key, convert to bigint\n        const seedArgs = [int2octets(d), int2octets(h1int)];\n        // extraEntropy. RFC6979 3.6: additional k' (optional).\n        if (extraEntropy != null && extraEntropy !== false) {\n            // K = HMAC_K(V || 0x00 || int2octets(x) || bits2octets(h1) || k')\n            // gen random bytes OR pass as-is\n            const e = extraEntropy === true ? randomBytes(lengths.secretKey) : extraEntropy;\n            seedArgs.push(ensureBytes('extraEntropy', e)); // check for being bytes\n        }\n        const seed = concatBytes(...seedArgs); // Step D of RFC6979 3.2\n        const m = h1int; // NOTE: no need to call bits2int second time here, it is inside truncateHash!\n        // Converts signature params into point w r/s, checks result for validity.\n        // To transform k => Signature:\n        // q = kG\n        // r = q.x mod n\n        // s = k^-1(m + rd) mod n\n        // Can use scalar blinding b^-1(bm + bdr) where b  [1,q1] according to\n        // https://tches.iacr.org/index.php/TCHES/article/view/7337/6509. We've decided against it:\n        // a) dependency on CSPRNG b) 15% slowdown c) doesn't really help since bigints are not CT\n        function k2sig(kBytes) {\n            // RFC 6979 Section 3.2, step 3: k = bits2int(T)\n            // Important: all mod() calls here must be done over N\n            const k = bits2int(kBytes); // mod n, not mod p\n            if (!Fn.isValidNot0(k))\n                return; // Valid scalars (including k) must be in 1..N-1\n            const ik = Fn.inv(k); // k^-1 mod n\n            const q = Point.BASE.multiply(k).toAffine(); // q = kG\n            const r = Fn.create(q.x); // r = q.x mod n\n            if (r === _0n)\n                return;\n            const s = Fn.create(ik * Fn.create(m + r * d)); // Not using blinding here, see comment above\n            if (s === _0n)\n                return;\n            let recovery = (q.x === r ? 0 : 2) | Number(q.y & _1n); // recovery bit (2 or 3, when q.x > n)\n            let normS = s;\n            if (lowS && isBiggerThanHalfOrder(s)) {\n                normS = Fn.neg(s); // if lowS was passed, ensure s is always\n                recovery ^= 1; // // in the bottom half of N\n            }\n            return new Signature(r, normS, recovery); // use normS, not s\n        }\n        return { seed, k2sig };\n    }\n    /**\n     * Signs message hash with a secret key.\n     *\n     * ```\n     * sign(m, d) where\n     *   k = rfc6979_hmac_drbg(m, d)\n     *   (x, y) = G  k\n     *   r = x mod n\n     *   s = (m + dr) / k mod n\n     * ```\n     */\n    function sign(message, secretKey, opts = {}) {\n        message = ensureBytes('message', message);\n        const { seed, k2sig } = prepSig(message, secretKey, opts); // Steps A, D of RFC6979 3.2.\n        const drbg = createHmacDrbg(hash.outputLen, Fn.BYTES, hmac);\n        const sig = drbg(seed, k2sig); // Steps B, C, D, E, F, G\n        return sig;\n    }\n    function tryParsingSig(sg) {\n        // Try to deduce format\n        let sig = undefined;\n        const isHex = typeof sg === 'string' || isBytes(sg);\n        const isObj = !isHex &&\n            sg !== null &&\n            typeof sg === 'object' &&\n            typeof sg.r === 'bigint' &&\n            typeof sg.s === 'bigint';\n        if (!isHex && !isObj)\n            throw new Error('invalid signature, expected Uint8Array, hex string or Signature instance');\n        if (isObj) {\n            sig = new Signature(sg.r, sg.s);\n        }\n        else if (isHex) {\n            try {\n                sig = Signature.fromBytes(ensureBytes('sig', sg), 'der');\n            }\n            catch (derError) {\n                if (!(derError instanceof DER.Err))\n                    throw derError;\n            }\n            if (!sig) {\n                try {\n                    sig = Signature.fromBytes(ensureBytes('sig', sg), 'compact');\n                }\n                catch (error) {\n                    return false;\n                }\n            }\n        }\n        if (!sig)\n            return false;\n        return sig;\n    }\n    /**\n     * Verifies a signature against message and public key.\n     * Rejects lowS signatures by default: see {@link ECDSAVerifyOpts}.\n     * Implements section 4.1.4 from https://www.secg.org/sec1-v2.pdf:\n     *\n     * ```\n     * verify(r, s, h, P) where\n     *   u1 = hs^-1 mod n\n     *   u2 = rs^-1 mod n\n     *   R = u1G + u2P\n     *   mod(R.x, n) == r\n     * ```\n     */\n    function verify(signature, message, publicKey, opts = {}) {\n        const { lowS, prehash, format } = validateSigOpts(opts, defaultSigOpts);\n        publicKey = ensureBytes('publicKey', publicKey);\n        message = validateMsgAndHash(ensureBytes('message', message), prehash);\n        if ('strict' in opts)\n            throw new Error('options.strict was renamed to lowS');\n        const sig = format === undefined\n            ? tryParsingSig(signature)\n            : Signature.fromBytes(ensureBytes('sig', signature), format);\n        if (sig === false)\n            return false;\n        try {\n            const P = Point.fromBytes(publicKey);\n            if (lowS && sig.hasHighS())\n                return false;\n            const { r, s } = sig;\n            const h = bits2int_modN(message); // mod n, not mod p\n            const is = Fn.inv(s); // s^-1 mod n\n            const u1 = Fn.create(h * is); // u1 = hs^-1 mod n\n            const u2 = Fn.create(r * is); // u2 = rs^-1 mod n\n            const R = Point.BASE.multiplyUnsafe(u1).add(P.multiplyUnsafe(u2)); // u1G + u2P\n            if (R.is0())\n                return false;\n            const v = Fn.create(R.x); // v = r.x mod n\n            return v === r;\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    function recoverPublicKey(signature, message, opts = {}) {\n        const { prehash } = validateSigOpts(opts, defaultSigOpts);\n        message = validateMsgAndHash(message, prehash);\n        return Signature.fromBytes(signature, 'recovered').recoverPublicKey(message).toBytes();\n    }\n    return Object.freeze({\n        keygen,\n        getPublicKey,\n        getSharedSecret,\n        utils,\n        lengths,\n        Point,\n        sign,\n        verify,\n        recoverPublicKey,\n        Signature,\n        hash,\n    });\n}\n/** @deprecated use `weierstrass` in newer releases */\nexport function weierstrassPoints(c) {\n    const { CURVE, curveOpts } = _weierstrass_legacy_opts_to_new(c);\n    const Point = weierstrassN(CURVE, curveOpts);\n    return _weierstrass_new_output_to_legacy(c, Point);\n}\nfunction _weierstrass_legacy_opts_to_new(c) {\n    const CURVE = {\n        a: c.a,\n        b: c.b,\n        p: c.Fp.ORDER,\n        n: c.n,\n        h: c.h,\n        Gx: c.Gx,\n        Gy: c.Gy,\n    };\n    const Fp = c.Fp;\n    let allowedLengths = c.allowedPrivateKeyLengths\n        ? Array.from(new Set(c.allowedPrivateKeyLengths.map((l) => Math.ceil(l / 2))))\n        : undefined;\n    const Fn = Field(CURVE.n, {\n        BITS: c.nBitLength,\n        allowedLengths: allowedLengths,\n        modFromBytes: c.wrapPrivateKey,\n    });\n    const curveOpts = {\n        Fp,\n        Fn,\n        allowInfinityPoint: c.allowInfinityPoint,\n        endo: c.endo,\n        isTorsionFree: c.isTorsionFree,\n        clearCofactor: c.clearCofactor,\n        fromBytes: c.fromBytes,\n        toBytes: c.toBytes,\n    };\n    return { CURVE, curveOpts };\n}\nfunction _ecdsa_legacy_opts_to_new(c) {\n    const { CURVE, curveOpts } = _weierstrass_legacy_opts_to_new(c);\n    const ecdsaOpts = {\n        hmac: c.hmac,\n        randomBytes: c.randomBytes,\n        lowS: c.lowS,\n        bits2int: c.bits2int,\n        bits2int_modN: c.bits2int_modN,\n    };\n    return { CURVE, curveOpts, hash: c.hash, ecdsaOpts };\n}\nexport function _legacyHelperEquat(Fp, a, b) {\n    /**\n     * y = x + ax + b: Short weierstrass curve formula. Takes x, returns y.\n     * @returns y\n     */\n    function weierstrassEquation(x) {\n        const x2 = Fp.sqr(x); // x * x\n        const x3 = Fp.mul(x2, x); // x * x\n        return Fp.add(Fp.add(x3, Fp.mul(x, a)), b); // x + a * x + b\n    }\n    return weierstrassEquation;\n}\nfunction _weierstrass_new_output_to_legacy(c, Point) {\n    const { Fp, Fn } = Point;\n    function isWithinCurveOrder(num) {\n        return inRange(num, _1n, Fn.ORDER);\n    }\n    const weierstrassEquation = _legacyHelperEquat(Fp, c.a, c.b);\n    return Object.assign({}, {\n        CURVE: c,\n        Point: Point,\n        ProjectivePoint: Point,\n        normPrivateKeyToScalar: (key) => _normFnElement(Fn, key),\n        weierstrassEquation,\n        isWithinCurveOrder,\n    });\n}\nfunction _ecdsa_new_output_to_legacy(c, _ecdsa) {\n    const Point = _ecdsa.Point;\n    return Object.assign({}, _ecdsa, {\n        ProjectivePoint: Point,\n        CURVE: Object.assign({}, c, nLength(Point.Fn.ORDER, Point.Fn.BITS)),\n    });\n}\n// _ecdsa_legacy\nexport function weierstrass(c) {\n    const { CURVE, curveOpts, hash, ecdsaOpts } = _ecdsa_legacy_opts_to_new(c);\n    const Point = weierstrassN(CURVE, curveOpts);\n    const signs = ecdsa(Point, hash, ecdsaOpts);\n    return _ecdsa_new_output_to_legacy(c, signs);\n}\n//# sourceMappingURL=weierstrass.js.map","/**\n * SECG secp256k1. See [pdf](https://www.secg.org/sec2-v2.pdf).\n *\n * Belongs to Koblitz curves: it has efficiently-computable GLV endomorphism ,\n * check out {@link EndomorphismOpts}. Seems to be rigid (not backdoored).\n * @module\n */\n/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */\nimport { sha256 } from '@noble/hashes/sha2.js';\nimport { randomBytes } from '@noble/hashes/utils.js';\nimport { createCurve } from \"./_shortw_utils.js\";\nimport { createHasher, isogenyMap, } from \"./abstract/hash-to-curve.js\";\nimport { Field, mapHashToField, mod, pow2 } from \"./abstract/modular.js\";\nimport { _normFnElement, mapToCurveSimpleSWU, } from \"./abstract/weierstrass.js\";\nimport { bytesToNumberBE, concatBytes, ensureBytes, inRange, numberToBytesBE, utf8ToBytes, } from \"./utils.js\";\n// Seems like generator was produced from some seed:\n// `Point.BASE.multiply(Point.Fn.inv(2n, N)).toAffine().x`\n// // gives short x 0x3b78ce563f89a0ed9414f5aa28ad0d96d6795f9c63n\nconst secp256k1_CURVE = {\n    p: BigInt('0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f'),\n    n: BigInt('0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141'),\n    h: BigInt(1),\n    a: BigInt(0),\n    b: BigInt(7),\n    Gx: BigInt('0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798'),\n    Gy: BigInt('0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8'),\n};\nconst secp256k1_ENDO = {\n    beta: BigInt('0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee'),\n    basises: [\n        [BigInt('0x3086d221a7d46bcde86c90e49284eb15'), -BigInt('0xe4437ed6010e88286f547fa90abfe4c3')],\n        [BigInt('0x114ca50f7a8e2f3f657c1108d9d44cfd8'), BigInt('0x3086d221a7d46bcde86c90e49284eb15')],\n    ],\n};\nconst _0n = /* @__PURE__ */ BigInt(0);\nconst _1n = /* @__PURE__ */ BigInt(1);\nconst _2n = /* @__PURE__ */ BigInt(2);\n/**\n * n = n^((p+1)/4) for fields p = 3 mod 4. We unwrap the loop and multiply bit-by-bit.\n * (P+1n/4n).toString(2) would produce bits [223x 1, 0, 22x 1, 4x 0, 11, 00]\n */\nfunction sqrtMod(y) {\n    const P = secp256k1_CURVE.p;\n    // prettier-ignore\n    const _3n = BigInt(3), _6n = BigInt(6), _11n = BigInt(11), _22n = BigInt(22);\n    // prettier-ignore\n    const _23n = BigInt(23), _44n = BigInt(44), _88n = BigInt(88);\n    const b2 = (y * y * y) % P; // x^3, 11\n    const b3 = (b2 * b2 * y) % P; // x^7\n    const b6 = (pow2(b3, _3n, P) * b3) % P;\n    const b9 = (pow2(b6, _3n, P) * b3) % P;\n    const b11 = (pow2(b9, _2n, P) * b2) % P;\n    const b22 = (pow2(b11, _11n, P) * b11) % P;\n    const b44 = (pow2(b22, _22n, P) * b22) % P;\n    const b88 = (pow2(b44, _44n, P) * b44) % P;\n    const b176 = (pow2(b88, _88n, P) * b88) % P;\n    const b220 = (pow2(b176, _44n, P) * b44) % P;\n    const b223 = (pow2(b220, _3n, P) * b3) % P;\n    const t1 = (pow2(b223, _23n, P) * b22) % P;\n    const t2 = (pow2(t1, _6n, P) * b2) % P;\n    const root = pow2(t2, _2n, P);\n    if (!Fpk1.eql(Fpk1.sqr(root), y))\n        throw new Error('Cannot find square root');\n    return root;\n}\nconst Fpk1 = Field(secp256k1_CURVE.p, { sqrt: sqrtMod });\n/**\n * secp256k1 curve, ECDSA and ECDH methods.\n *\n * Field: `2n**256n - 2n**32n - 2n**9n - 2n**8n - 2n**7n - 2n**6n - 2n**4n - 1n`\n *\n * @example\n * ```js\n * import { secp256k1 } from '@noble/curves/secp256k1';\n * const { secretKey, publicKey } = secp256k1.keygen();\n * const msg = new TextEncoder().encode('hello');\n * const sig = secp256k1.sign(msg, secretKey);\n * const isValid = secp256k1.verify(sig, msg, publicKey) === true;\n * ```\n */\nexport const secp256k1 = createCurve({ ...secp256k1_CURVE, Fp: Fpk1, lowS: true, endo: secp256k1_ENDO }, sha256);\n// Schnorr signatures are superior to ECDSA from above. Below is Schnorr-specific BIP0340 code.\n// https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki\n/** An object mapping tags to their tagged hash prefix of [SHA256(tag) | SHA256(tag)] */\nconst TAGGED_HASH_PREFIXES = {};\nfunction taggedHash(tag, ...messages) {\n    let tagP = TAGGED_HASH_PREFIXES[tag];\n    if (tagP === undefined) {\n        const tagH = sha256(utf8ToBytes(tag));\n        tagP = concatBytes(tagH, tagH);\n        TAGGED_HASH_PREFIXES[tag] = tagP;\n    }\n    return sha256(concatBytes(tagP, ...messages));\n}\n// ECDSA compact points are 33-byte. Schnorr is 32: we strip first byte 0x02 or 0x03\nconst pointToBytes = (point) => point.toBytes(true).slice(1);\nconst Pointk1 = /* @__PURE__ */ (() => secp256k1.Point)();\nconst hasEven = (y) => y % _2n === _0n;\n// Calculate point, scalar and bytes\nfunction schnorrGetExtPubKey(priv) {\n    const { Fn, BASE } = Pointk1;\n    const d_ = _normFnElement(Fn, priv);\n    const p = BASE.multiply(d_); // P = d'G; 0 < d' < n check is done inside\n    const scalar = hasEven(p.y) ? d_ : Fn.neg(d_);\n    return { scalar, bytes: pointToBytes(p) };\n}\n/**\n * lift_x from BIP340. Convert 32-byte x coordinate to elliptic curve point.\n * @returns valid point checked for being on-curve\n */\nfunction lift_x(x) {\n    const Fp = Fpk1;\n    if (!Fp.isValidNot0(x))\n        throw new Error('invalid x: Fail if x  p');\n    const xx = Fp.create(x * x);\n    const c = Fp.create(xx * x + BigInt(7)); // Let c = x + 7 mod p.\n    let y = Fp.sqrt(c); // Let y = c^(p+1)/4 mod p. Same as sqrt().\n    // Return the unique point P such that x(P) = x and\n    // y(P) = y if y mod 2 = 0 or y(P) = p-y otherwise.\n    if (!hasEven(y))\n        y = Fp.neg(y);\n    const p = Pointk1.fromAffine({ x, y });\n    p.assertValidity();\n    return p;\n}\nconst num = bytesToNumberBE;\n/**\n * Create tagged hash, convert it to bigint, reduce modulo-n.\n */\nfunction challenge(...args) {\n    return Pointk1.Fn.create(num(taggedHash('BIP0340/challenge', ...args)));\n}\n/**\n * Schnorr public key is just `x` coordinate of Point as per BIP340.\n */\nfunction schnorrGetPublicKey(secretKey) {\n    return schnorrGetExtPubKey(secretKey).bytes; // d'=int(sk). Fail if d'=0 or d'n. Ret bytes(d'G)\n}\n/**\n * Creates Schnorr signature as per BIP340. Verifies itself before returning anything.\n * auxRand is optional and is not the sole source of k generation: bad CSPRNG won't be dangerous.\n */\nfunction schnorrSign(message, secretKey, auxRand = randomBytes(32)) {\n    const { Fn } = Pointk1;\n    const m = ensureBytes('message', message);\n    const { bytes: px, scalar: d } = schnorrGetExtPubKey(secretKey); // checks for isWithinCurveOrder\n    const a = ensureBytes('auxRand', auxRand, 32); // Auxiliary random data a: a 32-byte array\n    const t = Fn.toBytes(d ^ num(taggedHash('BIP0340/aux', a))); // Let t be the byte-wise xor of bytes(d) and hash/aux(a)\n    const rand = taggedHash('BIP0340/nonce', t, px, m); // Let rand = hash/nonce(t || bytes(P) || m)\n    // Let k' = int(rand) mod n. Fail if k' = 0. Let R = k'G\n    const { bytes: rx, scalar: k } = schnorrGetExtPubKey(rand);\n    const e = challenge(rx, px, m); // Let e = int(hash/challenge(bytes(R) || bytes(P) || m)) mod n.\n    const sig = new Uint8Array(64); // Let sig = bytes(R) || bytes((k + ed) mod n).\n    sig.set(rx, 0);\n    sig.set(Fn.toBytes(Fn.create(k + e * d)), 32);\n    // If Verify(bytes(P), m, sig) (see below) returns failure, abort\n    if (!schnorrVerify(sig, m, px))\n        throw new Error('sign: Invalid signature produced');\n    return sig;\n}\n/**\n * Verifies Schnorr signature.\n * Will swallow errors & return false except for initial type validation of arguments.\n */\nfunction schnorrVerify(signature, message, publicKey) {\n    const { Fn, BASE } = Pointk1;\n    const sig = ensureBytes('signature', signature, 64);\n    const m = ensureBytes('message', message);\n    const pub = ensureBytes('publicKey', publicKey, 32);\n    try {\n        const P = lift_x(num(pub)); // P = lift_x(int(pk)); fail if that fails\n        const r = num(sig.subarray(0, 32)); // Let r = int(sig[0:32]); fail if r  p.\n        if (!inRange(r, _1n, secp256k1_CURVE.p))\n            return false;\n        const s = num(sig.subarray(32, 64)); // Let s = int(sig[32:64]); fail if s  n.\n        if (!inRange(s, _1n, secp256k1_CURVE.n))\n            return false;\n        // int(challenge(bytes(r)||bytes(P)||m))%n\n        const e = challenge(Fn.toBytes(r), pointToBytes(P), m);\n        // R = sG - eP, where -eP == (n-e)P\n        const R = BASE.multiplyUnsafe(s).add(P.multiplyUnsafe(Fn.neg(e)));\n        const { x, y } = R.toAffine();\n        // Fail if is_infinite(R) / not has_even_y(R) / x(R)  r.\n        if (R.is0() || !hasEven(y) || x !== r)\n            return false;\n        return true;\n    }\n    catch (error) {\n        return false;\n    }\n}\n/**\n * Schnorr signatures over secp256k1.\n * https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki\n * @example\n * ```js\n * import { schnorr } from '@noble/curves/secp256k1';\n * const { secretKey, publicKey } = schnorr.keygen();\n * // const publicKey = schnorr.getPublicKey(secretKey);\n * const msg = new TextEncoder().encode('hello');\n * const sig = schnorr.sign(msg, secretKey);\n * const isValid = schnorr.verify(sig, msg, publicKey);\n * ```\n */\nexport const schnorr = /* @__PURE__ */ (() => {\n    const size = 32;\n    const seedLength = 48;\n    const randomSecretKey = (seed = randomBytes(seedLength)) => {\n        return mapHashToField(seed, secp256k1_CURVE.n);\n    };\n    // TODO: remove\n    secp256k1.utils.randomSecretKey;\n    function keygen(seed) {\n        const secretKey = randomSecretKey(seed);\n        return { secretKey, publicKey: schnorrGetPublicKey(secretKey) };\n    }\n    return {\n        keygen,\n        getPublicKey: schnorrGetPublicKey,\n        sign: schnorrSign,\n        verify: schnorrVerify,\n        Point: Pointk1,\n        utils: {\n            randomSecretKey: randomSecretKey,\n            randomPrivateKey: randomSecretKey,\n            taggedHash,\n            // TODO: remove\n            lift_x,\n            pointToBytes,\n            numberToBytesBE,\n            bytesToNumberBE,\n            mod,\n        },\n        lengths: {\n            secretKey: size,\n            publicKey: size,\n            publicKeyHasPrefix: false,\n            signature: size * 2,\n            seed: seedLength,\n        },\n    };\n})();\nconst isoMap = /* @__PURE__ */ (() => isogenyMap(Fpk1, [\n    // xNum\n    [\n        '0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7',\n        '0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581',\n        '0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262',\n        '0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c',\n    ],\n    // xDen\n    [\n        '0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b',\n        '0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14',\n        '0x0000000000000000000000000000000000000000000000000000000000000001', // LAST 1\n    ],\n    // yNum\n    [\n        '0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c',\n        '0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3',\n        '0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931',\n        '0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84',\n    ],\n    // yDen\n    [\n        '0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b',\n        '0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573',\n        '0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f',\n        '0x0000000000000000000000000000000000000000000000000000000000000001', // LAST 1\n    ],\n].map((i) => i.map((j) => BigInt(j)))))();\nconst mapSWU = /* @__PURE__ */ (() => mapToCurveSimpleSWU(Fpk1, {\n    A: BigInt('0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533'),\n    B: BigInt('1771'),\n    Z: Fpk1.create(BigInt('-11')),\n}))();\n/** Hashing / encoding to secp256k1 points / field. RFC 9380 methods. */\nexport const secp256k1_hasher = /* @__PURE__ */ (() => createHasher(secp256k1.Point, (scalars) => {\n    const { x, y } = mapSWU(Fpk1.create(scalars[0]));\n    return isoMap(x, y);\n}, {\n    DST: 'secp256k1_XMD:SHA-256_SSWU_RO_',\n    encodeDST: 'secp256k1_XMD:SHA-256_SSWU_NU_',\n    p: Fpk1.ORDER,\n    m: 1,\n    k: 128,\n    expand: 'xmd',\n    hash: sha256,\n}))();\n/** @deprecated use `import { secp256k1_hasher } from '@noble/curves/secp256k1.js';` */\nexport const hashToCurve = /* @__PURE__ */ (() => secp256k1_hasher.hashToCurve)();\n/** @deprecated use `import { secp256k1_hasher } from '@noble/curves/secp256k1.js';` */\nexport const encodeToCurve = /* @__PURE__ */ (() => secp256k1_hasher.encodeToCurve)();\n//# sourceMappingURL=secp256k1.js.map","/**\n * Utilities for short weierstrass curves, combined with noble-hashes.\n * @module\n */\n/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */\nimport { weierstrass } from \"./abstract/weierstrass.js\";\n/** connects noble-curves to noble-hashes */\nexport function getHash(hash) {\n    return { hash };\n}\n/** @deprecated use new `weierstrass()` and `ecdsa()` methods */\nexport function createCurve(curveDef, defHash) {\n    const create = (hash) => weierstrass({ ...curveDef, hash: hash });\n    return { ...create(defHash), create };\n}\n//# sourceMappingURL=_shortw_utils.js.map","/**\n * SHA2-256 a.k.a. sha256. In JS, it is the fastest hash, even faster than Blake3.\n *\n * To break sha256 using birthday attack, attackers need to try 2^128 hashes.\n * BTC network is doing 2^70 hashes/sec (2^95 hashes/year) as per 2025.\n *\n * Check out [FIPS 180-4](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf).\n * @module\n * @deprecated\n */\nimport { SHA224 as SHA224n, sha224 as sha224n, SHA256 as SHA256n, sha256 as sha256n, } from \"./sha2.js\";\n/** @deprecated Use import from `noble/hashes/sha2` module */\nexport const SHA256 = SHA256n;\n/** @deprecated Use import from `noble/hashes/sha2` module */\nexport const sha256 = sha256n;\n/** @deprecated Use import from `noble/hashes/sha2` module */\nexport const SHA224 = SHA224n;\n/** @deprecated Use import from `noble/hashes/sha2` module */\nexport const sha224 = sha224n;\n//# sourceMappingURL=sha256.js.map","import { schnorr } from '@noble/curves/secp256k1'\r\nimport { bytesToHex } from '@noble/hashes/utils'\r\nimport { sha256 } from '@noble/hashes/sha256'\r\n\r\n// import {utf8Encoder} from './utils'\r\n// import { getPublicKey } from './keys'\r\n\r\nexport const utf8Decoder = new TextDecoder('utf-8')\r\nexport const utf8Encoder = new TextEncoder()\r\n\r\nexport const SEC = 'https://w3id.org/security#' // Proof, VerificationMethod\r\n// export const CERT = 'http://www.w3.org/ns/auth/cert#' // PrivateKey, PublicKey, key\r\n\r\n/* export enum Kind {\r\n  Metadata = 0,\r\n  Text = 1,\r\n  RecommendRelay = 2,\r\n  Contacts = 3,\r\n  EncryptedDirectMessage = 4,\r\n  EventDeletion = 5,\r\n  Reaction = 7,\r\n  BadgeAward = 8,\r\n  ChannelCreation = 40,\r\n  ChannelMetadata = 41,\r\n  ChannelMessage = 42,\r\n  ChannelHideMessage = 43,\r\n  ChannelMuteUser = 44,\r\n  Report = 1984,\r\n  ZapRequest = 9734,\r\n  Zap = 9735,\r\n  RelayList = 10002,\r\n  ClientAuth = 22242,\r\n  BadgeDefinition = 30008,\r\n  ProfileBadge = 30009,\r\n  Article = 30023\r\n} */\r\n\r\nexport type MsgTemplate = {\r\n  id: string\r\n  created: string\r\n  dateDeleted: string\r\n  content: string\r\n  maker: string\r\n  sig: string\r\n}\r\n\r\nexport type UnsignedMsg = MsgTemplate & {\r\n  pubkey: string\r\n}\r\n\r\nexport type Message = UnsignedMsg & {\r\n  id: string\r\n  sig: string\r\n}\r\n\r\nexport function getBlankMsg (): MsgTemplate {\r\n  return {\r\n    id: '',\r\n    created: '',\r\n    dateDeleted: '', // TODO to remove if not used\r\n    content: '',\r\n    maker: '',\r\n    sig: '' // TODO to remove if not used\r\n  }\r\n}\r\n\r\n/* export function finishMsg (t: MsgTemplate, privateKey: string): Message {\r\n  // to update to chat message triples\r\n  const message = t as Message\r\n  // message.pubkey = getPublicKey(privateKey)\r\n  message.id = getMsgHash(message)\r\n  message.sig = signMsg(message, privateKey)\r\n  return message\r\n} */\r\n\r\nexport function serializeMsg (msg: UnsignedMsg): string {\r\n  // to update to chat messages triples\r\n  /* if (!validateMsg(msg))\r\n    throw new Error(\"can't serialize message with wrong or missing properties\") */\r\n\r\n  return JSON.stringify(msg)\r\n}\r\n\r\nexport function getMsgHash (message: UnsignedMsg) {\r\n  const msgHash = sha256(utf8Encoder.encode(serializeMsg(message)))\r\n  return bytesToHex(msgHash)\r\n}\r\n\r\n// const isRecord = (obj: unknown): obj is Record<string, unknown> => obj instanceof Object\r\n\r\n/* export function validateMsg<T> (message: T): message is T & UnsignedMsg {\r\n  if (!isRecord(message)) return false\r\n  if (typeof message.kind !== 'number') return false\r\n  if (typeof message.content !== 'string') return false\r\n  if (typeof message.created_at !== 'number') return false\r\n  if (typeof message.pubkey !== 'string') return false\r\n  if (!message.pubkey.match(/^[a-f0-9]{64}$/)) return false\r\n\r\n  if (!Array.isArray(message.tags)) return false\r\n  for (let i = 0; i < message.tags.length; i++) {\r\n    let tag = message.tags[i]\r\n    if (!Array.isArray(tag)) return false\r\n    for (let j = 0; j < tag.length; j++) {\r\n      if (typeof tag[j] === 'object') return false\r\n    }\r\n  }\r\n\r\n  return true\r\n} */\r\n\r\nexport function verifySignature (sig: string, message: Message, pubKey: string): boolean {\r\n  return schnorr.verify(\r\n    sig,\r\n    getMsgHash(message),\r\n    pubKey\r\n  )\r\n}\r\n\r\nexport function signMsg (message: UnsignedMsg, key: string): string {\r\n  return bytesToHex(\r\n    schnorr.sign(getMsgHash(message), key)\r\n  )\r\n}\r\n","import { store } from 'solid-logic'\nimport ns from '../../ns'\nimport { NamedNode } from 'rdflib'\n// Will rename this file later. We will probably be using solid-logic anyway\n// moved it out so I can mock\n\nexport const getRootIfPreferencesExist = (webId: NamedNode) => {\n  let root = store.any(webId, ns.space('preferencesFile'), null, webId.doc())?.value\n  root = root?.split('/').slice(0, -2).join('/')\n  if (!root) throw new Error(`prefererencesFile is expected to exist in ${webId}`)\n  return root\n}\n","import * as debug from '../../debug'\nimport { store } from 'solid-logic'\nimport ns from '../../ns'\nimport { NamedNode } from 'rdflib'\nimport { getRootIfPreferencesExist } from './otherHelpers'\n\nexport const pubKeyUrl = (webId: NamedNode) => {\n  let url\n  try {\n    const root = getRootIfPreferencesExist(webId)\n    url = `${root}/profile/keys/publicKey.ttl`\n  } catch (err) {\n    debug.error(err)\n  }\n  return url\n}\n\nexport const privKeyUrl = (webId: NamedNode) => {\n  let url\n  try {\n    const root = getRootIfPreferencesExist(webId)\n    url = `${root}/settings/keys/privateKey.ttl`\n  } catch (err) {\n    debug.error(err)\n  }\n  return url\n}\n\nexport async function getExistingPublicKey (webId: NamedNode, publicKeyUrl: string) {\n  // find publickey\n  return await getKeyIfExists(webId, publicKeyUrl, 'publicKey')\n}\n\nexport async function getExistingPrivateKey (webId: NamedNode, privateKeyUrl: string) {\n  // find privateKey\n  return await getKeyIfExists(webId, privateKeyUrl, 'privateKey')\n}\n\ntype KeyType = 'publicKey' | 'privateKey'\n\nexport async function getKeyIfExists (webId: NamedNode, keyUrl: string, keyType: KeyType) {\n  try {\n    await store.fetcher.load(keyUrl)\n    const key = store.any(webId, ns.solid(keyType)) // store.sym(CERT + keyType))\n    return key?.value // as NamedNode\n  } catch (err) {\n    if (err.response.status === 404) {\n      debug.log(\n        'createIfNotExists: doc does NOT exist, will create... ' + keyUrl\n      )\n      try {\n        await store.fetcher.webOperation('PUT', keyUrl, {\n          data: '',\n          contentType: 'text/turtle'\n        })\n      } catch (err) {\n        debug.log('createIfNotExists doc FAILED: ' + keyUrl + ': ' + err)\n        throw err\n      }\n      delete store.fetcher.requested[keyUrl] // delete cached 404 error\n      // debug.log('createIfNotExists doc created ok ' + doc)\n      return undefined // response\n    } else {\n      debug.log('createIfNotExists doc FAILED: ' + keyUrl + ': ' + err)\n      throw err\n    }\n  }\n}\n","import * as debug from '../../debug'\nimport { store } from 'solid-logic'\n\n/**\n * set ACL\n * @param keyDoc\n * @param aclBody\n */\nexport async function setAcl (keyDoc: string, aclBody: string) {\n  // Some servers don't present a Link http response header\n  // if the container doesn't exist yet, refetch the resource\n\n  await store.fetcher.load(keyDoc)\n\n  // FIXME: check the Why value on this quad:\n  // debug.log(store.statementsMatching(store.sym(keyDoc), store.sym('http://www.iana.org/assignments/link-relations/acl')))\n  const keyAclDoc = store.any(store.sym(keyDoc), store.sym('http://www.iana.org/assignments/link-relations/acl'))\n  if (!keyAclDoc) {\n    throw new Error('Key ACL doc not found!')\n  }\n\n  try {\n    await store.fetcher.webOperation('PUT', keyAclDoc.value, {\n      data: aclBody,\n      contentType: 'text/turtle'\n    })\n  } catch (err) {\n    if (err?.response?.status !== 404) { throw new Error(err) }\n    debug.log('delete ' + keyAclDoc.value + ' ' + err.response.status) // should test 404 and 2xx\n  }\n}\n\n/**\n * key container ACL\n * @param me\n * @returns aclBody\n */\nexport const keyContainerAclBody = (me: string) => {\n  const aclBody = `\n@prefix : <#>.\n@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix key: <./>.\n\n:ReadWrite\n    a acl:Authorization;\n    acl:accessTo key:;\n    acl:default key:;\n    acl:agent <${me}>;\n    acl:mode acl:Read, acl:Write.\n`\n  return aclBody\n}\n\n/**\n * Read only ACL\n * @param keyDoc\n * @param me\n * @returns aclBody\n */\nexport const keyAclBody = (keyDoc, me) => {\n  let keyAgent = 'acl:agentClass foaf:Agent' // publicKey\n  if (me?.length) keyAgent = `acl:agent <${me}>` // privateKey\n  const aclBody = `\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n<#Read>\n    a acl:Authorization;\n    ${keyAgent};\n    acl:accessTo <${keyDoc.split('/').pop()}>;\n    acl:mode acl:Read.\n`\n  return aclBody\n}\n","import * as debug from '../debug'\r\nimport { schnorr } from '@noble/curves/secp256k1'\r\nimport { bytesToHex } from '@noble/hashes/utils'\r\nimport ns from '../ns'\r\nimport { store } from 'solid-logic'\r\nimport { NamedNode } from 'rdflib'\r\nimport * as $rdf from 'rdflib'\r\nimport { getExistingPublicKey, pubKeyUrl, privKeyUrl, getExistingPrivateKey } from '../utils/keyHelpers/accessData'\r\nimport { setAcl, keyContainerAclBody, keyAclBody } from '../utils/keyHelpers/acl'\r\n\r\nexport function generatePrivateKey (): string {\r\n  return bytesToHex(schnorr.utils.randomPrivateKey())\r\n}\r\n\r\nexport function generatePublicKey (privateKey: string): string {\r\n  return bytesToHex(schnorr.getPublicKey(privateKey))\r\n}\r\n\r\n/**\r\n * getPublicKey\r\n * used for displaying messages in chat, therefore does not\r\n * create a new key if not found\r\n * @param webId\r\n * @returns string | undefined\r\n */\r\nexport async function getPublicKey (webId: NamedNode) {\r\n  await store.fetcher.load(webId)\r\n  const publicKeyDoc = await pubKeyUrl(webId)\r\n  try {\r\n    await store.fetcher.load(publicKeyDoc) // url.href)\r\n    const key = store.any(webId, ns.solid('publicKey'))\r\n    return key?.value // as NamedNode\r\n  } catch (_err) {\r\n    return undefined\r\n  }\r\n}\r\n\r\nexport async function getPrivateKey (webId: NamedNode) {\r\n  await store.fetcher.load(webId)\r\n  // find keys url's\r\n  const publicKeyDoc = await pubKeyUrl(webId)\r\n  const privateKeyDoc = await privKeyUrl(webId)\r\n\r\n  // find key pair\r\n  const publicKey = await getExistingPublicKey(webId, publicKeyDoc)\r\n  let privateKey = await getExistingPrivateKey(webId, privateKeyDoc)\r\n\r\n  // is publicKey valid ?\r\n  let validPublicKey = true\r\n  if (privateKey && (publicKey !== generatePublicKey(privateKey as string))) {\r\n    if (confirm('This is strange the publicKey is not valid for\\n' + webId?.uri +\r\n     '\\'shall we repair keeping the private key ?')) validPublicKey = false\r\n  }\r\n\r\n  // create key pair or repair publicKey\r\n  if (!privateKey || !publicKey || !validPublicKey) {\r\n    let del: any[] = []\r\n    let add: any[] = []\r\n\r\n    if (!privateKey) {\r\n      // add = []\r\n      privateKey = generatePrivateKey()\r\n      add = [$rdf.st(webId, ns.solid('privateKey'), $rdf.literal(privateKey), store.sym(privateKeyDoc))]\r\n      await saveKey(privateKeyDoc, [], add, webId.uri)\r\n    }\r\n    if (!publicKey || !validPublicKey) {\r\n      del = []\r\n      // delete invalid public key\r\n      if (publicKey) {\r\n        del = [$rdf.st(webId, ns.solid('publicKey'), $rdf.lit(publicKey), store.sym(publicKeyDoc))]\r\n        debug.log('delete invalid publicKey ' + del)\r\n      }\r\n      // update new valid key\r\n      const newPublicKey = generatePublicKey(privateKey)\r\n      add = [$rdf.st(webId, ns.solid('publicKey'), $rdf.literal(newPublicKey), store.sym(publicKeyDoc))]\r\n      await saveKey(publicKeyDoc, del, add)\r\n    }\r\n    const keyContainer = privateKeyDoc.substring(0, privateKeyDoc.lastIndexOf('/') + 1)\r\n    await setAcl(keyContainer, keyContainerAclBody(webId.uri)) // includes DELETE and PUT\r\n  }\r\n  return privateKey as string\r\n}\r\n\r\nconst deleteKeyAcl = async (keyDoc: string) => {\r\n  await store.fetcher.load(keyDoc)\r\n\r\n  const keyAclDoc = store.any(store.sym(keyDoc), store.sym('http://www.iana.org/assignments/link-relations/acl'))\r\n  if (keyAclDoc) {\r\n    // delete READ only keyAclDoc. This is possible if the webId is an owner\r\n    try {\r\n      const response = await store.fetcher.webOperation('DELETE', keyAclDoc.value) // this may fail if webId is not an owner\r\n      debug.log('delete keyAcl' + keyAclDoc.value + ' ' + response.status) // should test 404 and 2xx\r\n    } catch (err) {\r\n      if (err.response.status !== 404) { throw new Error(err) }\r\n      debug.log('delete keyAcl' + keyAclDoc.value + ' ' + err.response.status) // should test 404 and 2xx\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * delete acl if keydoc exists\r\n * create/edit keyDoc\r\n * set keyDoc acl\r\n */\r\nasync function saveKey (keyDoc: string, del, add, me: string = '') {\r\n  await deleteKeyAcl(keyDoc)\r\n  // save key\r\n  await store.updater.updateMany(del, add) // or a promise store.updater.update ?\r\n\r\n  // create READ only ACL\r\n  const aclBody = keyAclBody(keyDoc, me)\r\n  await setAcl(keyDoc, aclBody)\r\n}\r\n","/**\n * Contains the [[ChatChannel]] class and logic for Solid Chat\n * @packageDocumentation\n */\n\nimport * as debug from '../debug'\nimport { DateFolder } from './dateFolder'\nimport { store, authn } from 'solid-logic'\nimport ns from '../ns'\nimport * as $rdf from 'rdflib' // pull in first avoid cross-refs\nimport * as utils from '../utils'\nimport { getBlankMsg, signMsg, SEC } from './signature'\nimport { getPrivateKey } from './keys'\n\n/* The Solid logic for a 'LongChat'\n*/\n/**\n * Common code for a chat (discussion area of messages about something)\n * This version runs over a series of files for different time periods\n *\n * Parameters for the whole chat like its title are stored on\n * index.ttl#this and the chats messages are stored in YYYY/MM/DD/chat.ttl\n *\n */\n\nexport class ChatChannel {\n  constructor (channel, options) {\n    this.channel = channel\n    this.channelRoot = channel.doc()\n    this.options = options\n    this.dateFolder = new DateFolder(this.channelRoot, 'chat.ttl')\n    this.div = null // : HTMLElement\n  }\n\n  /* Store a new message in the web,\n  */\n  async createMessage (text) {\n    return this.updateMessage(text)\n  }\n\n  /* Store a new message in the web,\n    as a replacement for an existing one.\n    The old one iis left, and the two are linked\n  */\n  async updateMessage (text, oldMsg = null, deleteIt, thread = null) {\n    const sts = []\n    const now = new Date()\n    const timestamp = '' + now.getTime()\n    const dateStamp = $rdf.term(now)\n    const chatDocument = oldMsg ? oldMsg.doc() : this.dateFolder.leafDocumentFromDate(now)\n    const message = store.sym(chatDocument.uri + '#' + 'Msg' + timestamp)\n    // const content = store.literal(text)\n\n    const me = authn.currentUser() // If already logged on\n\n    const msg = getBlankMsg()\n    msg.id = message.uri\n    if (oldMsg) { // edit message replaces old one\n      const oldMsgMaker = store.any(oldMsg, ns.foaf('maker')) // may not be needed here, but needed on READ\n      if (oldMsgMaker.uri === me.uri) {\n        const oldMsgMostRecentVersion = await mostRecentVersion(oldMsg)\n        sts.push($rdf.st(oldMsgMostRecentVersion, ns.dct('isReplacedBy'), message, chatDocument))\n        // if oldMsg has_reply => add has_reply to message\n        const oldMsgThread = store.any(oldMsgMostRecentVersion, ns.sioc('has_reply'))\n        if (oldMsgThread) {\n          sts.push($rdf.st(message, ns.sioc('has_reply'), oldMsgThread, chatDocument))\n        }\n        if (deleteIt) { // we need to add a specific signature, else anyone can delete a msg ?\n          sts.push($rdf.st(message, ns.schema('dateDeleted'), dateStamp, chatDocument))\n        }\n      } else {\n        const errMsg = 'Error you cannot delete/edit a message from someone else : \\n' + oldMsgMaker.uri\n        debug.warn(errMsg)\n        alert(errMsg)\n        throw new Error(errMsg)\n      }\n    } else { // link new message to channel\n      sts.push($rdf.st(this.channel, ns.wf('message'), message, chatDocument))\n    }\n    sts.push(\n      $rdf.st(message, ns.sioc('content'), store.literal(text), chatDocument)\n    )\n    msg.content = text\n\n    sts.push(\n      $rdf.st(message, ns.dct('created'), dateStamp, chatDocument)\n    )\n    msg.created = dateStamp.value\n    if (me) {\n      sts.push($rdf.st(message, ns.foaf('maker'), me, chatDocument))\n      msg.maker = me.uri\n      // privateKey the cached private key of me, cached in store\n      const privateKey = await getPrivateKey(me) // me.uri)\n\n      const sig = signMsg(msg, privateKey)\n      sts.push($rdf.st(message, $rdf.sym(`${SEC}proofValue`), $rdf.lit(sig), chatDocument))\n    }\n    if (thread) {\n      sts.push($rdf.st(thread, ns.sioc('has_member'), message, chatDocument))\n      if (!thread.doc().sameTerm(message.doc())) {\n        sts.push($rdf.st(thread, ns.sioc('has_member'), message, thread.doc()))\n      }\n    }\n\n    try {\n      await store.updater.updateMany([], sts)\n    } catch (err) {\n      const errMsg = 'Error saving chat message: ' + err\n      debug.warn(errMsg)\n      alert(errMsg)\n      throw new Error(errMsg)\n    }\n    return message\n  }\n\n  /* Mark a message as deleted\n  * Wee add a new version of the message,m witha deletion flag (deletion date)\n  * so that the deletion can be revoked by adding another non-deleted update\n  */\n  async deleteMessage (message) {\n    return this.updateMessage('(message deleted)', message, true)\n  }\n\n  // Create a new thread of replies to the thread root message\n  //  or return one which already exists\n\n  async createThread (threadRoot) {\n    const already = store.each(threadRoot, ns.sioc('has_reply'), null, threadRoot.doc())\n      .filter(thread => store.holds(thread, ns.rdf('type'), ns.sioc('Thread'), thread.doc()))\n    if (already.length > 0) return already[0]\n\n    const thread = $rdf.sym(threadRoot.uri + '-thread')\n    const insert = [\n      $rdf.st(thread, ns.rdf('type'), ns.sioc('Thread'), thread.doc()),\n      $rdf.st(threadRoot, ns.sioc('has_reply'), thread, thread.doc())\n    ]\n    await store.updater.update([], insert)\n    return thread\n  }\n} // class ChatChannel\n\n// ////////// Utility functions\n\n// Have to not loop forever if fed loops\nexport async function allVersions (message) {\n  const versions = [message]\n  const done = {}\n  done[message.uri] = true\n  let m = message\n  while (true) { // earlier?\n    const prev = store.any(null, ns.dct('isReplacedBy'), m, m.doc())\n    if (!prev || done[prev.uri]) break\n    await store.fetcher.load(prev)\n    versions.unshift(prev)\n    done[prev.uri] = true\n    m = prev\n  }\n  m = message\n  while (true) { // later?\n    const next = store.any(m, ns.dct('isReplacedBy'), null, m.doc())\n    if (!next || done[next.uri]) break\n    versions.push(next)\n    done[next.uri] = true\n    m = next\n  }\n  return versions\n}\n\nexport async function originalVersion (message) {\n  let msg = message\n  const done = {}\n  // done[message.uri] = true\n  while (msg) {\n    if (done[msg.uri]) {\n      debug.error('originalVersion: verion loop' + message)\n      return message\n    }\n    done[msg.uri] = true\n    message = msg\n    await store.fetcher.load(message)\n    msg = store.any(null, ns.dct('isReplacedBy'), message, message.doc())\n  }\n  return message\n}\n\nexport async function mostRecentVersion (message) {\n  let msg = message\n  const done = {}\n  while (msg) {\n    if (done[msg.uri]) {\n      debug.error('mostRecentVersion: verion loop' + message)\n      return message\n    }\n    done[msg.uri] = true\n    message = msg\n    await store.fetcher.load(message)\n    msg = store.any(message, ns.dct('isReplacedBy'), null, message.doc())\n  }\n  return message\n}\n\nexport function isDeleted (message) {\n  return store.holds(message, ns.schema('dateDeleted'), null, message.doc())\n}\n\nexport function isReplaced (message) {\n  return store.holds(message, ns.dct('isReplacedBy'), null, message.doc())\n}\n\nexport function isHidden (message) {\n  return this.isDeleted(message) || this.isReplaced(message)\n}\n\n// A Nickname for a person\n\nexport function nick (person) {\n  const s = store.any(person, ns.foaf('nick'))\n  if (s) return '' + s.value\n  return '' + utils.label(person)\n}\n// ends\n","/* Manage a UI for the participation of a person in any thing\n*/\n\n// import { currentUser } from './authn/authn'\nimport * as debug from './debug'\nimport { LiveStore, NamedNode, st, UpdateManager } from 'rdflib'\nimport ns from './ns'\nimport { personTR, newThing, errorMessageBlock } from './widgets'\nimport { syncTableToArray } from './utils'\nimport { lightColorHash } from './pad'\nimport { log } from './debug'\nimport { style } from './style'\nimport styleConstants from './styleConstants'\nimport { solidLogicSingleton, authn } from 'solid-logic'\n\ntype ParticipationOptions = {\n  deleteFunction?: () => {}\n  link?: string\n  draggable?: boolean\n}\n\nclass ParticipationTableElement extends HTMLTableElement {\n  refresh?: () => void\n}\nconst store = solidLogicSingleton.store as LiveStore\n\n/**  Manage participation in this session\n*\n*  @param {Document} dom - the web page loaded into the browser\n*  @param {HTMLTableElement} table - the table element\n*  @param {NamedNode} unused1/document - the document to render (this argument is no longer used, but left in for backwards compatibility)\n*  @param {NamedNode} subject - the thing in which the participation is happening\n*  @param {NamedNode} unused2/me - user that is logged into the pod (this argument is no longer used, but left in for backwards compatibility)\n*  @param {ParticipationOptions} options - the options that can be passed in are deleteFunction, link, and draggable; these are used by the personTR button\n*/\nexport function renderParticipants (dom: HTMLDocument, table: ParticipationTableElement, unused1: NamedNode, subject: NamedNode, unused2: NamedNode, options: ParticipationOptions) {\n  table.setAttribute('style', style.participantsStyle)\n\n  const newRowForParticipation = function (parp) {\n    const person = store.any(parp, ns.wf('participant'))\n\n    let tr\n    if (!person) {\n      tr = dom.createElement('tr')\n      tr.textContent = '???' // Don't crash - invalid part'n entry\n      return tr\n    }\n    const bg = store.anyValue(parp, ns.ui('backgroundColor')) || styleConstants.participationDefaultBackground\n\n    const block = dom.createElement('div')\n    block.setAttribute(\n      'style', style.participantsBlock)\n    block.style.backgroundColor = bg\n\n    tr = personTR(dom, null, person, options)\n    table.appendChild(tr)\n    const td = dom.createElement('td')\n    td.setAttribute('style', style.personTableTD)\n    td.appendChild(block)\n    tr.insertBefore(td, tr.firstChild)\n    return tr\n  }\n\n  const syncTable = function () {\n    const parps = store.each(subject, ns.wf('participation')).map(function (parp) {\n      log('in participants')\n      return [store.anyValue(parp as any, ns.cal('dtstart')) || '9999-12-31', parp]\n    })\n    parps.sort() // List in order of joining\n    const participations = parps.map(function (p) {\n      return p[1]\n    })\n    syncTableToArray(table, participations, newRowForParticipation)\n  }\n  table.refresh = syncTable\n  syncTable()\n  return table\n}\n\n/** Record, or find old, Participation object\n *\n * A participation object is a place to record things specifically about\n * subject and the user, such as preferences, start of membership, etc\n * @param {NamedNode} subject - the thing in which the participation is happening\n * @param {NamedNode} document -  where to record the data\n * @param {NamedNode} me - the logged in user\n *\n */\nexport function participationObject (subject: NamedNode, padDoc: NamedNode, me: NamedNode) {\n  return new Promise(function (resolve, reject) {\n    if (!me) {\n      throw new Error('No user id')\n    }\n\n    const parps = store.each(subject, ns.wf('participation')).filter(function (pn) {\n      return store.holds(pn, ns.wf('participant'), me)\n    })\n    if (parps.length > 1) { // This can happen. https://github.com/solidos/chat-pane/issues/71\n      const candidates: (string | NamedNode) [][] = []\n      for (const participation of parps) {\n        const date = store.anyValue(participation as NamedNode, ns.cal('dtstart'))\n        if (date) {\n          candidates.push([date, participation as NamedNode])\n        }\n      }\n      candidates.sort() // Pick the earliest\n      // @@ Possibly, for extra credit, delete the others, if we have write access\n      debug.warn('Multiple participation objects, picking earliest, in ' + padDoc)\n      resolve(candidates[0][1])\n      // throw new Error('Multiple records of your participation')\n    }\n    if (parps.length) {\n      // If I am not already recorded\n      resolve(parps[0]) // returns the participation object\n    } else {\n      const participation = newThing(padDoc)\n      const ins = [\n        st(subject, ns.wf('participation'), participation, padDoc),\n\n        st(participation, ns.wf('participant'), me, padDoc),\n        st(participation, ns.cal('dtstart'), new Date() as any, padDoc),\n        st(\n          participation,\n          ns.ui('backgroundColor'),\n          lightColorHash(me) as any,\n          padDoc\n        )\n      ];\n      (store.updater as UpdateManager).update([], ins, function (uri: string | null | undefined, ok: boolean, errorMessage?: string) {\n        if (!ok) {\n          reject(new Error('Error recording your participation: ' + errorMessage))\n        } else {\n          resolve(participation)\n        }\n      })\n      resolve(participation)\n    }\n  })\n}\n\n/** Record my participation and display participants\n *\n * @param {NamedNode} subject - the thing in which participation is happening\n * @param {NamedNode} padDoc - the document into which the participation should be recorded\n * @param {DOMNode} refreshable - a DOM element whose refresh() is to be called if the change works\n *\n */\nexport function recordParticipation (subject: NamedNode, padDoc: NamedNode, refreshable: any) {\n  const me = authn.currentUser()\n  if (!me) return // Not logged in\n\n  const parps = store.each(subject, ns.wf('participation')).filter(function (pn) {\n    return store.holds(pn, ns.wf('participant'), me)\n  })\n  if (parps.length > 1) {\n    throw new Error('Multiple records of your participation')\n  }\n  if (parps.length) {\n    // If I am not already recorded\n    return parps[0] // returns the participation object\n  } else {\n    if (!(store.updater as UpdateManager).editable(padDoc)) {\n      debug.log('Not recording participation, as no write access as ' + me + ' to ' + padDoc)\n      return null\n    }\n    const participation = newThing(padDoc)\n    const ins = [\n      st(subject, ns.wf('participation'), participation, padDoc),\n\n      st(participation, ns.wf('participant'), me, padDoc),\n      st(participation, ns.cal('dtstart'), new Date() as any, padDoc),\n      st(\n        participation,\n        ns.ui('backgroundColor'),\n        lightColorHash(me) as any,\n        padDoc\n      )\n    ];\n    (store.updater as UpdateManager).update([], ins, function (uri: string | null | undefined, ok: boolean, errorMessage?: string) {\n      if (!ok) {\n        throw new Error('Error recording your participation: ' + errorMessage)\n      }\n      if (refreshable && refreshable.refresh) {\n        refreshable.refresh()\n      }\n    })\n    return participation\n  }\n}\n\n/**  Record my participation and display participants\n*\n*   @param {Document} dom  - the web page loaded into the browser\n*   @param {HTMLDivElement} container - the container element where the participants should be displayed\n*   @param {NamedNode} document - the document into which the participation should be shown\n*   @param {NamedNode} subject - the thing in which participation is happening\n*   @param {NamedNode} me - the logged in user\n*   @param {ParticipationOptions} options - the options that can be passed in are deleteFunction, link, and draggable; these are used by the personTR button\n*\n*/\nexport function manageParticipation (\n  dom: Document,\n  container: HTMLDivElement,\n  padDoc: NamedNode,\n  subject: NamedNode,\n  me: NamedNode,\n  options: ParticipationOptions\n) {\n  const table = dom.createElement('table')\n  container.appendChild(table)\n  renderParticipants(dom, table, padDoc, subject, me, options)\n  try {\n    recordParticipation(subject, padDoc, table)\n  } catch (e) {\n    container.appendChild(\n      errorMessageBlock(\n        dom,\n        'Error recording your participation: ' + e\n      )\n    ) // Clean up?\n  }\n  return table\n}\n","/** **************\n *   Notepad Widget\n */\n\n/** @module pad\n */\nimport ns from './ns'\nimport { Namespace, NamedNode, st, IndexedFormula } from 'rdflib'\nimport { newThing, errorMessageBlock } from './widgets'\nimport { beep } from './utils'\nimport { log } from './debug'\nimport { solidLogicSingleton } from 'solid-logic'\nimport { style } from './style'\nexport { renderParticipants, participationObject, manageParticipation, recordParticipation } from './participation'\n\nconst store = solidLogicSingleton.store\n\nconst PAD = Namespace('http://www.w3.org/ns/pim/pad#')\n\ntype notepadOptions = {\n  statusArea?: HTMLDivElement\n  exists?: boolean\n}\n/**\n * @ignore\n */\nclass NotepadElement extends HTMLElement {\n  subject?: NamedNode\n}\n/**\n * @ignore\n */\nclass NotepadPart extends HTMLElement {\n  subject?: NamedNode | string\n  value?: string\n  state?: Number\n  lastSent?: String\n}\n/** Figure out a random color from my webid\n *\n * @param {NamedNode} author - The author of text being displayed\n * @returns {String} The CSS color generated, constrained to be light for a background color\n */\nexport function lightColorHash (author?: NamedNode): string {\n  const hash = function (x) {\n    return x.split('').reduce(function (a, b) {\n      a = (a << 5) - a + b.charCodeAt(0)\n      return a & a\n    }, 0)\n  }\n  return author && author.uri\n    ? '#' + ((hash(author.uri) & 0xffffff) | 0xc0c0c0).toString(16)\n    : '#ffffff' // c0c0c0  forces pale\n} // no id -> white\n\n/**  notepad\n *\n * @param {HTMLDocument} dom - the web page of the browser\n * @param {NamedNode} padDoc - the document in which the participation should be shown\n * @param {NamedNode} subject - the thing in which participation is happening\n * @param {NamedNode} me - person who is logged into the pod\n * @param {notepadOptions} options - the options that can be passed in consist of statusArea, exists\n */\nexport function notepad (dom: HTMLDocument, padDoc: NamedNode, subject: NamedNode, me: NamedNode, options?: notepadOptions) {\n  options = options || {}\n  const exists = options.exists\n  const table: any = dom.createElement('table')\n  const kb = store\n\n  if (me && !me.uri) throw new Error('UI.pad.notepad:  Invalid userid')\n\n  const updater = store.updater\n\n  const PAD = Namespace('http://www.w3.org/ns/pim/pad#')\n\n  table.setAttribute('style', style.notepadStyle)\n\n  let upstreamStatus: HTMLElement | null = null\n  let downstreamStatus: HTMLElement | null = null\n\n  if (options.statusArea) {\n    const t = options.statusArea.appendChild(dom.createElement('table'))\n    const tr = t.appendChild(dom.createElement('tr'))\n    upstreamStatus = tr.appendChild(dom.createElement('td'))\n    downstreamStatus = tr.appendChild(dom.createElement('td'))\n\n    if (upstreamStatus) {\n      upstreamStatus.setAttribute('style', style.upstreamStatus)\n    }\n    if (downstreamStatus) {\n      downstreamStatus.setAttribute('style', style.downstreamStatus)\n    }\n  }\n  /* @@ TODO want to look into this, it seems upstream should be a boolean and default to false ?\n  *\n  */\n  const complain = function (message: string, upstream: boolean = false) {\n    log(message)\n    if ((options as notepadOptions).statusArea) {\n      ; (upstream ? upstreamStatus as HTMLElement : downstreamStatus as HTMLElement).appendChild(errorMessageBlock(dom, message, 'pink'))\n    }\n  }\n  // @@ TODO need to refactor so that we don't have to type cast\n  const clearStatus = function (_upsteam?: any) {\n    if ((options as notepadOptions).statusArea) {\n      ((options as notepadOptions).statusArea as HTMLElement).innerHTML = ''\n    }\n  }\n\n  const setPartStyle = function (part: NotepadPart, colors?: string, pending?: any) {\n    const chunk = part.subject\n    colors = colors || ''\n    const baseStyle = style.baseStyle\n    const headingCore = style.headingCore\n    const headingStyle = style.headingStyle\n\n    const author = kb.any(chunk as any, ns.dc('author'))\n    if (!colors && author) {\n      // Hash the user webid for now -- later allow user selection!\n      const bgcolor = lightColorHash(author as any)\n      colors =\n        'color: ' +\n        (pending ? '#888' : 'black') +\n        '; background-color: ' +\n        bgcolor +\n        ';'\n    }\n\n    // @@ TODO Need to research when this can be an object with the indent stored in value\n    // and when the indent is stored as a Number itself, not in an object.\n    let indent: any = kb.any(chunk as any, PAD('indent'))\n\n    indent = indent ? indent.value : 0\n    const localStyle =\n      indent >= 0\n        ? baseStyle + 'text-indent: ' + indent * 3 + 'em;'\n        : headingCore + headingStyle[-1 - indent]\n    // ? baseStyle + 'padding-left: ' + (indent * 3) + 'em;'\n    part.setAttribute('style', localStyle + colors)\n  }\n\n  const removePart = function (part: NotepadPart) {\n    const chunk = part.subject\n    if (!chunk) throw new Error('No chunk for line to be deleted!') // just in case\n    const prev: any = kb.any(undefined, PAD('next'), chunk as any)\n    const next: any = kb.any(chunk as any, PAD('next'))\n    if (prev.sameTerm(subject) && next.sameTerm(subject)) {\n      // Last one\n      log('You can\\'t delete the only line.')\n      return\n    }\n\n    const del = kb\n      .statementsMatching(chunk as any, undefined, undefined, padDoc)\n      .concat(kb.statementsMatching(undefined, undefined, chunk as any, padDoc))\n    const ins = [st(prev, PAD('next'), next, padDoc)]\n\n    // @@ TODO what should we do if chunk is not a NamedNode should we\n    // assume then it is a string?\n    if (chunk instanceof NamedNode) {\n      const label = chunk.uri.slice(-4)\n\n      log('Deleting line ' + label)\n    }\n    if (!updater) {\n      throw new Error('have no updater')\n    }\n    // @@ TODO below you can see that before is redefined and not a boolean\n    updater.update(del, ins, function (uri, ok, errorMessage, response) {\n      if (ok) {\n        const row = part.parentNode\n        if (row) {\n          const before: any = row.previousSibling\n          if (row.parentNode) {\n            row.parentNode.removeChild(row)\n          }\n          // console.log('    deleted line ' + label + ' ok ' + part.value)\n          if (before && before.firstChild) {\n            // @@ TODO IMPORTANT FOCUS ISN'T A PROPERTY ON A CHILDNODE\n            before.firstChild.focus()\n          }\n        }\n      } else if (response && (response as any).status === 409) {\n        // Conflict\n        setPartStyle(part, 'color: black;  background-color: #ffd;') // yellow\n        part.state = 0 // Needs downstream refresh\n        beep(0.5, 512) // Ooops clash with other person\n        setTimeout(function () {\n          // Ideally, beep! @@\n          reloadAndSync() // Throw away our changes and\n          // updater.requestDownstreamAction(padDoc, reloadAndSync)\n        }, 1000)\n      } else {\n        log('    removePart FAILED ' + chunk + ': ' + errorMessage)\n        log('    removePart was deleteing :\\'' + del)\n        setPartStyle(part, 'color: black;  background-color: #fdd;') // failed\n        const res = response ? (response as any).status : ' [no response field] '\n        complain('Error ' + res + ' saving changes: ' + (errorMessage as any).true) // upstream,\n        // updater.requestDownstreamAction(padDoc, reloadAndSync);\n      }\n    })\n  } // removePart\n\n  const changeIndent = function (part: NotepadPart, chunk: string, delta) {\n    const del = kb.statementsMatching(chunk as any, PAD('indent'))\n    const current = del.length ? Number(del[0].object.value) : 0\n    if (current + delta < -3) return //  limit negative indent\n    const newIndent = current + delta\n    const ins = st(chunk as any, PAD('indent'), newIndent, padDoc)\n    if (!updater) {\n      throw new Error('no updater')\n    }\n    updater.update(del, ins as any, function (uri, ok, errorBody) {\n      if (!ok) {\n        log(\n          'Indent change FAILED \\'' +\n          newIndent +\n          '\\' for ' +\n          padDoc +\n          ': ' +\n          errorBody\n        )\n        setPartStyle(part, 'color: black;  background-color: #fdd;') // failed\n        updater.requestDownstreamAction(padDoc, reloadAndSync)\n      } else {\n        setPartStyle(part) // Implement the indent\n      }\n    })\n  }\n\n  const addListeners = function (part: any, chunk: any) {\n    part.addEventListener('keydown', function (event) {\n      if (!updater) {\n        throw new Error('no updater')\n      }\n\n      let queueProperty, queue\n      //  up 38; down 40; left 37; right 39     tab 9; shift 16; escape 27\n      switch (event.keyCode) {\n        case 13: // Return\n        {\n          const before: NotepadElement = event.shiftKey\n          log('enter') // Shift-return inserts before -- only way to add to top of pad.\n          if (before) {\n            queue = kb.any(undefined, PAD('next'), chunk)\n            queueProperty = 'newlinesAfter'\n          } else {\n            queue = kb.any(chunk, PAD('next'))\n            queueProperty = 'newlinesBefore'\n          }\n          queue[queueProperty] = queue[queueProperty] || 0\n          queue[queueProperty] += 1\n          if (queue[queueProperty] > 1) {\n            log('    queueing newline queue = ' + queue[queueProperty])\n            return\n          }\n          log('    go ahead line before ' + queue[queueProperty])\n          newChunk(part, before) // was document.activeElement\n          break\n        }\n        case 8: // Delete\n          if (part.value.length === 0) {\n            log(\n              'Delete key line ' + chunk.uri.slice(-4) + ' state ' + part.state\n            )\n\n            switch (part.state) {\n              case 1: // contents being sent\n              case 2: // contents need to be sent again\n                part.state = 4 // delete me\n                return\n              case 3: // already being deleted\n              case 4: // already deleted state\n                return\n              case undefined:\n              case 0:\n                part.state = 3 // being deleted\n                removePart(part)\n                event.preventDefault()\n                break // continue\n              default:\n                throw new Error('pad: Unexpected state ' + part)\n            }\n          }\n          break\n        case 9: // Tab\n        {\n          const delta = event.shiftKey ? -1 : 1\n          changeIndent(part, chunk, delta)\n          event.preventDefault() // default is to highlight next field\n          break\n        }\n        case 27: // ESC\n          log('escape')\n          updater.requestDownstreamAction(padDoc, reloadAndSync)\n          event.preventDefault()\n          break\n\n        case 38: // Up\n          if (part.parentNode.previousSibling) {\n            part.parentNode.previousSibling.firstChild.focus()\n            event.preventDefault()\n          }\n          break\n\n        case 40: // Down\n          if (part.parentNode.nextSibling) {\n            part.parentNode.nextSibling.firstChild.focus()\n            event.preventDefault()\n          }\n          break\n\n        default:\n      }\n    })\n\n    const updateStore = function (part: NotepadPart) {\n      const chunk: any = part.subject\n      setPartStyle(part, undefined, true)\n      const old = (kb.any(chunk, ns.sioc('content')) as any).value\n      const del = [st(chunk, ns.sioc('content'), old, padDoc)]\n      let ins\n      if (part.value) {\n        ins = [st(chunk, ns.sioc('content'), part.value as any, padDoc)]\n      }\n      const newOne = part.value\n\n      // DEBUGGING ONLY\n      if (part.lastSent) {\n        if (old !== part.lastSent) {\n          throw new Error(\n            'Out of order, last sent expected \\'' +\n            old +\n            '\\' but found \\'' +\n            part.lastSent +\n            '\\''\n          )\n        }\n      }\n      part.lastSent = newOne\n\n      /* console.log(\n        ' Patch proposed to ' +\n        chunk.uri.slice(-4) +\n        \" '\" +\n        old +\n        \"' -> '\" +\n        newOne +\n        \"' \"\n      ) */\n      if (!updater) {\n        throw new Error('no updater')\n      }\n\n      updater.update(del, ins, function (uri, ok, errorBody, xhr) {\n        if (!ok) {\n          // alert(\"clash \" + errorBody);\n          log(\n            '    patch FAILED ' +\n            (xhr as any).status +\n            ' for \\'' +\n            old +\n            '\\' -> \\'' +\n            newOne +\n            '\\': ' +\n            errorBody\n          )\n          if ((xhr as any).status === 409) {\n            // Conflict -  @@ we assume someone else\n            setPartStyle(part, 'color: black;  background-color: #fdd;')\n            part.state = 0 // Needs downstream refresh\n            beep(0.5, 512) // Ooops clash with other person\n            setTimeout(function () {\n              updater.requestDownstreamAction(padDoc, reloadAndSync)\n            }, 1000)\n          } else {\n            setPartStyle(part, 'color: black;  background-color: #fdd;') // failed pink\n            part.state = 0\n            complain(\n              '    Error ' + (xhr as any).status + ' sending data: ' + errorBody,\n              true\n            )\n            beep(1.0, 128) // Other\n            // @@@   Do soemthing more serious with other errors eg auth, etc\n          }\n        } else {\n          clearStatus(true) // upstream\n          setPartStyle(part) // synced\n          log('    Patch ok \\'' + old + '\\' -> \\'' + newOne + '\\' ')\n\n          if (part.state === 4) {\n            //  delete me\n            part.state = 3\n            removePart(part)\n          } else if (part.state === 3) {\n            // being deleted\n            // pass\n          } else if (part.state === 2) {\n            part.state = 1 // pending: lock\n            updateStore(part)\n          } else {\n            part.state = 0 // clear lock\n          }\n        }\n      })\n    }\n\n    part.addEventListener('input', function inputChangeListener (_event) {\n      // debug.log(\"input changed \"+part.value);\n      setPartStyle(part, undefined, true) // grey out - not synced\n      log(\n        'Input event state ' + part.state + ' value \\'' + part.value + '\\''\n      )\n      switch (part.state) {\n        case 3: // being deleted\n          return\n        case 4: // needs to be deleted\n          return\n        case 2: // needs content updating, we know\n          return\n        case 1:\n          part.state = 2 // lag we need another patch\n          return\n        case 0:\n        case undefined:\n          part.state = 1 // being upadted\n          updateStore(part)\n      }\n    }) // listener\n  } // addlisteners\n\n  // @@ TODO Need to research before as it appears to be used as an Element and a boolean\n  const newPartAfter = function (tr1: HTMLTableElement, chunk: String, before?: NotepadElement | boolean) {\n    // @@ take chunk and add listeners\n    let text: any = kb.any(chunk as any, ns.sioc('content'))\n    text = text ? text.value : ''\n    const tr = dom.createElement('tr')\n    if (before) {\n      table.insertBefore(tr, tr1)\n    } else {\n      // after\n      if (tr1 && tr1.nextSibling) {\n        table.insertBefore(tr, tr1.nextSibling)\n      } else {\n        table.appendChild(tr)\n      }\n    }\n    const part: any = tr.appendChild(dom.createElement('input'))\n    part.subject = chunk\n    part.setAttribute('type', 'text')\n    part.value = text\n    if (me) {\n      setPartStyle(part, '')\n      addListeners(part, chunk)\n    } else {\n      setPartStyle(part, 'color: #222; background-color: #fff')\n      log('Note can\\'t add listeners - not logged in')\n    }\n    return part\n  }\n\n  /* @@ TODO we need to look at indent, it can be a Number or an Object this doesn't seem correct.\n  */\n  const newChunk = function (ele?: NotepadElement, before?: NotepadElement) {\n    // element of chunk being split\n    const kb = store\n    let indent: any = 0\n    let queueProperty: string | null = null\n    let here, prev, next, queue, tr1: any\n\n    if (ele) {\n      if (ele.tagName.toLowerCase() !== 'input') {\n        log('return pressed when current document is: ' + ele.tagName)\n      }\n      here = ele.subject\n      indent = kb.any(here, PAD('indent'))\n      indent = indent ? Number(indent.value) : 0\n      if (before) {\n        prev = kb.any(undefined, PAD('next'), here)\n        next = here\n        queue = prev\n        queueProperty = 'newlinesAfter'\n      } else {\n        prev = here\n        next = kb.any(here, PAD('next'))\n        queue = next\n        queueProperty = 'newlinesBefore'\n      }\n      tr1 = ele.parentNode\n    } else {\n      prev = subject\n      next = subject\n      tr1 = undefined\n    }\n\n    const chunk = newThing(padDoc)\n    const label = chunk.uri.slice(-4)\n\n    const del = [st(prev, PAD('next'), next, padDoc)]\n    const ins = [\n      st(prev, PAD('next'), chunk, padDoc),\n      st(chunk, PAD('next'), next, padDoc),\n      st(chunk, ns.dc('author'), me, padDoc),\n      st(chunk, ns.sioc('content'), '' as any, padDoc)\n    ]\n    if (indent > 0) {\n      // Do not inherit\n      ins.push(st(chunk, PAD('indent'), indent, padDoc))\n    }\n\n    log('    Fresh chunk ' + label + ' proposed')\n    if (!updater) {\n      throw new Error('no updater')\n    }\n    updater.update(del, ins, function (uri, ok, errorBody, _xhr) {\n      if (!ok) {\n        // alert(\"Error writing new line \" + label + \": \" + errorBody);\n        log('    ERROR writing new line ' + label + ': ' + errorBody)\n      } else {\n        const newPart = newPartAfter(tr1, chunk, before)\n        setPartStyle(newPart)\n        newPart.focus() // Note this is delayed\n        if (queueProperty) {\n          log(\n            '    Fresh chunk ' +\n            label +\n            ' updated, queue = ' +\n            queue[queueProperty]\n          )\n          queue[queueProperty] -= 1\n          if (queue[queueProperty] > 0) {\n            log(\n              '    Implementing queued newlines = ' + next.newLinesBefore\n            )\n            newChunk(newPart, before)\n          }\n        }\n      }\n    })\n  }\n\n  const consistencyCheck = function () {\n    const found: { [uri: string]: boolean } = {}\n    let failed = 0\n    function complain2 (msg) {\n      complain(msg)\n      failed++\n    }\n\n    if (!kb.the(subject, PAD('next'))) {\n      complain2('No initial next pointer')\n      return false // can't do linked list\n    }\n    // var chunk = kb.the(subject, PAD('next'))\n    let prev = subject\n    let chunk\n    for (; ;) {\n      chunk = kb.the(prev, PAD('next'))\n      if (!chunk) {\n        complain2('No next pointer from ' + prev)\n      }\n      if (chunk.sameTerm(subject)) {\n        break\n      }\n      prev = chunk\n      const label = chunk.uri.split('#')[1]\n      if (found[chunk.uri]) {\n        complain2('Loop!')\n        return false\n      }\n\n      found[chunk.uri] = true\n      let k = kb.each(chunk, PAD('next')).length\n      if (k !== 1) {\n        complain2('Should be 1 not ' + k + ' next pointer for ' + label)\n      }\n\n      k = kb.each(chunk, PAD('indent')).length\n      if (k > 1) {\n        complain2('Should be 0 or 1 not ' + k + ' indent for ' + label)\n      }\n\n      k = kb.each(chunk, ns.sioc('content')).length\n      if (k !== 1) {\n        complain2('Should be 1 not ' + k + ' contents for ' + label)\n      }\n\n      k = kb.each(chunk, ns.dc('author')).length\n      if (k !== 1) {\n        complain2('Should be 1 not ' + k + ' author for ' + label)\n      }\n\n      const sts = kb.statementsMatching(undefined, ns.sioc('contents'))\n      sts.forEach(function (st) {\n        if (!found[st.subject.value]) {\n          complain2('Loose chunk! ' + st.subject.value)\n        }\n      })\n    }\n    return !failed\n  }\n\n  // Ensure that the display matches the current state of the\n  // @@ TODO really need to refactor this so that we don't need to cast types\n  const sync = function () {\n    // var first = kb.the(subject, PAD('next'))\n    if (kb.each(subject, PAD('next')).length !== 1) {\n      const msg =\n        'Pad: Inconsistent data - NEXT pointers: ' +\n        kb.each(subject, PAD('next')).length\n      log(msg)\n      if ((options as notepadOptions).statusArea) {\n        ((options as notepadOptions).statusArea as HTMLElement).textContent += msg\n      }\n      return\n    }\n    let row\n\n    // First see which of the logical chunks have existing physical manifestations\n    const manif: any = []\n    // Find which lines correspond to existing chunks\n\n    for (\n      let chunk = kb.the(subject, PAD('next')) as unknown as any;\n      !chunk.sameTerm(subject);\n      chunk = kb.the(chunk, PAD('next'))\n    ) {\n      for (let i = 0; i < table.children.length; i++) {\n        const tr: any = table.children[i]\n        if (tr.firstChild) {\n          if (tr.firstChild.subject.sameTerm(chunk)) {\n            manif[chunk.uri] = tr.firstChild\n          }\n        }\n      }\n    }\n\n    // Remove any deleted lines\n    for (let i = table.children.length - 1; i >= 0; i--) {\n      row = table.children[i]\n      if (!manif[row.firstChild.subject.uri]) {\n        table.removeChild(row)\n      }\n    }\n    // Insert any new lines and update old ones\n    row = table.firstChild // might be null\n    for (\n      let chunk = kb.the(subject, PAD('next')) as unknown as any;\n      !chunk.sameTerm(subject);\n      chunk = kb.the(chunk, PAD('next'))\n    ) {\n      const text = (kb.any(chunk, ns.sioc('content')) as any).value\n      // superstitious -- don't mess with unchanged input fields\n      // which may be selected by the user\n      if (row && manif[chunk.uri]) {\n        const part = row.firstChild\n        if (text !== part.value) {\n          part.value = text\n        }\n        setPartStyle(part)\n        part.state = 0 // Clear the state machine\n        delete part.lastSent // DEBUG ONLY\n        row = row.nextSibling\n      } else {\n        newPartAfter(row, chunk, true) // actually before\n      }\n    }\n  }\n\n  // Refresh the DOM tree\n\n  const refreshTree = function (root) {\n    if (root.refresh) {\n      root.refresh()\n      return\n    }\n    for (let i = 0; i < root.children.length; i++) {\n      refreshTree(root.children[i])\n    }\n  }\n\n  let reloading = false\n\n  const checkAndSync = function () {\n    log('    reloaded OK')\n    clearStatus()\n    if (!consistencyCheck()) {\n      complain('CONSISTENCY CHECK FAILED')\n    } else {\n      refreshTree(table)\n    }\n  }\n\n  const reloadAndSync = function () {\n    if (reloading) {\n      log('   Already reloading - stop')\n      return // once only needed\n    }\n    reloading = true\n    let retryTimeout = 1000 // ms\n    const tryReload = function () {\n      log('try reload - timeout = ' + retryTimeout)\n      if (!updater) {\n        throw new Error('no updater')\n      }\n      updater.reload(updater.store, padDoc, function (ok, message, xhr) {\n        reloading = false\n        if (ok) {\n          checkAndSync()\n        } else {\n          if ((xhr as any).status === 0) {\n            complain(\n              'Network error refreshing the pad. Retrying in ' +\n              retryTimeout / 1000\n            )\n            reloading = true\n            retryTimeout = retryTimeout * 2\n            setTimeout(tryReload, retryTimeout)\n          } else {\n            complain(\n              'Error ' +\n              (xhr as any).status +\n              'refreshing the pad:' +\n              message +\n              '. Stopped. ' +\n              padDoc\n            )\n          }\n        }\n      })\n    }\n    tryReload()\n  }\n\n  table.refresh = sync // Catch downward propagating refresh events\n  table.reloadAndSync = reloadAndSync\n\n  if (!me) log('Warning: must be logged in for pad to be edited')\n\n  if (exists) {\n    log('Existing pad.')\n    if (consistencyCheck()) {\n      sync()\n      if (kb.holds(subject, PAD('next'), subject)) {\n        // Empty list untenable\n        newChunk() // require at least one line\n      }\n    } else {\n      log((table.textContent = 'Inconsistent data. Abort'))\n    }\n  } else {\n    // Make new pad\n    log('No pad exists - making new one.')\n    const insertables = [\n      st(subject, ns.rdf('type'), PAD('Notepad'), padDoc),\n      st(subject, ns.dc('author'), me, padDoc),\n      st(subject, ns.dc('created'), new Date() as any, padDoc),\n      st(subject, PAD('next'), subject, padDoc)\n    ]\n\n    if (!updater) {\n      throw new Error('no updater')\n    }\n    updater.update([], insertables, function (uri: string | null | undefined, ok: boolean, errorBody?: string) {\n      if (!ok) {\n        complain(errorBody || '')\n      } else {\n        log('Initial pad created')\n        newChunk() // Add a first chunck\n        // getResults();\n      }\n    })\n  }\n  return table\n}\n\n/**\n * Get the chunks of the notepad\n * They are stored in a RDF linked list\n */\n\n// @ignore exporting this only for the unit test\nexport function getChunks (subject: NamedNode, kb: IndexedFormula) {\n  const chunks: any[] = []\n  for (\n    let chunk: any = kb.the(subject, PAD('next'));\n    !chunk.sameTerm(subject);\n    chunk = kb.the(chunk, PAD('next'))\n  ) {\n    chunks.push(chunk)\n  }\n  return chunks\n}\n\n/**\n *  Encode content to be put in XML or HTML elements\n */\n// @ignore exporting this only for the unit test\nexport function xmlEncode (str) {\n  return str.replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;')\n}\n\n/**\n * Convert a notepad to HTML\n *   @param { } pad - the notepad\n *   @param {store} pad - the data store\n */\nexport function notepadToHTML (pad: any, kb: IndexedFormula) {\n  const chunks = getChunks(pad, kb)\n  let html = '<html>\\n  <head>\\n'\n  const title = kb.anyValue(pad, ns.dct('title'))\n  if (title) {\n    html += `    <title>${xmlEncode(title)}</title>\\n`\n  }\n  html += '  </head>\\n  <body>\\n'\n  let level = 0\n\n  function increaseLevel (indent) {\n    for (; level < indent; level++) {\n      html += '<ul>\\n'\n    }\n  }\n\n  function decreaseLevel (indent) {\n    for (; level > indent; level--) {\n      html += '</ul>\\n'\n    }\n  }\n  chunks.forEach(chunk => {\n    const indent = kb.anyJS(chunk, PAD('indent'))\n    const rawContent = kb.anyJS(chunk, ns.sioc('content'))\n    if (!rawContent) return // seed chunk is dummy\n    const content = xmlEncode(rawContent)\n    if (indent < 0) { // negative indent levels represent heading levels\n      decreaseLevel(0)\n      const h = indent >= -3 ? 4 + indent : 1 // -1 -> h4, -2 -> h3\n      html += `\\n<h${h}>${content}</h${h}>\\n`\n    } else { // >= 0\n      if (indent > 0) { // Lists\n        decreaseLevel(indent)\n        increaseLevel(indent)\n        html += `<li>${content}</li>\\n`\n      } else { // indent 0\n        decreaseLevel(indent)\n        html += `<p>${content}</p>\\n`\n      }\n    }\n  }) // foreach chunk\n  // At the end decreaseLevel any open ULs\n  decreaseLevel(0)\n  html += '  </body>\\n</html>\\n'\n  return html\n}\n","/**\n * Functions related to chat and bookmarks\n * @packageDocumentation\n */\n\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { media } from '../media/index'\nimport ns from '../ns'\nimport * as pad from '../pad'\nimport * as $rdf from 'rdflib' // pull in first avoid cross-refs\nimport { style } from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { store, createTypeIndexLogic, authn } from 'solid-logic'\nimport { findAppInstances } from '../login/login'\n\nconst UI = { icons, ns, media, pad, style, utils, widgets }\n\nconst BOOK = $rdf.Namespace('http://www.w3.org/2002/01/bookmark#')\nconst BOOKMARK_ICON = 'noun_45961.svg'\n\nconst label = utils.label\nconst dom = window.document || null\n\n// @@@@ use the one in rdflib.js when it is avaiable and delete this\nfunction updatePromise (del, ins) {\n  return new Promise(function (resolve, reject) {\n    store.updater.update(del, ins, function (uri, ok, errorBody) {\n      if (!ok) {\n        reject(new Error(errorBody))\n      } else {\n        resolve()\n      }\n    }) // callback\n  }) // promise\n}\n\n/*         Bookmarking\n */\n/** Find a user's bookmarks\n */\nexport async function findBookmarkDocument (userContext) {\n  const theClass = BOOK('Bookmark')\n  const fileTail = 'bookmarks.ttl'\n  const isPublic = true\n\n  await findAppInstances(userContext, theClass, isPublic) // public -- only look for public links\n\n  if (userContext.instances && userContext.instances.length > 0) {\n    userContext.bookmarkDocument = userContext.instances[0]\n    if (userContext.instances.length > 1) {\n      debug.warn('More than one bookmark file! ' + userContext.instances) // @@ todo - deal with > 1\n      // Note: should pick up community bookmarks as well\n    }\n  } else {\n    if (userContext.publicProfile) {\n      // publicProfile or preferencesFile\n      const newBookmarkFile = $rdf.sym(\n        userContext.publicProfile.dir().uri + fileTail\n      )\n      try {\n        debug.log('Creating new bookmark file ' + newBookmarkFile)\n        await store.fetcher.createIfNotExists(newBookmarkFile)\n      } catch (e) {\n        debug.warn('Can\\'t make fresh bookmark file:' + e)\n        return userContext\n      }\n      await createTypeIndexLogic.registerInTypeIndex(\n        newBookmarkFile,\n        userContext.index,\n        theClass\n      )\n      userContext.bookmarkDocument = newBookmarkFile\n    } else {\n      debug.warn('You seem to have no bookmark file, nor even a profile file!')\n    }\n  }\n  return userContext\n}\n\n/** Add a bookmark\n */\n\nasync function addBookmark (context, target) {\n  /* like\n @prefix terms: <http://purl.org/dc/terms/>.\n @prefix bookm: <http://www.w3.org/2002/01/bookmark#>.\n @prefix n0: <http://xmlns.com/foaf/0.1/>.\n <> terms:references <#0.5534145389246576>.\n <#0.5534145389246576>\n   a bookm:Bookmark;\n   terms:created \"2019-01-26T20:26:44.374Z\"^^XML:dateTime;\n   terms:title \"Herons\";\n   bookm:recalls wiki:Heron;\n   n0:maker c:me.\n  */\n  let title = ''\n  const me = authn.currentUser() // If already logged on\n  if (!me) throw new Error('Must be logged on to add Bookmark')\n\n  const author = store.any(target, ns.foaf('maker'))\n  title =\n    label(author) + ': ' + store.anyValue(target, ns.sioc('content')).slice(0, 80) // @@ add chat title too?\n  const bookmarkDoc = context.bookmarkDocument\n  const bookmark = UI.widgets.newThing(bookmarkDoc, title)\n  const ins = [\n    $rdf.st(bookmarkDoc, UI.ns.dct('references'), bookmark, bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.rdf('type'), BOOK('Bookmark'), bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.dct('created'), new Date(), bookmarkDoc),\n    $rdf.st(bookmark, BOOK('recalls'), target, bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.foaf('maker'), me, bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.dct('title'), title, bookmarkDoc)\n  ]\n  try {\n    await updatePromise([], ins) // 20190118A\n  } catch (e) {\n    const msg = 'Making bookmark: ' + e\n    debug.warn(msg)\n    return null\n  }\n  return bookmark\n}\n\nexport async function toggleBookmark (userContext, target, bookmarkButton) {\n  await store.fetcher.load(userContext.bookmarkDocument)\n  const bookmarks = store.each(\n    null,\n    BOOK('recalls'),\n    target,\n    userContext.bookmarkDocument\n  )\n  if (bookmarks.length) {\n    // delete\n    if (!confirm('Delete bookmark on this?' + bookmarks.length)) return\n    for (let i = 0; i < bookmarks.length; i++) {\n      try {\n        await updatePromise(store.connectedStatements(bookmarks[i]), [])\n        bookmarkButton.style.backgroundColor = 'white'\n        debug.log('Bookmark deleted: ' + bookmarks[i])\n      } catch (e) {\n        debug.error('Cant delete bookmark:' + e)\n        debug.warn('Cannot delete bookmark:' + e)\n      }\n    }\n  } else {\n    const bookmark = await addBookmark(userContext, target)\n    bookmarkButton.style.backgroundColor = 'yellow'\n    debug.log('Bookmark added: ' + bookmark)\n  }\n}\n\nexport async function renderBookmarksButton (userContext, target) {\n  async function setBookmarkButtonColor (bookmarkButton) {\n    await store.fetcher.load(userContext.bookmarkDocument)\n    const bookmarked = store.any(\n      null,\n      BOOK('recalls'),\n      bookmarkButton.target,\n      userContext.bookmarkDocument\n    )\n    bookmarkButton.style = UI.style.buttonStyle\n    if (bookmarked) bookmarkButton.style.backgroundColor = 'yellow'\n  }\n\n  let bookmarkButton\n  if (userContext.bookmarkDocument) {\n    bookmarkButton = UI.widgets.button(\n      dom,\n      UI.icons.iconBase + BOOKMARK_ICON,\n      label(BOOK('Bookmark')),\n      () => {\n        toggleBookmark(userContext, target, bookmarkButton)\n      }\n    )\n    bookmarkButton.target = target\n    await setBookmarkButtonColor(bookmarkButton)\n    return bookmarkButton\n  }\n}\n","/**\n * Tools for doing things with a message\n * Let us be creative here.  Allow all sorts of things to\n * be done to a message - linking to new or old objects in an open way\n *\n * Ideas: Bookmark, Like, star, pin at top of chat, reply as new thread,\n * If you made it originally: edit, delete, attach\n * @packageDocumentation\n */\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\n// import { media } from '../media/index'\nimport ns from '../ns'\n// import * as pad from '../pad'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n// import { style } from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { renderBookmarksButton } from './bookmarks'\nimport { authn, store } from 'solid-logic'\n\nimport { allVersions, mostRecentVersion, isDeleted } from './chatLogic'\nimport { switchToEditor } from './message'\n\nconst dom = window.document\n\n// THE UNUSED ICONS are here as reminders for possible future functionality\n// const BOOKMARK_ICON = 'noun_45961.svg'\n// const HEART_ICON = 'noun_130259.svg' -> Add this to my (private) favorites\n// const MENU_ICON = 'noun_897914.svg'\n// const PAPERCLIP_ICON = 'noun_25830.svg' -> add attachments to this message\n// const PIN_ICON = 'noun_562340.svg'  -> pin this message permanently in the chat UI\nconst PENCIL_ICON = 'noun_253504.svg' // edit a message\n// const SPANNER_ICON = 'noun_344563.svg' -> settings\nconst THUMBS_UP_ICON = 'noun_1384132.svg'\nconst THUMBS_DOWN_ICON = 'noun_1384135.svg'\nconst REPLY_ICON = 'noun-reply-5506924.svg'\n/**\n * Emoji in Unicode\n */\nconst emojiMap = {}\nemojiMap[ns.schema('AgreeAction')] = ''\nemojiMap[ns.schema('DisagreeAction')] = ''\nemojiMap[ns.schema('EndorseAction')] = ''\nemojiMap[ns.schema('LikeAction')] = ''\n\nexport function emojiFromActionClass (action) {\n  return emojiMap[action] || null\n}\n\nexport function ActionClassFromEmoji (emoji) {\n  for (const a in emojiMap) {\n    if (emojiMap[a] === emoji) {\n      return rdf.sym(a.slice(1, -1)) // remove < >\n    }\n  }\n  return null\n}\n\n// Allow the action to give its own emoji as content,\n// or get the emoji from the class of action.\nexport function emojiFromAction (action) {\n  const content = store.any(action, ns.sioc('content'), null, action.doc())\n  if (content) return content\n  const klass = store.any(action, ns.rdf('type'), null, action.doc())\n  if (klass) {\n    const em = emojiFromActionClass(klass)\n    if (em) return em\n  }\n  return ''\n}\n\n/**\n * Create strip of sentiments expressed\n */\nexport async function sentimentStrip (target, doc) { // alain: seems not used\n  const versions = await allVersions(target)\n  // debug.log('sentimentStrip Versions for ' + target, versions)\n  const actions = versions.map(version => store.each(null, ns.schema('target'), version, doc)).flat()\n  // debug.log('sentimentStrip: Actions for ' + target, actions)\n  const strings = actions.map(action => emojiFromAction(action) || '')\n  return dom.createTextNode(strings.join(' '))\n}\n/**\n * Create strip of sentiments expressed, with hyperlinks\n *\n * @param target {NamedNode} - The thing about which they are expressed\n * @param doc {NamedNode} - The document in which they are expressed\n */\nexport async function sentimentStripLinked (target, doc) {\n  const strip = dom.createElement('span')\n  async function refresh () {\n    strip.innerHTML = ''\n    if (isDeleted(target)) return strip\n    const versions = await allVersions(target)\n    // debug.log('sentimentStripLinked: Versions for ' + target, versions)\n    const actions = versions.map(version => store.each(null, ns.schema('target'), version, doc)).flat()\n    // debug.log('sentimentStripLinked: Actions for ' + target, actions)\n    if (actions.length === 0) return strip\n    const sentiments = actions.map(a => [\n      store.any(a, ns.rdf('type'), null, doc),\n      store.any(a, ns.sioc('content'), null, doc),\n      store.any(a, ns.schema('agent'), null, doc)\n    ])\n    // debug.log('  Actions sentiments ', sentiments)\n    sentiments.sort()\n    sentiments.forEach(ss => {\n      const [theClass, content, agent] = ss\n      let res\n      if (agent) {\n        res = dom.createElement('a')\n        res.setAttribute('href', agent.uri)\n      } else {\n        res = dom.createTextNode('')\n      }\n      res.textContent = content || emojiMap[theClass] || ''\n      strip.appendChild(res)\n    })\n    // debug.log('  Actions strip ', strip)\n  }\n  refresh().then(debug.log('sentimentStripLinked: sentimentStripLinked async refreshed'))\n  strip.refresh = refresh\n  return strip\n}\n/**\n * Creates a message toolbar component\n */\nexport async function messageToolbar (message, messageRow, userContext, channelObject) {\n  async function deleteMessage () {\n    const author = store.any(message, ns.foaf('maker'))\n    if (!me) {\n      alert('You can\\'t delete the message, you are not logged in.')\n    } else if (me.sameTerm(author)) {\n      try {\n        await channelObject.deleteMessage(message)\n      } catch (err) {\n        const msg = 'Error deleting messaage ' + err\n        debug.warn(msg)\n        alert(msg)\n        const area = userContext.statusArea || messageRow.parentNode\n        area.appendChild(widgets.errorMessageBlock(dom, msg))\n      }\n      messageRow.parentNode.removeChild(messageRow)\n    } else {\n      alert('You can\\'t delete the message, you are not logged in as the author, ' + author)\n    }\n    closeToolbar()\n  }\n\n  async function editMessage (messageRow) {\n    if (me.value === store.any(message, ns.foaf('maker')).value) {\n      closeToolbar() // edit is a one-off action\n      await switchToEditor(messageRow, message, channelObject, userContext)\n    }\n  }\n\n  async function replyInThread () {\n    const thread = await channelObject.createThread(message)\n    const options = userContext.chatOptions\n    if (!options) throw new Error('replyInThread: missing options')\n    options.showThread(thread, options)\n    closeToolbar() // a one-off action\n  }\n\n  // alain: TODO allow chat owner to fully delete message + sentiments and replacing messages\n\n  const div = dom.createElement('div')\n  // is message deleted ?\n  if (await mostRecentVersion(message).value === ns.schema('dateDeleted').value) return div\n  function closeToolbar () {\n    div.parentElement.parentElement.removeChild(div.parentElement) // remive the TR\n  }\n\n  async function deleteThingThen (x) {\n    await store.updater.update(store.connectedStatements(x), [])\n  }\n\n  // Things only the original author can do\n  let me = authn.currentUser() // If already logged on\n  if (me && store.holds(message, ns.foaf('maker'), me)) {\n    // button to delete the message\n    div.appendChild(widgets.deleteButtonWithCheck(dom, div, 'message', deleteMessage))\n    // button to edit the message\n    div.appendChild(widgets.button(dom, icons.iconBase + PENCIL_ICON, 'edit', () => editMessage(messageRow)))\n  } // if mine\n  // Things anyone can do if they have a bookmark list async\n  /*\n var bookmarkButton = await bookmarks.renderBookmarksButton(userContext)\n if (bookmarkButton) {\n   div.appendChild(bookmarkButton)\n }\n */\n  // Things anyone can do if they have a bookmark list\n\n  renderBookmarksButton(userContext).then(bookmarkButton => {\n    if (bookmarkButton) div.appendChild(bookmarkButton)\n  })\n\n  /**   Button to allow user to express a sentiment (like, endorse, etc) about a target\n   *\n   * @param context {Object} - Provide dom and me\n   * @param target {NamedNode} - The thing the user expresses an opnion about\n   * @param icon {uristring} - The icon to be used for the button\n   * @param actionClass {NamedNode} - The RDF class  - typically a subclass of schema:Action\n   * @param doc - {NamedNode} - the Solid document iunto which the data should be written\n   * @param mutuallyExclusive {Array<NamedNode>} - Any RDF classes of sentimentswhich are mutiually exclusive\n   */\n  function sentimentButton (\n    context,\n    target,\n    icon,\n    actionClass,\n    doc,\n    mutuallyExclusive\n  ) {\n    function setColor () {\n      button.style.backgroundColor = action ? 'yellow' : 'white'\n    }\n    const button = widgets.button(\n      dom,\n      icon,\n      utils.label(actionClass),\n      async function (_event) {\n        if (action) {\n          await deleteThingThen(action)\n          action = null\n          setColor()\n        } else {\n          // no action\n          action = widgets.newThing(doc)\n          const insertMe = [\n            rdf.st(action, ns.schema('agent'), context.me, doc),\n            rdf.st(action, ns.rdf('type'), actionClass, doc),\n            rdf.st(action, ns.schema('target'), target, doc)\n          ]\n          await store.updater.update([], insertMe)\n          setColor()\n\n          if (mutuallyExclusive) {\n            // Delete incompative sentiments\n            let dirty = false\n            for (let i = 0; i < mutuallyExclusive.length; i++) {\n              const a = existingAction(mutuallyExclusive[i])\n              if (a) {\n                await deleteThingThen(a) // but how refresh? refreshTree the parent?\n                dirty = true\n              }\n            }\n            if (dirty) {\n              // widgets.refreshTree(button.parentNode) // requires them all to be immediate siblings\n              widgets.refreshTree(messageRow) // requires them all to be immediate siblings\n            }\n          }\n        }\n      }\n    )\n    function existingAction (actionClass) {\n      const actions = store\n        .each(null, ns.schema('agent'), context.me, doc)\n        .filter(x => store.holds(x, ns.rdf('type'), actionClass, doc))\n        .filter(x => store.holds(x, ns.schema('target'), target, doc))\n      return actions.length ? actions[0] : null\n    }\n    function refresh () {\n      action = existingAction(actionClass)\n      setColor()\n    }\n    let action\n    button.refresh = refresh // If the file changes, refresh live\n    refresh()\n    return button\n  }\n\n  // THUMBS_UP_ICON\n  // https://schema.org/AgreeAction\n  me = authn.currentUser() // If already logged on\n\n  if (me && (await mostRecentVersion(message).value !== ns.schema('dateDeleted').value)) {\n    const context1 = { me, dom, div }\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message, // @@ TODO use widgets.sentimentButton\n        icons.iconBase + THUMBS_UP_ICON,\n        ns.schema('AgreeAction'),\n        message.doc(),\n        [ns.schema('DisagreeAction')]\n      )\n    )\n    // Thumbs down\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message,\n        icons.iconBase + THUMBS_DOWN_ICON,\n        ns.schema('DisagreeAction'),\n        message.doc(),\n        [ns.schema('AgreeAction')]\n      )\n    )\n  }\n  // Reply buttton\n\n  if (store.any(message, ns.dct('created'))) { // Looks like a messsage? Bar can be used for other things\n    div.appendChild(widgets.button(dom, icons.iconBase + REPLY_ICON, 'Reply in thread', async () => {\n      await replyInThread()\n    }))\n  }\n  // X button to remove the tool UI itself\n  const cancelButton = div.appendChild(widgets.cancelButton(dom))\n  cancelButton.style.float = 'right'\n  cancelButton.firstChild.style.opacity = '0.3'\n  cancelButton.addEventListener('click', closeToolbar)\n  return div\n}\n","/**  UI code for individual messages: display them, edit them\n *\n * @packageDocumentation\n */\n\n/* global $rdf */\nimport { insertMessageIntoTable } from './infinite'\nimport { messageToolbar, sentimentStripLinked } from './messageTools'\nimport { findBookmarkDocument } from './bookmarks'\nimport { mostRecentVersion, originalVersion, allVersions } from './chatLogic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { store, authn } from 'solid-logic'\nimport { ensureLoggedIn } from '../login/login'\nimport { media } from '../media/index'\nimport ns from '../ns'\nimport * as pad from '../pad'\nimport { style } from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { getBlankMsg, verifySignature, SEC } from './signature'\nimport { getPublicKey } from './keys'\n\nconst dom = window.document\nconst messageBodyStyle = style.messageBodyStyle\n\nconst label = utils.label\n\n/**\n * elementForImageURI\n * HTML component for an image\n * @param imageUri\n * @param options { inlineImageHeightEms }\n * @returns HTMLAnchorElement For Image\n */\nexport function elementForImageURI (imageUri, options) {\n  const img = dom.createElement('img')\n  let height = '10'\n  if (options.inlineImageHeightEms) {\n    height = ('' + options.inlineImageHeightEms).trim()\n  }\n  img.setAttribute(\n    'style',\n    'max-height: ' + height + 'em; border-radius: 1em; margin: 0.7em;'\n  )\n  // widgets.makeDropTarget(img, handleURIsDroppedOnMugshot, droppedFileHandler)\n  if (imageUri) img.setAttribute('src', imageUri)\n  const anchor = dom.createElement('a')\n  anchor.setAttribute('href', imageUri)\n  anchor.setAttribute('target', 'images')\n  anchor.appendChild(img)\n  widgets.makeDraggable(img, $rdf.sym(imageUri))\n  return anchor\n}\n\nconst anchor = function (text, term) {\n  // If there is no link return an element anyway\n  const a = dom.createElement('a')\n  if (term && term.uri) {\n    a.setAttribute('href', term.uri)\n    a.addEventListener('click', widgets.openHrefInOutlineMode, true)\n    a.setAttribute('style', 'color: #3B5998; text-decoration: none; ') // font-weight: bold\n  }\n  a.textContent = text\n  return a\n}\n\nfunction nickname (person) {\n  const s = store.any(person, ns.foaf('nick'))\n  if (s) return '' + s.value\n  return '' + label(person)\n}\n\n/**\n * creatorAndDate\n * Displays creator and date for a chat message\n * inside the `td1` element\n * @param td1\n * @param creator\n * @param date\n * @param message\n * @returns HTMLAnchorElement For Image\n */\nexport function creatorAndDate (td1, creator, date, message) {\n  const nickAnchor = td1.appendChild(anchor(nickname(creator), creator))\n  if (creator.uri) {\n    store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n      _ok,\n      _body\n    ) {\n      nickAnchor.textContent = nickname(creator)\n    })\n  }\n  td1.appendChild(dom.createElement('br'))\n  td1.appendChild(anchor(date, message))\n}\n\n/**\n * creatorAndDateHorizontal\n * Horizontally displays creator and date for a chat message\n * inside the `td1` element\n * @param td1\n * @param creator\n * @param date\n * @param message\n * @returns HTMLAnchorElement For Image\n */\nexport function creatorAndDateHorizontal (td1, creator, date, message) {\n  const nickAnchor = td1.appendChild(anchor(label(creator), creator))\n  if (creator.uri) {\n    store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n      _ok,\n      _body\n    ) {\n      nickAnchor.textContent = nickname(creator)\n    })\n  }\n  const dateBit = td1.appendChild(anchor(date, message))\n  dateBit.style.fontSize = '80%'\n  dateBit.style.marginLeft = '1em'\n  td1.appendChild(dom.createElement('br'))\n}\n\n/**\n * renderMessageRow\n * Renders a chat message, read-only mode\n * @param channelObject\n * @param message\n * @param fresh\n * @param options\n * @param userContext\n * @returns Message Row HTML Table Element\n */\nexport async function renderMessageRow (channelObject, message, fresh, options, userContext) {\n  let unsignedMessage = false\n  const colorizeByAuthor =\n    options.colorizeByAuthor === '1' || options.colorizeByAuthor === true\n\n  // const id = store.any(latestVersion, ns.sioc('id'))\n  // const replies = store.each(latestVersion, ns.sioc('has_reply'))\n\n  const creator = store.any(message, ns.foaf('maker'))\n  const date = store.any(message, ns.dct('created'))\n  const latestVersion = await mostRecentVersion(message)\n  const latestVersionCreator = store.any(latestVersion, ns.foaf('maker'))\n\n  // use latest content if same owner, else use original\n  // this is may be too strict. Should we find latest valid version if any ?\n  const msgId = creator.uri === latestVersionCreator?.uri ? latestVersion : message\n  const content = store.any(msgId, ns.sioc('content'))\n\n  const versions = await allVersions(msgId)\n  if (versions.length > 1) {\n    debug.log('renderMessageRow versions: ', versions.join(',  '))\n  }\n  // be tolerant in accepting replies on any version of a message\n  const replies = versions.map(version => store.each(version, ns.sioc('has_reply'))).flat()\n\n  let thread = null\n  const straightReplies = []\n  for (const reply of replies) {\n    if (store.holds(reply, ns.rdf('type'), ns.sioc('Thread'))) {\n      thread = reply\n      debug.log('renderMessageRow: found thread: ' + thread)\n    } else {\n      straightReplies.push(reply)\n    }\n  }\n  if (straightReplies.length > 1) {\n    debug.log('renderMessageRow: found normal replies: ', straightReplies)\n  }\n  if (!thread) {\n    // thread = store.any(message, ns.sioc('has_reply'))\n    thread = store.any(null, ns.sioc('has_member'), message)\n  }\n  // debug.log('@@@@ is thread' + thread)\n\n  // get signature\n  const signature = store.any(msgId, $rdf.sym(`${SEC}proofValue`))\n\n  // set proof message object\n  const msg = getBlankMsg()\n  msg.id = msgId.uri\n  msg.created = store.any(msgId, ns.dct('created')).value\n  msg.content = content.value\n  msg.maker = creator.uri\n\n  // verify signature\n  if (!signature?.value) { // unsigned message\n    unsignedMessage = true\n    debug.warn(msgId.uri + ' is unsigned') // TODO replace with UI (colored message ?)\n  } else { // signed message, get public key and check signature\n    getPublicKey(creator).then(publicKey => {\n      // debug.log(creator.uri + '\\n' + msg.created + '\\n' + msg.id + '\\n' + publicKey)\n      if (!publicKey) {\n        debug.warn('message is signed but ' + creator.uri + ' is missing publicKey')\n      }\n      // check that publicKey is a valid hex string\n      const regex = /[0-9A-Fa-f]{6}/g\n      if (!publicKey?.match(regex)) debug.warn('invalid publicKey hex string\\n' + creator.uri + '\\n' + publicKey)\n      // verify signature\n      else if (signature?.value && !verifySignature(signature?.value, msg, publicKey)) debug.warn('invalid signature\\n' + msg.id)\n    })\n  }\n\n  const originalMessage = await originalVersion(message)\n  const edited = !message.sameTerm(originalMessage)\n  // @@ load it first  @@   Or display the new data at the old date.\n  // @@@ kludge!\n  const sortDate = store.the(originalMessage, ns.dct('created'), null, originalMessage.doc()) || store.the(message, ns.dct('created'), null, message.doc())\n  // In message\n\n  const messageRow = dom.createElement('tr')\n  if (unsignedMessage) messageRow.setAttribute('style', 'background-color: red')\n  messageRow.AJAR_date = sortDate.value\n  messageRow.AJAR_subject = message\n\n  const td1 = dom.createElement('td')\n  messageRow.appendChild(td1)\n  if (!options.authorDateOnLeft) {\n    const img = dom.createElement('img')\n    img.setAttribute(\n      'style',\n      'max-height: 2.5em; max-width: 2.5em; border-radius: 0.5em; margin: auto;'\n    )\n    widgets.setImage(img, creator)\n    td1.appendChild(img)\n  } else {\n    creatorAndDate(td1, creator, widgets.shortDate(sortDate.value), message)\n  }\n  let bothDates = widgets.shortDate(sortDate.value)\n  if (edited) {\n    bothDates += ' ... ' + widgets.shortDate(date.value)\n  }\n\n  // Render the content ot the message itself\n  const td2 = messageRow.appendChild(dom.createElement('td'))\n\n  if (!options.authorDateOnLeft) {\n    creatorAndDateHorizontal(\n      td2,\n      creator,\n      bothDates, // widgets.shortDate(dateString)\n      message\n    )\n  }\n  const text = content ? content.value.trim() : '??? no content?'\n  const isURI = /^https?:\\/[^ <>]*$/i.test(text)\n  let para = null\n  if (isURI) {\n    const isImage = /\\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(text) // @@ Should use content-type not URI\n    if (isImage && options.expandImagesInline) {\n      const img = elementForImageURI(text, options)\n      td2.appendChild(img)\n    } else {\n      // Link but not Image\n      const anc = td2.appendChild(dom.createElement('a'))\n      para = anc.appendChild(dom.createElement('p'))\n      anc.href = text\n      para.textContent = text\n      td2.appendChild(anc)\n    }\n  } else {\n    // text\n    para = dom.createElement('p')\n    td2.appendChild(para)\n    para.textContent = text\n  }\n  if (para) {\n    const bgcolor = colorizeByAuthor\n      ? pad.lightColorHash(creator)\n      : getBgColor(fresh)\n    para.setAttribute(\n      'style',\n      messageBodyStyle + 'background-color: ' + bgcolor + ';'\n    )\n  }\n\n  function getBgColor (fresh) {\n    return fresh ? '#e8ffe8' : 'white'\n  }\n\n  // Sentiment strip\n  const strip = await sentimentStripLinked(message, message.doc())\n  if (strip.children.length) {\n    td2.appendChild(dom.createElement('br'))\n    td2.appendChild(strip)\n  }\n\n  // Message tool bar button\n  const td3 = dom.createElement('td')\n  messageRow.appendChild(td3)\n  const toolsButton = widgets.button(\n    dom,\n    icons.iconBase + 'noun_243787.svg',\n    '...'\n  )\n  td3.appendChild(toolsButton)\n  toolsButton.addEventListener('click', async function (_event) {\n    if (messageRow.toolTR) {\n      // already got a toolbar? Toogle\n      messageRow.parentNode.removeChild(messageRow.toolTR)\n      delete messageRow.toolTR\n      return\n    }\n    const toolsTR = dom.createElement('tr')\n    const tools = await messageToolbar(message, messageRow, { ...userContext, chatOptions: options }, channelObject)\n    tools.style =\n      'border: 0.05em solid #888; border-radius: 0 0 0.7em 0.7em;  border-top: 0; height:3.5em; background-color: #fff;' // @@ fix\n    if (messageRow.nextSibling) {\n      messageRow.parentElement.insertBefore(toolsTR, messageRow.nextSibling)\n    } else {\n      messageRow.parentElement.appendChild(toolsTR)\n    }\n    messageRow.toolTR = toolsTR\n    toolsTR.appendChild(dom.createElement('td')) // left\n    const toolsTD = toolsTR.appendChild(dom.createElement('td'))\n    toolsTR.appendChild(dom.createElement('td')) // right\n    toolsTD.appendChild(tools)\n  })\n  if (thread && options.showThread) {\n    // debug.log('  message has thread ' + thread)\n    td3.appendChild(widgets.button(\n      dom,\n      icons.iconBase + 'noun_1180164.svg', // right arrow .. @@ think of stg better\n      'see thread',\n      _e => {\n        // debug.log('@@@@ Calling showThread thread ' + thread)\n        options.showThread(thread, options)\n      }\n    ))\n  }\n  return messageRow\n} // END OF RENDERMESSAGE\n\nexport async function switchToEditor (messageRow, message, channelObject, userContext) {\n  const messageTable = messageRow.parentNode\n  const editRow = renderMessageEditor(channelObject, messageTable, userContext,\n    channelObject.options, await mostRecentVersion(message))\n  messageTable.insertBefore(editRow, messageRow)\n  editRow.originalRow = messageRow\n  messageRow.style.visibility = 'hidden' // Hide the original message. unhide if user cancels edit\n}\n/*       Control for a new message -- or editing an old message ***************\n *\n */\nexport function renderMessageEditor (channelObject, messageTable, userContext, options, originalMessage) {\n  function revertEditing (messageEditor) {\n    messageEditor.originalRow.style.visibility = 'visible' // restore read-only version\n    messageEditor.parentNode.removeChild(messageEditor)\n  }\n\n  async function handleFieldInput (_event) {\n    await sendMessage(field.value, true)\n  }\n\n  async function sendMessage (text, fromMainField) {\n    async function sendComplete (message, _text2) {\n      // const dateStamp = store.any(message, ns.dct('created'), null, message.doc())\n      // const content = $rdf.literal(text2)\n      await insertMessageIntoTable(channelObject, messageTable, message, false, options, userContext) // not green\n\n      if (originalMessage) { // editing another message\n        const oldRow = messageEditor.originalRow\n        // oldRow.style.display = '' // restore read-only version, re-attack\n        if (oldRow.parentNode) {\n          oldRow.parentNode.removeChild(oldRow) // No longer needed old version\n        } else {\n          debug.warn('No parentNode on old message ' + oldRow.textContent)\n          oldRow.style.backgroundColor = '#fee'\n          oldRow.style.visibility = 'hidden' // @@ FIX THIS AND REMOVE FROM DOM INSTEAD\n        }\n        messageEditor.parentNode.removeChild(messageEditor) // no longer need editor\n      } else {\n        if (fromMainField) {\n          field.value = '' // clear from out for reuse\n          field.setAttribute('style', messageBodyStyle)\n          field.disabled = false\n          field.scrollIntoView(options.newestFirst) // allign bottom (top)\n          field.focus() // Start typing next line immediately\n          field.select()\n        }\n      }\n      // await channelObject.div.refresh() // Add new day if nec  @@ add back\n    }\n\n    // const me = authn.currentUser() // Must be logged on or wuld have got login button\n    if (fromMainField) {\n      field.setAttribute('style', messageBodyStyle + 'color: #bbb;') // pendingedit\n      field.disabled = true\n    }\n\n    let message\n    try {\n      message = await channelObject.updateMessage(text, originalMessage, null, options.thread)\n    } catch (err) {\n      const statusArea = userContext.statusArea || messageEditor\n      statusArea.appendChild(\n        widgets.errorMessageBlock(dom, 'Error writing message: ' + err)\n      )\n      return\n    }\n    await sendComplete(message, text)\n  } // sendMessage\n\n  //    DRAG AND DROP\n  function droppedFileHandler (files) {\n    const base = messageTable.chatDocument.dir().uri\n    widgets.uploadFiles(\n      store.fetcher,\n      files,\n      base + 'Files',\n      base + 'Pictures',\n      async function (theFile, destURI) {\n        // @@@@@@ Wait for each if several\n        await sendMessage(destURI)\n      }\n    )\n  }\n\n  // When a set of URIs are dropped on the field\n  const droppedURIHandler = async function (uris) {\n    for (const uri of uris) {\n      await sendMessage(uri)\n    }\n  }\n\n  // When we are actually logged on\n  function turnOnInput () {\n    function getImageDoc () {\n      imageDoc = $rdf.sym(\n        chatDocument.dir().uri + 'Image_' + Date.now() + '.png'\n      )\n      return imageDoc\n    }\n\n    async function tookPicture (imageDoc) {\n      if (imageDoc) {\n        await sendMessage(imageDoc.uri)\n      }\n    }\n\n    // Body of turnOnInput\n\n    let menuButton\n    if (options.menuHandler) {\n      const menuButton = widgets.button(\n        dom, icons.iconBase + 'noun_243787.svg', 'More')\n      menuButton.setAttribute('style', style.buttonStyle + 'float: right;')\n      // menuButton.addEventListener('click', _event => sendMessage(), false) (done in turnoninput)\n      rhs.appendChild(menuButton)\n    }\n\n    if (options.menuHandler && menuButton) {\n      const me = authn.currentUser()\n      const menuOptions = {\n        me,\n        dom,\n        div: null, // @@ was: div\n        newBase: messageTable.chatDocument.dir().uri\n      }\n      menuButton.addEventListener(\n        'click',\n        event => {\n          options.menuHandler(event, channelObject.chatChannel, menuOptions)\n        },\n        false\n      )\n    }\n\n    const me = authn.currentUser() // If already logged on\n    creatorAndDate(lhs, me, '', null)\n\n    field = dom.createElement('textarea')\n    middle.innerHTML = ''\n    middle.appendChild(field)\n    field.rows = 3\n    if (originalMessage) {\n      field.value = store.anyValue(originalMessage, ns.sioc('content'), null, originalMessage.doc())\n    }\n    // field.cols = 40\n    field.setAttribute('style', messageBodyStyle + 'background-color: #eef;')\n\n    // Trap the Enter BEFORE it is used ti make a newline\n\n    field.addEventListener(\n      'keydown',\n      async function (e) {\n        // User preference?\n        if (e.code === 'Enter') {\n        // if (e.keyCode === 13) { // deprocated https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n          if ((!e.shiftKey && !options.shiftEnterSendsMessage) || (e.shiftKey && options.shiftEnterSendsMessage)) {\n            // Shift-Enter just adds a new line\n            // (note alt-enter doesn't add newline anyway on my setup - so have to use shift.\n            await handleFieldInput(e)\n          }\n        }\n      },\n      false\n    )\n\n    widgets.makeDropTarget(field, droppedURIHandler, droppedFileHandler)\n\n    rhs.innerHTML = ''\n\n    sendButton = widgets.button(dom, sendIcon, 'Send')\n    sendButton.style.float = 'right'\n    sendButton.addEventListener('click', _event => handleFieldInput(), false)\n    rhs.appendChild(sendButton)\n\n    if (originalMessage) { // Are we editing another message?\n      const cancelButton = rhs.appendChild(widgets.cancelButton(dom))\n      cancelButton.style.float = 'left'\n      // cancelButton.firstChild.style.opacity = '0.3' // moved to buttons\n      cancelButton.addEventListener('click', _event => revertEditing(messageEditor), false)\n      rhs.appendChild(cancelButton)\n    }\n\n    const chatDocument = channelObject.dateFolder.leafDocumentFromDate(new Date())\n    let imageDoc\n\n    middle.appendChild(\n      media.cameraButton(dom, store, getImageDoc, tookPicture)\n    )\n\n    pad.recordParticipation(channelObject.channel, channelObject.channel.doc()) // participation =\n  } // turn on inpuut\n\n  // Body of renderMessageEditor\n\n  let sortDate, sendIcon\n  if (originalMessage) {\n    sortDate = store.anyValue(originalMessage, ns.dct('created'), null, originalMessage.doc())\n    // text = store.anyValue(originalMessage, ns.sioc('content'), null, originalMessage.doc())\n    sendIcon = icons.iconBase + 'noun_1180158.svg' // Green check\n    // cancelIcon = icons.iconBase + 'noun_1180156.svg' // Black cross\n  } else {\n    sendIcon = icons.iconBase + 'noun_383448.svg'\n    sortDate = '9999-01-01T00:00:00Z' // ISO format for field sort\n    // text = ''\n  }\n  const messageEditor = dom.createElement('tr')\n  const lhs = dom.createElement('td')\n  const middle = dom.createElement('td')\n  const rhs = dom.createElement('td')\n  messageEditor.appendChild(lhs)\n  messageEditor.appendChild(middle)\n  messageEditor.appendChild(rhs)\n  messageEditor.AJAR_date = sortDate\n  // messageEditor.appendChild(dom.createElement('br'))\n\n  let field, sendButton\n  const context = { div: middle, dom }\n\n  ensureLoggedIn(context).then(context => {\n    // me = context.me\n    turnOnInput()\n    Object.assign(context, userContext)\n    findBookmarkDocument(context).then(_context => {\n      // debug.log('Bookmark file: ' + context.bookmarkDocument)\n    })\n  })\n\n  return messageEditor\n} // renderMessageEditor\n","/**\n * Contains the [[infiniteMessageArea]] class\n * @packageDocumentation\n */\n// import { findBookmarkDocument } from './bookmarks'\nimport * as $rdf from 'rdflib' // pull in first avoid cross-refs\nimport { store } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport ns from '../ns'\n// import { style } from '../style'\n// import * as utils from '../utils'\nimport * as widgets from '../widgets'\n// import * as pad from '../pad'\n// import { DateFolder } from './dateFolder'\nimport { ChatChannel, isDeleted } from './chatLogic'\nimport { renderMessageEditor, renderMessageRow } from './message'\n\n// const UI = { authn, icons, ns, media, pad, $rdf, store, style, utils, widgets }\n\nexport function desktopNotification (str) {\n  // Let's check if the browser supports notifications\n  if (!('Notification' in window)) {\n    debug.warn('This browser does no t support desktop notification')\n  } else if (Notification.permission === 'granted') {\n    // Let's check whether notificatio n permissions have already been granted\n    // eslint-disable-next-line no-new\n    new Notification(str)\n  } else if (Notification.permission !== 'denied') {\n    // Otherwise, we need to ask the user for permission\n    Notification.requestPermission().then(function (permission) {\n      // If the user accepts, let's create a notification\n      if (permission === 'granted') {\n        // eslint-disable-next-line no-new\n        new Notification(str)\n      }\n    })\n  }\n  // At last, if the user has denied notifications, and you\n  // want to be respectful there is no need to bother them any more.\n}\n\n/**\n * Renders a chat message inside a `messageTable`\n */\nexport async function insertMessageIntoTable (channelObject, messageTable, message, fresh, options, userContext) {\n  const messageRow = await renderMessageRow(channelObject,\n    message,\n    fresh,\n    options,\n    userContext\n  )\n\n  // const message = messageRow.AJAR_subject\n  if (options.selectedMessage && options.selectedMessage.sameTerm(message)) {\n    messageRow.style.backgroundColor = 'yellow'\n    options.selectedElement = messageRow\n    messageTable.selectedElement = messageRow\n  }\n\n  let done = false\n  for (let ele = messageTable.firstChild; ; ele = ele.nextSibling) {\n    if (!ele) {\n      // empty\n      break\n    }\n    const newestFirst = options.newestfirst === true\n    const dateString = messageRow.AJAR_date\n    if (\n      (dateString > ele.AJAR_date && newestFirst) ||\n      (dateString < ele.AJAR_date && !newestFirst)\n    ) {\n      messageTable.insertBefore(messageRow, ele)\n      done = true\n      break\n    }\n  }\n  if (!done) {\n    messageTable.appendChild(messageRow)\n  }\n}\n\n/**\n * Common code for a chat (discussion area of messages about something)\n * This version runs over a series of files for different time periods\n *\n * Parameters for the whole chat like its title are stored on\n * index.ttl#this and the chats messages are stored in YYYY/MM/DD/chat.ttl\n *\n * Use to import store as param 2, now ignores it and uses the UI main store\n *\n * Options include:\n\n - shiftEnterSendsMessage: Use shift/enter to send message, Enter to add newline, instead of the reverse.\n - authorDateOnLeft:  Display the author's anme and date of the message in the left column instead of first above the content\n - selectedMessage: Display one message highlighted with the chat around it\n - solo: By itelf on a webpage, so user scroll anywhere in the web page scan scroll the chat.\n - newestFirst: Arrange the chat messages chronologically newest at the top insted of at the bottom\n - infinite:  Use infinite scroll\n - showDeletedMessages: Show messages which have been delted as \"deleted message\". Otherwise hide them.\n - expandImagesInline: If a URI by itself in a message looks like an image URI, replace it with the image\n - inlineImageHeightEms: The height (in ems) of images expaned from their URIs in the chat.\n\n */\nexport async function infiniteMessageArea (dom, wasStore, chatChannel, options) {\n  // ///////////////////////////////////////////////////////////////////////\n\n  async function syncMessages (chatChannel, messageTable) {\n    const displayed = {}\n    let ele, ele2\n    for (ele = messageTable.firstChild; ele; ele = ele.nextSibling) {\n      if (ele.AJAR_subject) {\n        displayed[ele.AJAR_subject.uri] = true\n      }\n    }\n    const messages = store.each(chatChannel, ns.wf('message'), null, messageTable.chatDocument)\n\n    const stored = {}\n    for (const m of messages) {\n      stored[m.uri] = true\n      if (!displayed[m.uri]) {\n        await addMessage(m, messageTable)\n      }\n    }\n\n    for (ele = messageTable.firstChild; ele;) {\n      ele2 = ele.nextSibling\n      if (ele.AJAR_subject && !stored[ele.AJAR_subject.uri]) {\n        messageTable.removeChild(ele)\n      }\n      ele = ele2\n    }\n    for (ele = messageTable.firstChild; ele; ele = ele.nextSibling) {\n      if (ele.AJAR_subject) {\n        // Refresh thumbs up etc\n        widgets.refreshTree(ele) // Things inside may have changed too\n      }\n    }\n  } // syncMessages\n\n  // Called once per original message displayed\n  async function addMessage (message, messageTable) {\n    // const latest = await mostRecentVersion(message)\n    // const content = store.any(latest, ns.sioc('content'))\n    if (isDeleted(message) && !options.showDeletedMessages) {\n      return // ignore deleted messaged -- @@ could also leave a placeholder\n    }\n    /* if (isReplaced(message)) { //\n      return // this is old version\n    } */\n    let thread = store.any(null, ns.sioc('has_member'), message, message.doc())\n    const id = store.any(message, ns.sioc('id'), null, message.doc())\n    if (id && !thread) {\n      thread = store.any(null, ns.sioc('has_member'), id, message.doc())\n    }\n\n    if (options.thread) { // only show things in thread\n      if (store.holds(message, ns.sioc('has_reply'), options.thread)) { // root of thread\n        // debug.log(' addMessage: displaying root of thread ' + thread)\n      } else if (thread && thread.sameTerm(options.thread)) {\n        // debug.log(' addMessage: Displaying body of thread ' + message.uri.slice(-10))\n      } else {\n        // debug.log(' addMessage: Suppress non-thread message in thread table ' + message.uri.slice(-10))\n        return // suppress message not in thread\n      }\n    } else { // Not threads\n      if (thread) {\n        // debug.log(' addMessage: Suppress thread message in non-thread table ' + message.uri.slice(-10))\n        return // supress thread messages in body\n      } else {\n        // debug.log(' addMessage: Normal non-thread message in non-thread table ' + message.uri.slice(-10))\n      }\n    }\n    if (!messageTable.fresh) { // if messageTable has been updated with insertMessageIntoTable() don't do it again\n      // debug.log('@@@ infinite insertMessageIntoTable ' + message) // alain\n      // debug.log('fresh ' + messageTable.fresh)\n      // debug.log(messageTable)\n      await insertMessageIntoTable(channelObject,\n        messageTable,\n        message,\n        messageTable.fresh,\n        options,\n        userContext\n      ) // fresh from elsewhere\n    }\n  }\n\n  /* Add a new messageTable at the top/bottom\n\n   */\n  async function insertPreviousMessages (backwards) {\n    const extremity = backwards ? earliest : latest\n    let date = extremity.messageTable.date // day in mssecs\n\n    // Are we at the top of a thread?\n    if (backwards && earliest.limit && date <= earliest.limit) {\n      if (!liveMessageTable) await appendCurrentMessages() // If necessary skip to today and add that\n      return true // done\n    }\n    // debug.log(' insertPreviousMessages:  loadPrevious given date ' + date)\n\n    date = await dateFolder.loadPrevious(date, backwards) // backwards\n    // debug.log(' insertPreviousMessages:  loadPrevious returns date ' + date)\n\n    /* debug.log(\n      `insertPreviousMessages: from ${\n        backwards ? 'backwards' : 'forwards'\n      } loadPrevious: ${date}`\n    ) */\n    if (!date && !backwards && !liveMessageTable) {\n      await appendCurrentMessages() // If necessary skip to today and add that\n    }\n    if (!date) return true // done\n    let live = false\n    if (!backwards) {\n      const todayDoc = dateFolder.leafDocumentFromDate(new Date())\n      const doc = dateFolder.leafDocumentFromDate(date)\n      live = doc.sameTerm(todayDoc) // Is this todays?\n    }\n    const newMessageTable = await createMessageTable(date, live)\n    extremity.messageTable = newMessageTable // move pointer to earliest\n    if (backwards ? newestFirst : !newestFirst) {\n      // put on bottom or top\n      div.appendChild(newMessageTable)\n    } else {\n      // put on top as we scroll back\n      div.insertBefore(newMessageTable, div.firstChild)\n    }\n    return live // not done\n  }\n\n  /* Remove message tables earlier than this one\n   */\n  function removePreviousMessages (backwards, messageTable) {\n    if (backwards ? newestFirst : !newestFirst) {\n      // it was put on bottom\n      while (messageTable.nextSibling) {\n        div.removeChild(messageTable.nextSibling)\n      }\n    } else {\n      // it was put on top as we scroll back\n      while (messageTable.previousSibling) {\n        div.removeChild(messageTable.previousSibling)\n      }\n    }\n    const extr = backwards ? earliest : latest\n    extr.messageTable = messageTable\n  }\n\n  /* Load and render message table\n   ** @returns DOM element generates\n   */\n  async function createMessageTable (date, live) {\n    // debug.log('   createMessageTable for  ' + date)\n    const chatDocument = dateFolder.leafDocumentFromDate(date)\n    try {\n      await store.fetcher.createIfNotExists(chatDocument)\n    } catch (err) {\n      const messageTable = dom.createElement('table')\n      const statusTR = messageTable.appendChild(dom.createElement('tr')) // ### find status in exception\n      if (err.response && err.response.status && err.response.status === 404) {\n        // debug.log('Error 404 for chat file ' + chatDocument)\n        return await renderMessageTable(date, live) // no message file is fine. will be created later\n        // statusTR.appendChild(widgets.errorMessageBlock(dom, 'no message file', 'white'))\n      } else {\n        debug.log('*** Error NON 404 for chat file ' + chatDocument)\n        statusTR.appendChild(widgets.errorMessageBlock(dom, err, 'pink'))\n      }\n      return statusTR\n    }\n    return await renderMessageTable(date, live)\n  }\n\n  async function renderMessageTable (date, live) {\n    const scrollBackbutton = null // was let\n    const scrollForwardButton = null // was let\n\n    /// /////////////////   Scroll down adding more above\n\n    async function extendBackwards () {\n      const done = await insertPreviousMessages(true)\n      if (done) {\n        if (scrollBackbutton) {\n          scrollBackbutton.firstChild.setAttribute(\n            'src',\n            icons.iconBase + 'noun_T-Block_1114655_000000.svg'\n          ) // T\n          scrollBackbutton.disabled = true\n        }\n        messageTable.initial = true\n      } else {\n        messageTable.extendedBack = true\n      }\n      setScrollBackbuttonIcon()\n      return done\n    }\n\n    function setScrollBackbuttonIcon () {\n      if (!scrollBackbutton) {\n        return\n      }\n      const sense = messageTable.extendedBack ? !newestFirst : newestFirst\n      const scrollBackIcon = messageTable.initial\n        ? 'noun_T-Block_1114655_000000.svg'\n        : getScrollbackIcon(sense)\n      scrollBackbutton.firstChild.setAttribute(\n        'src',\n        icons.iconBase + scrollBackIcon\n      )\n\n      function getScrollbackIcon (sense) {\n        return sense ? 'noun_1369241.svg' : 'noun_1369237.svg'\n      }\n    }\n\n    /// ////////////// Scroll up adding more below\n\n    async function extendForwards () {\n      const done = await insertPreviousMessages(false)\n      /*\n      if (done) {\n        scrollForwardButton.firstChild.setAttribute(\n          'src',\n          icons.iconBase + 'noun_T-Block_1114655_000000.svg'\n        )\n        scrollForwardButton.disabled = true\n        messageTable.final = true\n      } else {\n        messageTable.extendedForwards = true\n      }\n      setScrollForwardButtonIcon()\n      */\n      return done\n    }\n\n    function setScrollForwardButtonIcon () {\n      if (!scrollForwardButton) return\n      const sense = messageTable.extendedForwards ? !newestFirst : newestFirst // noun_T-Block_1114657_000000.svg\n      const scrollForwardIcon = messageTable.final\n        ? 'noun_T-Block_1114657_000000.svg'\n        : getScrollForwardButtonIcon(sense)\n      scrollForwardButton.firstChild.setAttribute(\n        'src',\n        icons.iconBase + scrollForwardIcon\n      )\n\n      function getScrollForwardButtonIcon (sense) {\n        return !sense ? 'noun_1369241.svg' : 'noun_1369237.svg'\n      }\n    }\n\n    // eslint-disable-next-line no-unused-vars\n    async function scrollForwardButtonHandler (_event) {\n      if (messageTable.extendedForwards) {\n        removePreviousMessages(false, messageTable)\n        messageTable.extendedForwards = false\n        setScrollForwardButtonIcon()\n      } else {\n        await extendForwards() // async\n        latest.messageTable.scrollIntoView(newestFirst)\n      }\n    }\n\n    /// ///////////////////////\n    /*\n    options = options || {}\n    options.authorDateOnLeft = true\n    const newestFirst = options.newestFirst === '1' || options.newestFirst === true // hack for now\n    const channelObject = new ChatChannel(chatChannel, options)\n    const dateFolder = channelObject.dateFolder\n\n    const div = dom.createElement('div')\n    const statusArea = div.appendChild(dom.createElement('div'))\n    const userContext = { dom, statusArea, div: statusArea } // logged on state, pointers to user's stuff\n\n*/\n    // debug.log('Options for called message Area', options)\n    const messageTable = dom.createElement('table')\n    messageTable.style.width = '100%' // fill the pane div\n    messageTable.extendBackwards = extendBackwards // Make function available to scroll stuff\n    messageTable.extendForwards = extendForwards // Make function available to scroll stuff\n\n    messageTable.date = date\n    const chatDocument = dateFolder.leafDocumentFromDate(date)\n    messageTable.chatDocument = chatDocument\n\n    messageTable.fresh = false\n    messageTable.setAttribute('style', 'width: 100%;') // fill that div!\n    if (live) {\n      messageTable.final = true\n      liveMessageTable = messageTable\n      latest.messageTable = messageTable\n      const tr = renderMessageEditor(channelObject, messageTable, userContext, options)\n      if (newestFirst) {\n        messageTable.insertBefore(tr, messageTable.firstChild) // If newestFirst\n      } else {\n        messageTable.appendChild(tr) // not newestFirst\n      }\n      messageTable.inputRow = tr\n    }\n\n    /// ///// Infinite scroll\n    //\n    // @@ listen for swipe past end event not just button\n    const test = true\n    if (test) { // ws options.infinite but need for non-infinite\n      const titleTR = dom.createElement('tr')\n      /*  const scrollBackbuttonCell = titleTR.appendChild(\n        dom.createElement('td')\n      ) */\n      // up traingles: noun_1369237.svg\n      // down triangles: noun_1369241.svg\n      /*\n      const scrollBackIcon = newestFirst\n        ? 'noun_1369241.svg'\n        : 'noun_1369237.svg' // down and up arrows respoctively\n      scrollBackbutton = widgets.button(\n        dom,\n        icons.iconBase + scrollBackIcon,\n        'Previous messages ...'\n      )\n      scrollBackbuttonCell.style = 'width:3em; height:3em;'\n      scrollBackbutton.addEventListener('click', scrollBackbuttonHandler, false)\n      messageTable.extendedBack = false\n      scrollBackbuttonCell.appendChild(scrollBackbutton)\n      setScrollBackbuttonIcon()\n      */\n      const dateCell = titleTR.appendChild(dom.createElement('td'))\n      dateCell.style =\n        'text-align: center; vertical-align: middle; color: #888; font-style: italic;'\n      dateCell.textContent = widgets.shortDate(date.toISOString(), true) // no time, only date\n\n      // @@@@@@@@@@@ todo move this button to other end of  message cell, o\n      const scrollForwardButtonCell = titleTR.appendChild(\n        dom.createElement('td')\n      )\n      if (options.includeRemoveButton) {\n        scrollForwardButtonCell.appendChild(widgets.cancelButton(dom, _e => {\n          div.parentNode.removeChild(div)\n        }))\n      }\n      /*\n      const scrollForwardIcon = newestFirst\n        ? 'noun_1369241.svg'\n        : 'noun_1369237.svg' // down and up arrows respoctively\n      scrollForwardButton = widgets.button(\n        dom,\n        icons.iconBase + scrollForwardIcon,\n        'Later messages ...'\n      )\n      scrollForwardButtonCell.appendChild(scrollForwardButton)\n      scrollForwardButtonCell.style = 'width:3em; height:3em;'\n      scrollForwardButton.addEventListener(\n        'click',\n        scrollForwardButtonHandler,\n        false\n      )\n      messageTable.extendedForward = false\n      setScrollForwardButtonIcon()\n      */\n      messageTable.extendedForwards = false\n\n      if (!newestFirst) {\n        // opposite end from the entry field\n        messageTable.insertBefore(titleTR, messageTable.firstChild) // If not newestFirst\n      } else {\n        messageTable.appendChild(titleTR) //  newestFirst\n      }\n    }\n\n    const sts = store.statementsMatching(null, ns.wf('message'), null, chatDocument)\n    if (!live && sts.length === 0) {\n      // not todays\n      // no need buttomns at the moment\n      // messageTable.style.visibility = 'collapse' // Hide files with no messages\n    }\n    for (const st of sts) {\n      await addMessage(st.object, messageTable)\n    }\n    messageTable.fresh = true // message table updated with insertMessageIntoTable()\n    return messageTable\n  } // renderMessageTable\n\n  async function addNewChatDocumentIfNewDay () {\n    // @@ Remove listener from previous table as it is now static\n    const newChatDocument = dateFolder.leafDocumentFromDate(new Date())\n    if (!newChatDocument.sameTerm(latest.messageTable.chatDocument)) {\n      // It is a new day\n      if (liveMessageTable.inputRow) {\n        liveMessageTable.removeChild(liveMessageTable.inputRow)\n        delete liveMessageTable.inputRow\n      }\n      const oldChatDocument = latest.messageTable.chatDocument\n      await appendCurrentMessages()\n      // Adding a link in the document will ping listeners to add the new block too\n      if (\n        !store.holds(\n          oldChatDocument,\n          ns.rdfs('seeAlso'),\n          newChatDocument,\n          oldChatDocument\n        )\n      ) {\n        const sts = [\n          $rdf.st(\n            oldChatDocument,\n            ns.rdfs('seeAlso'),\n            newChatDocument,\n            oldChatDocument\n          )\n        ]\n        try {\n          store.updater.update([], sts)\n        } catch (err) {\n          alert('Unable to link old chat file to new one:' + err)\n        }\n      }\n    }\n  }\n\n  /*\n  function messageCount () {\n    var n = 0\n    const tables = div.children\n    for (let i = 0; i < tables.length; i++) {\n      n += tables[i].children.length - 1\n      // debug.log('    table length:' + tables[i].children.length)\n    }\n    return n\n  }\n*/\n\n  /* Add the live message block with entry field for today\n   */\n  async function appendCurrentMessages () {\n    const now = new Date()\n    const chatDocument = dateFolder.leafDocumentFromDate(now)\n\n    /// ///////////////////////////////////////////////////////////\n    const messageTable = await createMessageTable(now, true)\n    div.appendChild(messageTable)\n    div.refresh = async function () {\n      // only the last messageTable is live\n      await addNewChatDocumentIfNewDay(new Date())\n      await syncMessages(chatChannel, messageTable) // @@ livemessagetable??\n      desktopNotification(chatChannel)\n    } // The short chat version the live update listening is done in the pane but we do it in the widget @@\n    store.updater.addDownstreamChangeListener(chatDocument, div.refresh) // Live update\n    liveMessageTable = messageTable\n    latest.messageTable = liveMessageTable\n    return messageTable\n  }\n\n  async function loadMoreWhereNeeded (event, fixScroll) {\n    if (lock) return\n    lock = true\n    const freeze = !fixScroll\n    const magicZone = 150\n    // const top = div.scrollTop\n    // const bottom = div.scrollHeight - top - div.clientHeight\n    let done\n\n    while (\n      div.scrollTop < magicZone &&\n      earliest.messageTable &&\n      !earliest.messageTable.initial &&\n      earliest.messageTable.extendBackwards\n    ) {\n      // If this has been called before the element is actually in the\n      // user's DOM tree, then this scrollTop check won't work -> loop forever\n      // https://github.com/solidos/solid-ui/issues/366\n      if (div.scrollHeight === 0) {\n        // debug.log('    chat/loadMoreWhereNeeded: trying later...')\n        setTimeout(loadMoreWhereNeeded, 2000) // couple be less\n        lock = false\n        return // abandon now, do later\n      }\n      // debug.log('    chat/loadMoreWhereNeeded: Going now')\n      const scrollBottom = div.scrollHeight - div.scrollTop\n      // debug.log('infinite scroll: adding above: top ' + div.scrollTop)\n      done = await earliest.messageTable.extendBackwards()\n      if (freeze) {\n        div.scrollTop = div.scrollHeight - scrollBottom\n      }\n      if (fixScroll) fixScroll()\n      if (done) break\n    }\n    while (\n      options.selectedMessage && // we started in the middle not at the bottom\n      div.scrollHeight - div.scrollTop - div.clientHeight < magicZone && // we are scrolled right to the bottom\n      latest.messageTable &&\n      !latest.messageTable.final && // there is more data to come\n      latest.messageTable.extendForwards\n    ) {\n      const scrollTop = div.scrollTop\n      /* debug.log(\n        'infinite scroll: adding below: bottom: ' +\n        (div.scrollHeight - div.scrollTop - div.clientHeight)\n      ) */\n      done = await latest.messageTable.extendForwards() // then add more data on the bottom\n      if (freeze) {\n        div.scrollTop = scrollTop // while adding below keep same things in view\n      }\n      if (fixScroll) fixScroll()\n      if (done) break\n    }\n    lock = false\n  }\n\n  async function loadInitialContent () {\n    function yank () {\n      if (selectedMessageTable && selectedMessageTable.selectedElement) {\n        selectedMessageTable.selectedElement.scrollIntoView({ block: 'center' })\n      }\n    }\n\n    // During initial load ONLY keep scroll to selected thing or bottom\n    function fixScroll () {\n      if (options.selectedElement) {\n        options.selectedElement.scrollIntoView({ block: 'center' }) // align tops or bottoms\n      } else {\n        if (liveMessageTable.inputRow.scrollIntoView) {\n          liveMessageTable.inputRow.scrollIntoView(newestFirst) // align tops or bottoms\n        }\n      }\n    }\n\n    let live, selectedDocument, threadRootDocument\n    if (options.selectedMessage) {\n      selectedDocument = options.selectedMessage.doc()\n    }\n    if (threadRootMessage) {\n      threadRootDocument = threadRootMessage.doc()\n    }\n    const initialDocment = selectedDocument || threadRootDocument\n\n    if (initialDocment) {\n      const now = new Date()\n      const todayDocument = dateFolder.leafDocumentFromDate(now)\n      live = todayDocument.sameTerm(initialDocment)\n    }\n\n    let selectedMessageTable\n    if (initialDocment && !live) {\n      const selectedDate = dateFolder.dateFromLeafDocument(initialDocment)\n      selectedMessageTable = await createMessageTable(selectedDate, live)\n      div.appendChild(selectedMessageTable)\n      earliest.messageTable = selectedMessageTable\n      latest.messageTable = selectedMessageTable\n      yank()\n      setTimeout(yank, 1000) // @@ kludge - restore position distubed by other cHANGES\n    } else {\n      // Live end\n      await appendCurrentMessages()\n      earliest.messageTable = liveMessageTable\n      latest.messageTable = liveMessageTable\n    }\n\n    await loadMoreWhereNeeded(null, fixScroll)\n    div.addEventListener('scroll', loadMoreWhereNeeded)\n    if (options.solo) {\n      document.body.addEventListener('scroll', loadMoreWhereNeeded)\n    }\n  }\n\n  // Body of main function\n\n  options = options || {}\n  options.authorDateOnLeft = false // @@ make a user optiosn\n  const newestFirst = options.newestFirst === '1' || options.newestFirst === true // hack for now\n\n  const channelObject = new ChatChannel(chatChannel, options)\n  const dateFolder = channelObject.dateFolder\n\n  const div = dom.createElement('div')\n  channelObject.div = div\n\n  const statusArea = div.appendChild(dom.createElement('div'))\n  const userContext = { dom, statusArea, div: statusArea } // logged on state, pointers to user's stuff\n\n  let liveMessageTable\n  let threadRootMessage\n  const earliest = { messageTable: null } // Stuff about each end of the loaded days\n  const latest = { messageTable: null }\n\n  if (options.thread) {\n    const thread = options.thread\n    threadRootMessage = store.any(null, ns.sioc('has_reply'), thread, thread.doc())\n    if (threadRootMessage) {\n      const threadTime = store.any(threadRootMessage, ns.dct('created'), null, threadRootMessage.doc())\n      if (threadTime) {\n        earliest.limit = new Date(threadTime.value)\n        // debug.log(' infinite: thread start at ' + earliest.limit)\n      }\n    }\n  }\n\n  let lock = false\n\n  await loadInitialContent()\n  return div\n}\n","//                  Solid-UI preferences\n//                  =====================\n//\n\nimport * as $rdf from 'rdflib' // pull in first avoid cross-refs\nimport { store } from 'solid-logic'\nimport * as debug from './debug'\nimport { ensureLoadedPreferences } from './login/login'\nimport ns from './ns'\nimport * as participation from './participation' // @ts-ignore\nimport * as widgets from './widgets'\n\nconst kb = store\n\n// This was tabulator . preferences in the tabulator\n//  Is this functionality used anywhere?\n//\n\n// used for storing user name\n// @@ Deprocate these functions.  They were used for\n// communication around the tabulator functionality about the user session\n\nexport const value = []\nexport function get (k) {\n  return value[k]\n}\n\nexport function set (k, v) {\n  if (typeof v !== 'string') {\n    debug.log('Non-string value of preference ' + k + ': ' + v)\n    throw new Error('Non-string value of preference ' + k + ': ' + v)\n  }\n  this.value[k] = v\n}\n\n// In a solid world, Preferences are stored in the web\n//\n// Make an RDF node for recording the common view preferences for any object\n// (maybe make it in a separate file?)\nexport function recordSharedPreferences (subject, context) {\n  return new Promise(function (resolve, reject) {\n    const sharedPreferences = kb.any(subject, ns.ui('sharedPreferences'))\n    if (!sharedPreferences) {\n      if (!kb.updater.editable(subject.doc())) {\n        debug.log(` Cant make shared preferences, may not change ${subject.doc}`)\n        resolve(context)\n      }\n      const sp = $rdf.sym(subject.doc().uri + '#SharedPreferences')\n      const ins = [\n        $rdf.st(subject, ns.ui('sharedPreferences'), sp, subject.doc())\n      ]\n      debug.log('Creating shared preferences ' + sp)\n      kb.updater.update([], ins, function (uri, ok, errorMessage) {\n        if (!ok) {\n          reject(new Error('Error creating shared prefs: ' + errorMessage))\n        } else {\n          context.sharedPreferences = sp\n          resolve(context)\n        }\n      })\n    } else {\n      context.sharedPreferences = sharedPreferences\n      resolve(context)\n    }\n  })\n}\n\n// Construct a personal defaults node in the preferences file for a given class of object\n//\nexport function recordPersonalDefaults (theClass, context) {\n  return new Promise(function (resolve, reject) {\n    ensureLoadedPreferences(context).then(\n      context => {\n        if (!context.preferencesFile) {\n          debug.log(\n            'Not doing private class preferences as no access to preferences file. ' +\n              context.preferencesFileError\n          )\n          return\n        }\n        const regs = kb.each(\n          null,\n          ns.solid('forClass'),\n          theClass,\n          context.preferencesFile\n        )\n        let ins = []\n        let prefs\n        let reg\n        if (regs.length) {\n          // Use existing node if we can\n          regs.forEach(r => {\n            prefs = prefs || kb.any(r, ns.solid('personalDefaults'))\n          })\n          if (prefs) {\n            context.personalDefaults = prefs // Found one\n            resolve(context)\n            return\n          } else {\n            prefs = widgets.newThing(context.preferencesFile)\n            reg = regs[0]\n          }\n        } else {\n          // no regs fo class\n          reg = widgets.newThing(context.preferencesFile)\n          ins = [\n            $rdf.st(\n              reg,\n              ns.rdf('type'),\n              ns.solid('TypeRegistration'),\n              context.preferencesFile\n            ),\n            $rdf.st(reg, ns.solid('forClass'), theClass, context.preferencesFile)\n          ]\n        }\n        prefs = widgets.newThing(context.preferencesFile)\n        ins.push(\n          $rdf.st(\n            reg,\n            ns.solid('personalDefaults'),\n            prefs,\n            context.preferencesFile\n          )\n        )\n        kb.updater.update([], ins, function (uri, ok, errm) {\n          if (!ok) {\n            reject(new Error('Setting preferences for ' + theClass + ': ' + errm))\n          } else {\n            context.personalDefaults = prefs\n            resolve(context)\n          }\n        })\n      },\n      err => {\n        reject(err)\n      }\n    )\n  })\n}\n\nexport function renderPreferencesForm (subject, theClass, preferencesForm, context) {\n  const prefContainer = context.dom.createElement('div')\n  participation.participationObject(subject, subject.doc(), context.me).then(\n    participation => {\n      const dom = context.dom\n      function heading (text) {\n        prefContainer.appendChild(dom.createElement('h5')).textContent = text\n      }\n      heading('My view of this ' + context.noun)\n      widgets.appendForm(\n        dom,\n        prefContainer,\n        {},\n        participation,\n        preferencesForm,\n        subject.doc(),\n        (ok, mes) => {\n          if (!ok) widgets.complain(context, mes)\n        }\n      )\n\n      heading('Everyone\\'s  view of this ' + context.noun)\n      recordSharedPreferences(subject, context).then(context => {\n        const sharedPreferences = context.sharedPreferences\n        widgets.appendForm(\n          dom,\n          prefContainer,\n          {},\n          sharedPreferences,\n          preferencesForm,\n          subject.doc(),\n          (ok, mes) => {\n            if (!ok) widgets.complain(context, mes)\n          }\n        )\n\n        heading('My default view of any ' + context.noun)\n        recordPersonalDefaults(theClass, context).then(\n          context => {\n            widgets.appendForm(\n              dom,\n              prefContainer,\n              {},\n              context.personalDefaults,\n              preferencesForm,\n              context.preferencesFile,\n              (ok, mes) => {\n                if (!ok) widgets.complain(context, mes)\n              }\n            )\n          },\n          err => {\n            widgets.complain(context, err)\n          }\n        )\n      })\n    },\n    err => {\n      // parp object fails\n      prefContainer.appendChild(widgets.errorMessageBlock(context.dom, err))\n    }\n  )\n  return prefContainer\n}\n\n// This should be part of rdflib.js ad part of the RDFJS Standard!!\n\nfunction toJS (term) {\n  if (!term.datatype) return term // Objects remain objects\n  if (term.datatype.equals(ns.xsd('boolean'))) {\n    return term.value === '1'\n  }\n  if (\n    term.datatype.equals(ns.xsd('dateTime')) ||\n    term.datatype.equals(ns.xsd('date'))\n  ) {\n    return new Date(term.value)\n  }\n  if (\n    term.datatype.equals(ns.xsd('integer')) ||\n    term.datatype.equals(ns.xsd('float')) ||\n    term.datatype.equals(ns.xsd('decimal'))\n  ) {\n    return Number(term.value)\n  }\n  return term.value\n}\n\n// This is the function which acuakly reads and combines the preferences\n//\n//  @@ make it much more tolerant of missing buts of prefernces\nexport function getPreferencesForClass (subject, theClass, predicates, context) {\n  return new Promise(function (resolve, reject) {\n    recordSharedPreferences(subject, context).then(context => {\n      const sharedPreferences = context.sharedPreferences\n      if (context.me) {\n        participation\n          .participationObject(subject, subject.doc(), context.me)\n          .then(participation => {\n            recordPersonalDefaults(theClass, context).then(context => {\n              const results = []\n              const personalDefaults = context.personalDefaults\n              predicates.forEach(pred => {\n                // Order of preference: My settings on object, Global settings on object, my settings on class\n                const v1 =\n                  kb.any(participation, pred) ||\n                  kb.any(sharedPreferences, pred) ||\n                  kb.any(personalDefaults, pred)\n                if (v1) {\n                  results[pred.uri] = toJS(v1)\n                }\n              })\n              resolve(results)\n            }, reject)\n          }, reject)\n      } else {\n        // no user defined, just use common prefs\n        const results = []\n        predicates.forEach(pred => {\n          const v1 = kb.any(sharedPreferences, pred)\n          if (v1) {\n            results[pred.uri] = toJS(v1)\n          }\n        })\n        resolve(results)\n      }\n    })\n  })\n}\n\n// ends\n","// Table Widget: Format an array of RDF statements as an HTML table.\n//\n// This can operate in one of three modes: when the class of object is given\n// or when the source document from whuch data is taken is given,\n// or if a prepared query object is given.\n// (In principle it could operate with neither class nor document\n// given but typically\n// there would be too much data.)\n// When the tableClass is not given, it looks for common  classes in the data,\n// and gives the user the option.\n//\n// 2008 Written, Ilaria Liccardi  as the tableViewPane.js\n// 2014 Core table widget moved into common/table.js - timbl\n//\n\nimport * as debug from './debug'\nimport { icons } from './iconBase'\nimport { store } from 'solid-logic'\nimport * as log from './log'\nimport ns from './ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\nimport * as utils from './utils'\nimport * as widgets from './widgets'\n\nconst UI = { icons, log, ns, utils, widgets }\n\n// UI.widgets.renderTableViewPane\nexport function renderTableViewPane (doc, options) {\n  const sourceDocument = options.sourceDocument\n  const tableClass = options.tableClass\n  const givenQuery = options.query\n\n  const RDFS_LITERAL = 'http://www.w3.org/2000/01/rdf-schema#Literal'\n  const ns = UI.ns\n  const kb = store\n  const rowsLookup = {} //  Persistent mapping of subject URI to dom TR\n\n  // Predicates that are never made into columns:\n\n  const FORBIDDEN_COLUMNS = {\n    'http://www.w3.org/2002/07/owl#sameAs': true,\n    'http://www.w3.org/1999/02/22-rdf-syntax-ns#type': true\n  }\n\n  // Number types defined in the XML schema:\n\n  const XSD_NUMBER_TYPES = {\n    'http://www.w3.org/2001/XMLSchema#decimal': true,\n    'http://www.w3.org/2001/XMLSchema#float': true,\n    'http://www.w3.org/2001/XMLSchema#double': true,\n    'http://www.w3.org/2001/XMLSchema#integer': true,\n    'http://www.w3.org/2001/XMLSchema#nonNegativeInteger': true,\n    'http://www.w3.org/2001/XMLSchema#positiveInteger': true,\n    'http://www.w3.org/2001/XMLSchema#nonPositiveInteger': true,\n    'http://www.w3.org/2001/XMLSchema#negativeInteger': true,\n    'http://www.w3.org/2001/XMLSchema#long': true,\n    'http://www.w3.org/2001/XMLSchema#int': true,\n    'http://www.w3.org/2001/XMLSchema#short': true,\n    'http://www.w3.org/2001/XMLSchema#byte': true,\n    'http://www.w3.org/2001/XMLSchema#unsignedLong': true,\n    'http://www.w3.org/2001/XMLSchema#unsignedInt': true,\n    'http://www.w3.org/2001/XMLSchema#unsignedShort': true,\n    'http://www.w3.org/2001/XMLSchema#unsignedByte': true\n  }\n\n  const XSD_DATE_TYPES = {\n    'http://www.w3.org/2001/XMLSchema#dateTime': true,\n    'http://www.w3.org/2001/XMLSchema#date': true\n  }\n\n  // Classes that indicate an image:\n\n  const IMAGE_TYPES = {\n    'http://xmlns.com/foaf/0.1/Image': true,\n    'http://purl.org/dc/terms/Image': true\n  }\n\n  // Name of the column used as a \"key\" value to look up the row.\n  // This is necessary because in the normal view, the columns are\n  // all \"optional\" values, meaning that we will get a result set\n  // for every individual value that is found.  The row key acts\n  // as an anchor that can be used to combine this information\n  // back into the same row.\n\n  const keyVariable = options.keyVariable || '?_row'\n\n  let subjectIdCounter = 0\n  let allType, types\n  let typeSelectorDiv, addColumnDiv\n\n  // The last SPARQL query used:\n  let lastQuery = null\n  let mostCommonType = null\n\n  const resultDiv = doc.createElement('div')\n  resultDiv.className = 'tableViewPane'\n\n  resultDiv.appendChild(generateControlBar()) // sets typeSelectorDiv\n\n  const tableDiv = doc.createElement('div')\n  resultDiv.appendChild(tableDiv)\n\n  // Save a refresh function for use by caller\n  resultDiv.refresh = function () {\n    runQuery(table.query, table.logicalRows, table.columns, table)\n    // updateTable(givenQuery, mostCommonType) // This could be a lot more incremental and efficient\n  }\n\n  // A specifically asked-for query\n  let table\n  if (givenQuery) {\n    table = renderTableForQuery(givenQuery)\n    // lastQuery = givenQuery\n    tableDiv.appendChild(table)\n  } else {\n    // Find the most common type and select it by default\n\n    const s = calculateTable()\n    allType = s[0]\n    types = s[1]\n    if (!tableClass) {\n      typeSelectorDiv.appendChild(generateTypeSelector(allType, types))\n    }\n\n    mostCommonType = getMostCommonType(types)\n\n    if (mostCommonType) {\n      buildFilteredTable(mostCommonType)\n    } else {\n      buildFilteredTable(allType)\n    }\n  }\n  return resultDiv\n\n  // /////////////////////////////////////////////////////////////////\n  /*\n  function closeDialog (dialog) {\n    dialog.parentNode.removeChild(dialog)\n  }\n\n  function createActionButton (label, callback) {\n    var button = doc.createElement('input')\n    button.setAttribute('type', 'submit')\n    button.setAttribute('value', label)\n    button.addEventListener('click', callback, false)\n    return button\n  }\n// @@ Tdo:  put these  buttonsback in,\n// to allow user to see and edit and save the sparql query for the table they are looking at\n//\n\n  function createSparqlWindow () {\n    var dialog = doc.createElement('div')\n\n    dialog.setAttribute('class', 'sparqlDialog')\n\n    var title = doc.createElement('h3')\n    title.appendChild(doc.createTextNode('Edit SPARQL query'))\n\n    var inputbox = doc.createElement('textarea')\n    inputbox.value = rdf.queryToSPARQL(lastQuery)\n\n    dialog.appendChild(title)\n    dialog.appendChild(inputbox)\n\n    dialog.appendChild(createActionButton('Query', function () {\n      var query = rdf.SPARQLToQuery(inputbox.value)\n      updateTable(query)\n      closeDialog(dialog)\n    }))\n\n    dialog.appendChild(createActionButton('Close', function () {\n      closeDialog(dialog)\n    }))\n\n    return dialog\n  }\n\n  function sparqlButtonPressed () {\n    var dialog = createSparqlWindow()\n\n    resultDiv.appendChild(dialog)\n  }\n\n  function generateSparqlButton () {\n    var image = doc.createElement('img')\n    image.setAttribute('class', 'sparqlButton')\n    image.setAttribute('src', UI.iconBase + 'icons/1pt5a.gif')\n    image.setAttribute('alt', 'Edit SPARQL query')\n\n    image.addEventListener('click', sparqlButtonPressed, false)\n\n    return image\n  }\n*/\n  // Generate the control bar displayed at the top of the screen.\n\n  function generateControlBar () {\n    const result = doc.createElement('table')\n    result.setAttribute('class', 'toolbar')\n\n    const tr = doc.createElement('tr')\n\n    /*             @@    Add in later -- not debugged yet\n            var sparqlButtonDiv = doc.createElement(\"td\")\n            sparqlButtonDiv.appendChild(generateSparqlButton())\n            tr.appendChild(sparqlButtonDiv)\n    */\n    typeSelectorDiv = doc.createElement('td')\n    tr.appendChild(typeSelectorDiv)\n\n    addColumnDiv = doc.createElement('td')\n    tr.appendChild(addColumnDiv)\n\n    result.appendChild(tr)\n\n    return result\n  }\n\n  // Add the SELECT details to the query being built.\n\n  function addSelectToQuery (query, type) {\n    const selectedColumns = type.getColumns()\n\n    for (let i = 0; i < selectedColumns.length; ++i) {\n      // TODO: autogenerate nicer names for variables\n      // variables have to be unambiguous\n\n      const variable = kb.variable('_col' + i)\n\n      query.vars.push(variable)\n      selectedColumns[i].setVariable(variable)\n    }\n  }\n\n  // Add WHERE details to the query being built.\n\n  function addWhereToQuery (query, rowVar, type) {\n    let queryType = type.type\n\n    if (!queryType) {\n      queryType = kb.variable('_any')\n    }\n\n    // _row a type\n    query.pat.add(rowVar, UI.ns.rdf('type'), queryType)\n  }\n\n  // Generate OPTIONAL column selectors.\n\n  function addColumnsToQuery (query, rowVar, type) {\n    const selectedColumns = type.getColumns()\n\n    for (let i = 0; i < selectedColumns.length; ++i) {\n      const column = selectedColumns[i]\n\n      const formula = kb.formula()\n\n      formula.add(rowVar, column.predicate, column.getVariable())\n\n      query.pat.optional.push(formula)\n    }\n  }\n\n  // Generate a query object from the currently-selected type\n  // object.\n\n  function generateQuery (type) {\n    const query = new rdf.Query()\n    const rowVar = kb.variable(keyVariable.slice(1)) // don't pass '?'\n\n    addSelectToQuery(query, type)\n    addWhereToQuery(query, rowVar, type)\n    addColumnsToQuery(query, rowVar, type)\n\n    return query\n  }\n\n  // Build the contents of the tableDiv element, filtered according\n  // to the specified type.\n\n  function buildFilteredTable (type) {\n    // Generate \"add column\" cell.\n\n    clearElement(addColumnDiv)\n    addColumnDiv.appendChild(generateColumnAddDropdown(type))\n\n    const query = generateQuery(type)\n\n    updateTable(query, type)\n  }\n\n  function updateTable (query, type) {\n    // Stop the previous query from doing any updates.\n\n    if (lastQuery) {\n      lastQuery.running = false\n    }\n\n    // Render the HTML table.\n\n    const htmlTable = renderTableForQuery(query, type)\n\n    // Clear the tableDiv element, and replace with the new table.\n\n    clearElement(tableDiv)\n    tableDiv.appendChild(htmlTable)\n\n    // Save the query for the edit dialog.\n\n    lastQuery = query\n  }\n\n  // Remove all subelements of the specified element.\n\n  function clearElement (element) {\n    while (element.childNodes.length > 0) {\n      element.removeChild(element.childNodes[0])\n    }\n  }\n\n  // A SubjectType is created for each rdf:type discovered.\n\n  function SubjectType (type) {\n    this.type = type\n    this.columns = null\n    this.allColumns = []\n    this.useCount = 0\n\n    // Get a list of all columns used by this type.\n\n    this.getAllColumns = function () {\n      return this.allColumns\n    }\n\n    // Get a list of the current columns used by this type\n    // (subset of allColumns)\n\n    this.getColumns = function () {\n      // The first time through, get a list of all the columns\n      // and select only the six most popular columns.\n\n      if (!this.columns) {\n        const allColumns = this.getAllColumns()\n        this.columns = allColumns.slice(0, 7)\n      }\n\n      return this.columns\n    }\n\n    // Get a list of unused columns\n\n    this.getUnusedColumns = function () {\n      const allColumns = this.getAllColumns()\n      const columns = this.getColumns()\n\n      const result = []\n\n      for (let i = 0; i < allColumns.length; ++i) {\n        if (columns.indexOf(allColumns[i]) === -1) {\n          result.push(allColumns[i])\n        }\n      }\n\n      return result\n    }\n\n    this.addColumn = function (column) {\n      this.columns.push(column)\n    }\n\n    this.removeColumn = function (column) {\n      this.columns = this.columns.filter(function (x) {\n        return x !== column\n      })\n    }\n\n    this.getLabel = function () {\n      return utils.label(this.type)\n    }\n\n    this.addUse = function () {\n      this.useCount += 1\n    }\n  }\n\n  // Class representing a column in the table.\n\n  function Column () {\n    this.useCount = 0\n\n    // Have we checked any values for this column yet?\n\n    this.checkedAnyValues = false\n\n    // If the range is unknown, but we just get literals in this\n    // column, then we can generate a literal selector.\n\n    this.possiblyLiteral = true\n\n    // If the range is unknown, but we just get literals and they\n    // match the regular expression for numbers, we can generate\n    // a number selector.\n\n    this.possiblyNumber = true\n\n    // We accumulate classes which things in the column must be a member of\n\n    this.constraints = []\n\n    // Check values as they are read.  If we don't know what the\n    // range is, we might be able to infer that it is a literal\n    // if all of the values are literals.  Similarly, we might\n    // be able to determine if the literal values are actually\n    // numbers (using regexps).\n\n    this.checkValue = function (term) {\n      const termType = term.termType\n      if (\n        this.possiblyLiteral &&\n        termType !== 'Literal' &&\n        termType !== 'NamedNode'\n      ) {\n        this.possiblyNumber = false\n        this.possiblyLiteral = false\n      } else if (this.possiblyNumber) {\n        if (termType !== 'Literal') {\n          this.possiblyNumber = false\n        } else {\n          const literalValue = term.value\n\n          if (!literalValue.match(/^-?\\d+(\\.\\d*)?$/)) {\n            this.possiblyNumber = false\n          }\n        }\n      }\n\n      this.checkedAnyValues = true\n    }\n\n    this.getVariable = function () {\n      return this.variable\n    }\n\n    this.setVariable = function (variable) {\n      this.variable = variable\n    }\n\n    this.getKey = function () {\n      return this.variable.toString()\n    }\n\n    this.addUse = function () {\n      this.useCount += 1\n    }\n\n    this.getHints = function () {\n      if (\n        options &&\n        options.hints &&\n        this.variable &&\n        options.hints[this.variable.toNT()]\n      ) {\n        return options.hints[this.variable.toNT()]\n      }\n      return {}\n    }\n\n    this.getLabel = function () {\n      if (this.getHints().label) {\n        return this.getHints().label\n      }\n      if (this.predicate) {\n        if (this.predicate.sameTerm(ns.rdf('type')) && this.superClass) {\n          return utils.label(this.superClass, true) // do initial cap\n        }\n        return utils.label(this.predicate)\n      } else if (this.variable) {\n        return this.variable.toString()\n      } else {\n        return 'unlabeled column?'\n      }\n    }\n\n    this.setPredicate = function (predicate, inverse, other) {\n      if (inverse) {\n        // variable is in the subject pos\n        this.inverse = predicate\n        this.constraints = this.constraints.concat(\n          kb.each(predicate, UI.ns.rdfs('domain'))\n        )\n        if (\n          predicate.sameTerm(ns.rdfs('subClassOf')) &&\n          other.termType === 'NamedNode'\n        ) {\n          this.superClass = other\n          this.alternatives = kb.each(undefined, ns.rdfs('subClassOf'), other)\n        }\n      } else {\n        // variable is the object\n        this.predicate = predicate\n        this.constraints = this.constraints.concat(\n          kb.each(predicate, UI.ns.rdfs('range'))\n        )\n      }\n    }\n\n    this.getConstraints = function () {\n      return this.constraints\n    }\n\n    this.filterFunction = function () {\n      return true\n    }\n\n    this.sortKey = function () {\n      return this.getLabel().toLowerCase()\n    }\n\n    this.isImageColumn = function () {\n      for (let i = 0; i < this.constraints.length; i++) {\n        if (this.constraints[i].uri in IMAGE_TYPES) return true\n      }\n      return false\n    }\n  }\n\n  // Convert an object to an array.\n\n  function objectToArray (obj, filter) {\n    const result = []\n\n    for (const property in obj) {\n      // @@@ have to guard against methods\n      const value = obj[property]\n\n      if (!filter || filter(property, value)) {\n        result.push(value)\n      }\n    }\n\n    return result\n  }\n\n  // Generate an <option> in a drop-down list.\n\n  function optionElement (label, value) {\n    const result = doc.createElement('option')\n\n    result.setAttribute('value', value)\n    result.appendChild(doc.createTextNode(label))\n\n    return result\n  }\n\n  // Generate drop-down list box for choosing type of data displayed\n\n  function generateTypeSelector (allType, types) {\n    const resultDiv = doc.createElement('div')\n\n    resultDiv.appendChild(doc.createTextNode('Select type: '))\n\n    const dropdown = doc.createElement('select')\n\n    dropdown.appendChild(optionElement('All types', 'null'))\n\n    for (const uri in types) {\n      dropdown.appendChild(optionElement(types[uri].getLabel(), uri))\n    }\n\n    dropdown.addEventListener(\n      'click',\n      function () {\n        let type\n\n        if (dropdown.value === 'null') {\n          type = allType\n        } else {\n          type = types[dropdown.value]\n        }\n\n        typeSelectorChanged(type)\n      },\n      false\n    )\n\n    resultDiv.appendChild(dropdown)\n\n    return resultDiv\n  }\n\n  // Callback invoked when the type selector drop-down list is changed.\n\n  function typeSelectorChanged (selectedType) {\n    buildFilteredTable(selectedType)\n  }\n\n  // Build drop-down list to add a new column\n\n  function generateColumnAddDropdown (type) {\n    const resultDiv = doc.createElement('div')\n\n    const unusedColumns = type.getUnusedColumns()\n\n    unusedColumns.sort(function (a, b) {\n      const aLabel = a.sortKey()\n      const bLabel = b.sortKey()\n      return (aLabel > bLabel) - (aLabel < bLabel)\n    })\n\n    // If there are no unused columns, the div is empty.\n\n    if (unusedColumns.length > 0) {\n      resultDiv.appendChild(doc.createTextNode('Add column: '))\n\n      // Build dropdown list of unused columns.\n\n      const dropdown = doc.createElement('select')\n\n      dropdown.appendChild(optionElement('', '-1'))\n\n      for (let i = 0; i < unusedColumns.length; ++i) {\n        const column = unusedColumns[i]\n        dropdown.appendChild(optionElement(column.getLabel(), '' + i))\n      }\n\n      resultDiv.appendChild(dropdown)\n\n      // Invoke callback when the dropdown is changed, to add\n      // the column and reload the table.\n\n      dropdown.addEventListener(\n        'click',\n        function () {\n          const columnIndex = Number(dropdown.value)\n\n          if (columnIndex >= 0) {\n            type.addColumn(unusedColumns[columnIndex])\n            buildFilteredTable(type)\n          }\n        },\n        false\n      )\n    }\n\n    return resultDiv\n  }\n\n  // Find the column for a given variable\n\n  function getColumnForVariable (columns, variableNT) {\n    for (const predicateUri in columns) {\n      const column = columns[predicateUri]\n      if (column.variable.toNT() === variableNT) {\n        return column\n      }\n    }\n    throw new Error(`getColumnForVariable: no column for variable ${variableNT}`)\n    // return null\n  }\n\n  // Find the column for a given predicate, creating a new column object\n  // if necessary.\n\n  function getColumnForPredicate (columns, predicate) {\n    let column\n\n    if (predicate.uri in columns) {\n      column = columns[predicate.uri]\n    } else {\n      column = new Column()\n      column.setPredicate(predicate)\n      columns[predicate.uri] = column\n    }\n\n    return column\n  }\n\n  // Find a type by its URI, creating a new SubjectType object if\n  // necessary.\n\n  function getTypeForObject (types, type) {\n    let subjectType\n\n    if (type.uri in types) {\n      subjectType = types[type.uri]\n    } else {\n      subjectType = new SubjectType(type)\n      types[type.uri] = subjectType\n    }\n\n    return subjectType\n  }\n\n  // Discover types and subjects for search.\n\n  function discoverTypes () {\n    // rdf:type properties of subjects, indexed by URI for the type.\n\n    const types = {}\n\n    // Get a list of statements that match:  ? rdfs:type ?\n    // From this we can get a list of subjects and types.\n\n    const subjectList = kb.statementsMatching(\n      undefined,\n      UI.ns.rdf('type'),\n      tableClass, // can be undefined OR\n      sourceDocument\n    ) // can be undefined\n\n    // Subjects for later lookup.  This is a mapping of type URIs to\n    // lists of subjects (it is necessary to record the type of\n    // a subject).\n\n    const subjects = {}\n\n    for (let i = 0; i < subjectList.length; ++i) {\n      const type = subjectList[i].object\n\n      if (type.termType !== 'NamedNode') {\n        // @@ no bnodes?\n        continue\n      }\n\n      const typeObj = getTypeForObject(types, type)\n\n      if (!(type.uri in subjects)) {\n        subjects[type.uri] = []\n      }\n\n      subjects[type.uri].push(subjectList[i].subject)\n      typeObj.addUse()\n    }\n\n    return [subjects, types]\n  }\n\n  // Get columns for the given subject.\n\n  function getSubjectProperties (subject, columns) {\n    // Get a list of properties of this subject.\n\n    const properties = kb.statementsMatching(\n      subject,\n      undefined,\n      undefined,\n      sourceDocument\n    )\n\n    const result = {}\n\n    for (let j = 0; j < properties.length; ++j) {\n      const predicate = properties[j].predicate\n\n      if (predicate.uri in FORBIDDEN_COLUMNS) {\n        continue\n      }\n\n      // Find/create a column for this predicate.\n\n      const column = getColumnForPredicate(columns, predicate)\n      column.checkValue(properties[j].object)\n\n      result[predicate.uri] = column\n    }\n\n    return result\n  }\n\n  // Identify the columns associated with a type.\n\n  function identifyColumnsForType (type, subjects) {\n    const allColumns = {}\n\n    // Process each subject of this type to build up the\n    // column list.\n\n    for (let i = 0; i < subjects.length; ++i) {\n      const columns = getSubjectProperties(subjects[i], allColumns)\n\n      for (const predicateUri in columns) {\n        const column = columns[predicateUri]\n\n        column.addUse()\n      }\n    }\n\n    // Generate the columns list\n\n    const allColumnsList = objectToArray(allColumns)\n    sortColumns(allColumnsList)\n    type.allColumns = allColumnsList\n  }\n\n  // Build table information from parsing RDF statements.\n\n  function calculateTable () {\n    // Find the types that we will display in the dropdown\n    // list box, and associated objects of those types.\n\n    let subjects, types\n\n    const s = discoverTypes()\n    // eslint-disable-next-line prefer-const\n    subjects = s[0]\n    // eslint-disable-next-line prefer-const\n    types = s[1] // no [ ] on LHS\n\n    for (const typeUrl in subjects) {\n      const subjectList = subjects[typeUrl]\n      const type = types[typeUrl]\n\n      identifyColumnsForType(type, subjectList)\n    }\n\n    // TODO: Special type that captures all rows.\n    // Combine columns from all types\n\n    const allType = new SubjectType(null)\n\n    return [allType, objectToArray(types)]\n  }\n\n  // Sort the list of columns by the most common columns.\n\n  function sortColumns (columns) {\n    function sortFunction (a, b) {\n      return (a.useCount < b.useCount) - (a.useCount > b.useCount)\n    }\n\n    columns.sort(sortFunction)\n  }\n\n  // Create the delete button for a column.\n\n  function renderColumnDeleteButton (type, column) {\n    const button = doc.createElement('a')\n\n    button.appendChild(doc.createTextNode('[x]'))\n\n    button.addEventListener(\n      'click',\n      function () {\n        type.removeColumn(column)\n        buildFilteredTable(type)\n      },\n      false\n    )\n\n    return button\n  }\n\n  // Render the table header for the HTML table.\n\n  function renderTableHeader (columns, type) {\n    const tr = doc.createElement('tr')\n\n    /* Empty header for link column */\n    const linkTd = doc.createElement('th')\n    tr.appendChild(linkTd)\n\n    for (let i = 0; i < columns.length; ++i) {\n      const th = doc.createElement('th')\n      const column = columns[i]\n\n      th.appendChild(doc.createTextNode(column.getLabel()))\n\n      // We can only add a delete button if we are using the\n      // proper interface and have a type to delete from:\n      if (type) {\n        th.appendChild(renderColumnDeleteButton(type, column))\n      }\n\n      tr.appendChild(th)\n    }\n\n    return tr\n  }\n\n  // Sort the rows in the rendered table by data from a specific\n  // column, using the provided sort function to compare values.\n\n  function applyColumnSort (rows, column, sortFunction, reverse) {\n    const columnKey = column.getKey()\n\n    // Sort the rows array.\n    rows.sort(function (row1, row2) {\n      let row1Value = null\n      let row2Value = null\n\n      if (columnKey in row1.values) {\n        row1Value = row1.values[columnKey][0]\n      }\n      if (columnKey in row2.values) {\n        row2Value = row2.values[columnKey][0]\n      }\n\n      const result = sortFunction(row1Value, row2Value)\n\n      if (reverse) {\n        return -result\n      } else {\n        return result\n      }\n    })\n\n    // Remove all rows from the table:\n\n    if (rows.length) {\n      const parentTable = rows[0]._htmlRow.parentNode\n\n      for (let i = 0; i < rows.length; ++i) {\n        parentTable.removeChild(rows[i]._htmlRow)\n      }\n\n      // Add back the rows in the new sorted order:\n\n      for (let i = 0; i < rows.length; ++i) {\n        parentTable.appendChild(rows[i]._htmlRow)\n      }\n    }\n  }\n\n  // Filter the list of rows based on the selectors for the\n  // columns.\n\n  function applyColumnFiltersToRow (row, columns) {\n    let rowDisplayed = true\n\n    // Check the filter functions for every column.\n    // The row should only be displayed if the filter functions\n    // for all of the columns return true.\n\n    for (let c = 0; c < columns.length; ++c) {\n      const column = columns[c]\n      const columnKey = column.getKey()\n\n      let columnValue = null\n\n      if (columnKey in row.values) {\n        columnValue = row.values[columnKey][0]\n      }\n\n      if (!column.filterFunction(columnValue)) {\n        rowDisplayed = false\n        break\n      }\n    }\n\n    // Show or hide the HTML row according to the result\n    // from the filter function.\n\n    const htmlRow = row._htmlRow\n\n    if (rowDisplayed) {\n      htmlRow.style.display = ''\n    } else {\n      htmlRow.style.display = 'none'\n    }\n  }\n\n  // Filter the list of rows based on the selectors for the\n  // columns.\n\n  function applyColumnFilters (rows, columns) {\n    // Apply filterFunction to each row.\n\n    for (let r = 0; r < rows.length; ++r) {\n      const row = rows[r]\n      applyColumnFiltersToRow(row, columns)\n    }\n  }\n\n  // /////////////////////////////////// Literal column handling\n\n  // Sort by literal value\n\n  function literalSort (rows, column, reverse) {\n    function literalToString (colValue) {\n      if (colValue) {\n        if (colValue.termType === 'Literal') {\n          return colValue.value.toLowerCase()\n        } else if (colValue.termType === 'NamedNode') {\n          return utils.label(colValue).toLowerCase()\n        }\n        return colValue.value.toLowerCase()\n      } else {\n        return ''\n      }\n    }\n\n    function literalCompare (value1, value2) {\n      const strValue1 = literalToString(value1)\n      const strValue2 = literalToString(value2)\n\n      if (strValue1 < strValue2) {\n        return -1\n      } else if (strValue1 > strValue2) {\n        return 1\n      } else {\n        return 0\n      }\n    }\n\n    applyColumnSort(rows, column, literalCompare, reverse)\n  }\n\n  // Generates a selector for an RDF literal column.\n\n  function renderLiteralSelector (rows, columns, column) {\n    const result = doc.createElement('div')\n\n    const textBox = doc.createElement('input')\n    textBox.setAttribute('type', 'text')\n    textBox.style.width = '70%'\n\n    result.appendChild(textBox)\n\n    const sort1 = doc.createElement('span')\n    sort1.appendChild(doc.createTextNode('\\u25BC'))\n    sort1.addEventListener(\n      'click',\n      function () {\n        literalSort(rows, column, false)\n      },\n      false\n    )\n    result.appendChild(sort1)\n\n    const sort2 = doc.createElement('span')\n    sort2.appendChild(doc.createTextNode('\\u25B2'))\n    sort2.addEventListener(\n      'click',\n      function () {\n        literalSort(rows, column, true)\n      },\n      false\n    )\n    result.appendChild(sort2)\n\n    let substring = null\n\n    // Filter the table to show only rows that have a particular\n    // substring in the specified column.\n\n    column.filterFunction = function (colValue) {\n      if (!substring) {\n        return true\n      } else if (!colValue) {\n        return false\n      } else {\n        let literalValue\n\n        if (colValue.termType === 'Literal') {\n          literalValue = colValue.value\n        } else if (colValue.termType === 'NamedNode') {\n          literalValue = utils.label(colValue)\n        } else {\n          literalValue = ''\n        }\n\n        return literalValue.toLowerCase().indexOf(substring) >= 0\n      }\n    }\n\n    textBox.addEventListener(\n      'keyup',\n      function () {\n        if (textBox.value !== '') {\n          substring = textBox.value.toLowerCase()\n        } else {\n          substring = null\n        }\n\n        applyColumnFilters(rows, columns)\n      },\n      false\n    )\n\n    return result\n  }\n\n  // ///////////////////////////////////  Enumeration\n\n  // Generates a dropdown selector for enumeration types include\n  //\n  //  @param rows,\n  //  @param columns, the mapping of predictae URIs to columns\n  //  @param column,\n  //  @param list,    List of alternative terms\n  //\n  function renderEnumSelector (rows, columns, column, list) {\n    const doMultiple = true\n    const result = doc.createElement('div')\n    const dropdown = doc.createElement('select')\n\n    let searchValue = {} // Defualt to all enabled\n    for (let i = 0; i < list.length; ++i) {\n      const value = list[i]\n      searchValue[value.uri] = true\n    }\n\n    const initialSelection = getHints(column).initialSelection\n    if (initialSelection) searchValue = initialSelection\n\n    if (doMultiple) dropdown.setAttribute('multiple', 'true')\n    else dropdown.appendChild(optionElement('(All)', '-1'))\n\n    for (let i = 0; i < list.length; ++i) {\n      const value = list[i]\n      const ele = optionElement(utils.label(value), i)\n      if (searchValue[value.uri]) ele.selected = true\n      dropdown.appendChild(ele)\n    }\n    result.appendChild(dropdown)\n\n    // Select based on an enum value.\n\n    column.filterFunction = function (colValue) {\n      return !searchValue || (colValue && searchValue[colValue.uri])\n    }\n\n    dropdown.addEventListener(\n      'click',\n      function () {\n        if (doMultiple) {\n          searchValue = {}\n          const opt = dropdown.options\n          for (let i = 0; i < opt.length; i++) {\n            const option = opt[i]\n            const index = Number(option.value)\n            if (opt[i].selected) searchValue[list[index].uri] = true\n          }\n        } else {\n          const index = Number(dropdown.value) // adjusted in Standard tweaks 2018-01\n          if (index < 0) {\n            searchValue = null\n          } else {\n            searchValue = {}\n            searchValue[list[index].uri] = true\n          }\n        }\n        applyColumnFilters(rows, columns)\n      },\n      true\n    )\n\n    return result\n  }\n\n  // //////////////////////////////////// Numeric\n  //\n  // Selector for XSD number types.\n\n  function renderNumberSelector (rows, columns, column) {\n    const result = doc.createElement('div')\n\n    const minSelector = doc.createElement('input')\n    minSelector.setAttribute('type', 'text')\n    minSelector.style.width = '40px'\n    result.appendChild(minSelector)\n\n    const maxSelector = doc.createElement('input')\n    maxSelector.setAttribute('type', 'text')\n    maxSelector.style.width = '40px'\n    result.appendChild(maxSelector)\n\n    // Select based on minimum/maximum limits.\n\n    let min = null\n    let max = null\n\n    column.filterFunction = function (colValue) {\n      if (colValue) {\n        colValue = Number(colValue)\n      }\n\n      if (min && (!colValue || colValue < min)) {\n        return false\n      }\n      if (max && (!colValue || colValue > max)) {\n        return false\n      }\n\n      return true\n    }\n\n    // When the values in the boxes are changed, update the\n    // displayed columns.\n\n    function eventListener () {\n      if (minSelector.value === '') {\n        min = null\n      } else {\n        min = Number(minSelector.value)\n      }\n\n      if (maxSelector.value === '') {\n        max = null\n      } else {\n        max = Number(maxSelector.value)\n      }\n\n      applyColumnFilters(rows, columns)\n    }\n\n    minSelector.addEventListener('keyup', eventListener, false)\n    maxSelector.addEventListener('keyup', eventListener, false)\n\n    return result\n  }\n\n  // /////////////////////////////////////////////////////////////////\n\n  // Fallback attempts at generating a selector if other attempts fail.\n\n  function fallbackRenderTableSelector (rows, columns, column) {\n    // Have all values matched as numbers?\n\n    if (column.checkedAnyValues && column.possiblyNumber) {\n      return renderNumberSelector(rows, columns, column)\n    }\n\n    // Have all values been literals?\n\n    if (column.possiblyLiteral) {\n      return renderLiteralSelector(rows, columns, column)\n    }\n\n    return null\n  }\n\n  // Render a selector for a given row.\n\n  function renderTableSelector (rows, columns, column) {\n    // What type of data is in this column?  Check the constraints for\n    // this predicate.\n\n    // If this is a class which can be one of various sibling classes?\n    if (column.superClass && column.alternatives.length > 0) {\n      return renderEnumSelector(rows, columns, column, column.alternatives)\n    }\n\n    const cs = column.getConstraints()\n    let range\n    for (let i = 0; i < cs.length; i++) {\n      range = cs[i]\n\n      // Is this a number type?\n      // Alternatively, is this an rdf:Literal type where all of\n      // the values match as numbers?\n\n      if (\n        (column.checkedAnyValues && column.possiblyNumber) ||\n        range.uri in XSD_NUMBER_TYPES\n      ) {\n        return renderNumberSelector(rows, columns, column)\n      }\n\n      // rdf:Literal?  Assume a string at this point\n\n      if (range.uri === RDFS_LITERAL) {\n        return renderLiteralSelector(rows, columns, column)\n      }\n\n      // Is this an enumeration type?\n\n      // Also  ToDo: @@@ Handle membership of classes whcih are disjointUnions\n\n      const choices = kb.each(range, UI.ns.owl('oneOf'))\n      if (choices.length > 0) {\n        return renderEnumSelector(rows, columns, column, choices.elements)\n      }\n    }\n    return fallbackRenderTableSelector(rows, columns, column)\n  }\n\n  // Generate the search selectors for the table columns.\n\n  function renderTableSelectors (rows, columns) {\n    const tr = doc.createElement('tr')\n    tr.className = 'selectors'\n\n    // Empty link column\n\n    tr.appendChild(doc.createElement('td'))\n\n    // Generate selectors.\n\n    for (let i = 0; i < columns.length; ++i) {\n      const td = doc.createElement('td')\n\n      const selector = renderTableSelector(rows, columns, columns[i])\n\n      if (selector) {\n        td.appendChild(selector)\n      }\n      /*\n                  // Useful debug: display URI of predicate in column header\n                  if (columns[i].predicate.uri) {\n                      td.appendChild(document.createTextNode(columns[i].predicate.uri))\n                  }\n      */\n      tr.appendChild(td)\n    }\n\n    return tr\n  }\n\n  function linkTo (uri, linkText, hints) {\n    hints = hints || {}\n    const result = doc.createElement('a')\n    const linkFunction = hints.linkFunction\n    result.setAttribute('href', uri)\n    result.appendChild(doc.createTextNode(linkText))\n    if (!linkFunction) {\n      result.addEventListener('click', UI.widgets.openHrefInOutlineMode, true)\n    } else {\n      result.addEventListener(\n        'click',\n        function (e) {\n          e.preventDefault()\n          e.stopPropagation()\n          const target = utils.getTarget(e)\n          const uri = target.getAttribute('href')\n          if (!uri) debug.log('No href found \\n')\n          linkFunction(uri)\n        },\n        true\n      )\n    }\n    return result\n  }\n\n  function linkToObject (obj, hints) {\n    let match = false\n\n    if (obj.uri) {\n      match = obj.uri.match(/^mailto:(.*)/)\n    }\n\n    if (match) {\n      return linkTo(obj.uri, match[1], hints)\n    } else {\n      return linkTo(obj.uri, utils.label(obj), hints)\n    }\n  }\n\n  // Render an image\n\n  function renderImage (obj) {\n    const result = doc.createElement('img')\n    result.setAttribute('src', obj.uri)\n\n    // Set the height, so it appears as a thumbnail.\n    result.style.height = '40px'\n    return result\n  }\n\n  // Render an individual RDF object to an HTML object displayed\n  // in a table cell.\n\n  function getHints (column) {\n    if (\n      options &&\n      options.hints &&\n      column.variable &&\n      options.hints[column.variable.toNT()]\n    ) {\n      return options.hints[column.variable.toNT()]\n    }\n    return {}\n  }\n\n  function renderValue (obj, column) {\n    // hint\n    const hints = getHints(column)\n    const cellFormat = hints.cellFormat\n    if (cellFormat) {\n      switch (cellFormat) {\n        case 'shortDate':\n          return doc.createTextNode(UI.widgets.shortDate(obj.value))\n        // break\n        default:\n        // drop through\n      }\n    } else {\n      if (obj.termType === 'Literal') {\n        if (obj.datatype) {\n          if (XSD_DATE_TYPES[obj.datatype.uri]) {\n            return doc.createTextNode(UI.widgets.shortDate(obj.value))\n          } else if (XSD_NUMBER_TYPES[obj.datatype.uri]) {\n            const span = doc.createElement('span')\n            span.textContent = obj.value\n            span.setAttribute('style', 'text-align: right')\n            return span\n          }\n        }\n        return doc.createTextNode(obj.value)\n      } else if (obj.termType === 'NamedNode' && column.isImageColumn()) {\n        return renderImage(obj)\n      } else if (obj.termType === 'NamedNode' || obj.termType === 'BlankNode') {\n        return linkToObject(obj, hints)\n      } else if (obj.termType === 'Collection') {\n        const span = doc.createElement('span')\n        span.appendChild(doc.createTextNode('['))\n        obj.elements.forEach(function (x) {\n          span.appendChild(renderValue(x, column))\n          span.appendChild(doc.createTextNode(', '))\n        })\n        span.removeChild(span.lastChild)\n        span.appendChild(doc.createTextNode(']'))\n        return span\n      } else {\n        return doc.createTextNode('unknown termtype \\'' + obj.termType + '\\'!')\n      }\n    }\n  }\n\n  // Render a row of the HTML table, from the given row structure.\n  // Note that unlike other functions, this renders into a provided\n  // row (<tr>) element.\n\n  function renderTableRowInto (tr, row, columns, _downstream) {\n    /* Link column, for linking to this subject. */\n\n    const linkTd = doc.createElement('td')\n\n    if (row._subject && 'uri' in row._subject) {\n      linkTd.appendChild(linkTo(row._subject.uri, '\\u2192'))\n    }\n\n    tr.appendChild(linkTd)\n\n    // Create a <td> for each column (whether the row has data for that\n    // column or not).\n\n    for (let i = 0; i < columns.length; ++i) {\n      const column = columns[i]\n      const td = doc.createElement('td')\n      let orig\n\n      const columnKey = column.getKey()\n\n      if (columnKey in row.values) {\n        const objects = row.values[columnKey]\n        let different = false\n        if (row.originalValues && row.originalValues[columnKey]) {\n          if (objects.length !== row.originalValues[columnKey].length) {\n            different = true\n          }\n        }\n        for (let j = 0; j < objects.length; ++j) {\n          const obj = objects[j]\n          if (\n            row.originalValues &&\n            row.originalValues[columnKey] &&\n            row.originalValues[columnKey].length > j\n          ) {\n            orig = row.originalValues[columnKey][j]\n            if (obj.toString() !== orig.toString()) {\n              different = true\n            }\n          }\n          td.appendChild(renderValue(obj, column))\n\n          if (j !== objects.length - 1) {\n            td.appendChild(doc.createTextNode(',\\n'))\n          }\n          if (different) {\n            td.style.background = '#efe' // green = new changed\n          }\n        }\n      }\n\n      tr.appendChild(td)\n    }\n\n    // Save a reference to the HTML row in the row object.\n\n    row._htmlRow = tr\n\n    return tr\n  }\n\n  // Check if a value is already stored in the list of values for\n  // a cell (the query can sometimes find it multiple times)\n\n  function valueInList (value, list) {\n    let key = null\n\n    if (value.termType === 'Literal') {\n      key = 'value'\n    } else if (value.termType === 'NamedNode') {\n      key = 'uri'\n    } else {\n      return list.indexOf(value) >= 0\n    }\n\n    // Check the list and compare keys:\n\n    let i\n\n    for (i = 0; i < list.length; ++i) {\n      if (list[i].termType === value.termType && list[i][key] === value[key]) {\n        return true\n      }\n    }\n\n    // Not found?\n\n    return false\n  }\n\n  // Update a row, add new values, and regenerate the HTML element\n  // containing the values.\n\n  function updateRow (row, columns, values) {\n    let key\n    let needUpdate = false\n\n    for (key in values) {\n      const value = values[key]\n\n      // If this key is not already in the row, create a new entry\n      // for it:\n\n      if (!(key in row.values)) {\n        row.values[key] = []\n      }\n\n      // Possibly add this new value to the list, but don't\n      // add it if we have already added it:\n\n      if (!valueInList(value, row.values[key])) {\n        row.values[key].push(value)\n        needUpdate = true\n      }\n    }\n\n    // Regenerate the HTML row?\n\n    if (needUpdate) {\n      clearElement(row._htmlRow)\n      renderTableRowInto(row._htmlRow, row, columns)\n    }\n    applyColumnFiltersToRow(row, columns) // Hide immediately if nec\n  }\n\n  // Get a unique ID for the given subject.  This is normally the\n  // URI; if the subject has no URI, a unique ID is assigned.\n\n  function getSubjectId (subject) {\n    if ('uri' in subject) {\n      return subject.uri\n    } else if ('_subject_id' in subject) {\n      return subject._subject_id\n    } else {\n      const result = '' + subjectIdCounter\n      subject._subject_id = result\n      ++subjectIdCounter\n      return result\n    }\n  }\n\n  // Run a query and populate the table.\n  // Populates also an array of logical rows.  This will be empty when the function\n  // first returns (as the query is performed in the background)\n\n  function runQuery (query, rows, columns, table) {\n    query.running = true\n    const startTime = Date.now()\n\n    let progressMessage = doc.createElement('tr')\n    table.appendChild(progressMessage)\n    progressMessage.textContent = 'Loading ...'\n\n    for (let i = 0; i < rows.length; i++) {\n      rows[i].original = true\n      if (!rows[i].originalValues) {\n        // remember first set\n        rows[i].originalValues = rows[i].values\n      }\n      rows[i].values = {}\n      // oldStyle = rows[i]._htmlRow.getAttribute('style') || ''\n      // rows[i]._htmlRow.style.background = '#ffe'; //setAttribute('style', ' background-color: #ffe;')// yellow\n    }\n\n    const onResult = function (values) {\n      if (!query.running) {\n        return\n      }\n\n      progressMessage.textContent += '.' // give a progress bar\n\n      let row = null\n      let rowKey = null\n      let rowKeyId\n\n      // If the query has a row key, use it to look up the row.\n\n      if (keyVariable in values) {\n        rowKey = values[keyVariable]\n        rowKeyId = getSubjectId(rowKey)\n\n        // Do we have a row for this already?\n        // If so, reuse it; otherwise, we must create a new row.\n\n        if (rowKeyId in rowsLookup) {\n          row = rowsLookup[rowKeyId]\n        }\n      }\n\n      // Create a new row?\n\n      if (!row) {\n        const tr = doc.createElement('tr')\n        table.appendChild(tr)\n\n        row = {\n          _htmlRow: tr,\n          _subject: rowKey,\n          values: {}\n        }\n        rows.push(row)\n\n        if (rowKey) {\n          rowsLookup[rowKeyId] = row\n        }\n      }\n\n      // Add the new values to this row.\n      delete row.original // This is included in the new data\n      updateRow(row, columns, values)\n    }\n\n    const onDone = function () {\n      if (\n        progressMessage &&\n        progressMessage.parentNode &&\n        progressMessage.parentNode.removeChild\n      ) {\n        progressMessage.parentNode.removeChild(progressMessage)\n        progressMessage = null\n      }\n\n      const elapsedTimeMS = Date.now() - startTime\n      debug.log(\n        'Query done: ' + rows.length + ' rows, ' + elapsedTimeMS + 'ms'\n      )\n      // Delete rows which were from old values not new\n      for (let i = rows.length - 1; i >= 0; i--) {\n        // backwards\n        if (rows[i].original) {\n          debug.log('   deleting row ' + rows[i]._subject)\n          const tr = rows[i]._htmlRow\n          tr.parentNode.removeChild(tr)\n          delete rowsLookup[getSubjectId(rows[i]._subject)]\n          rows.splice(i, 1)\n        }\n      }\n\n      if (options.sortBy) { // @@ for each column check needs sorting\n        const column = getColumnForVariable(columns, options.sortBy)\n        literalSort(rows, column, options.sortReverse)\n      }\n\n      if (options.onDone) options.onDone(resultDiv) // return div makes testing easier\n    }\n    kb.query(query, onResult, undefined, onDone)\n  }\n\n  // Given the formula object which is the query pattern,\n  // deduce from where the variable occurs constraints on\n  // what values it can take.\n\n  function inferColumnsFromFormula (columns, formula) {\n    UI.log.debug('>> processing formula')\n\n    for (let i = 0; i < formula.statements.length; ++i) {\n      const statement = formula.statements[i]\n      // UI.log.debug(\"processing statement \" + i)\n\n      // Does it match this?:\n      // <something> <predicate> ?var\n      // If so, we can use the predicate as the predicate for the\n      // column used for the specified variable.\n\n      if (\n        statement.predicate.termType === 'NamedNode' &&\n        statement.object.termType === 'Variable'\n      ) {\n        const variable = statement.object.toString()\n        if (variable in columns) {\n          const column = columns[variable]\n          column.setPredicate(statement.predicate, false, statement.subject)\n        }\n      }\n      if (\n        statement.predicate.termType === 'NamedNode' &&\n        statement.subject.termType === 'Variable'\n      ) {\n        const variable = statement.subject.toString()\n        if (variable in columns) {\n          const column = columns[variable]\n          column.setPredicate(statement.predicate, true, statement.object)\n        }\n      }\n    }\n\n    // Apply to OPTIONAL formulas:\n\n    for (let i = 0; i < formula.optional.length; ++i) {\n      UI.log.debug('recurse to optional subformula ' + i)\n      inferColumnsFromFormula(columns, formula.optional[i])\n    }\n\n    UI.log.debug('<< finished processing formula')\n  }\n\n  // Generate a list of column structures and infer details about the\n  // predicates based on the contents of the query\n\n  function inferColumns (query) {\n    // Generate the columns list:\n\n    const result = []\n    const columns = {}\n\n    for (let i = 0; i < query.vars.length; ++i) {\n      const column = new Column()\n      const queryVar = query.vars[i]\n      UI.log.debug('column ' + i + ' : ' + queryVar)\n\n      column.setVariable(queryVar)\n      columns[queryVar] = column\n      result.push(column)\n    }\n\n    inferColumnsFromFormula(columns, query.pat)\n\n    return result\n  }\n\n  // Generate a table from a query.\n\n  function renderTableForQuery (query, type) {\n    // infer columns from query, to allow generic queries\n    let columns\n    if (!givenQuery) {\n      columns = type.getColumns()\n    } else {\n      columns = inferColumns(query)\n    }\n\n    // Start with an empty list of rows; this will be populated\n    // by the query.\n\n    const rows = []\n\n    // Create table element and header.\n\n    const table = doc.createElement('table')\n\n    table.appendChild(renderTableHeader(columns, type))\n    table.appendChild(renderTableSelectors(rows, columns))\n\n    // Run query.  Note that this is perform asynchronously; the\n    // query runs in the background and this call does not block.\n\n    table.logicalRows = rows // Save for refresh\n    table.columns = columns\n    table.query = query\n\n    runQuery(query, rows, columns, table)\n\n    return table\n  }\n\n  // Find the most common type of row\n\n  function getMostCommonType (types) {\n    let bestCount = -1\n    let best = null\n\n    let typeUri\n    for (typeUri in types) {\n      const type = types[typeUri]\n\n      if (type.useCount > bestCount) {\n        best = type\n        bestCount = type.useCount\n      }\n    }\n\n    return best\n  }\n\n  // Filter list of columns to only those columns used in the\n  // specified rows.\n  /*\n  function filterColumns (columns, rows) {\n    var filteredColumns = {}\n\n    // Copy columns from \"columns\" -> \"filteredColumns\", but only\n    // those columns that are used in the list of rows specified.\n\n    for (let columnUri in columns) {\n      for (let i = 0; i < rows.length; ++i) {\n        if (columnUri in rows[i]) {\n          filteredColumns[columnUri] = columns[columnUri]\n          break\n        }\n      }\n    }\n    return filteredColumns\n  }\n  */\n}\n// ///////////////////////////////////////////////////////////////////\n\n// ENDS\n","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return assertThisInitialized(t);\n}\nexport { _possibleConstructorReturn as default };","function _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nexport { _assertThisInitialized as default };","function _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nexport { _getPrototypeOf as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","function _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function _isNativeReflectConstruct() {\n    return !!t;\n  })();\n}\nexport { _isNativeReflectConstruct as default };","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport setPrototypeOf from \"./setPrototypeOf.js\";\nimport isNativeFunction from \"./isNativeFunction.js\";\nimport construct from \"./construct.js\";\nfunction _wrapNativeSuper(t) {\n  var r = \"function\" == typeof Map ? new Map() : void 0;\n  return _wrapNativeSuper = function _wrapNativeSuper(t) {\n    if (null === t || !isNativeFunction(t)) return t;\n    if (\"function\" != typeof t) throw new TypeError(\"Super expression must either be null or a function\");\n    if (void 0 !== r) {\n      if (r.has(t)) return r.get(t);\n      r.set(t, Wrapper);\n    }\n    function Wrapper() {\n      return construct(t, arguments, getPrototypeOf(this).constructor);\n    }\n    return Wrapper.prototype = Object.create(t.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: !1,\n        writable: !0,\n        configurable: !0\n      }\n    }), setPrototypeOf(Wrapper, t);\n  }, _wrapNativeSuper(t);\n}\nexport { _wrapNativeSuper as default };","function _isNativeFunction(t) {\n  try {\n    return -1 !== Function.toString.call(t).indexOf(\"[native code]\");\n  } catch (n) {\n    return \"function\" == typeof t;\n  }\n}\nexport { _isNativeFunction as default };","import isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nimport setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _construct(t, e, r) {\n  if (isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);\n  var o = [null];\n  o.push.apply(o, e);\n  var p = new (t.bind.apply(t, o))();\n  return r && setPrototypeOf(p, r.prototype), p;\n}\nexport { _construct as default };","import { cancelButton } from './widgets'\nimport { label } from './utils'\nimport { NamedNode } from 'rdflib'\nimport { style } from './style'\nimport { store } from 'solid-logic'\n\n/**\n * @ignore\n */\nclass ContainerElement extends HTMLElement {\n  asSettings?: boolean\n}\n\ntype TabWidgetOptions = {\n  backgroundColor?: string;\n  dom?: HTMLDocument;\n  items?: Array<NamedNode>;\n  onClose?: (event: Event) => void;\n  ordered?: boolean;\n  orientation?: '0' | '1' | '2' | '3';\n  predicate?: NamedNode;\n  renderMain?: (bodyMain: HTMLElement, subject: NamedNode) => void;\n  renderTab?: (tabDiv: HTMLButtonElement, subject: NamedNode) => void;\n  renderTabSettings?: (bodyMain: ContainerElement, subject: NamedNode) => void;\n  selectedTab?: NamedNode;\n  startEmpty?: boolean;\n  subject?: NamedNode;\n}\n\nexport class TabWidgetElement extends HTMLElement {\n  bodyContainer?: HTMLElement\n  refresh?: () => void\n  tabContainer?: HTMLElement\n}\n\n/**\n * @ignore\n */\nclass TabElement extends HTMLElement {\n  bodyTR?: HTMLElement\n  subject?: NamedNode\n}\n\n/**\n * Use this widget to generate tabs from triples set in the global store.\n *\n * [Here you can see examples of the tabs](https://solidos.github.io/solid-ui/examples/tabs/).\n *\n * It assumes that items to use for tabs will be in a collection by default,\n * e.g.:\n *\n * ```turtle\n * :subject :predicate ( :item1 :item2 ) .\n * ```\n *\n * You can override this by setting `ordered: false`, in which case it expects\n * unordered triples:\n *\n * ```turtle\n * :subject :predicate :item1, :item 2 .\n * ```\n *\n * Triples that are not ordered in collection are in principle not sorted,\n * which means that tabs could change order every time you render the widget.\n * But in this case the widget will try to sort it in order to keep it\n * consistent.\n *\n * In both of these cases you need to define options `subject` and `predicate`\n * to tell the widget which triples it should be looking for.\n *\n * Finally you can set items manually, using the `items` option, e.g.:\n *\n * ```javascript\n * {\n *   items: [\n *     namedNode('https://domain.tld/#item1'),\n *     namedNode('https://domain.tld/#item2')\n *   ]\n * }\n * ```\n *\n * When you set items manually you do not need to set `subject` and\n * `predicate`.\n *\n * In any case you probably want to set the renderMain option to specify\n * what should be rendered for the various items, e.g.:\n *\n * ```javascript\n * {\n *   renderMain: (bodyMain, subject) => {\n *     bodyMain.innerHTML = renderItem(subject)\n *   }\n * }\n * ```\n *\n * **Note:** `renderItem` is a custom function that you need to define yourself.\n *\n * The option `renderTabSettings` allows you to render a custom view in the\n * body container that is shown when you hold the ALT key and click on a\n * tab. It works very much like the `renderMain` option:\n *\n * ```javascript\n * {\n *   renderTabSettings: (bodyMain, subject) => {\n *     bodyMain.innerHTML = renderTabSettings(subject)\n *   }\n * }\n * ```\n *\n * **Note:** `renderTabSettings` is a custom function that you need to define\n * yourself.\n *\n * By default the widget will try to guess the label by using the\n * [[utils.label]] function. If you want to customize this yourself, you can\n * use the `renderTab` option:\n *\n * ```javascript\n * {\n *   renderTab: (tabDiv, subject) => {\n *     tabDiv.innerText = renderTabText(subject)\n *   }\n * }\n * ```\n *\n * **Note:** `renderTabText` is a custom function you need to define yourself.\n *\n * The option renderTab is also important if you want to set which tab should\n * be selected once the widget is rendered. By default it will simply select\n * the first tab, but you can override by setting `dataset.name` on the tab\n * and referring to the same string in `selectedTab`:\n *\n * ```javascript\n * {\n *   renderTab: (tabDiv, subject)  => {\n *     tabDiv.dataset.name = subject.uri\n *   },\n *   selectedTab: item2.uri\n * }\n * ```\n *\n * You can apply a color to use for tabs and border of the container by using\n * option `background-color`. This is #ddddcc by default.\n *\n * You can override the document object that the widget uses to generate DOM\n * elements by setting the option `dom`. This is encouraged to set if you\n * intend your functionality to be used in environments that don't provide\n * a global `document` object.\n *\n * If you want to render a close button next to the tabs you can set option\n * `onClose` which takes a callback function that is triggered when the\n * button is clicked:\n *\n * ```javascript\n * {\n *   onClose: (event) => {\n *     // do something that hides the widget altogether\n *   }\n * }\n * ```\n *\n * The option `orientation` allows you to set which side the tabs should be\n * located: `'0'` = Top, `'1'` = Left, `'2'` = Bottom, `'3'` = Right\n *\n * If you don't want to render anything in the body container by default,\n * you can set the option `startEmpty` to `true`.\n *\n * @param options\n */\nconst tabsDefaultBackgroundColor = '#ddddcc'\n\nexport function tabWidget (options: TabWidgetOptions) {\n  const subject = options.subject\n  const dom = options.dom || document\n  const orientation = parseInt(options.orientation || '0')\n  const backgroundColor = options.backgroundColor || tabsDefaultBackgroundColor\n  const flipped = orientation & 2\n  const vertical = orientation & 1\n  const onClose = options.onClose\n\n  const [selectedColor, color] = getColors(backgroundColor)\n  const bodyMainStyle = `flex: 2; width: auto; height: 100%; border: 0.1em; border-style: solid; border-color: ${selectedColor}; padding: 1em;`\n  const rootElement: TabWidgetElement = dom.createElement('div') // 20200117a\n\n  rootElement.setAttribute('style', style.tabsRootElement)\n  rootElement.style.flexDirection = (vertical ? 'row' : 'column') + (flipped ? '-reverse' : '')\n\n  const navElement = rootElement.appendChild(dom.createElement('nav'))\n  navElement.setAttribute('style', style.tabsNavElement)\n\n  const mainElement = rootElement.appendChild(dom.createElement('main'))\n\n  mainElement.setAttribute('style', style.tabsMainElement) // override tabbedtab.css\n  const tabContainer = navElement.appendChild(dom.createElement('ul'))\n  tabContainer.setAttribute('style', style.tabContainer)\n  tabContainer.style.flexDirection = `${vertical ? 'column' : 'row'}`\n\n  const tabElement = 'li'\n\n  const bodyContainer = mainElement\n  rootElement.tabContainer = tabContainer\n  rootElement.bodyContainer = bodyContainer\n\n  const corners = ['0.2em', '0.2em', '0', '0'] // top left, TR, BR, BL\n  const cornersPrepped = corners.concat(corners).slice(orientation, orientation + 4)\n  const cornersStyle = `border-radius: ${cornersPrepped.join(' ')};`\n\n  const margins = ['0.3em', '0.3em', '0', '0.3em'] // top, right, bottom, left\n  const marginsPrepped = margins.concat(margins).slice(orientation, orientation + 4)\n  const marginsStyle = `margin: ${marginsPrepped.join(' ')};`\n\n  const paddingStyle = `padding: ${marginsPrepped.join(' ')};`\n\n  const tabStyle = cornersStyle + `position: relative; padding: 0.7em; max-width: 20em; color: ${color};`\n  const unselectedStyle = `${\n    tabStyle + marginsStyle\n  } opacity: 50%; background-color: ${backgroundColor};`\n  const selectedStyle = `${tabStyle + marginsStyle} background-color: ${selectedColor};`\n  const shownStyle = 'height: 100%; width: 100%;'\n  const hiddenStyle = shownStyle + 'display: none;'\n  rootElement.refresh = orderedSync\n  orderedSync()\n\n  if (!options.startEmpty && tabContainer.children.length && options.selectedTab) {\n    const selectedTab0 = Array.from(tabContainer.children) // Version left for compatibility with ??\n      .map((tab) => tab.firstChild as HTMLElement)\n      .find((tab) => tab.dataset.name === options.selectedTab)\n\n    const selectedTabURI = options.selectedTab.uri\n    const selectedTab1 = Array.from(tabContainer.children)\n      // @ts-ignore\n      .find(\n        (tab) =>\n          (tab as TabElement).subject &&\n          // @ts-ignore\n          (tab as TabElement).subject.uri &&\n          // @ts-ignore\n          (tab as TabElement).subject.uri === selectedTabURI\n      )\n\n    const tab = selectedTab1 || selectedTab0 || (tabContainer.children[0] as HTMLButtonElement)\n    const clickMe = tab.firstChild\n    // @ts-ignore\n    if (clickMe) clickMe.click()\n  } else if (!options.startEmpty) {\n    (tabContainer.children[0].firstChild as HTMLButtonElement).click() // Open first tab\n  }\n  return rootElement\n\n  function addCancelButton (tabContainer) {\n    if (tabContainer.dataset.onCloseSet) {\n      // @@ TODO: this is only here to make the browser tests work\n      // Discussion at https://github.com/solidos/solid-ui/pull/110#issuecomment-527080663\n      const existingCancelButton = tabContainer.querySelector('.unstyled')\n      tabContainer.removeChild(existingCancelButton)\n    }\n    const extraTab = dom.createElement(tabElement)\n    extraTab.classList.add('unstyled')\n    const tabCancelButton = cancelButton(dom, onClose)\n    tabCancelButton.setAttribute('style', tabCancelButton.getAttribute('style') + paddingStyle)\n    extraTab.appendChild(tabCancelButton)\n    tabContainer.appendChild(extraTab)\n    tabContainer.dataset.onCloseSet = 'true'\n  }\n\n  function getItems (): Array<NamedNode> {\n    if (options.items) return options.items\n    if (options.ordered !== false) {\n      // options.ordered defaults to true\n      return (store.the(subject, options.predicate) as any).elements\n    } else {\n      return store.each(subject, options.predicate) as any\n    }\n  }\n\n  function makeNewSlot (item: NamedNode) {\n    const ele = dom.createElement(tabElement) as TabElement\n    ele.setAttribute('style', unselectedStyle)\n    ele.subject = item\n    const div = ele.appendChild(dom.createElement('button'))\n    div.setAttribute('style', style.makeNewSlot)\n\n    div.onclick = function () {\n      resetTabStyle()\n      resetBodyStyle()\n      ele.setAttribute('style', selectedStyle)\n      if (!ele.bodyTR) return\n      ele.bodyTR.setAttribute('style', shownStyle)\n      const bodyMain = getOrCreateContainerElement(ele)\n      if (options.renderMain && ele.subject && bodyMain.asSettings !== false) {\n        bodyMain.innerHTML = 'loading item ...' + item\n        options.renderMain(bodyMain, ele.subject)\n        bodyMain.asSettings = false\n      }\n    }\n\n    if (options.renderTabSettings && ele.subject) {\n      const ellipsis = dom.createElement('button')\n      ellipsis.textContent = '...'\n      ellipsis.setAttribute('style', style.ellipsis)\n\n      ellipsis.onclick = function () {\n        resetTabStyle()\n        resetBodyStyle()\n        ele.setAttribute('style', selectedStyle)\n        if (!ele.bodyTR) return\n        ele.bodyTR.setAttribute('style', shownStyle)\n        const bodyMain = getOrCreateContainerElement(ele)\n        if (options.renderTabSettings && ele.subject && bodyMain.asSettings !== true) {\n          bodyMain.innerHTML = 'loading settings ...' + item\n          options.renderTabSettings(bodyMain, ele.subject)\n          bodyMain.asSettings = true\n        }\n      }\n      ele.appendChild(ellipsis)\n    }\n\n    if (options.renderTab) {\n      options.renderTab(div, item)\n    } else {\n      div.innerHTML = label(item)\n    }\n    return ele\n\n    function getOrCreateContainerElement (ele: TabElement): ContainerElement {\n      const bodyMain = ele.bodyTR?.children[0] as ContainerElement\n      if (bodyMain) return bodyMain\n      const newBodyMain = ele.bodyTR!.appendChild(dom.createElement('main'))\n      newBodyMain.setAttribute('style', bodyMainStyle)\n      return newBodyMain\n    }\n  }\n\n  // @@ Use common one from utils?\n  function orderedSync () {\n    const items = getItems()\n    let slot: TabElement, i, j, left, right\n    let differ = false\n    // Find how many match at each end\n    for (left = 0; left < tabContainer.children.length; left++) {\n      slot = tabContainer.children[left] as TabElement\n      if (left >= items.length || (slot.subject && !slot.subject.sameTerm(items[left]))) {\n        differ = true\n        break\n      }\n    }\n    if (!differ && items.length === tabContainer.children.length) {\n      return // The two just match in order: a case to optimize for\n    }\n    for (right = tabContainer.children.length - 1; right >= 0; right--) {\n      slot = tabContainer.children[right] as TabElement\n      j = right - tabContainer.children.length + items.length\n      if (slot.subject && !slot.subject.sameTerm(items[j])) {\n        break\n      }\n    }\n    // The elements left ... right in tabContainer.children do not match\n    const insertables = items.slice(left, right - tabContainer.children.length + items.length + 1)\n    while (right >= left) {\n      // remove extra\n      tabContainer.removeChild(tabContainer.children[left])\n      bodyContainer.removeChild(bodyContainer.children[left])\n      right -= 1\n    }\n    for (i = 0; i < insertables.length; i++) {\n      const newSlot = makeNewSlot(insertables[i])\n      const newBodyDiv = dom.createElement('div')\n      newSlot.bodyTR = newBodyDiv\n      if (left === tabContainer.children.length) {\n        // None left of original on right\n        tabContainer.appendChild(newSlot)\n        bodyContainer.appendChild(newBodyDiv)\n      } else {\n        tabContainer.insertBefore(newSlot, tabContainer.children[left + i])\n        bodyContainer.insertBefore(newBodyDiv, bodyContainer.children[left + i])\n      }\n    }\n    if (onClose) {\n      addCancelButton(tabContainer)\n    }\n  }\n\n  function resetTabStyle () {\n    for (let i = 0; i < tabContainer.children.length; i++) {\n      const tab = tabContainer.children[i]\n      if (tab.classList.contains('unstyled')) {\n        continue\n      } else {\n        tab.setAttribute('style', unselectedStyle)\n      }\n    }\n  }\n\n  function resetBodyStyle () {\n    for (let i = 0; i < bodyContainer.children.length; i++) {\n      bodyContainer.children[i].setAttribute('style', hiddenStyle)\n    }\n  }\n}\n\n/**\n * @internal\n */\nfunction getColors (backgroundColor: string): [string, string] {\n  return isLight(backgroundColor)\n    ? [colorBlend(backgroundColor, '#ffffff', 0.3), '#000000']\n    : [colorBlend(backgroundColor, '#000000', 0.3), '#ffffff']\n}\n\n/**\n * @internal\n */\nfunction colorBlend (a: string, b: string, mix: number): string {\n  let ca, cb, res\n  let str = '#'\n  const hex = '0123456789abcdef'\n  for (let i = 0; i < 3; i++) {\n    ca = parseInt(a.slice(i * 2 + 1, i * 2 + 3), 16)\n    cb = parseInt(b.slice(i * 2 + 1, i * 2 + 3), 16)\n    res = ca * (1.0 - mix) + cb * mix // @@@ rounding\n    const res2 = parseInt(('' + res).split('.')[0]) // @@ ugh\n    const h = parseInt(('' + res2 / 16).split('.')[0]) // @@ ugh\n    const l = parseInt(('' + (res2 % 16)).split('.')[0]) // @@ ugh\n    str += hex[h] + hex[l]\n  }\n  return str\n}\n\n/**\n * @internal\n */\nfunction isLight (x: string): boolean {\n  let total = 0\n  for (let i = 0; i < 3; i++) {\n    total += parseInt(x.slice(i * 2 + 1, i * 2 + 3), 16)\n  }\n  return total > 128 * 3\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && setPrototypeOf(t, e);\n}\nexport { _inherits as default };","export const emptyProfile = `\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" fill=\"none\">\n    <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M13 25C19.6274 25 25 19.6274 25 13C25 6.37258 19.6274 1 13 1C6.37258 1 1 6.37258 1 13C1 19.6274 6.37258 25 13 25Z\" fill=\"#D8D8D8\" stroke=\"#8B8B8B\"/>\n    <mask id=\"mask0\" mask-type=\"alpha\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"26\" height=\"26\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M13 25C19.6274 25 25 19.6274 25 13C25 6.37258 19.6274 1 13 1C6.37258 1 1 6.37258 1 13C1 19.6274 6.37258 25 13 25Z\" fill=\"white\" stroke=\"white\"/>\n    </mask>\n    <g mask=\"url(#mask0)\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M17.0468 10.4586C17.0468 14.4979 15.4281 16.9214 12.9999 16.9214C10.5718 16.9214 8.95298 14.4979 8.95298 10.4586C8.95298 6.41931 12.9999 6.41931 12.9999 6.41931C12.9999 6.41931 17.0468 6.41931 17.0468 10.4586ZM4.09668 23.3842C6.52483 17.7293 12.9999 17.7293 12.9999 17.7293C12.9999 17.7293 19.475 17.7293 21.9031 23.3842C21.9031 23.3842 17.8481 25 12.9999 25C8.15169 25 4.09668 23.3842 4.09668 23.3842Z\" fill=\"#8B8B8B\"/>\n    </g>\n</svg>`\n","/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, LiveStore, NamedNode, parse, sym } from 'rdflib'\nimport { ns } from '..'\n\n/* @ts-ignore  no-console */\ntype ThrottleOptions = {\n  leading?: boolean;\n  throttling?: boolean;\n  trailing?: boolean;\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n */\nexport async function getPodOwner (pod: NamedNode, store: LiveStore): Promise<NamedNode | null> {\n  // This is a massive guess.  In future\n  // const podOwner = sym(`${pod.uri}profile/card#me`)\n\n  try {\n    // load turtle Container representation\n    if (!store.any(pod, null, ns.ldp('Container'), pod)) {\n      const response = await store.fetcher.webOperation('GET', pod.uri, store.fetcher.initFetchOptions(pod.uri, { headers: { accept: 'text/turtle' } }))\n      const containerTurtle = response.responseText\n      parse(containerTurtle as string, store, pod.uri, 'text/turtle')\n    }\n  } catch (err) {\n    console.error('Error loading pod ' + pod + ': ' + err)\n    return null\n  }\n  if (!store.holds(pod, ns.rdf('type'), ns.space('Storage'), pod)) {\n    console.warn('Pod  ' + pod + ' does not declare itself as a space:Storage')\n    return null\n  }\n  const podOwner = store.any(pod, ns.solid('owner'), null, pod) ||\n        store.any(null, ns.space('storage'), pod, pod)\n  if (podOwner) {\n    try {\n      await store.fetcher.load((podOwner as NamedNode).doc())\n    } catch (_err) {\n      console.warn('Unable to load profile of pod owner ' + podOwner)\n      return null\n    }\n    if (!store.holds(podOwner, ns.space('storage'), pod, (podOwner as NamedNode).doc())) {\n      console.warn(`Pod owner ${podOwner} does NOT list pod ${pod} as their storage`)\n    }\n    return podOwner as NamedNode// Success!\n  } else { // pod owner not declared in pod\n    // @@ TODO: This is given the structure that NSS provides\n    // This is a massive guess.  For old pods which don't have owner link\n    const guess = sym(`${pod.uri}profile/card#me`)\n    try {\n      // @ts-ignore  LiveStore always has fetcher\n      await store.fetcher.load(guess)\n    } catch (_err) {\n      console.error('Ooops. Guessed wrong pod owner webid {$guess} : can\\'t load it.')\n      return null\n    }\n    if (store.holds(guess, ns.space('storage'), pod, guess.doc())) {\n      console.warn('Using guessed pod owner webid but it links back.')\n      return guess\n    }\n    return null\n  }\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n","/* global EventListenerOrEventListenerObject */\n/*\n    This file was copied from mashlib/src/global/header.ts file. It is modified to\n    work in solid-ui by adjusting where imported functions are found.\n */\nimport { IndexedFormula, NamedNode } from 'rdflib'\nimport { icons } from '../index'\nimport { authn, authSession } from 'solid-logic'\nimport { loginStatusBox } from '../login/login'\n// import { loginStatusBox, authSession, currentUser } from '../authn/authn'\nimport * as widgets from '../widgets'\nimport { style } from '../style'\nimport { emptyProfile } from './empty-profile'\nimport { getPod, throttle } from '../utils/headerFooterHelpers'\n\n/**\n * menu icons\n*/\nconst DEFAULT_HELP_MENU_ICON = icons.iconBase + 'noun_help.svg'\nconst DEFAUL_SOLID_ICON_URL = 'https://solidproject.org/assets/img/solid-emblem.svg'\n\nexport type MenuItemLink = {\n  label: string,\n  url: string,\n  target?: string\n}\n\nexport type MenuItemButton = {\n  label: string,\n  onclick: () => void\n}\n\nexport type MenuItems = MenuItemLink | MenuItemButton\n\n/*\n  HeaderOptions allow for customizing the logo and menu list.  If a logo is not provided the default\n  is solid. Menulist will always show a link to logout and to the users profile.\n  */\nexport type HeaderOptions = {\n  logo?: string,\n  helpIcon?: string,\n  helpMenuList?: MenuItems[]\n}\n\n/**\n * Initialize header component, the header object returned depends on whether the user is authenticated.\n * @param store the data store\n * @param userMenuList a list of menu items when the user is logged in\n * @param options allow the header to be customized with a personalized logo, help icon and a help menu list of links or buttons.\n * @returns a header for an authenticated user with menu items given or a login screen\n */\nexport async function initHeader (store: IndexedFormula, userMenuList: MenuItems[], options?: HeaderOptions) {\n  const header = document.getElementById('PageHeader')\n  if (!header) {\n    return\n  }\n\n  const pod = getPod()\n  rebuildHeader(header, store, pod, userMenuList, options)()\n  authSession.events.on('logout', rebuildHeader(header, store, pod, userMenuList, options))\n  authSession.events.on('login', rebuildHeader(header, store, pod, userMenuList, options))\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function rebuildHeader (header: HTMLElement, store: IndexedFormula, pod: NamedNode, userMenuList: MenuItems[], options?: HeaderOptions) {\n  return async () => {\n    const user = authn.currentUser()\n    header.innerHTML = ''\n    header.appendChild(await createBanner(store, pod, user, userMenuList, options))\n  }\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function createBanner (store: IndexedFormula, pod: NamedNode, user: NamedNode | null, userMenuList: MenuItems[], options?: HeaderOptions): Promise<HTMLElement> {\n  const podLink = document.createElement('a')\n  podLink.href = pod.uri\n  podLink.setAttribute('style', style.headerBannerLink)\n  const image = document.createElement('img')\n  if (options) {\n    image.src = options.logo ? options.logo : DEFAUL_SOLID_ICON_URL\n  }\n  image.setAttribute('style', style.headerBannerIcon)\n  podLink.appendChild(image)\n\n  const userMenu = user\n    ? await createUserMenu(store, user, userMenuList)\n    : createLoginSignUpButtons()\n\n  const banner = document.createElement('div')\n  banner.setAttribute('style', style.headerBanner)\n  banner.appendChild(podLink)\n\n  const leftSideOfHeader = document.createElement('div')\n  leftSideOfHeader.setAttribute('style', style.headerBannerRightMenu)\n  leftSideOfHeader.appendChild(userMenu)\n\n  if (options && options.helpMenuList) {\n    const helpMenu = createHelpMenu(options, options.helpMenuList)\n    leftSideOfHeader.appendChild(helpMenu as HTMLDivElement)\n  }\n\n  banner.appendChild(leftSideOfHeader)\n\n  return banner\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createHelpMenu (options: HeaderOptions, helpMenuItems: MenuItems[]) {\n  if (!helpMenuItems) return\n  const helpMenuList = document.createElement('ul')\n  helpMenuList.setAttribute('style', style.headerUserMenuList)\n  helpMenuItems.forEach(function (menuItem) {\n    const menuItemType: string = (menuItem as MenuItemLink).url ? 'url' : 'onclick'\n    if (menuItemType === 'url') {\n      helpMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label, (menuItem as MenuItemLink).url, (menuItem as MenuItemLink).target)))\n    } else {\n      helpMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label, (menuItem as MenuItemButton).onclick)))\n    }\n  })\n\n  const helpMenu = document.createElement('nav')\n\n  helpMenu.setAttribute('style', style.headerUserMenuNavigationMenuNotDisplayed)\n  helpMenu.setAttribute('aria-hidden', 'true')\n  helpMenu.setAttribute('id', 'helperNav')\n  helpMenu.appendChild(helpMenuList)\n\n  const helpMenuContainer = document.createElement('div')\n  helpMenuContainer.setAttribute('style', style.headerBannerUserMenu)\n  helpMenuContainer.appendChild(helpMenu)\n\n  const helpMenuTrigger = document.createElement('button')\n  helpMenuTrigger.setAttribute('style', style.headerUserMenuTrigger)\n  helpMenuTrigger.type = 'button'\n\n  const helpMenuIcon = document.createElement('img')\n  helpMenuIcon.src = (options && options.helpIcon) ? options.helpIcon : icons.iconBase + DEFAULT_HELP_MENU_ICON\n  helpMenuIcon.setAttribute('style', style.headerUserMenuTriggerImg)\n  helpMenuContainer.appendChild(helpMenuTrigger)\n  helpMenuTrigger.appendChild(helpMenuIcon)\n\n  const throttledMenuToggle = throttle((event: Event) => toggleMenu(event, helpMenuTrigger, helpMenu), 50)\n  helpMenuTrigger.addEventListener('click', throttledMenuToggle)\n  let timer = setTimeout(() => null, 0)\n  helpMenuContainer.addEventListener('mouseover', event => {\n    clearTimeout(timer)\n    throttledMenuToggle(event)\n    const nav = document.getElementById('helperNav')\n    nav?.setAttribute('style', style.headerUserMenuNavigationMenu)\n  })\n  helpMenuContainer.addEventListener('mouseout', event => {\n    timer = setTimeout(() => throttledMenuToggle(event), 200)\n    const nav = document.getElementById('helperNav')\n    nav?.setAttribute('style', style.headerUserMenuNavigationMenuNotDisplayed)\n  })\n\n  return helpMenuContainer\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createLoginSignUpButtons () {\n  const profileLoginButtonPre = document.createElement('div')\n  profileLoginButtonPre.setAttribute('style', style.headerBannerLogin)\n  profileLoginButtonPre.appendChild(loginStatusBox(document, null, {}))\n  return profileLoginButtonPre\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuButton (label: string, onClick: EventListenerOrEventListenerObject): HTMLElement {\n  const button = document.createElement('button')\n  button.setAttribute('style', style.headerUserMenuButton)\n  button.onmouseover = function () {\n    button.setAttribute('style', style.headerUserMenuButtonHover)\n  }\n  button.onmouseout = function () {\n    button.setAttribute('style', style.headerUserMenuButton)\n  }\n  button.addEventListener('click', onClick)\n  button.innerText = label\n  return button\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuLink (label: string, href: string, target?: string): HTMLElement {\n  const link = document.createElement('a')\n  link.setAttribute('style', style.headerUserMenuLink)\n  link.onmouseover = function () {\n    link.setAttribute('style', style.headerUserMenuLinkHover)\n  }\n  link.onmouseout = function () {\n    link.setAttribute('style', style.headerUserMenuLink)\n  }\n  link.href = href\n  link.innerText = label\n  if (target) link.target = target\n  return link\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function createUserMenu (store: IndexedFormula, user: NamedNode, userMenuList: MenuItems[]): Promise<HTMLElement> {\n  const fetcher = (<any>store).fetcher\n  if (fetcher) {\n    // Making sure that Profile is loaded before building menu\n    await fetcher.load(user)\n  }\n\n  const loggedInMenuList = document.createElement('ul')\n  loggedInMenuList.setAttribute('style', style.headerUserMenuList)\n  if (userMenuList) {\n    userMenuList.forEach(function (menuItem) {\n      const menuItemType: string = (menuItem as MenuItemLink).url ? 'url' : 'onclick'\n      if (menuItemType === 'url') {\n        loggedInMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label, (menuItem as MenuItemLink).url, (menuItem as MenuItemLink).target)))\n      } else {\n        loggedInMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label, (menuItem as MenuItemButton).onclick)))\n      }\n    })\n  }\n  const loggedInMenu = document.createElement('nav')\n\n  loggedInMenu.setAttribute('style', style.headerUserMenuNavigationMenuNotDisplayed)\n  loggedInMenu.setAttribute('aria-hidden', 'true')\n  loggedInMenu.setAttribute('id', 'loggedInNav')\n  loggedInMenu.appendChild(loggedInMenuList)\n\n  const loggedInMenuTrigger = document.createElement('button')\n  loggedInMenuTrigger.setAttribute('style', style.headerUserMenuTrigger)\n  loggedInMenuTrigger.type = 'button'\n  const profileImg = getProfileImg(store, user)\n  if (typeof profileImg === 'string') {\n    loggedInMenuTrigger.innerHTML = profileImg\n  } else {\n    loggedInMenuTrigger.appendChild(profileImg)\n  }\n\n  const loggedInMenuContainer = document.createElement('div')\n  loggedInMenuContainer.setAttribute('style', style.headerBannerUserMenuNotDisplayed)\n  loggedInMenuContainer.appendChild(loggedInMenuTrigger)\n  loggedInMenuContainer.appendChild(loggedInMenu)\n\n  const throttledMenuToggle = throttle((event: Event) => toggleMenu(event, loggedInMenuTrigger, loggedInMenu), 50)\n  loggedInMenuTrigger.addEventListener('click', throttledMenuToggle)\n  let timer = setTimeout(() => null, 0)\n  loggedInMenuContainer.addEventListener('mouseover', event => {\n    clearTimeout(timer)\n    throttledMenuToggle(event)\n    const nav = document.getElementById('loggedInNav')\n    nav?.setAttribute('style', style.headerUserMenuNavigationMenu)\n  })\n  loggedInMenuContainer.addEventListener('mouseout', event => {\n    timer = setTimeout(() => throttledMenuToggle(event), 200)\n    const nav = document.getElementById('loggedInNav')\n    nav?.setAttribute('style', style.headerUserMenuNavigationMenuNotDisplayed)\n  })\n\n  return loggedInMenuContainer\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuItem (child: HTMLElement): HTMLElement {\n  const menuProfileItem = document.createElement('li')\n  menuProfileItem.setAttribute('style', style.headerUserMenuListItem)\n  menuProfileItem.appendChild(child)\n  return menuProfileItem\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getProfileImg (store: IndexedFormula, user: NamedNode): string | HTMLElement {\n  let profileUrl = null\n  try {\n    profileUrl = widgets.findImage(user)\n    if (!profileUrl) {\n      return emptyProfile\n    }\n  } catch {\n    return emptyProfile\n  }\n\n  const profileImage = document.createElement('div')\n  profileImage.setAttribute('style', style.headerUserMenuPhoto)\n  profileImage.style.backgroundImage = `url(${profileUrl})`\n  return profileImage\n}\n\n/**\n * @internal\n */\nfunction toggleMenu (event: Event, trigger: HTMLButtonElement, menu: HTMLElement): void {\n  const isExpanded = trigger.getAttribute('aria-expanded') === 'true'\n  const expand = event.type === 'mouseover'\n  const close = event.type === 'mouseout'\n  if ((isExpanded && expand) || (!isExpanded && close)) {\n    return\n  }\n  trigger.setAttribute('aria-expanded', (!isExpanded).toString())\n  menu.setAttribute('aria-hidden', isExpanded.toString())\n}\n","/*\n    This file was copied from mashlib/src/global/footer.ts file. It is modified to\n    work in solid-ui by adjusting where imported functions are found.\n */\nimport { LiveStore, NamedNode } from 'rdflib'\nimport { authn, authSession } from 'solid-logic'\nimport { style } from '../style'\nimport { getName, getPod, getPodOwner } from '../utils/headerFooterHelpers'\n\nconst DEFAULT_SOLID_PROJECT_URL = 'https://solidproject.org'\nconst DEFAULT_SOLID_PROJECT_NAME = 'solidproject.org'\n\n/*\n  FooterOptions allow for customizing the link and name of the link part of the footer.\n  */\nexport type FooterOptions = {\n  solidProjectUrl?: string,\n  solidProjectName?: string\n}\n\n/**\n * Initialize footer component, the footer object returned depends on whether the user is authenticated.\n * @param store the data store\n * @returns the footer\n */\nexport async function initFooter (store: LiveStore, options?: FooterOptions) {\n  const footer = document.getElementById('PageFooter')\n  if (!footer) {\n    return\n  }\n  const pod = getPod()\n  const podOwner = await getPodOwner(pod, store)\n  rebuildFooter(footer, store, pod, podOwner, options)()\n  authSession.events.on('login', rebuildFooter(footer, store, pod, podOwner, options))\n  authSession.events.on('logout', rebuildFooter(footer, store, pod, podOwner, options))\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function rebuildFooter (footer: HTMLElement, store: LiveStore, pod: NamedNode | null, podOwner: NamedNode | null, options?: FooterOptions) {\n  return async () => {\n    const user = authn.currentUser()\n    footer.innerHTML = ''\n    footer.appendChild(await createControllerInfoBlock(store, user, pod, podOwner, options))\n  }\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createControllerInfoBlock (store: LiveStore, user: NamedNode | null, pod: NamedNode | null, podOwner: NamedNode | null, options?: FooterOptions): HTMLElement {\n  const profileLinkContainer = document.createElement('div')\n  if (!pod || !podOwner || (user && user.equals(podOwner))) {\n    return profileLinkContainer\n  }\n\n  profileLinkContainer.setAttribute('style', style.footer)\n\n  const podLinkPre = document.createElement('span')\n  podLinkPre.innerText = 'You\\'re visiting '\n\n  const podLink = document.createElement('a')\n  podLink.href = pod.uri\n  podLink.innerText = 'the Pod'\n\n  const profileLinkPre = document.createElement('span')\n  profileLinkPre.innerText = ' controlled by '\n\n  const profileLink = document.createElement('a')\n  profileLink.href = podOwner.uri\n  profileLink.innerText = getName(store, podOwner)\n\n  const solidProjectLinkPre = document.createElement('span')\n  solidProjectLinkPre.innerText = '. For more info, check out '\n\n  const solidProjectLink = document.createElement('a')\n  solidProjectLink.href = options && options.solidProjectUrl ? options.solidProjectUrl : DEFAULT_SOLID_PROJECT_URL\n  solidProjectLink.innerText = options && options.solidProjectName ? options.solidProjectName : DEFAULT_SOLID_PROJECT_NAME\n\n  const solidProjectLinkPost = document.createElement('span')\n  solidProjectLinkPost.innerText = '.'\n\n  profileLinkContainer.appendChild(podLinkPre)\n  profileLinkContainer.appendChild(podLink)\n  profileLinkContainer.appendChild(profileLinkPre)\n  profileLinkContainer.appendChild(profileLink)\n  profileLinkContainer.appendChild(solidProjectLinkPre)\n  profileLinkContainer.appendChild(solidProjectLink)\n  profileLinkContainer.appendChild(solidProjectLinkPost)\n\n  return profileLinkContainer\n}\n","/*\nThe MIT License (MIT)\n\nCopyright (c) 2015-2016 Solid\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\nIf you would like to know more about the solid Solid project, please see\nhttps://github.com/solidos/solid\n*/\n'use strict'\n/**\n * Provides a Solid client helper object (which exposes various static modules).\n * @module UI.js\n * @main UI.js\n */\n\n/**\n * @class UI\n * @static\n */\n\n// REMOVE @ts-ignore as you migrate files to TypeScript\n// @ts-ignore\nimport ns from './ns'\nimport { acl, aclControl } from './acl/index'\nimport { create } from './create/index'\n// @ts-ignore\nimport { icons } from './iconBase'\nimport * as language from './widgets/forms/autocomplete/language'\nimport * as log from './log'\nimport { matrix } from './matrix/index'\nimport { media } from './media/index'\n// @ts-ignore\nimport { messageArea } from './messageArea'\n// @ts-ignore\nimport { infiniteMessageArea } from './chat/infinite'\n// @ts-ignore\nimport * as pad from './pad'\n// @ts-ignore\nimport * as participation from './participation'\n// @ts-ignore\nimport * as preferences from './preferences'\n// @ts-ignore\nimport { style } from './style'\n// @ts-ignore\nimport { renderTableViewPane as table } from './table'\nimport * as tabs from './tabs'\n// @ts-ignore\nimport * as utils from './utils'\nimport * as login from './login/login'\nimport * as widgets from './widgets/index'\nimport { initHeader } from './header'\nimport { initFooter } from './footer'\nimport * as createTypes from './create/types'\n\nconst dom = window ? window.document : null // Idea that UI.dom can be adapted in non-browser environments\n\nif (typeof window !== 'undefined') {\n  ;(<any>window).UI = {\n    ns,\n    acl,\n    aclControl,\n    create,\n    createTypes,\n    dom,\n    icons,\n    language,\n    log,\n    login,\n    matrix,\n    media,\n    messageArea,\n    infiniteMessageArea,\n    pad,\n    participation,\n    preferences,\n    style,\n    table,\n    tabs,\n    utils,\n    widgets,\n    initHeader,\n    initFooter\n  } // Simpler access by non-node scripts\n}\n\n// this variables are directly used in the storybook\nexport {\n  ns,\n  acl,\n  aclControl,\n  create,\n  createTypes,\n  dom,\n  icons,\n  language,\n  log,\n  login,\n  matrix,\n  media,\n  messageArea,\n  infiniteMessageArea,\n  pad,\n  participation,\n  preferences,\n  style,\n  table,\n  tabs,\n  utils,\n  widgets,\n  initHeader,\n  initFooter\n}\n// uses in solid-panes\nexport type { CreateContext, NewAppInstanceOptions } from './create/types'\n"],"names":["extensions","types","db","extname","mimeScore","EXTRACT_TYPE_REGEXP","TEXT_TYPE_REGEXP","charset","type","match","exec","mime","toLowerCase","test","extension","exts","exports","length","_preferredType","ext","type0","type1","source","_preferredTypeLegacy","SOURCE_RANK","undefined","score0","indexOf","score1","slice","charsets","lookup","contentType","str","Object","create","path","_extensionConflicts","keys","forEach","i","legacyType","push","module","e","d","this","v","k","__esModule","n","r","t","unshift","pop","value","done","iconsOnGithub","icons","scriptURI","iconBase","lastIndexOf","originalIconBase","$SolidTestEnvironment","log","aliases","acl","arg","as","bookmark","cal","cco","cert","contact","dc","dct","doap","foaf","geo","gpx","gr","http","httph","icalTZ","ldp","link","meeting","mo","org","owl","pad","patch","prov","pto","qu","trip","rdf","rdfs","rss","sched","schema","sioc","skos","solid","space","stat","tab","tabont","ui","vann","vcard","wf","xsd","namedNode","u","namespaces","alias","expansion","localName","_console","console","apply","arguments","warn","_console2","error","_console3","trace","_console4","_regeneratorDefine","defineProperty","o","_invoke","enumerable","configurable","writable","_typeof","Symbol","iterator","call","next","isNaN","TypeError","matchHtmlRegExp","string","escape","html","index","lastIndex","charCodeAt","substring","OverloadYield","regenerator","regeneratorAsync","regeneratorAsyncGen","regeneratorAsyncIterator","regeneratorKeys","regeneratorValues","_regeneratorRuntime","m","getPrototypeOf","__proto__","constructor","displayName","name","a","stop","abrupt","delegateYield","resultName","finish","f","_t","p","prev","sent","wrap","w","reverse","isGeneratorFunction","mark","awrap","AsyncIterator","async","values","prototype","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","regeneratorDefine","c","resolve","then","asyncIterator","Promise","FACET_SCORES","default","SOURCE_SCORES","nginx","apache","iana","TYPE_SCORES","application","font","mimeType","subtype","split","facet","replace","_regenerator","toStringTag","Generator","y","G","bind","l","GeneratorFunction","GeneratorFunctionPrototype","setPrototypeOf","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","id","loaded","__webpack_modules__","getter","definition","key","get","hmd","children","set","Error","obj","prop","hasOwnProperty","__WEBPACK_EXTERNAL_MODULE_$rdf__","solidNamespace","$rdf","asyncGeneratorStep","_next","_throw","TERROR","TWARN","TMESG","TSUCCESS","TINFO","TDEBUG","TALL","LogLevel","_level","_ascending","_dom","document","_window","window","typestr","logArea","getElementById","addendum","createElement","setAttribute","now","Date","innerHTML","concat","getHours","getMinutes","getSeconds","escapeForXML","insertBefore","firstChild","appendChild","msg","message","debug","info","success","alert","clear","_dom2","setLevel","level","dumpHTML","_dom3","body","logAscending","logDescending","setInternals","UI","ns","label","thing","initialCap","doCap","toUpperCase","cleanUp","result","store","any","sym","getWellKnownLabel","termType","elements","s","uri","toString","map","decodeURIComponent","join","_e","hex","String","fromCharCode","parseInt","hash","slash","suffix","kb","solidLogicSingleton","adoptACLDefault","doc","aclDoc","defaultResource","defaultACLDoc","ACL","isContainer","proposed","each","reduce","accumulatedStatements","da","statementsMatching","st","kb2","graph","add","move","subject","predicate","object","symbol","readACL","auths","getDefaultsFallback","ac","agent","agentClass","agentGroup","origin","originClass","pred","mode","sameACL","b","contains","ACLunion","list","ag","_loop","loadUnionACL","subjectList","callbackFunction","aclList","doList","getACLorDefault","shift","ok","p2","targetDoc","targetACLDoc","defaultHolder","defa","ACLbyCombination","byCombo","combo","sort","combo2","makeACLGraph","x","makeACLGraphbyCombo","main","pairs","modeURIs","short","comboToString","sameTerm","utils","putACLObject","putACLbyCombo","_kb$updater","updater","put","_kb$fetcher","fetcher","unload","requested","fixIndividualACL","item","subjects","exists","union","getACL","status","tryParent","right","doc2","nowOrWhenFetched","ACL_LINK","nonexistent","response","getProspectiveHolder","_x","_getProspectiveHolder","_asyncToGenerator","_callee","targetDirectory","_context","reject","isDirectACL","toPropertyKey","toPrimitive","Number","_defineProperties","_arrayLikeToArray","Array","_unsupportedIterableToArray","from","_slicedToArray","isArray","highlightColor","formBorderColor","formHeadingColor","lowProfileLinkColor","formFieldNameBoxWidth","mediaModuleCanvasWidth","mediaModuleCanvasHeight","textInputSize","tabBorderRadius","textInputBackgroundColor","textInputBackgroundColorUneditable","textInputColor","textInputColorPending","defaultErrorBackgroundColor","participationDefaultBackground","basicMaxLength","style","checkboxStyle","checkboxInputStyle","fieldLabelStyle","formSelectStyle","textInputStyle","textInputStyleUneditable","buttonStyle","commentStyle","iconStyle","smallButtonStyle","classIconStyle","confirmPopupStyle","messageBodyStyle","pendingeditModifier","personaBarStyle","searchInputStyle","autocompleteRowStyle","signInAndUpButtonStyle","headerBannerLoginInput","signUpBackground","signInBackground","heading1Style","heading2Style","heading3Style","heading4Style","formHeadingStyle","formTextInput","formGroupStyle","styleConstants","formFieldLabelStyle","formFieldNameBoxStyle","multilineTextInputStyle","renderAsDivStyle","imageDivStyle","linkDivStyle","aclControlBoxContainer","aclControlBoxHeader","aclControlBoxStatus","aclControlBoxStatusRevealed","aclGroupContent","accessGroupList","accessGroupListItem","defaultsController","defaultsControllerNotice","bigButton","group","group1","group2","group3","group5","group9","group13","trustedAppAddApplicationsTable","trustedAppCancelButton","trustedAppControllerI","temporaryStatusInit","temporaryStatusEnd","headerUserMenuLink","headerUserMenuLinkHover","headerUserMenuTrigger","headerUserMenuTriggerImg","headerUserMenuButton","headerUserMenuButtonHover","headerUserMenuList","headerUserMenuListDisplay","headerUserMenuNavigationMenu","headerUserMenuNavigationMenuNotDisplayed","headerUserMenuListItem","headerUserMenuPhoto","headerBanner","headerBannerLink","headerBannerRightMenu","headerBannerLogin","allChildrenVisible","headerBannerUserMenu","headerBannerHelpMenu","headerBannerIcon","footer","primaryButton","primaryButtonHover","primaryButtonNoBorder","primaryButtonNoBorderHover","secondaryButton","secondaryButtonHover","secondaryButtonNoBorder","secondaryButtonNoBorderHover","controlStyle","dragEvent","dropEvent","restoreStyle","errorCancelButton","errorMessageBlockStyle","notepadStyle","upstreamStatus","downstreamStatus","baseStyle","headingCore","headingStyle","participantsStyle","participantsBlock","personTableTD","tabsNavElement","tabsRootElement","tabsMainElement","tabContainer","makeNewSlot","ellipsis","makeDropTarget","ele","droppedURIHandler","droppedFileHandler","dragoverListener","preventDefault","dataTransfer","dropEffect","dragenterListener","localStyle","savedStyle","dragleaveListener","dropListener","text","uris","getData","files","size","lastModifiedDate","toLocaleDateString","addEventListener","addTargetListeners","makeDraggable","tr","fontWeight","setData","outerHTML","stopPropagation","uploadFiles","fileBase","imageBase","successHandler","reader","FileReader","onload","theFile","data","target","byteLength","endsWith","folderName","startsWith","destURI","encodeURIComponent","webOperation","_response","readAsArrayBuffer","setStyle","styleName","audioContext","nextVariable","newVariableName","clearVariableNames","beep","ctx","duration","frequency","finishedCallback","osc","createOscillator","connect","destination","start","hashColor","who","genUuid","Math","random","syncTableToArray","table","things","createNewRow","foundOne","row","trashMe","g","newRow","removeChild","syncTableToArrayReOrdered","elementMap","toNT","existingRow","before","stackString","stack","lines","toPrint","line","charAt","chunks","emptyNode","node","nodes","childNodes","getTarget","event","srcElement","nodeType","parentNode","ancestor","tagName","getAbout","aa","getAttribute","fromNT","getTerm","statementTr","AJAR_statement","className","AJAR_inverse","nextSibling","include","linkstr","lnk","addLoadEvent","func","oldonload","findPos","DocBox","ownerDocument","documentElement","getBoundingClientRect","box","left","top","getEyeFocus","element","instantly","isBottom","myWindow","elementPosY","appContext","SolidAppContext","totalScroll","scroll","scrollY","scrollBy","clientHeight","innerHeight","setInterval","times","clearInterval","AJARImage","src","alt","tt","image","clipboardData","shortName","pok","prefixes","canUse","pp","prefixchars","ontologyLabel","term","part","labelWithOntology","findTypeURIs","labelForXML","predicateLabelForXML","inverse","predicateLabel","lab","ip","RDFComparePredicateObject","self","other","compareTerm","RDFComparePredicateSubject","predParentOf","previousSibling","nodeName","errorMessageBlock","dom","err","backgroundColor","err2","div","errorObject","textContent","cancelButton","AudioContext","webkitAudioContext","wrapDivInATR","addClickListenerToElement","onClickFunction","createImageDiv","imageDiv","linkIcon","iconURI","anchor","img","createLinkForURI","linkDiv","iconLink","classList","cancelIconURI","checkIconURI","complain","context","statusArea","getElementsByTagName","firstElementChild","getStatusArea","clearElement","extractLogURI","fullURI","logPos","search","rulPos","shortDate","noTime","nowZ","toISOString","formatDateTime","date","format","Month","Milliseconds","FullYear","timestamp","shortTime","setName","findName","_ok","imagesOf","iconForClass","tempSite","q","findImageFromURI","iconDir","findImage","trySetImage","iconForClassMap","explitImage","typeIcon","schemeIcon","typeURI","setImage","pref","theClass","faviconOrDefault","parts","isOrigin","res","deleteButtonWithCheck","container","noun","deleteFunction","minusIconURI","deleteButton","prompt","title","refererenceElement","position","removePopup","parentElement","removePopupAndDoDeletion","popup","display","gridTemplateColumns","affirm","gridColumn","gridRow","cancel","xButton","cancelPrompt","affirmIcon","button","sureButtonElt","renderDeleteConfirmPopup","handler","options","buttonColor","needsBorder","toLocaleUpperCase","onmouseover","onmouseout","opacity","continueButton","askName","_reject","form","namefield","gotName","trim","select","keyCode","_event","focus","personTR","renderAsRow","td1","td2","td3","draggable","createNameDiv","nameDiv","createLinkDiv","renderAsDiv","clickable","wrapInATR","refreshTree","root","refresh","attachmentList","theTarget","opt","modify","update","errorBody","_xhr","deleteAttachment","attachmentTable","ins","_options$uploadFolder","_options$uploadFolder2","uploadFolder","promptIcon","attachmentOuter","attachmentOne","attachmentLeft","paperclip","fhandler","buttonDiv","fileUploadButtonDiv","openHrefInOutlineMode","outlineManager","GotoSubject","panes","getOutliner","defaultAnnotationStore","allClassURIs","propertyTriage","possibleProperties","dp","op","no","nd","nu","pi","predicateIndex","ps","linkButton","removeButton","selectorPanel","possible","linkCallback","selectorPanelRefresh","style0","selected","refreshItem","already","iconDiv","connectIcon","twoLine","widgetForClass","nav","addStyleSheet","href","links","querySelectorAll","isAudio","file","isImage","isVideo","kind","what","typeURIs","prefix","Util","mediaTypeClass","audio","video","input","click","_defineProperty","failed","enc","widget","sup","findSuperClassesNT","cl","authEndpoint","fallbackAuthEndpoint","signupEndpoint","signupWindowHeight","signupWindowWidth","Signup","config","defaultConfig","listen","eventMethod","eventListener","user","signup","signupUrl","width","height","leftPosition","screen","topPosition","windowUrl","location","windowSpecs","open","webid","fieldParams","_fieldParams","dt","pattern","uriPrefix","field","mostSpecificClassURI","ft","bot","bottomTypeURIs","bots","fieldFunction","fieldInQuestion","fun","dom2","STYLE_URI_PREFIX","renderNameValuePair","flexDirection","lhs","rhs","createTextNode","fieldLabel","property","fieldStore","def","sts","why","editable","basicField","formDoc","suppressEmptyUneditable","anyJS","params","paramStyle","inputStyle","maxLength","disabled","ds","Literal","is","statement","updateMany","callback","docs","includes","is1","filter","is2","ds1","ds2","readOnly","languageCodeURIBase","defaultPreferredLanguages","addDefaults","array","code","getPreferredLanguagesFor","_getPreferredLanguagesFor","person","_store$fetcher","languageCodeArray","load","lang","getPreferredLanguages","_getPreferredLanguages","_callee2","me","solidLanguagePrefs","_context2","authn","currentUser","navigator","languages","longForm","language","filterByLanguage","bindings","languagePrefs","binding","languagePrefs2","slimmed","sortMe","AUTOCOMPLETE_LIMIT","subjectRegexp","wikidataClasses","Corporation","EducationalOrganization","GovernmentOrganization","MedicalOrganization","MusicGroup","NGO","Occupation","Project","ResearchOrganization","SportsOrganization","instituteDetailsWikidataQuery","fetcherOptionsJsonPublicData","credentials","headers","Headers","Accept","escoParameters","logo","searchByNameURI","dbpediaParameters","searchByNameQuery","endpoint","dbPediaTypeMap","AcademicInsitution","wikidataOutgoingClassMap","Enterprise","Business","CharitableOrganization","Insitute","wikidataParameters","limit","insitituteDetailsQuery","wikidataIncomingClassMap","variableNameToPredicateMap","targetClass","sealImage","subsidiary","city","state","country","homepage","lat","long","bindingToTerm","typ","loadFromBindings","solidSubject","predMap","results","combined","JSON","stringify","Set","parse","datatype","float","latitude","longitude","ESCOResultToBindings","json","_embedded","queryESCODataByName","_x2","_x3","_queryESCODataByName","queryTarget","queryURI","responseText","fixWikidataJSON","syntaxProblem","goodness","queryPublicDataByName","_x4","_x5","_x6","_x7","_queryPublicDataByName","substituteStrings","sparql","_store$fetcher2","text2","_t2","template","queryPublicDataSelect","_x8","_x9","_queryPublicDataSelect","_callee3","_store$fetcher3","myUrlWithParams","_context3","URL","searchParams","append","queryPublicDataConstruct","_x0","_x1","_x10","_queryPublicDataConstruct","_callee4","pubicId","_store$fetcher4","report","_context4","loadPublicDataThing","_x11","_x12","_x13","_loadPublicDataThing","_callee5","publicDataID","iDToFetch","_context5","getDbpediaDetails","getWikidataDetails","_x14","_x15","_x16","_getWikidataDetails","_callee6","subjRegexp","_context6","getWikidataDetailsOld","_x17","_x18","_x19","_getWikidataDetailsOld","_callee7","_context7","getWikidataLocation","_x20","_x21","_x22","_getWikidataLocation","_callee8","_context8","_x23","_x24","_x25","_getDbpediaDetails","_callee9","_context9","setVisible","visible","renderAutoComplete","_renderAutoComplete","acOptions","decoration","gotIt","_gotIt","acceptButtonHandler","_acceptButtonHandler","cancelButtonHandler","_cancelButtonHandler","nameMatch","clearList","inputEventHHandler","_inputEventHHandler","loadBindingsAndFilterByLanguage","_loadBindingsAndFilterByLanguage","filterByName","refreshList","_refreshList","initialize","lastBindings","loadedEnough","inputEventHandlerLock","allDisplayed","lastFilter","numberOfRows","foundName","foundObject","head","cell","searchInput","currentObject","currentName","acceptButton","editButton","rowForBinding","compareBindingsByName","displayable","_iterator","_step","color","nameTerm","_ref","_createForOfIteratorHelper","queryParams","lastChild","candidate","j","word","permanent","disbaled","objectURIBase","errorRow","widgets","padding","GREEN_PLUS","SEARCH_ICON","EDIT_ICON","renderAutocompleteControl","_renderAutocompleteControl","barOptions","addOneIdAndRefresh","deleteOne","autoCompleteDone","_autoCompleteDone","greenButtonHandler","_greenButtonHandler","removeDecorated","displayAutocomplete","_displayAutocomplete","searchButtonHandler","_searchButtonHandler","_droppedURIHandler","deleteButtonContainer","editing","syncEditingStatus","decoratedAutocomplete","creationArea","manualURIEntry","idNoun","dbLookup","_toConsumableArray","multiselect__container","multiselect__wrapper","multiselect__clear_btn","multiselect__options","multiselect__options_visible","multiselect__options_ul","multiselect__options_ul_li","multiselect__options_ul_li_hover","multiselect__options_ul_p_multiselect__options_no_results","multiselect__options_ul_p_multiselect__options_no_data","multiselect__options_ul_li_multiselect__options_selected","multiselect__options_ul_li_multiselect__options_selected_hover","multiselect__options_ul_li_arrow_selected","multiselect__selected","multiselect__selected_multiselect__remove_btn","multiselect__input","IconicMultiSelect","_createClass","itemTemplate","noData","noResults","placeholder","tagTemplate","textField","valueField","_classCallCheck","_data","_itemTemplate","_noData","_noResults","_placeholder","_select","_selectContainer","_tagTemplate","_textField","_valueField","_options","_getDataFromSettings","_getDataFromSelectTag","_renderMultiselect","_renderOptionsList","_domElements","_multiselect","querySelector","optionsContainer","optionsContainerList","find","callbackFn","some","_enableEventListenners","_initSelectedList","option","_this","_processTemplate","multiselect__remove_btn","_cross","insertAdjacentHTML","lastElementChild","el","dataset","_handleOption","_this2","_selectedOptions","remove","_removeOptionFromList","_handleClearSelectionBtn","_handlePlaceholder","_dispatchEvent","action","selection","_filterOptions","_removeAllArrowSelected","_this3","_ref2","_closeList","_clearSelection","_ref3","_ref4","_handleArrows","_handleBackspace","_handleEnter","_this4","isOpen","valueLowerCase","hasResults","_showNoResults","characters","floor","arr","hasAttribute","isValueFieldValid","isTextFieldValid","ArrowUp","Up","ArrowDown","Down","scrollIntoView","_scrollIntoView","lastSelectedOption","targetLastSelectedOption","dispatchEvent","splice","multiselect__options_selected","_addOptionToList","_this5","hasItemsSelected","_loop2","processedTemplate","objAttr","_this$_data$index$att","attr","optionDom","_this6","_showNoData","_generateId","parent","child","rectParent","rectChild","bottom","offsetHeight","scrollTop","offsetTop","condition","checkMarkCharacter","cancelCharacter","dashCharacter","refreshOpionsSubfieldinGroup","dataDoc","groupDiv","subfields","eles","newOne","optionsRender","booleanField","tristate","errorBlock","buildCheckboxForm","addSubFormChoice","selectDiv","subForm","editFormButton","appendForm","itemDone","propertiesForClass","explicit","members","used","findClosest","cla","agenda","lists","supers","formsFor","t1","candidates","sortBySequence","pair","sortByLabel","newButton","promptForNew","formFunction","newThing","gotButton","linkDone","insertMe","holds","buttons","AJAR_subject","makeDescription","submit","desc","saveChange","rows","cols","visibility","makeSelectForClassifierOptions","actual","sub","mint","getActual","multiple","currentURI","AJAR_uri","disambiguate","AJAR_mint","nullLabel","newObject","removeValue","mintClass","thisForm","change","mintStatementsFun","sel","subSelect","superSelect","doneNew","_body","fn","makeSelectForOptions","makeSelectForCategory","category","subs","du","makeSelectForNestedCategory","del","colorCarrier","fix","holdsAll","displayState","negation","true","false","null","toDelete","newState","toInsert","getTime","makeSelectForChoice","inputPossibleOptions","selectedOptions","uiFrom","optionsFromClassUIfrom","firstSelectOptionText","createOption","containsObject","hidden","newSelectedOptions","_step2","addValue","existingValues","_iterator2","_step3","_iterator3","removeAttribute","multiSelect","_addOneIdAndRefresh","oldValue","oldName","deletables","insertables","_kb$updater2","the","labelProperty","equals","_deleteOne","_result","_name","_kb$updater3","e2","dataSource","autocompleteOptions","control","already2","weight0","weight","subFieldFunction","itemChanged","dependingOn","cases","tests","debugString","addItem","_addItem","toBeInserted","ordered","createListIfNecessary","saveListThenRefresh","renderItem","_deleteThisItem","subField","moveThisItem","_moveThisItem","upwards","multipleUIlabel","frame","gridTemplateRows","moveUpButton","moveDownButton","shim","gridRowStart","plusIconURI","orderedNode","toJS","min","tail","_eventNotUsed","_saveListThenRefresh","putBack","vals","li","_asyncStuff","extra","asyncStuff","opts","selector","possibleOptions","thisClass","quad","len2","len4","ref1","ref2","ref3","ref4","ref5","seeds","ref","transitiveClosure","rdfFactory","len","len1","len3","findMembersNT","getSelectorOptions","multiSelectDiv","init","subscribe","_callbackFunction","contents","classUri","cssAttribute","_err","setFieldStyle","suppressIfUneditable","_solidLogicSingleton$","profile","loadPreferences","loadProfile","_solidLogicSingleton$2","typeIndex","getScopedAppInstances","getRegistrations","loadAllTypeIndexes","getScopedAppsFromIndex","deleteTypeIndexRegistration","ensureLoggedIn","saveUser","checkUser","webId","loginStatusBox","webIdUri","ensureLoadedPreferences","_ensureLoadedPreferences","preferencesFile","m2","_t4","ensureLoadedProfile","UnauthorizedError","CrossOriginForbiddenError","preferencesFileError","SameOriginForbiddenError","NotEditableError","WebOperationError","FetchError","_ensureLoadedProfile","logInContext","_t5","publicProfile","findAppInstances","_findAppInstances","isPublic","items","_t6","scope","instances","instance","scopeLabel","registrationControl","_registrationControl","registrationStatements","renderScopeCheckbox","scopes","tbody","_t7","statements","registrations","reg","BlankNode","renderScopeHeadingRow","backgoundColor","private","public","header","textAlign","registrationList","_registrationList","headingRow","_t8","_t9","_context0","_deleteFunction","paddingLeft","renderSignInPopup","issuerPopup","issuerPopupBox","issuerPopupBoxTopMenu","issuerPopupBoxLabel","innerText","issuerPopupBoxCloseButton","loginToIssuer","issuerUri","preLoginRedirectHash","locationUrl","flagAuthorizationMetadata","localStorage","setItem","authSession","login","redirectUrl","oidcIssuer","issuerTextContainer","issuerTextInputContainer","issuerTextLabel","issuerTextInput","getItem","issuerTextGoButton","issuerButtonContainer","issuerBottonLabel","getSuggestedIssuers","issuerInfo","issuerButton","listener","offlineTestID","setIt","newidURI","logoutButtonHandler","oldMe","logout","trackSession","sessionInfo","isLoggedIn","signInButtonStyle","logoutLabel","nick","signOutButton","logoutButton","setUserCallback","magicClassName","signInPopUpButton","events","on","webIdURI","divs","getElementsByClassName","offline","signupButton","signInOrSignUpBox","selectWorkspace","appDetails","callbackWS","appPathSegment","say","background","figureOutBase","ws","newBaseString","newBaseNode","_makeNewWorkspace","newBase","newWs","newData","_t3","encodeURI","storages","baseField","autocomplete","col1","col2","col3","comment","cellStyle","deselectedStyle","anyValue","bgcolor","trLast","newAppInstance","gotWS","base","getUserRoles","_getUserRoles","_callee0","_yield$ensureLoadedPr","_t0","_context1","filterAvailablePanes","_filterAvailablePanes","_callee1","userRoles","_context10","pane","isMatchingAudience","audience","isMatch","audienceRole","role","issuer","wellKnownUri","wellKnownResult","openidConfiguration","pathname","fetch","end_session_endpoint","reload","AddAgentButtons","groupList","rootElement","controller","barElement","renderAddButton","toggleBar","renderBar","isExpanded","renderPersonButton","renderGroupButton","renderPublicButton","renderAuthenticatedAgentButton","renderBotButton","renderAppsButton","renderSimplifiedBar","renderNameForm","addPerson","renderCleanup","renderStatus","addGroup","addAgent","renderTemporaryStatus","_this7","addBot","_this8","eventContext","existingApps","renderAppsTable","renderAppsView","newApp","getOriginFromName","race","addNewURI","_this9","trustedApplications","session","paneRegistry","byName","trustedApplicationsElement","render","trustedAppController","_renderAppsTable","trustedApps","trustedOrigins","_this0","flatMap","app","appsTable","thingTR","innerTable","innerRow","_addPerson","domainNameRegexp","_addGroup","_addAgent","agentUri","_addBot","_getOriginFromName","COLLOQUIAL","RECOMMENDED","EXPLANATION","AccessGroups","defaults","_store","aclMap","addAgentButton","renderGroups","isEditable","groupElements","comboIndex","kToCombo","renderGroup","groupRow","handleDroppedUris","renderGroupElements","column","groupNameColumn","ktToList","groupAgentsColumn","groupAgentsTable","renderAgent","agentElement","groupDescriptionElement","personRow","deleteAgent","_deleteAgent","combos","comboToRemove","comboPred","comboObj","save","_addNewURI","handleDroppedUri","_handleDroppedUris","all","_handleDroppedUri","secondAttempt","_this$_store","_args4","findAgent","setACLCombo","removeAgentFromCombos","ty","AccessController","statusElement","targetIsProtected","prospectiveDefaultHolder","isUsingDefaults","aclDefaultStore","mainCombo","defaultsCombo","defaultsDiffer","defaultHolderLink","shortNameForFolder","renderRemoveDefaultsController","renderAddDefaultsController","renderAddAclsController","renderRemoveAclsController","useDefaultButton","removeAcls","addAclButton","addAcls","containerElement","noticeElement","removeDefaults","setTimeout","_addAcls","_message","_addDefaults","_removeAcls","_removeDefaults","fallbackCombo","newAClGraph","_fetch","UpdateManager","global","preventBrowserDropEventsDone","preventDrag","handleDrop","confirm","_loadController","getController","getDirectory","isStorage","hasProtectedAcl","site","ACLToString","makeACLString","serialize","fixIndividualCardACL","groups","setACL","docURI","aclText","aclControl","preventBrowserDropEvents","ACLControlBox5","loadController","newThingUI","createContext","dataBrowserContext","thePanes","star","pre","styleTheIcons","iconArray","selectNewTool","mintingPanes","mintNew","mintingClassMap","classMap","icon","selectTool","folder","iconEle","noIndexHTML","refreshTarget","selectUI","newPaneOptions","assign","workspace","newInstance","isPackage","pa","matrix","matrixForQuery","query","vx","vy","vvalue","whenDone","lastHeader","columns","setCell","cellFunction","old","rowFor","y1","dataValueNT","yDecreasing","columnNumberFor","x1","xNT","col","xDecreasing","td","clearOldCells","colsUsed","rowsUsed","set_y","set_x","newcolumns","markOldCells","addCellFromBindings","colNo","cameraIcon","retakeIcon","cameraCaptureControl","getImageDoc","doneCallback","imageBlob","player","canvas","stopVideo","retakeButton","displayPlayer","shutterButton","canvasWidth","canvasHeight","getContext","drawImage","toBlob","blob","sendButton","mediaDevices","getUserMedia","constraints","stream","srcObject","_resp","saveBlob","getVideoTracks","track","media","cameraButton","but","restoreButton","_restoreButton","imageDoc","randomUUID","crypto","getRandomValues","rnds8","Uint8Array","byteToHex","unsafeStringify","offset","buf","rnds","rng","RangeError","PeoplePicker","groupPickedCb","selectedgroup","onSelectGroup","maxWidth","minHeight","outline","selectedGroup","Group","changeGroupButton","findAddressBook","book","chooseExistingGroupButton","margin","GroupPicker","createNewGroupButton","createNewGroup","defaultNewGroupName","GroupBuilder","bookRegistration","errr","_indexes","indexes","groupIndex","groupContainer","uuidv4","patchPromises","typeStatement","nameStatement","includesGroupStatement","toIns","xhr","responseURL","loadGroups","groupButton","handleClickGroup","getWithDefault","doneBuildingCb","groupChangedCb","onGroupChanged","changeType","dropContainer","groupNameInput","setGroupName","groupNameLabel","webIdNode","personDiv","Person","handleRemove","copy","_templateObject","freeze","defineProperties","raw","doneBuildingButton","rdfClass","holdsStatement","toDel","errorMessage","updatePromises","namedGraph","oldNameStatements","newNameStatement","_solidResponse","removeStatements","imgSrc","profileImg","nameSpan","flexGrow","defaultValue","url","dir","messageArea","messageStore","messageTable","WF","DCT","newestFirst","mention","announce","creatorAndDate","creator","nickAnchor","syncMessages","about","ele2","displayed","messages","stored","addMessage","renderMessage","fresh","content","dateString","AJAR_date","delButton","sureButton","deletions","deleteMessage","middle","sendMessage","dateStamp","literal","altKey","newMessageForm","vars","pat","emptyLeaf","_emptyLeaf","leafDocument","DateFolder","rootThing","leafFileName","membershipProperty","rootFolder","_loadPrevious","backwards","previousPeriod","_previousPeriod","found","nextDate","younger","suitable","lastOrFirst","siblings","_folder","uncle","cousins","leafDocumentFromDate","dateFromLeafDocument","_firstLeaf","folderStore","folderFetcher","earliestSubfolder","_earliestSubfolder","month","leafObjects","kids","force","leafObject","isBytes","ArrayBuffer","isView","anumber","isSafeInteger","abytes","lengths","ahash","h","outputLen","blockLen","aexists","checkFinished","destroyed","finished","clean","arrays","fill","createView","DataView","buffer","byteOffset","rotr","hasHexBuiltin","toHex","fromHex","hexes","_","padStart","bytesToHex","bytes","asciis","asciiToBase16","ch","hexToBytes","hl","al","ai","hi","n1","n2","char","utf8ToBytes","TextEncoder","encode","toBytes","concatBytes","sum","Hash","hashCons","hashC","digest","tmp","bytesLength","randomBytes","Chi","Maj","HashMD","padOffset","isLE","super","pos","view","take","dataView","process","subarray","roundClean","digestInto","out","aoutput","setBigUint64","_32n","BigInt","_u32_max","wh","wl","setUint32","oview","outLen","destroy","_cloneInto","to","clone","SHA256_IV","Uint32Array","SHA256_K","SHA256_W","SHA256","A","B","C","D","E","F","H","getUint32","W15","W2","s0","s1","T1","T2","HMAC","_key","iHash","oHash","_0n","_1n","_abool2","_abytes2","needsLen","numberToHexUnpadded","num","hexToNumber","numberToBytesBE","numberToBytesLE","expectedLength","isPosBig","max","bitLen","_validateObject","fields","optFields","checkField","fieldName","expectedType","isOpt","val","current","entries","memoized","WeakMap","args","computed","_2n","_3n","_4n","_5n","_7n","_8n","_9n","_16n","mod","pow2","power","modulo","invert","number","assertIsSquare","Fp","eql","sqr","sqrt3mod4","p1div4","ORDER","pow","sqrt5mod8","p5div8","mul","nv","ONE","tonelliShanks","P","Q","S","Z","_Fp","Field","FpLegendre","cc","Q1div2","is0","M","R","ZERO","t_tmp","exponent","FpSqrt","Fp_","tn","c1","neg","c2","c3","c4","tv1","tv2","tv3","tv4","e1","cmov","e3","sqrt9mod16","FIELD_FIELDS","FpPow","nums","passZero","inverted","multipliedAcc","acc","invertedAcc","inv","reduceRight","p1mod2","powered","yes","zero","nBitLength","_nBitLength","nByteLength","ceil","bitLenOrOpts","_nbitLength","_sqrt","allowedLengths","modFromBytes","sqrt","_opts","BITS","BYTES","sqrtP","MASK","isValid","isValidNot0","isOdd","sqrN","addN","subN","mulN","fromBytes","skipValidation","padded","scalar","invertBatch","lst","getFieldBytesLength","fieldOrder","bitLength","getMinHashLength","mapHashToField","fieldLen","minLen","reduced","negateCt","negate","normalizeZ","points","invertedZs","fromAffine","toAffine","validateW","W","bits","calcWOpts","scalarBits","maxNumber","windows","windowSize","mask","shiftBy","calcOffsets","wOpts","wbits","nextN","offsetStart","abs","isZero","isNeg","isNegF","offsetF","validateMSMPoints","validateMSMScalars","scalars","pointPrecomputes","pointWindowSizes","getW","assert0","wNAF","Point","BASE","Fn","_unsafeLadder","elm","double","precomputeWindow","point","precomputes","wo","wNAFUnsafe","getPrecomputes","transform","comp","cached","unsafe","createCache","delete","hasCache","createField","order","divNearest","den","validateSigFormat","validateSigOpts","optsn","optName","lowS","prehash","DERErr","DER","Err","_tlv","tag","dataLen","lenLen","decode","first","lengthBytes","_int","toSig","int","tlv","seqBytes","seqLeftBytes","rBytes","rLeftBytes","sBytes","sLeftBytes","hexFromSig","sig","seq","_normFnElement","expected","weierstrassN","extraOpts","validated","CURVE","curveOpts","FpFnLE","_createCurveFields","cofactor","CURVE_ORDER","allowInfinityPoint","clearCofactor","isTorsionFree","endo","wrapPrivateKey","beta","basises","getWLengths","assertCompressionIsSupported","encodePoint","_c","isCompressed","bx","pprefix","of","decodePoint","publicKey","publicKeyUncompressed","uncomp","L","isValidXY","y2","weierstrassEquation","sqrtError","x2","x3","Gx","Gy","_4a3","_27b2","acoord","banZero","aprjpoint","splitEndoScalarN","basis","a1","b1","a2","b2","k1","k2","k1neg","k2neg","MAX_NUM","_splitEndoScalar","toAffineMemo","iz","X","Y","zz","assertValidMemo","finishEndo","endoBeta","k1p","k2p","assertValidity","precompute","isLazy","wnaf","multiply","hasEvenY","X1","Y1","Z1","X2","Y2","Z2","U1","U2","b3","X3","Y3","Z3","t0","t2","t3","t4","t5","subtract","fake","k1f","k2f","multiplyUnsafe","sc","p1","mulEndoUnsafe","multiplyAndAddUnsafe","invertedZ","isSmallOrder","px","py","pz","toRawBytes","_setWindowSize","msm","fieldN","plength","slength","buckets","resI","sumI","pippenger","fromPrivateKey","privateKey","secretKey","publicKeyHasPrefix","signature","ecdsa","ecdsaOpts","hmac","bits2int","bits2int_modN","msgs","fnBits","keygen","getPublicKey","getSharedSecret","ecdhOpts","randomBytes_","seed","isValidSecretKey","randomSecretKey","isProbPub","isValidPublicKey","isValidPrivateKey","randomPrivateKey","normPrivateKeyToScalar","secretKeyA","publicKeyB","ecdh","defaultSigOpts","extraEntropy","defaultSigOpts_format","isBiggerThanHalfOrder","validateRS","Signature","recovery","recid","validateSigLength","addRecoveryBit","recoverPublicKey","messageHash","FIELD_ORDER","rec","radj","ir","u1","u2","hasHighS","fromCompact","fromDER","normalizeS","toDERRawBytes","toDERHex","toCompactRawBytes","toCompactHex","delta","ORDER_MASK","int2octets","aInRange","validateMsgAndHash","sign","k2sig","h1int","seedArgs","kBytes","ik","normS","prepSig","hashLen","qByteLen","hmacFn","u8n","u8of","byte","reset","reseed","gen","sl","createHmacDrbg","drbg","verify","sg","isHex","isObj","derError","tryParsingSig","_weierstrass_legacy_opts_to_new","allowedPrivateKeyLengths","weierstrass","_ecdsa_legacy_opts_to_new","_ecdsa","ProjectivePoint","_ecdsa_new_output_to_legacy","secp256k1_CURVE","secp256k1_ENDO","Fpk1","_6n","_11n","_22n","_23n","_44n","_88n","b6","b9","b11","b22","b44","b88","b176","b220","b223","secp256k1","curveDef","defHash","createCurve","TAGGED_HASH_PREFIXES","taggedHash","tagP","tagH","pointToBytes","Pointk1","hasEven","schnorrGetExtPubKey","priv","d_","lift_x","xx","challenge","schnorrGetPublicKey","schnorrSign","auxRand","rand","rx","schnorrVerify","pub","schnorr","bytesToNumberBE","TextDecoder","utf8Encoder","SEC","getBlankMsg","created","dateDeleted","maker","getMsgHash","msgHash","sha256","serializeMsg","verifySignature","pubKey","signMsg","getRootIfPreferencesExist","_store$any","_root","pubKeyUrl","privKeyUrl","getExistingPublicKey","_getExistingPublicKey","publicKeyUrl","getKeyIfExists","getExistingPrivateKey","_getExistingPrivateKey","privateKeyUrl","_getKeyIfExists","keyUrl","keyType","setAcl","_setAcl","keyDoc","aclBody","keyAclDoc","_err$response","keyContainerAclBody","keyAclBody","keyAgent","generatePrivateKey","generatePublicKey","_getPublicKey","publicKeyDoc","getPrivateKey","_getPrivateKey","privateKeyDoc","validPublicKey","newPublicKey","keyContainer","saveKey","deleteKeyAcl","_saveKey","ChatChannel","channel","channelRoot","dateFolder","_createMessage","updateMessage","_updateMessage","oldMsg","deleteIt","thread","chatDocument","oldMsgMaker","oldMsgMostRecentVersion","oldMsgThread","errMsg","_errMsg","_args2","mostRecentVersion","_deleteMessage","_createThread","threadRoot","insert","allVersions","_allVersions","versions","originalVersion","_originalVersion","_mostRecentVersion","isDeleted","renderParticipants","unused1","unused2","newRowForParticipation","parp","bg","block","syncTable","parps","participations","participationObject","padDoc","pn","participation","lightColorHash","recordParticipation","refreshable","manageParticipation","PAD","Namespace","author","notepad","upstream","clearStatus","_upsteam","setPartStyle","colors","pending","chunk","indent","removePart","NamedNode","reloadAndSync","addListeners","queueProperty","queue","shiftKey","newChunk","newIndent","requestDownstreamAction","changeIndent","updateStore","lastSent","newPartAfter","tr1","here","newPart","newLinesBefore","consistencyCheck","complain2","sync","manif","reloading","retryTimeout","tryReload","getChunks","xmlEncode","notepadToHTML","decreaseLevel","rawContent","increaseLevel","BOOK","updatePromise","_findBookmarkDocument","userContext","fileTail","newBookmarkFile","bookmarkDocument","createIfNotExists","createTypeIndexLogic","registerInTypeIndex","addBookmark","_addBookmark","bookmarkDoc","toggleBookmark","_toggleBookmark","bookmarkButton","bookmarks","connectedStatements","renderBookmarksButton","_renderBookmarksButton","setBookmarkButtonColor","_setBookmarkButtonColor","bookmarked","emojiMap","sentimentStripLinked","_sentimentStripLinked","strip","_refresh","actions","sentiments","version","flat","ss","_ss","messageToolbar","_messageToolbar","messageRow","channelObject","editMessage","_editMessage","replyInThread","_replyInThread","closeToolbar","deleteThingThen","_deleteThingThen","sentimentButton","context1","actionClass","mutuallyExclusive","setColor","dirty","existingAction","createThread","chatOptions","showThread","switchToEditor","elementForImageURI","imageUri","inlineImageHeightEms","nickname","creatorAndDateHorizontal","dateBit","fontSize","marginLeft","renderMessageRow","_renderMessageRow","unsignedMessage","colorizeByAuthor","latestVersion","latestVersionCreator","msgId","replies","straightReplies","reply","originalMessage","edited","sortDate","bothDates","isURI","para","_img","anc","getBgColor","toolsButton","authorDateOnLeft","expandImagesInline","toolsTR","tools","toolsTD","toolTR","_objectSpread","_switchToEditor","editRow","renderMessageEditor","originalRow","handleFieldInput","_handleFieldInput","_sendMessage","fromMainField","sendComplete","_sendComplete","_text2","oldRow","insertMessageIntoTable","messageEditor","sendIcon","_tookPicture","menuHandler","menuButton","shiftEnterSendsMessage","revertEditing","turnOnInput","findBookmarkDocument","desktopNotification","Notification","permission","requestPermission","_insertMessageIntoTable","selectedMessage","selectedElement","newestfirst","infiniteMessageArea","_infiniteMessageArea","_callee13","wasStore","chatChannel","_syncMessages","_addMessage","insertPreviousMessages","_insertPreviousMessages","removePreviousMessages","createMessageTable","_createMessageTable","renderMessageTable","_renderMessageTable","addNewChatDocumentIfNewDay","_addNewChatDocumentIfNewDay","appendCurrentMessages","_appendCurrentMessages","loadMoreWhereNeeded","_loadMoreWhereNeeded","loadInitialContent","_loadInitialContent","liveMessageTable","threadRootMessage","earliest","latest","threadTime","lock","_context13","_callee12","yank","fixScroll","live","selectedDocument","threadRootDocument","initialDocment","todayDocument","selectedMessageTable","selectedDate","_context12","inputRow","solo","_callee11","magicZone","scrollBottom","_context11","initial","extendBackwards","scrollHeight","extendForwards","_callee10","addDownstreamChangeListener","newChatDocument","oldChatDocument","scrollBackbutton","scrollForwardButton","_extendBackwards","setScrollBackbuttonIcon","_extendForwards","setScrollForwardButtonIcon","_scrollForwardButtonHandler","titleTR","dateCell","scrollForwardButtonCell","extendedForwards","sense","scrollForwardIcon","getScrollForwardButtonIcon","extendedBack","scrollBackIcon","getScrollbackIcon","includeRemoveButton","statusTR","extremity","todayDoc","newMessageTable","loadPrevious","showDeletedMessages","recordSharedPreferences","sharedPreferences","sp","recordPersonalDefaults","prefs","regs","personalDefaults","errm","renderPreferencesForm","preferencesForm","prefContainer","heading","mes","getPreferencesForClass","predicates","v1","renderTableViewPane","allType","typeSelectorDiv","addColumnDiv","sourceDocument","tableClass","givenQuery","rowsLookup","FORBIDDEN_COLUMNS","XSD_NUMBER_TYPES","XSD_DATE_TYPES","IMAGE_TYPES","keyVariable","subjectIdCounter","lastQuery","mostCommonType","resultDiv","generateControlBar","tableDiv","runQuery","logicalRows","renderTableForQuery","typeObj","getTypeForObject","addUse","discoverTypes","typeUrl","identifyColumnsForType","SubjectType","objectToArray","calculateTable","dropdown","optionElement","getLabel","buildFilteredTable","generateTypeSelector","typeUri","bestCount","best","useCount","getMostCommonType","generateQuery","rowVar","variable","selectedColumns","getColumns","setVariable","addSelectToQuery","queryType","addWhereToQuery","formula","getVariable","optional","addColumnsToQuery","unusedColumns","getUnusedColumns","aLabel","sortKey","bLabel","columnIndex","addColumn","generateColumnAddDropdown","running","htmlTable","updateTable","allColumns","getAllColumns","removeColumn","Column","checkedAnyValues","possiblyLiteral","possiblyNumber","checkValue","getKey","getHints","hints","superClass","setPredicate","alternatives","getConstraints","filterFunction","isImageColumn","getColumnForPredicate","subjectType","getSubjectProperties","properties","predicateUri","allColumnsList","sortFunction","sortColumns","renderColumnDeleteButton","applyColumnFiltersToRow","rowDisplayed","columnKey","columnValue","htmlRow","_htmlRow","applyColumnFilters","literalSort","literalToString","colValue","row1","row2","row1Value","row2Value","parentTable","applyColumnSort","value1","value2","strValue1","strValue2","renderLiteralSelector","textBox","sort1","sort2","renderEnumSelector","searchValue","initialSelection","renderNumberSelector","minSelector","maxSelector","renderTableSelector","range","cs","choices","fallbackRenderTableSelector","linkTo","linkText","linkFunction","renderValue","cellFormat","span","renderImage","linkToObject","valueInList","updateRow","needUpdate","linkTd","_subject","orig","objects","different","originalValues","renderTableRowInto","getSubjectId","_subject_id","startTime","progressMessage","original","rowKeyId","rowKey","elapsedTimeMS","sortBy","variableNT","getColumnForVariable","sortReverse","onDone","inferColumnsFromFormula","inferColumns","queryVar","th","renderTableHeader","renderTableSelectors","ReferenceError","_setPrototypeOf","Boolean","valueOf","Reflect","construct","Map","has","Wrapper","TabWidgetElement","_callSuper","_inherits","_wrapNativeSuper","HTMLElement","tabsDefaultBackgroundColor","tabWidget","orientation","flipped","vertical","onClose","_getColors","total","isLight","colorBlend","getColors","_getColors2","selectedColor","bodyMainStyle","navElement","mainElement","bodyContainer","corners","cornersPrepped","cornersStyle","margins","marginsPrepped","marginsStyle","paddingStyle","tabStyle","unselectedStyle","selectedStyle","shownStyle","hiddenStyle","orderedSync","startEmpty","selectedTab","selectedTab0","selectedTabURI","selectedTab1","clickMe","onclick","resetTabStyle","resetBodyStyle","bodyTR","bodyMain","getOrCreateContainerElement","renderMain","asSettings","renderTabSettings","renderTab","_ele$bodyTR","newBodyMain","slot","differ","newSlot","newBodyDiv","onCloseSet","existingCancelButton","extraTab","tabCancelButton","addCancelButton","mix","ca","cb","res2","emptyProfile","getPod","getPodOwner","_getPodOwner","pod","containerTurtle","podOwner","guess","initFetchOptions","accept","throttle","wait","timeout","previous","later","leading","remaining","clearTimeout","trailing","DEFAULT_HELP_MENU_ICON","initHeader","_initHeader","userMenuList","rebuildHeader","createBanner","_createBanner","podLink","userMenu","banner","leftSideOfHeader","helpMenu","createUserMenu","createLoginSignUpButtons","helpMenuList","createHelpMenu","helpMenuItems","menuItem","createUserMenuItem","createUserMenuLink","createUserMenuButton","helpMenuContainer","helpMenuTrigger","helpMenuIcon","helpIcon","throttledMenuToggle","toggleMenu","timer","profileLoginButtonPre","onClick","_createUserMenu","loggedInMenuList","loggedInMenu","loggedInMenuTrigger","loggedInMenuContainer","getProfileImg","headerBannerUserMenuNotDisplayed","menuProfileItem","profileUrl","_unused","profileImage","backgroundImage","trigger","menu","expand","close","initFooter","_initFooter","rebuildFooter","createControllerInfoBlock","profileLinkContainer","podLinkPre","profileLinkPre","profileLink","getName","solidProjectLinkPre","solidProjectLink","solidProjectUrl","solidProjectName","solidProjectLinkPost","createTypes","preferences","tabs"],"sourceRoot":""}