/*! For license information please see 396.9eab5752.iframe.bundle.js.LICENSE.txt */
(self.webpackChunksolid_ui=self.webpackChunksolid_ui||[]).push([[396],{"./lib/acl/access-controller.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessController=void 0;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),_acl=__webpack_require__("./lib/acl/acl.js"),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_accessGroups=__webpack_require__("./lib/acl/access-groups.js"),_aclControl=__webpack_require__("./lib/acl/acl-control.js"),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t5 in e)"default"!==_t5&&{}.hasOwnProperty.call(e,_t5)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t5))&&(i.get||i.set)?o(f,_t5,i):f[_t5]=e[_t5]);return f})(e,t)}exports.AccessController=function(){return(0,_createClass2.default)(function AccessController(subject,noun,context,statusElement,targetIsProtected,targetDoc,targetACLDoc,defaultHolder,defaultACLDoc,prospectiveDefaultHolder,store,dom){if((0,_classCallCheck2.default)(this,AccessController),this.subject=subject,this.noun=noun,this.context=context,this.statusElement=statusElement,this.targetIsProtected=targetIsProtected,this.targetDoc=targetDoc,this.targetACLDoc=targetACLDoc,this.defaultHolder=defaultHolder,this.defaultACLDoc=defaultACLDoc,this.prospectiveDefaultHolder=prospectiveDefaultHolder,this.store=store,this.dom=dom,(0,_defineProperty2.default)(this,"mainCombo",void 0),(0,_defineProperty2.default)(this,"defaultsCombo",void 0),(0,_defineProperty2.default)(this,"isContainer",void 0),(0,_defineProperty2.default)(this,"defaultsDiffer",void 0),(0,_defineProperty2.default)(this,"rootElement",void 0),(0,_defineProperty2.default)(this,"isUsingDefaults",void 0),this.rootElement=dom.createElement("div"),this.rootElement.setAttribute("style",style.aclGroupContent),this.isContainer="/"===targetDoc.uri.slice(-1),defaultHolder&&defaultACLDoc){this.isUsingDefaults=!0;var aclDefaultStore=(0,_acl.adoptACLDefault)(this.targetDoc,targetACLDoc,defaultHolder,defaultACLDoc);this.mainCombo=new _accessGroups.AccessGroups(targetDoc,targetACLDoc,this,aclDefaultStore,{defaults:this.isContainer}),this.defaultsCombo=null,this.defaultsDiffer=!1}else this.isUsingDefaults=!1,this.mainCombo=new _accessGroups.AccessGroups(targetDoc,targetACLDoc,this,store),this.defaultsCombo=new _accessGroups.AccessGroups(targetDoc,targetACLDoc,this,store,{defaults:this.isContainer}),this.defaultsDiffer=!(0,_acl.sameACL)(this.mainCombo.aclMap,this.defaultsCombo.aclMap)},[{key:"isEditable",get:function get(){return!this.isUsingDefaults}},{key:"render",value:function render(){if(this.rootElement.innerHTML="",this.isUsingDefaults){if(this.renderStatus("The sharing for this ".concat(this.noun," is the default for folder ")),this.defaultHolder){var defaultHolderLink=this.statusElement.appendChild(this.dom.createElement("a"));defaultHolderLink.href=this.defaultHolder.uri,defaultHolderLink.innerText=(0,_aclControl.shortNameForFolder)(this.defaultHolder)}}else!this.defaultsDiffer&&this.isContainer?this.renderStatus("This is also the default for things in this folder."):this.renderStatus("");return this.rootElement.appendChild(this.mainCombo.render()),this.defaultsCombo&&this.defaultsDiffer?(this.rootElement.appendChild(this.renderRemoveDefaultsController()),this.rootElement.appendChild(this.defaultsCombo.render())):this.isEditable&&this.isContainer&&this.rootElement.appendChild(this.renderAddDefaultsController()),!this.targetIsProtected&&this.isUsingDefaults?this.rootElement.appendChild(this.renderAddAclsController()):this.targetIsProtected||this.rootElement.appendChild(this.renderRemoveAclsController()),this.rootElement}},{key:"renderRemoveAclsController",value:function renderRemoveAclsController(){var _this=this,useDefaultButton=this.dom.createElement("button");return useDefaultButton.innerText="Remove custom sharing settings for this ".concat(this.noun," -- just use default").concat(this.prospectiveDefaultHolder?" for ".concat(utils.label(this.prospectiveDefaultHolder)):""),useDefaultButton.setAttribute("style",style.bigButton),useDefaultButton.addEventListener("click",function(){return _this.removeAcls().then(function(){return _this.render()}).catch(function(error){return _this.renderStatus(error)})}),useDefaultButton}},{key:"renderAddAclsController",value:function renderAddAclsController(){var _this2=this,addAclButton=this.dom.createElement("button");return addAclButton.innerText="Set specific sharing for this ".concat(this.noun),addAclButton.setAttribute("style",style.bigButton),addAclButton.addEventListener("click",function(){return _this2.addAcls().then(function(){return _this2.render()}).catch(function(error){return _this2.renderStatus(error)})}),addAclButton}},{key:"renderAddDefaultsController",value:function renderAddDefaultsController(){var _this3=this,containerElement=this.dom.createElement("div");containerElement.setAttribute("style",style.defaultsController);var noticeElement=containerElement.appendChild(this.dom.createElement("div"));noticeElement.innerText="Sharing for things within the folder currently tracks sharing for the folder.",noticeElement.setAttribute("style",style.defaultsControllerNotice);var button=containerElement.appendChild(this.dom.createElement("button"));return button.innerText="Set the sharing of folder contents separately from the sharing for the folder",button.setAttribute("style",style.bigButton),button.addEventListener("click",function(){return _this3.addDefaults().then(function(){return _this3.render()})}),containerElement}},{key:"renderRemoveDefaultsController",value:function renderRemoveDefaultsController(){var _this4=this,containerElement=this.dom.createElement("div");containerElement.setAttribute("style",style.defaultsController);var noticeElement=containerElement.appendChild(this.dom.createElement("div"));noticeElement.innerText="Access to things within this folder:",noticeElement.setAttribute("style",style.defaultsControllerNotice);var button=containerElement.appendChild(this.dom.createElement("button"));return button.innerText="Set default for folder contents to just track the sharing for the folder",button.setAttribute("style",style.bigButton),button.addEventListener("click",function(){return _this4.removeDefaults().then(function(){return _this4.render()}).catch(function(error){return _this4.renderStatus(error)})}),containerElement}},{key:"renderTemporaryStatus",value:function renderTemporaryStatus(message){var _this5=this;this.statusElement.setAttribute("style",style.aclControlBoxStatusRevealed),this.statusElement.innerText=message,this.statusElement.setAttribute("style",style.temporaryStatusInit),setTimeout(function(){_this5.statusElement.setAttribute("style",style.temporaryStatusEnd)}),setTimeout(function(){_this5.statusElement.innerText=""},5e3)}},{key:"renderStatus",value:function renderStatus(message){message||this.statusElement.setAttribute("style",style.aclControlBoxStatusRevealed),this.statusElement.innerText=message}},{key:"addAcls",value:(_addAcls=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var message,_message,_t,_this6=this;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(this.defaultHolder&&this.defaultACLDoc){_context.next=1;break}return message="Unable to find defaults to copy",debug.error(message),_context.abrupt("return",Promise.reject(message));case 1:return(0,_acl.adoptACLDefault)(this.targetDoc,this.targetACLDoc,this.defaultHolder,this.defaultACLDoc).statements.forEach(function(st){return _this6.store.add(st.subject,st.predicate,st.object,_this6.targetACLDoc)}),_context.prev=2,_context.next=3,this.store.fetcher.putBack(this.targetACLDoc);case 3:return this.isUsingDefaults=!1,_context.abrupt("return",Promise.resolve());case 4:return _context.prev=4,_t=_context.catch(2),_message=" Error writing back access control file! ".concat(_t),debug.error(_message),_context.abrupt("return",Promise.reject(_message));case 5:case"end":return _context.stop()}},_callee,this,[[2,4]])})),function addAcls(){return _addAcls.apply(this,arguments)})},{key:"addDefaults",value:(_addDefaults=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:this.defaultsCombo=new _accessGroups.AccessGroups(this.targetDoc,this.targetACLDoc,this,this.store,{defaults:!0}),this.defaultsDiffer=!0;case 1:case"end":return _context2.stop()}},_callee2,this)})),function addDefaults(){return _addDefaults.apply(this,arguments)})},{key:"removeAcls",value:(_removeAcls=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(){var message,_t2,_t3;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=1,this.store.fetcher.delete(this.targetACLDoc.uri,{});case 1:return this.isUsingDefaults=!0,_context3.prev=2,_context3.next=3,(0,_acl.getProspectiveHolder)(this.targetDoc.uri);case 3:this.prospectiveDefaultHolder=_context3.sent,_context3.next=5;break;case 4:_context3.prev=4,_t2=_context3.catch(2),debug.warn(_t2);case 5:_context3.next=7;break;case 6:return _context3.prev=6,_t3=_context3.catch(0),message="Error deleting access control file: ".concat(this.targetACLDoc,": ").concat(_t3),debug.error(message),_context3.abrupt("return",Promise.reject(message));case 7:case"end":return _context3.stop()}},_callee3,this,[[0,6],[2,4]])})),function removeAcls(){return _removeAcls.apply(this,arguments)})},{key:"removeDefaults",value:(_removeDefaults=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(){var fallbackCombo,_t4;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return fallbackCombo=this.defaultsCombo,_context4.prev=1,this.defaultsCombo=null,this.defaultsDiffer=!1,_context4.next=2,this.save();case 2:_context4.next=4;break;case 3:return _context4.prev=3,_t4=_context4.catch(1),this.defaultsCombo=fallbackCombo,this.defaultsDiffer=!0,debug.error(_t4),_context4.abrupt("return",Promise.reject(_t4));case 4:case"end":return _context4.stop()}},_callee4,this,[[1,3]])})),function removeDefaults(){return _removeDefaults.apply(this,arguments)})},{key:"save",value:function save(){var _this7=this,newAClGraph=(0,_rdflib.graph)();this.isContainer?this.defaultsCombo&&this.defaultsDiffer?((0,_acl.makeACLGraphbyCombo)(newAClGraph,this.targetDoc,this.mainCombo.byCombo,this.targetACLDoc,!0),(0,_acl.makeACLGraphbyCombo)(newAClGraph,this.targetDoc,this.defaultsCombo.byCombo,this.targetACLDoc,!1,!0)):(0,_acl.makeACLGraphbyCombo)(newAClGraph,this.targetDoc,this.mainCombo.byCombo,this.targetACLDoc,!0,!0):(0,_acl.makeACLGraphbyCombo)(newAClGraph,this.targetDoc,this.mainCombo.byCombo,this.targetACLDoc,!0),newAClGraph.fetcher=(0,_rdflib.fetcher)(newAClGraph,{fetch:this.store.fetcher._fetch});var updater=newAClGraph.updater||new _rdflib.UpdateManager(newAClGraph);return new Promise(function(resolve,reject){updater.put(_this7.targetACLDoc,newAClGraph.statementsMatching(void 0,void 0,void 0,_this7.targetACLDoc),"text/turtle",function(uri,ok,message){if(!ok)return reject(new Error("ACL file save failed: ".concat(message)));_this7.store.fetcher.unload(_this7.targetACLDoc),_this7.store.add(newAClGraph.statements),_this7.store.fetcher.requested[_this7.targetACLDoc.uri]="done",_this7.mainCombo.store=_this7.store,_this7.defaultsCombo&&(_this7.defaultsCombo.store=_this7.store),_this7.defaultsDiffer=!!_this7.defaultsCombo&&!(0,_acl.sameACL)(_this7.mainCombo.aclMap,_this7.defaultsCombo.aclMap),debug.log("ACL modification: success!"),resolve()})})}}]);var _removeDefaults,_removeAcls,_addDefaults,_addAcls}()},"./lib/acl/access-groups.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessGroups=void 0;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_slicedToArray2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/slicedToArray.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_acl=__webpack_require__("./lib/acl/acl.js"),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_addAgentButtons=__webpack_require__("./lib/acl/add-agent-buttons.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}var ACL=ns.acl,COLLOQUIAL={13:"Owners",9:"Owners (write locked)",5:"Editors",3:"Posters",2:"Submitters",1:"Viewers"},RECOMMENDED={13:!0,5:!0,3:!0,2:!0,1:!0},EXPLANATION={13:"can read, write, and control sharing.",9:"can read and control sharing, currently write-locked.",5:"can read and change information",3:"can add new information, and read but not change existing information",2:"can add new information but not read any",1:"can read but not change information"};exports.AccessGroups=function(){return(0,_createClass2.default)(function AccessGroups(doc,aclDoc,controller,store){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};(0,_classCallCheck2.default)(this,AccessGroups),this.doc=doc,this.aclDoc=aclDoc,this.controller=controller,this.options=options,(0,_defineProperty2.default)(this,"defaults",void 0),(0,_defineProperty2.default)(this,"byCombo",void 0),(0,_defineProperty2.default)(this,"aclMap",void 0),(0,_defineProperty2.default)(this,"addAgentButton",void 0),(0,_defineProperty2.default)(this,"rootElement",void 0),(0,_defineProperty2.default)(this,"_store",void 0),this.defaults=options.defaults||!1,this._store=store,this.aclMap=(0,_acl.readACL)(doc,aclDoc,store,this.defaults),this.byCombo=(0,_acl.ACLbyCombination)(this.aclMap),this.addAgentButton=new _addAgentButtons.AddAgentButtons(this),this.rootElement=this.controller.dom.createElement("div"),this.rootElement.setAttribute("style",style.accessGroupList)},[{key:"store",get:function get(){return this._store},set:function set(store){this._store=store,this.aclMap=(0,_acl.readACL)(this.doc,this.aclDoc,store,this.defaults),this.byCombo=(0,_acl.ACLbyCombination)(this.aclMap)}},{key:"render",value:function render(){var _this=this;return this.rootElement.innerHTML="",this.renderGroups().forEach(function(group){return _this.rootElement.appendChild(group)}),this.controller.isEditable&&this.rootElement.appendChild(this.addAgentButton.render()),this.rootElement}},{key:"renderGroups",value:function renderGroups(){for(var groupElements=[],comboIndex=15;comboIndex>0;comboIndex--){var combo=kToCombo(comboIndex);(this.controller.isEditable&&RECOMMENDED[comboIndex]||this.byCombo[combo])&&groupElements.push(this.renderGroup(comboIndex,combo))}return groupElements}},{key:"renderGroup",value:function renderGroup(comboIndex,combo){var _this2=this,groupRow=this.controller.dom.createElement("div");return groupRow.setAttribute("style",style.accessGroupListItem),widgets.makeDropTarget(groupRow,function(uris){return _this2.handleDroppedUris(uris,combo).then(function(){return _this2.controller.render()}).catch(function(error){return _this2.controller.renderStatus(error)})}),this.renderGroupElements(comboIndex,combo).forEach(function(column){return groupRow.appendChild(column)}),groupRow}},{key:"renderGroupElements",value:function renderGroupElements(comboIndex,combo){var _this3=this,groupNameColumn=this.controller.dom.createElement("div");if(groupNameColumn.setAttribute("style",style.group),this.controller.isEditable)switch(comboIndex){case 1:groupNameColumn.setAttribute("style",style.group1);break;case 2:groupNameColumn.setAttribute("style",style.group2);break;case 3:groupNameColumn.setAttribute("style",style.group3);break;case 5:groupNameColumn.setAttribute("style",style.group5);break;case 9:groupNameColumn.setAttribute("style",style.group9);break;case 13:groupNameColumn.setAttribute("style",style.group13);break;default:groupNameColumn.setAttribute("style",style.group)}groupNameColumn.innerText=COLLOQUIAL[comboIndex]||function ktToList(k){for(var list="",y=["Read","Append","Write","Control"],i=0;i<4;i++)k&1<<i&&(list+=y[i]);return list}(comboIndex);var groupAgentsColumn=this.controller.dom.createElement("div");if(groupAgentsColumn.setAttribute("style",style.group),this.controller.isEditable)switch(comboIndex){case 1:groupAgentsColumn.setAttribute("style",style.group1);break;case 2:groupAgentsColumn.setAttribute("style",style.group2);break;case 3:groupAgentsColumn.setAttribute("style",style.group3);break;case 5:groupAgentsColumn.setAttribute("style",style.group5);break;case 9:groupAgentsColumn.setAttribute("style",style.group9);break;case 13:groupAgentsColumn.setAttribute("style",style.group13);break;default:groupAgentsColumn.setAttribute("style",style.group)}var groupAgentsTable=groupAgentsColumn.appendChild(this.controller.dom.createElement("table"));(this.byCombo[combo]||[]).map(function(_ref){var _ref2=(0,_slicedToArray2.default)(_ref,2),pred=_ref2[0],obj=_ref2[1];return _this3.renderAgent(groupAgentsTable,combo,pred,obj)}).forEach(function(agentElement){return groupAgentsTable.appendChild(agentElement)});var groupDescriptionElement=this.controller.dom.createElement("div");if(groupDescriptionElement.setAttribute("style",style.group),this.controller.isEditable)switch(comboIndex){case 1:groupDescriptionElement.setAttribute("style",style.group1);break;case 2:groupDescriptionElement.setAttribute("style",style.group2);break;case 3:groupDescriptionElement.setAttribute("style",style.group3);break;case 5:groupDescriptionElement.setAttribute("style",style.group5);break;case 9:groupDescriptionElement.setAttribute("style",style.group9);break;case 13:groupDescriptionElement.setAttribute("style",style.group13);break;default:groupDescriptionElement.setAttribute("style",style.group)}return groupDescriptionElement.innerText=EXPLANATION[comboIndex]||"Unusual combination",[groupNameColumn,groupAgentsColumn,groupDescriptionElement]}},{key:"renderAgent",value:function renderAgent(groupAgentsTable,combo,pred,obj){var _this4=this,personRow=widgets.personTR(this.controller.dom,ACL(pred),(0,_rdflib.sym)(obj),this.controller.isEditable?{deleteFunction:function deleteFunction(){return _this4.deleteAgent(combo,pred,obj).then(function(){return groupAgentsTable.removeChild(personRow)}).catch(function(error){return _this4.controller.renderStatus(error)})}}:{});return personRow}},{key:"deleteAgent",value:(_deleteAgent=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(combo,pred,obj){var combos,comboToRemove;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return combos=this.byCombo[combo]||[],(comboToRemove=combos.find(function(_ref3){var _ref4=(0,_slicedToArray2.default)(_ref3,2),comboPred=_ref4[0],comboObj=_ref4[1];return comboPred===pred&&comboObj===obj}))&&combos.splice(combos.indexOf(comboToRemove),1),_context.next=1,this.controller.save();case 1:case"end":return _context.stop()}},_callee,this)})),function deleteAgent(_x,_x2,_x3){return _deleteAgent.apply(this,arguments)})},{key:"addNewURI",value:(_addNewURI=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(uri){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=1,this.handleDroppedUri(uri,kToCombo(1));case 1:return _context2.next=2,this.controller.save();case 2:case"end":return _context2.stop()}},_callee2,this)})),function addNewURI(_x4){return _addNewURI.apply(this,arguments)})},{key:"handleDroppedUris",value:(_handleDroppedUris=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(uris,combo){var _t,_this5=this;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=1,Promise.all(uris.map(function(uri){return _this5.handleDroppedUri(uri,combo)}));case 1:return _context3.next=2,this.controller.save();case 2:_context3.next=4;break;case 3:return _context3.prev=3,_t=_context3.catch(0),_context3.abrupt("return",Promise.reject(_t));case 4:case"end":return _context3.stop()}},_callee3,this,[[0,3]])})),function handleDroppedUris(_x5,_x6){return _handleDroppedUris.apply(this,arguments)})},{key:"handleDroppedUri",value:(_handleDroppedUri=(0,_asyncToGenerator2.default)(function(uri,combo){var _this6=this,secondAttempt=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _regenerator.default.mark(function _callee4(){var agent,thing,_this6$_store,message,error,_t2;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(agent=findAgent(uri,_this6.store),thing=(0,_rdflib.sym)(uri),agent||secondAttempt){_context4.next=5;break}return debug.log("   Not obvious: looking up dropped thing ".concat(thing)),_context4.prev=1,_context4.next=2,null===(_this6$_store=_this6._store)||void 0===_this6$_store||null===(_this6$_store=_this6$_store.fetcher)||void 0===_this6$_store?void 0:_this6$_store.load(thing.doc());case 2:_context4.next=4;break;case 3:return _context4.prev=3,_t2=_context4.catch(1),message="Ignore error looking up dropped thing: ".concat(_t2),debug.error(message),_context4.abrupt("return",Promise.reject(new Error(message)));case 4:return _context4.abrupt("return",_this6.handleDroppedUri(uri,combo,!0));case 5:if(agent){_context4.next=6;break}return error="   Error: Drop fails to drop appropriate thing! ".concat(uri),debug.error(error),_context4.abrupt("return",Promise.reject(new Error(error)));case 6:_this6.setACLCombo(combo,uri,agent,_this6.controller.subject);case 7:case"end":return _context4.stop()}},_callee4,null,[[1,3]])})()}),function handleDroppedUri(_x7,_x8){return _handleDroppedUri.apply(this,arguments)})},{key:"setACLCombo",value:function setACLCombo(combo,uri,res,subject){combo in this.byCombo||(this.byCombo[combo]=[]),this.removeAgentFromCombos(uri),this.byCombo[combo].push([res.pred,res.obj.uri]),debug.log("ACL: setting access to ".concat(subject," by ").concat(res.pred,": ").concat(res.obj))}},{key:"removeAgentFromCombos",value:function removeAgentFromCombos(uri){for(var k=0;k<16;k++){var combos=this.byCombo[kToCombo(k)];if(combos)for(var i=0;i<combos.length;i++)for(;i<combos.length&&combos[i][1]===uri;)combos.splice(i,1)}}}]);var _handleDroppedUri,_handleDroppedUris,_addNewURI,_deleteAgent}();function kToCombo(k){for(var y=["Read","Append","Write","Control"],combo=[],i=0;i<4;i++)k&1<<i&&combo.push("http://www.w3.org/ns/auth/acl#"+y[i]);return combo.sort(),combo.join("\n")}function findAgent(uri,kb){var obj=(0,_rdflib.sym)(uri),types=kb.findTypeURIs(obj);for(var ty in types)debug.log("    drop object type includes: "+ty);if(uri.startsWith("http")&&3===uri.split("/").length)return{pred:"origin",obj};if(uri.startsWith("http")&&4===uri.split("/").length&&uri.endsWith("/"))return debug.log("Assuming final slash on dragged origin URI was unintended!"),{pred:"origin",obj:(0,_rdflib.sym)(uri.slice(0,-1))};if(ns.vcard("WebID").uri in types)return{pred:"agent",obj};if(ns.vcard("Group").uri in types)return{pred:"agentGroup",obj};if(obj.sameTerm(ns.foaf("Agent"))||obj.sameTerm(ns.acl("AuthenticatedAgent"))||obj.sameTerm(ns.rdf("Resource"))||obj.sameTerm(ns.owl("Thing")))return{pred:"agentClass",obj};if(ns.vcard("Individual").uri in types||ns.foaf("Person").uri in types||ns.foaf("Agent").uri in types){var pref=kb.any(obj,ns.foaf("preferredURI"));return pref?{pred:"agent",obj:(0,_rdflib.sym)(pref)}:{pred:"agent",obj}}return ns.solid("AppProvider").uri in types?{pred:"origin",obj}:ns.solid("AppProviderClass").uri in types?{pred:"originClass",obj}:(debug.log("    Triage fails for "+uri),null)}},"./lib/acl/acl-control.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ACLControlBox5=function ACLControlBox5(subject,context,noun,kb){var dom=context.dom,doc=subject.doc(),container=dom.createElement("div");container.setAttribute("style",style.aclControlBoxContainer);var header=container.appendChild(dom.createElement("h1"));header.textContent="Sharing for ".concat(noun," ").concat(utils.label(subject)),header.setAttribute("style",style.aclControlBoxHeader);var status=container.appendChild(dom.createElement("div"));status.setAttribute("style",style.aclControlBoxStatus);try{(function loadController(_x,_x2,_x3,_x4,_x5,_x6,_x7){return _loadController.apply(this,arguments)})(doc,kb,subject,noun,context,dom,status).then(function(controller){return container.appendChild(controller.render())})}catch(error){status.innerText=error}return container},exports.handleDrop=handleDrop,exports.preventBrowserDropEvents=function preventBrowserDropEvents(document){if((0,_debug.log)("preventBrowserDropEvents called."),void 0!==global){if(global[preventBrowserDropEventsDone])return;global[preventBrowserDropEventsDone]=!0}document.addEventListener("drop",handleDrop,!1),document.addEventListener("dragenter",preventDrag,!1),document.addEventListener("dragover",preventDrag,!1)},exports.preventDrag=preventDrag,exports.setGlobalWindow=function setGlobalWindow(window){global=window},exports.shortNameForFolder=function shortNameForFolder(x){var str=x.uri;"/"===str.slice(-1)&&(str=str.slice(0,-1));var slash=str.lastIndexOf("/");slash>=0&&(str=str.slice(slash+1));return str||"/"};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),_acl=__webpack_require__("./lib/acl/acl.js"),_accessController=__webpack_require__("./lib/acl/access-controller.js"),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_debug=__webpack_require__("./lib/debug.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t2 in e)"default"!==_t2&&{}.hasOwnProperty.call(e,_t2)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t2))&&(i.get||i.set)?o(f,_t2,i):f[_t2]=e[_t2]);return f})(e,t)}var global=window,preventBrowserDropEventsDone=Symbol("prevent double triggering of drop event");function preventDrag(e){e.stopPropagation(),e.preventDefault()}function handleDrop(e){e.dataTransfer.files.length>0&&(global.confirm("Are you sure you want to drop this file here? (Cancel opens it in a new tab)")||(e.stopPropagation(),e.preventDefault(),(0,_debug.log)("@@@@ document-level DROP suppressed: "+e.dataTransfer.dropEffect)))}function _loadController(){return _loadController=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(doc,kb,subject,noun,context,dom,status){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",new Promise(function(resolve,reject){return(0,_acl.getACLorDefault)(doc,function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(ok,isDirectACL,targetDoc,targetACLDoc,defaultHolder,defaultACLDoc){var targetDirectory,targetIsProtected,prospectiveDefaultHolder,getController,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(getController=function _getController(prospectiveDefaultHolder){return new _accessController.AccessController(subject,noun,context,status,targetIsProtected,targetDoc,targetACLDoc,defaultHolder,defaultACLDoc,prospectiveDefaultHolder,kb,dom)},ok){_context.next=1;break}return _context.abrupt("return",reject(new Error("Error reading ".concat(isDirectACL?"":" default ","ACL. status ").concat(targetDoc,": ").concat(targetACLDoc))));case 1:if(targetDirectory=getDirectory(targetDoc),(targetIsProtected=isStorage(targetDoc,targetACLDoc,kb)||hasProtectedAcl(targetDoc))||!targetDirectory){_context.next=5;break}return _context.prev=2,_context.next=3,(0,_acl.getProspectiveHolder)(targetDirectory);case 3:return prospectiveDefaultHolder=_context.sent,_context.abrupt("return",resolve(getController(prospectiveDefaultHolder)));case 4:_context.prev=4,_t=_context.catch(2),(0,_debug.warn)(_t);case 5:return _context.abrupt("return",resolve(getController()));case 6:case"end":return _context.stop()}},_callee,null,[[2,4]])}));return function(_x8,_x9,_x0,_x1,_x10,_x11){return _ref.apply(this,arguments)}}())}));case 1:case"end":return _context2.stop()}},_callee2)})),_loadController.apply(this,arguments)}function getDirectory(doc){var str=doc.uri.split("#")[0],p=str.slice(0,-1).lastIndexOf("/"),q=str.indexOf("//");return q>=0&&p<q+2||p<0?null:str.slice(0,p+1)}function isStorage(doc,aclDoc,store){return store.holds(doc,ns.rdf("type"),ns.space("Storage"),aclDoc)}function hasProtectedAcl(targetDoc){return targetDoc.uri===targetDoc.site().uri}},"./lib/acl/acl.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ACLToString=function ACLToString(ac){return comboToString(ACLbyCombination(ac))},exports.ACLbyCombination=ACLbyCombination,exports.ACLunion=ACLunion,exports.adoptACLDefault=function adoptACLDefault(doc,aclDoc,defaultResource,defaultACLDoc){var ACL=ns.acl,isContainer="/"===doc.uri.slice(-1),proposed=kb.each(void 0,ACL("default"),defaultResource,defaultACLDoc).concat(kb.each(void 0,ACL("defaultForNew"),defaultResource,defaultACLDoc)).reduce(function(accumulatedStatements,da){return accumulatedStatements.concat(kb.statementsMatching(da,ns.rdf("type"),ACL("Authorization"),defaultACLDoc)).concat(kb.statementsMatching(da,ACL("agent"),void 0,defaultACLDoc)).concat(kb.statementsMatching(da,ACL("agentClass"),void 0,defaultACLDoc)).concat(kb.statementsMatching(da,ACL("agentGroup"),void 0,defaultACLDoc)).concat(kb.statementsMatching(da,ACL("origin"),void 0,defaultACLDoc)).concat(kb.statementsMatching(da,ACL("originClass"),void 0,defaultACLDoc)).concat(kb.statementsMatching(da,ACL("mode"),void 0,defaultACLDoc)).concat((0,_rdflib.st)(da,ACL("accessTo"),doc,defaultACLDoc)).concat(isContainer?(0,_rdflib.st)(da,ACL("default"),doc,defaultACLDoc):[])},[]),kb2=(0,_rdflib.graph)();return proposed.forEach(function(st){return kb2.add(move(st.subject),move(st.predicate),move(st.object),(0,_rdflib.sym)(aclDoc.uri))}),kb2;function move(symbol){var y=defaultACLDoc.uri.length;return(0,_rdflib.sym)(symbol.uri.slice(0,y)===defaultACLDoc.uri?aclDoc.uri+symbol.uri.slice(y):symbol.uri)}},exports.comboToString=comboToString,exports.fixIndividualACL=fixIndividualACL,exports.fixIndividualCardACL=function fixIndividualCardACL(person,log,callbackFunction){var groups=kb.each(void 0,ns.vcard("hasMember"),person);groups?fixIndividualACL(person,groups,log,callbackFunction):(log("This card is in no groups"),callbackFunction(!0))},exports.getACL=getACL,exports.getACLorDefault=getACLorDefault,exports.getProspectiveHolder=function getProspectiveHolder(_x){return _getProspectiveHolder.apply(this,arguments)},exports.loadUnionACL=loadUnionACL,exports.makeACLGraph=makeACLGraph,exports.makeACLGraphbyCombo=makeACLGraphbyCombo,exports.makeACLString=function makeACLString(x,ac,aclDoc){var kb2=(0,_rdflib.graph)();return makeACLGraph(kb2,x,ac,aclDoc),(0,_rdflib.serialize)(aclDoc,kb2,aclDoc.uri,"text/turtle")||""},exports.putACLObject=putACLObject,exports.putACLbyCombo=putACLbyCombo,exports.readACL=readACL,exports.sameACL=sameACL,exports.setACL=function setACL(docURI,aclText,callbackFunction){var aclDoc=kb.any(docURI,_solidLogic.ACL_LINK);if(!kb.fetcher)throw new Error("Store has no fetcher");aclDoc?kb.fetcher.webOperation("PUT",aclDoc.value,{data:aclText,contentType:"text/turtle"}).then(function(res){callbackFunction(res.ok,res.error||"")}):kb.fetcher.nowOrWhenFetched(docURI,void 0,function(ok,body){if(!ok)return callbackFunction(ok,"Gettting headers for ACL: "+body);var aclDoc=kb.any(docURI,_solidLogic.ACL_LINK);if(aclDoc){if(!kb.fetcher)throw new Error("Store has no fetcher");kb.fetcher.webOperation("PUT",aclDoc.value,{data:aclText,contentType:"text/turtle"}).then(function(res){callbackFunction(res.ok,res.error||"")})}else callbackFunction(!1,"No Link rel=ACL header for "+docURI)})};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var kb=_solidLogic.solidLogicSingleton.store;function readACL(doc,aclDoc){var kb2=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kb,auths=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?function getDefaultsFallback(kb,ns){return kb.each(void 0,ns.acl("default"),doc).concat(kb.each(void 0,ns.acl("defaultForNew"),doc))}(kb2,ns):kb2.each(void 0,ns.acl("accessTo"),doc),ACL=ns.acl,ac={agent:{},agentClass:{},agentGroup:{},origin:{},originClass:{}};return Object.keys(ac).forEach(function(pred){auths.forEach(function(a){kb2.each(a,ACL("mode")).forEach(function(mode){kb2.each(a,ACL(pred)).forEach(function(agent){ac[pred][agent.uri]=ac[pred][agent.uri]||{},ac[pred][agent.uri][mode.uri]=a})})})}),ac}function sameACL(a,b){var contains=function contains(a,b){for(var pred in{agent:!0,agentClass:!0,agentGroup:!0,origin:!0,originClass:!0})if(a[pred])for(var agent in a[pred])for(var mode in a[pred][agent])if(!b[pred][agent]||!b[pred][agent][mode])return!1;return!0};return contains(a,b)&&contains(b,a)}function ACLunion(list){for(var a,ag,b=list[0],_loop=function _loop(k){["agent","agentClass","agentGroup","origin","originClass"].forEach(function(pred){if((a=list[k])[pred])for(ag in a[pred])for(var mode in a[pred][ag])b[pred][ag]||(b[pred][ag]=[]),b[pred][ag][mode]=!0})},k=1;k<list.length;k++)_loop(k);return b}function loadUnionACL(subjectList,callbackFunction){var aclList=[],_doList=function doList(list){list.length?getACLorDefault(list.shift().doc(),function(ok,p2,targetDoc,targetACLDoc,defaultHolder,defaultACLDoc){var defa=!p2;if(!ok||!defaultHolder||!defaultACLDoc)return callbackFunction(ok,targetACLDoc);var acl=defa?readACL(defaultHolder,defaultACLDoc):readACL(targetDoc,targetACLDoc);aclList.push(acl),_doList(list.slice(1))}):callbackFunction(!0,ACLunion(aclList))};_doList(subjectList)}function ACLbyCombination(ac){var byCombo={};return["agent","agentClass","agentGroup","origin","originClass"].forEach(function(pred){for(var agent in ac[pred]){var combo=[];for(var mode in ac[pred][agent])combo.push(mode);combo.sort();var combo2=combo.join("\n");byCombo[combo2]||(byCombo[combo2]=[]),byCombo[combo2].push([pred,agent])}}),byCombo}function makeACLGraph(kb,x,ac,aclDoc){return makeACLGraphbyCombo(kb,x,ACLbyCombination(ac),aclDoc)}function makeACLGraphbyCombo(kb,x,byCombo,aclDoc,main,defa){var ACL=ns.acl;for(var combo in byCombo){var pairs=byCombo[combo];if(pairs.length){var modeURIs=combo.split("\n"),_short=modeURIs.map(function(u){return u.split("#")[1]}).join("");defa&&!main&&(_short+="Default");var a=kb.sym(aclDoc.uri+"#"+_short);kb.add(a,ns.rdf("type"),ACL("Authorization"),aclDoc),main&&kb.add(a,ACL("accessTo"),x,aclDoc),defa&&kb.add(a,ACL("default"),x,aclDoc);for(var i=0;i<modeURIs.length;i++)kb.add(a,ACL("mode"),kb.sym(modeURIs[i]),aclDoc);for(var _i=0;_i<pairs.length;_i++){var pred=pairs[_i][0],ag=pairs[_i][1];kb.add(a,ACL(pred),kb.sym(ag),aclDoc)}}}}function comboToString(byCombo){var str="";for(var combo in byCombo){str+=combo.split("\n").map(function(u){return u.split("#")[1][0]}).join("")+":";for(var pairs=byCombo[combo],i=0;i<pairs.length;i++){var pred=pairs[i][0],ag=(0,_rdflib.sym)(pairs[i][1]);str+="agent"===pred?"@":"",str+=ag.sameTerm(ns.foaf("Agent"))?"*":utils.label(ag),i<pairs.length-1&&(str+=",")}str+=";"}return"{"+str.slice(0,-1)+"}"}function putACLObject(kb,x,ac,aclDoc,callbackFunction){return putACLbyCombo(kb,x,ACLbyCombination(ac),aclDoc,callbackFunction)}function putACLbyCombo(kb,x,byCombo,aclDoc,callbackFunction){var _kb$updater,kb2=(0,_rdflib.graph)();makeACLGraphbyCombo(kb2,x,byCombo,aclDoc,!0),null===(_kb$updater=kb.updater)||void 0===_kb$updater||_kb$updater.put(aclDoc,kb2.statementsMatching(void 0,void 0,void 0,aclDoc),"text/turtle",function(uri,ok,message){var _kb$fetcher;ok?(null===(_kb$fetcher=kb.fetcher)||void 0===_kb$fetcher||_kb$fetcher.unload(aclDoc),makeACLGraphbyCombo(kb,x,byCombo,aclDoc,!0),kb.fetcher.requested[aclDoc.uri]="done",callbackFunction(ok)):callbackFunction(ok,message)})}function fixIndividualACL(item,subjects,log,callbackFunction){log=log||debug.log;var doc=item.doc();getACLorDefault(doc,function(ok,exists,targetDoc,targetACLDoc,defaultHolder,defaultACLDoc){if(!ok||!defaultHolder||!defaultACLDoc)return callbackFunction(!1,targetACLDoc);var ac=exists?readACL(targetDoc,targetACLDoc):readACL(defaultHolder,defaultACLDoc);loadUnionACL(subjects,function(ok,union){if(!ok)return callbackFunction(!1,union);sameACL(union,ac)?log("Nice - same ACL. no change "+utils.label(item)+" "+doc):(log("Group ACLs differ for "+utils.label(item)+" "+doc),putACLObject(kb,targetDoc,union,targetACLDoc,callbackFunction))})})}function getACLorDefault(doc,callbackFunction){getACL(doc,function(ok,status,aclDoc,message){var ACL=ns.acl;if(!ok)return callbackFunction(!1,!1,status,message);var _tryParent=function tryParent(uri){"/"===uri.slice(-1)&&(uri=uri.slice(0,-1));var right=uri.lastIndexOf("/");if(uri.indexOf("/",uri.indexOf("//")+2)>right)return callbackFunction(!1,!0,404,"Found no ACL resource");uri=uri.slice(0,right+1);var doc2=(0,_rdflib.sym)(uri);getACL(doc2,function(ok,status,defaultACLDoc){if(!ok)return callbackFunction(!1,!0,status,"( No ACL pointer ".concat(uri," ").concat(status,")").concat(defaultACLDoc));if(403===status)return callbackFunction(!1,!0,status,"( default ACL file FORBIDDEN. Stop.".concat(uri,")"));if(404===status)return _tryParent(uri);if(200!==status)return callbackFunction(!1,!0,status,"Error status '".concat(status,"' searching for default for ").concat(doc2));if(!kb.each(void 0,ACL("default"),kb.sym(uri),defaultACLDoc).concat(kb.each(void 0,ACL("defaultForNew"),kb.sym(uri),defaultACLDoc)).length)return _tryParent(uri);var defaultHolder=kb.sym(uri);return callbackFunction(!0,!1,doc,aclDoc,defaultHolder,defaultACLDoc)})};return ok?404!==status?403===status?callbackFunction(!1,!1,status,"(Sharing not available to you)".concat(message)):200!==status?callbackFunction(!1,!1,status,"Error ".concat(status," accessing Access Control information for ").concat(doc,": ").concat(message)):callbackFunction(!0,!0,doc,aclDoc):void _tryParent(doc.uri):callbackFunction(!1,!1,status,"Error accessing Access Control information for ".concat(doc,") ").concat(message))})}function getACL(doc,callbackFunction){if(!kb.fetcher)throw new Error("kb has no fetcher");kb.fetcher.nowOrWhenFetched(doc,void 0,function(ok,body){if(!ok)return callbackFunction(ok,"Can't get headers to find ACL for ".concat(doc,": ").concat(body));var aclDoc=kb.any(doc,_solidLogic.ACL_LINK);if(aclDoc){if(!kb.fetcher)throw new Error("kb has no fetcher");if(kb.fetcher.nonexistent[aclDoc.value])return callbackFunction(!0,404,aclDoc,"ACL file ".concat(aclDoc," does not exist."));kb.fetcher.nowOrWhenFetched(aclDoc,void 0,function(ok,message,response){ok?callbackFunction(!0,200,aclDoc):callbackFunction(!0,response.status,aclDoc,"Can't read Access Control File ".concat(aclDoc,": ").concat(message))})}else callbackFunction(!1,900,"No Link rel=ACL header for ".concat(doc))})}function _getProspectiveHolder(){return(_getProspectiveHolder=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(targetDirectory){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",new Promise(function(resolve,reject){return getACLorDefault((0,_rdflib.sym)(targetDirectory),function(ok,isDirectACL,targetDoc,targetACLDoc,defaultHolder){return ok?resolve(isDirectACL?targetDoc:defaultHolder):reject(new Error("Error loading ".concat(targetDirectory)))})}));case 1:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}},"./lib/acl/add-agent-buttons.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.AddAgentButtons=void 0;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),_login=__webpack_require__("./lib/login/login.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}exports.AddAgentButtons=function(){return(0,_createClass2.default)(function AddAgentButtons(groupList){(0,_classCallCheck2.default)(this,AddAgentButtons),this.groupList=groupList,(0,_defineProperty2.default)(this,"rootElement",void 0),(0,_defineProperty2.default)(this,"barElement",void 0),(0,_defineProperty2.default)(this,"isExpanded",!1),this.rootElement=groupList.controller.dom.createElement("div"),this.barElement=groupList.controller.dom.createElement("div")},[{key:"render",value:function render(){return this.rootElement.innerHTML="",this.rootElement.appendChild(this.renderAddButton()),this.rootElement.appendChild(this.barElement),this.rootElement}},{key:"renderAddButton",value:function renderAddButton(){var _this=this;return widgets.button(this.groupList.controller.dom,"".concat(_iconBase.icons.iconBase,"noun_34653_green.svg"),"Add ...",function(){_this.toggleBar(),_this.renderBar()})}},{key:"renderBar",value:function renderBar(){this.barElement.innerHTML="",this.isExpanded&&(this.barElement.appendChild(this.renderPersonButton()),this.barElement.appendChild(this.renderGroupButton()),this.barElement.appendChild(this.renderPublicButton()),this.barElement.appendChild(this.renderAuthenticatedAgentButton()),this.barElement.appendChild(this.renderBotButton()),this.barElement.appendChild(this.renderAppsButton()))}},{key:"renderSimplifiedBar",value:function renderSimplifiedBar(button){var _this2=this;Array.from(this.barElement.children).filter(function(element){return element!==button}).forEach(function(element){return _this2.barElement.removeChild(element)})}},{key:"renderPersonButton",value:function renderPersonButton(){var _this3=this;return widgets.button(this.groupList.controller.dom,_iconBase.icons.iconBase+widgets.iconForClass["vcard:Individual"],"Add Person",function(event){_this3.renderSimplifiedBar(event.target),_this3.renderNameForm(ns.vcard("Individual"),"person").then(function(name){return _this3.addPerson(name)}).then(function(){return _this3.renderCleanup()}).catch(function(error){return _this3.groupList.controller.renderStatus(error)})})}},{key:"renderGroupButton",value:function renderGroupButton(){var _this4=this;return widgets.button(this.groupList.controller.dom,_iconBase.icons.iconBase+widgets.iconForClass["vcard:Group"],"Add Group",function(event){_this4.renderSimplifiedBar(event.target),_this4.renderNameForm(ns.vcard("Group"),"group").then(function(name){return _this4.addGroup(name)}).then(function(){return _this4.renderCleanup()}).catch(function(error){return _this4.groupList.controller.renderStatus(error)})})}},{key:"renderNameForm",value:function renderNameForm(type,noun){return widgets.askName(this.groupList.controller.dom,this.groupList.store,this.barElement,ns.vcard("URI"),type,noun)}},{key:"renderPublicButton",value:function renderPublicButton(){var _this5=this;return widgets.button(this.groupList.controller.dom,_iconBase.icons.iconBase+widgets.iconForClass["foaf:Agent"],"Add Everyone",function(){return _this5.addAgent(ns.foaf("Agent").uri).then(function(){return _this5.groupList.controller.renderTemporaryStatus("Adding the general public to those who can read. Drag the globe to a different level to give them more access.")}).then(function(){return _this5.renderCleanup()})})}},{key:"renderAuthenticatedAgentButton",value:function renderAuthenticatedAgentButton(){var _this6=this;return widgets.button(this.groupList.controller.dom,"".concat(_iconBase.icons.iconBase,"noun_99101.svg"),"Anyone logged In",function(){return _this6.addAgent(ns.acl("AuthenticatedAgent").uri).then(function(){return _this6.groupList.controller.renderTemporaryStatus("Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.")}).then(function(){return _this6.renderCleanup()})})}},{key:"renderBotButton",value:function renderBotButton(){var _this7=this;return widgets.button(this.groupList.controller.dom,_iconBase.icons.iconBase+"noun_Robot_849764.svg","A Software Agent (bot)",function(event){_this7.renderSimplifiedBar(event.target),_this7.renderNameForm(ns.schema("Application"),"bot").then(function(name){return _this7.addBot(name)}).then(function(){return _this7.renderCleanup()})})}},{key:"renderAppsButton",value:function renderAppsButton(){var _this8=this;return widgets.button(this.groupList.controller.dom,"".concat(_iconBase.icons.iconBase,"noun_15177.svg"),"A Web App (origin)",function(event){_this8.renderSimplifiedBar(event.target);var eventContext={div:_this8.barElement,dom:_this8.groupList.controller.dom},existingApps=_this8.renderAppsTable(eventContext).catch(function(error){return _this8.groupList.controller.renderStatus(error)});_this8.renderAppsView();var newApp=_this8.renderNameForm(ns.schema("WebApplication"),"webapp domain").then(function(name){return _this8.getOriginFromName(name)});Promise.race([existingApps,newApp]).then(function(origin){origin&&_this8.groupList.addNewURI(origin)}).then(function(){return _this8.renderCleanup()})})}},{key:"renderAppsView",value:function renderAppsView(){var _this9=this,trustedApplications=this.groupList.controller.context.session.paneRegistry.byName("trustedApplications");if(trustedApplications){var trustedApplicationsElement=trustedApplications.render(null,this.groupList.controller.context);trustedApplicationsElement.setAttribute("style",style.trustedAppController);var cancelButton=widgets.cancelButton(this.groupList.controller.dom,function(){return _this9.renderCleanup()});cancelButton.setAttribute("style",style.trustedAppCancelButton),trustedApplicationsElement.insertBefore(cancelButton,trustedApplicationsElement.firstChild),this.barElement.appendChild(trustedApplicationsElement)}}},{key:"renderAppsTable",value:(_renderAppsTable=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(eventContext){var trustedApps,trustedOrigins,_this0=this;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=1,(0,_login.ensureLoadedProfile)(eventContext);case 1:return trustedApps=this.groupList.store.each(eventContext.me,ns.acl("trustedApp")),trustedOrigins=trustedApps.flatMap(function(app){return _this0.groupList.store.each(app,ns.acl("origin"))}),this.barElement.appendChild(this.groupList.controller.dom.createElement("p")).textContent="You have ".concat(trustedOrigins.length," selected web apps."),_context.abrupt("return",new Promise(function(resolve,reject){var appsTable=_this0.barElement.appendChild(_this0.groupList.controller.dom.createElement("table"));appsTable.setAttribute("style",style.trustedAppAddApplicationsTable),trustedApps.forEach(function(app){var origin=_this0.groupList.store.any(app,ns.acl("origin"));origin||reject(new Error("Unable to pick app: ".concat(app.value)));var thingTR=widgets.personTR(_this0.groupList.controller.dom,ns.acl("origin"),origin,{}),innerTable=_this0.groupList.controller.dom.createElement("table"),innerRow=innerTable.appendChild(_this0.groupList.controller.dom.createElement("tr"));innerRow.appendChild(_this0.groupList.controller.dom.createElement("td")).appendChild(thingTR),innerRow.appendChild(_this0.groupList.controller.dom.createElement("td")).textContent="Give access to ".concat(_this0.groupList.controller.noun," ").concat(utils.label(_this0.groupList.controller.subject),"?"),innerRow.appendChild(_this0.groupList.controller.dom.createElement("td")).appendChild(widgets.continueButton(_this0.groupList.controller.dom,function(){return resolve(origin.value)})),appsTable.appendChild(innerTable)})}));case 2:case"end":return _context.stop()}},_callee,this)})),function renderAppsTable(_x){return _renderAppsTable.apply(this,arguments)})},{key:"renderCleanup",value:function renderCleanup(){this.renderBar(),this.groupList.render()}},{key:"addPerson",value:(_addPerson=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(name){var domainNameRegexp;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(name){_context2.next=1;break}return _context2.abrupt("return",this.toggleBar());case 1:if(domainNameRegexp=/^https?:/i,name.match(domainNameRegexp)){_context2.next=2;break}return _context2.abrupt("return",Promise.reject(new Error("Not a http URI")));case 2:return debug.log("Adding to ACL person: ".concat(name)),_context2.next=3,this.groupList.addNewURI(name);case 3:this.toggleBar();case 4:case"end":return _context2.stop()}},_callee2,this)})),function addPerson(_x2){return _addPerson.apply(this,arguments)})},{key:"addGroup",value:(_addGroup=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(name){var domainNameRegexp;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(name){_context3.next=1;break}return _context3.abrupt("return",this.toggleBar());case 1:if(domainNameRegexp=/^https?:/i,name.match(domainNameRegexp)){_context3.next=2;break}return _context3.abrupt("return",Promise.reject(new Error("Not a http URI")));case 2:return debug.log("Adding to ACL group: "+name),_context3.next=3,this.groupList.addNewURI(name);case 3:this.toggleBar();case 4:case"end":return _context3.stop()}},_callee3,this)})),function addGroup(_x3){return _addGroup.apply(this,arguments)})},{key:"addAgent",value:(_addAgent=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(agentUri){return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=1,this.groupList.addNewURI(agentUri);case 1:this.toggleBar();case 2:case"end":return _context4.stop()}},_callee4,this)})),function addAgent(_x4){return _addAgent.apply(this,arguments)})},{key:"addBot",value:(_addBot=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(name){var domainNameRegexp;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(name){_context5.next=1;break}return _context5.abrupt("return",this.toggleBar());case 1:if(domainNameRegexp=/^https?:/i,name.match(domainNameRegexp)){_context5.next=2;break}return _context5.abrupt("return",Promise.reject(new Error("Not a http URI")));case 2:return debug.log("Adding to ACL bot: "+name),_context5.next=3,this.groupList.addNewURI(name);case 3:this.toggleBar();case 4:case"end":return _context5.stop()}},_callee5,this)})),function addBot(_x5){return _addBot.apply(this,arguments)})},{key:"getOriginFromName",value:(_getOriginFromName=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(name){var domainNameRegexp,origin;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(name){_context6.next=1;break}return _context6.abrupt("return",Promise.resolve());case 1:if(domainNameRegexp=/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i,name.match(domainNameRegexp)){_context6.next=2;break}return _context6.abrupt("return",Promise.reject(new Error("Not a domain name")));case 2:return origin="https://"+name,debug.log("Adding to ACL origin: "+origin),this.toggleBar(),_context6.abrupt("return",origin);case 3:case"end":return _context6.stop()}},_callee6,this)})),function getOriginFromName(_x6){return _getOriginFromName.apply(this,arguments)})},{key:"toggleBar",value:function toggleBar(){this.isExpanded=!this.isExpanded}}]);var _getOriginFromName,_addBot,_addAgent,_addGroup,_addPerson,_renderAppsTable}()},"./lib/acl/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.aclControl=exports.acl=void 0;var _acl=__webpack_require__("./lib/acl/acl.js"),_aclControl=__webpack_require__("./lib/acl/acl-control.js");exports.acl={adoptACLDefault:_acl.adoptACLDefault,readACL:_acl.readACL,sameACL:_acl.sameACL,ACLunion:_acl.ACLunion,loadUnionACL:_acl.loadUnionACL,ACLbyCombination:_acl.ACLbyCombination,makeACLGraph:_acl.makeACLGraph,makeACLGraphbyCombo:_acl.makeACLGraphbyCombo,ACLToString:_acl.ACLToString,comboToString:_acl.comboToString,makeACLString:_acl.makeACLString,putACLObject:_acl.putACLObject,putACLbyCombo:_acl.putACLbyCombo,fixIndividualCardACL:_acl.fixIndividualCardACL,fixIndividualACL:_acl.fixIndividualACL,setACL:_acl.setACL,getACLorDefault:_acl.getACLorDefault,getACL:_acl.getACL},exports.aclControl={preventBrowserDropEvents:_aclControl.preventBrowserDropEvents,shortNameForFolder:_aclControl.shortNameForFolder,ACLControlBox5:_aclControl.ACLControlBox5}},"./lib/chat/bookmarks.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.findBookmarkDocument=function findBookmarkDocument(_x){return _findBookmarkDocument.apply(this,arguments)},exports.renderBookmarksButton=function renderBookmarksButton(_x7,_x8){return _renderBookmarksButton.apply(this,arguments)},exports.toggleBookmark=toggleBookmark;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),_index=__webpack_require__("./lib/media/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),pad=_interopRequireWildcard(__webpack_require__("./lib/pad.js")),rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_login=__webpack_require__("./lib/login/login.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t4 in e)"default"!==_t4&&{}.hasOwnProperty.call(e,_t4)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t4))&&(i.get||i.set)?o(f,_t4,i):f[_t4]=e[_t4]);return f})(e,t)}var UI={icons:_iconBase.icons,ns,media:_index.media,pad,rdf,style,utils,widgets},$rdf=UI.rdf,BOOK=$rdf.Namespace("http://www.w3.org/2002/01/bookmark#"),label=utils.label,dom=window.document||null;function updatePromise(del,ins){return new Promise(function(resolve,reject){_solidLogic.store.updater.update(del,ins,function(uri,ok,errorBody){ok?resolve():reject(new Error(errorBody))})})}function _findBookmarkDocument(){return(_findBookmarkDocument=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(userContext){var theClass,fileTail,newBookmarkFile,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return theClass=BOOK("Bookmark"),fileTail="bookmarks.ttl",_context.next=1,(0,_login.findAppInstances)(userContext,theClass,true);case 1:if(!(userContext.instances&&userContext.instances.length>0)){_context.next=2;break}userContext.bookmarkDocument=userContext.instances[0],userContext.instances.length>1&&debug.warn("More than one bookmark file! "+userContext.instances),_context.next=9;break;case 2:if(!userContext.publicProfile){_context.next=8;break}return newBookmarkFile=$rdf.sym(userContext.publicProfile.dir().uri+fileTail),_context.prev=3,debug.log("Creating new bookmark file "+newBookmarkFile),_context.next=4,_solidLogic.store.fetcher.createIfNotExists(newBookmarkFile);case 4:_context.next=6;break;case 5:return _context.prev=5,_t=_context.catch(3),debug.warn("Can't make fresh bookmark file:"+_t),_context.abrupt("return",userContext);case 6:return _context.next=7,(0,_solidLogic.registerInTypeIndex)(newBookmarkFile,userContext.index,theClass);case 7:userContext.bookmarkDocument=newBookmarkFile,_context.next=9;break;case 8:debug.warn("You seem to have no bookmark file, nor even a profile file!");case 9:return _context.abrupt("return",userContext);case 10:case"end":return _context.stop()}},_callee,null,[[3,5]])}))).apply(this,arguments)}function addBookmark(_x2,_x3){return _addBookmark.apply(this,arguments)}function _addBookmark(){return(_addBookmark=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(context,target){var title,me,author,bookmarkDoc,bookmark,ins,msg,_t2;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(title="",me=_solidLogic.authn.currentUser()){_context2.next=1;break}throw new Error("Must be logged on to add Bookmark");case 1:return author=_solidLogic.store.any(target,ns.foaf("maker")),title=label(author)+": "+_solidLogic.store.anyValue(target,ns.sioc("content")).slice(0,80),bookmarkDoc=context.bookmarkDocument,bookmark=UI.widgets.newThing(bookmarkDoc,title),ins=[$rdf.st(bookmarkDoc,UI.ns.dct("references"),bookmark,bookmarkDoc),$rdf.st(bookmark,UI.ns.rdf("type"),BOOK("Bookmark"),bookmarkDoc),$rdf.st(bookmark,UI.ns.dct("created"),new Date,bookmarkDoc),$rdf.st(bookmark,BOOK("recalls"),target,bookmarkDoc),$rdf.st(bookmark,UI.ns.foaf("maker"),me,bookmarkDoc),$rdf.st(bookmark,UI.ns.dct("title"),title,bookmarkDoc)],_context2.prev=2,_context2.next=3,updatePromise([],ins);case 3:_context2.next=5;break;case 4:return _context2.prev=4,_t2=_context2.catch(2),msg="Making bookmark: "+_t2,debug.warn(msg),_context2.abrupt("return",null);case 5:return _context2.abrupt("return",bookmark);case 6:case"end":return _context2.stop()}},_callee2,null,[[2,4]])}))).apply(this,arguments)}function toggleBookmark(_x4,_x5,_x6){return _toggleBookmark.apply(this,arguments)}function _toggleBookmark(){return(_toggleBookmark=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(userContext,target,bookmarkButton){var bookmarks,i,bookmark,_t3;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=1,_solidLogic.store.fetcher.load(userContext.bookmarkDocument);case 1:if(!(bookmarks=_solidLogic.store.each(null,BOOK("recalls"),target,userContext.bookmarkDocument)).length){_context3.next=9;break}if(confirm("Delete bookmark on this?"+bookmarks.length)){_context3.next=2;break}return _context3.abrupt("return");case 2:i=0;case 3:if(!(i<bookmarks.length)){_context3.next=8;break}return _context3.prev=4,_context3.next=5,updatePromise(_solidLogic.store.connectedStatements(bookmarks[i]),[]);case 5:bookmarkButton.style.backgroundColor="white",debug.log("Bookmark deleted: "+bookmarks[i]),_context3.next=7;break;case 6:_context3.prev=6,_t3=_context3.catch(4),debug.error("Cant delete bookmark:"+_t3),debug.warn("Cannot delete bookmark:"+_t3);case 7:i++,_context3.next=3;break;case 8:_context3.next=11;break;case 9:return _context3.next=10,addBookmark(userContext,target);case 10:bookmark=_context3.sent,bookmarkButton.style.backgroundColor="yellow",debug.log("Bookmark added: "+bookmark);case 11:case"end":return _context3.stop()}},_callee3,null,[[4,6]])}))).apply(this,arguments)}function _renderBookmarksButton(){return _renderBookmarksButton=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(userContext,target){var setBookmarkButtonColor,_setBookmarkButtonColor,bookmarkButton;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(_setBookmarkButtonColor=function _setBookmarkButtonCol2(){return _setBookmarkButtonColor=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(bookmarkButton){var bookmarked;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=1,_solidLogic.store.fetcher.load(userContext.bookmarkDocument);case 1:bookmarked=_solidLogic.store.any(null,BOOK("recalls"),bookmarkButton.target,userContext.bookmarkDocument),bookmarkButton.style=UI.style.buttonStyle,bookmarked&&(bookmarkButton.style.backgroundColor="yellow");case 2:case"end":return _context4.stop()}},_callee4)})),_setBookmarkButtonColor.apply(this,arguments)},setBookmarkButtonColor=function _setBookmarkButtonCol(_x9){return _setBookmarkButtonColor.apply(this,arguments)},!userContext.bookmarkDocument){_context5.next=2;break}return(bookmarkButton=UI.widgets.button(dom,UI.icons.iconBase+"noun_45961.svg",label(BOOK("Bookmark")),function(){toggleBookmark(userContext,target,bookmarkButton)})).target=target,_context5.next=1,setBookmarkButtonColor(bookmarkButton);case 1:return _context5.abrupt("return",bookmarkButton);case 2:case"end":return _context5.stop()}},_callee5)})),_renderBookmarksButton.apply(this,arguments)}},"./lib/chat/chatLogic.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ChatChannel=void 0,exports.allVersions=function allVersions(_x5){return _allVersions.apply(this,arguments)},exports.isDeleted=function isDeleted(message){return _solidLogic.store.holds(message,ns.schema("dateDeleted"),null,message.doc())},exports.isHidden=function isHidden(message){return this.isDeleted(message)||this.isReplaced(message)},exports.isReplaced=function isReplaced(message){return _solidLogic.store.holds(message,ns.dct("isReplacedBy"),null,message.doc())},exports.mostRecentVersion=mostRecentVersion,exports.nick=function nick(person){var s=_solidLogic.store.any(person,ns.foaf("nick"));return s?""+s.value:""+utils.label(person)},exports.originalVersion=function originalVersion(_x6){return _originalVersion.apply(this,arguments)};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_dateFolder=__webpack_require__("./lib/chat/dateFolder.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),$rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),_signature=__webpack_require__("./lib/chat/signature.js"),_keys=__webpack_require__("./lib/chat/keys.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t2 in e)"default"!==_t2&&{}.hasOwnProperty.call(e,_t2)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t2))&&(i.get||i.set)?o(f,_t2,i):f[_t2]=e[_t2]);return f})(e,t)}exports.ChatChannel=function(){return(0,_createClass2.default)(function ChatChannel(channel,options){(0,_classCallCheck2.default)(this,ChatChannel),this.channel=channel,this.channelRoot=channel.doc(),this.options=options,this.dateFolder=new _dateFolder.DateFolder(this.channelRoot,"chat.ttl"),this.div=null},[{key:"createMessage",value:(_createMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(text){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",this.updateMessage(text));case 1:case"end":return _context.stop()}},_callee,this)})),function createMessage(_x){return _createMessage.apply(this,arguments)})},{key:"updateMessage",value:(_updateMessage=(0,_asyncToGenerator2.default)(function(text){var _this=this,oldMsg=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,deleteIt=arguments.length>2?arguments[2]:void 0,thread=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _regenerator.default.mark(function _callee2(){var sts,now,timestamp,dateStamp,chatDocument,message,me,msg,oldMsgMaker,oldMsgMostRecentVersion,oldMsgThread,errMsg,privateKey,sig,_errMsg,_t;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(sts=[],now=new Date,timestamp=""+now.getTime(),dateStamp=$rdf.term(now),chatDocument=oldMsg?oldMsg.doc():_this.dateFolder.leafDocumentFromDate(now),message=_solidLogic.store.sym(chatDocument.uri+"#Msg"+timestamp),me=_solidLogic.authn.currentUser(),(msg=(0,_signature.getBlankMsg)()).id=message.uri,!oldMsg){_context2.next=4;break}if((oldMsgMaker=_solidLogic.store.any(oldMsg,ns.foaf("maker"))).uri!==me.uri){_context2.next=2;break}return _context2.next=1,mostRecentVersion(oldMsg);case 1:oldMsgMostRecentVersion=_context2.sent,sts.push($rdf.st(oldMsgMostRecentVersion,ns.dct("isReplacedBy"),message,chatDocument)),(oldMsgThread=_solidLogic.store.any(oldMsgMostRecentVersion,ns.sioc("has_reply")))&&sts.push($rdf.st(message,ns.sioc("has_reply"),oldMsgThread,chatDocument)),deleteIt&&sts.push($rdf.st(message,ns.schema("dateDeleted"),dateStamp,chatDocument)),_context2.next=3;break;case 2:throw errMsg="Error you cannot delete/edit a message from someone else : \n"+oldMsgMaker.uri,debug.warn(errMsg),alert(errMsg),new Error(errMsg);case 3:_context2.next=5;break;case 4:sts.push($rdf.st(_this.channel,ns.wf("message"),message,chatDocument));case 5:if(sts.push($rdf.st(message,ns.sioc("content"),_solidLogic.store.literal(text),chatDocument)),msg.content=text,sts.push($rdf.st(message,ns.dct("created"),dateStamp,chatDocument)),msg.created=dateStamp.value,!me){_context2.next=7;break}return sts.push($rdf.st(message,ns.foaf("maker"),me,chatDocument)),msg.maker=me.uri,_context2.next=6,(0,_keys.getPrivateKey)(me);case 6:privateKey=_context2.sent,sig=(0,_signature.signMsg)(msg,privateKey),sts.push($rdf.st(message,$rdf.sym("".concat(_signature.SEC,"proofValue")),$rdf.lit(sig),chatDocument));case 7:return thread&&(sts.push($rdf.st(thread,ns.sioc("has_member"),message,chatDocument)),thread.doc().sameTerm(message.doc())||sts.push($rdf.st(thread,ns.sioc("has_member"),message,thread.doc()))),_context2.prev=8,_context2.next=9,_solidLogic.store.updater.updateMany([],sts);case 9:_context2.next=11;break;case 10:throw _context2.prev=10,_t=_context2.catch(8),_errMsg="Error saving chat message: "+_t,debug.warn(_errMsg),alert(_errMsg),new Error(_errMsg);case 11:return _context2.abrupt("return",message);case 12:case"end":return _context2.stop()}},_callee2,null,[[8,10]])})()}),function updateMessage(_x2){return _updateMessage.apply(this,arguments)})},{key:"deleteMessage",value:(_deleteMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(message){return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",this.updateMessage("(message deleted)",message,!0));case 1:case"end":return _context3.stop()}},_callee3,this)})),function deleteMessage(_x3){return _deleteMessage.apply(this,arguments)})},{key:"createThread",value:(_createThread=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(threadRoot){var already,thread,insert;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(already=_solidLogic.store.each(threadRoot,ns.sioc("has_reply"),null,threadRoot.doc()).filter(function(thread){return _solidLogic.store.holds(thread,ns.rdf("type"),ns.sioc("Thread"),thread.doc())}),!(already.length>0)){_context4.next=1;break}return _context4.abrupt("return",already[0]);case 1:return thread=$rdf.sym(threadRoot.uri+"-thread"),insert=[$rdf.st(thread,ns.rdf("type"),ns.sioc("Thread"),thread.doc()),$rdf.st(threadRoot,ns.sioc("has_reply"),thread,thread.doc())],_context4.next=2,_solidLogic.store.updater.update([],insert);case 2:return _context4.abrupt("return",thread);case 3:case"end":return _context4.stop()}},_callee4)})),function createThread(_x4){return _createThread.apply(this,arguments)})}]);var _createThread,_deleteMessage,_updateMessage,_createMessage}();function _allVersions(){return(_allVersions=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(message){var versions,done,m,prev,next;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:versions=[message],(done={})[message.uri]=!0,m=message;case 1:if((prev=_solidLogic.store.any(null,ns.dct("isReplacedBy"),m,m.doc()))&&!done[prev.uri]){_context5.next=2;break}return _context5.abrupt("continue",4);case 2:return _context5.next=3,_solidLogic.store.fetcher.load(prev);case 3:versions.unshift(prev),done[prev.uri]=!0,m=prev,_context5.next=1;break;case 4:m=message;case 5:if((next=_solidLogic.store.any(m,ns.dct("isReplacedBy"),null,m.doc()))&&!done[next.uri]){_context5.next=6;break}return _context5.abrupt("continue",7);case 6:versions.push(next),done[next.uri]=!0,m=next,_context5.next=5;break;case 7:return _context5.abrupt("return",versions);case 8:case"end":return _context5.stop()}},_callee5)}))).apply(this,arguments)}function _originalVersion(){return(_originalVersion=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(message){var msg,done;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:msg=message,done={};case 1:if(!msg){_context6.next=4;break}if(!done[msg.uri]){_context6.next=2;break}return debug.error("originalVersion: verion loop"+message),_context6.abrupt("return",message);case 2:return done[msg.uri]=!0,message=msg,_context6.next=3,_solidLogic.store.fetcher.load(message);case 3:msg=_solidLogic.store.any(null,ns.dct("isReplacedBy"),message,message.doc()),_context6.next=1;break;case 4:return _context6.abrupt("return",message);case 5:case"end":return _context6.stop()}},_callee6)}))).apply(this,arguments)}function mostRecentVersion(_x7){return _mostRecentVersion.apply(this,arguments)}function _mostRecentVersion(){return(_mostRecentVersion=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(message){var msg,done;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:msg=message,done={};case 1:if(!msg){_context7.next=4;break}if(!done[msg.uri]){_context7.next=2;break}return debug.error("mostRecentVersion: verion loop"+message),_context7.abrupt("return",message);case 2:return done[msg.uri]=!0,message=msg,_context7.next=3,_solidLogic.store.fetcher.load(message);case 3:msg=_solidLogic.store.any(message,ns.dct("isReplacedBy"),null,message.doc()),_context7.next=1;break;case 4:return _context7.abrupt("return",message);case 5:case"end":return _context7.stop()}},_callee7)}))).apply(this,arguments)}},"./lib/chat/dateFolder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.DateFolder=void 0,exports.emptyLeaf=emptyLeaf;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),$rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t2 in e)"default"!==_t2&&{}.hasOwnProperty.call(e,_t2)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t2))&&(i.get||i.set)?o(f,_t2,i):f[_t2]=e[_t2]);return f})(e,t)}function emptyLeaf(_x){return _emptyLeaf.apply(this,arguments)}function _emptyLeaf(){return(_emptyLeaf=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(leafDocument){return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=1,_solidLogic.store.fetcher.load(leafDocument);case 1:return _context5.abrupt("return",!(_solidLogic.store.statementsMatching(null,ns.dct("created"),null,leafDocument).length>0));case 2:case"end":return _context5.stop()}},_callee5)}))).apply(this,arguments)}exports.DateFolder=function(){return(0,_createClass2.default)(function DateFolder(rootThing,leafFileName,membershipProperty){(0,_classCallCheck2.default)(this,DateFolder),this.root=rootThing,this.rootFolder=rootThing.dir(),this.leafFileName=leafFileName||"index.ttl",this.membershipProperty=membershipProperty||ns.wf("leafObject")},[{key:"leafDocumentFromDate",value:function leafDocumentFromDate(date){var path=date.toISOString().split("T")[0].replace(/-/g,"/");return path=this.root.dir().uri+path+"/"+this.leafFileName,_solidLogic.store.sym(path)}},{key:"dateFromLeafDocument",value:function dateFromLeafDocument(doc){var head=this.rootFolder.uri.length,str=doc.uri.slice(head,head+10).replace(/\//g,"-");return new Date(str)}},{key:"loadPrevious",value:(_loadPrevious=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(date,backwards){var previousPeriod,_previousPeriod,folder,found,leafDocument,nextDate;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:_previousPeriod=function _previousPeriod3(){return(_previousPeriod=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(file,level){var younger,suitable,lastOrFirst,parent,siblings,_folder,uncle,cousins,result,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return lastOrFirst=function _lastOrFirst(siblings){return(siblings=siblings.filter(suitable)).sort(),backwards||siblings.reverse(),siblings.pop()},suitable=function _suitable(x){var tail=x.uri.slice(0,-1).split("/").slice(-1)[0];return!!"0123456789".includes(tail[0])},younger=function _younger(x){return!(backwards?x.uri>=file.uri:x.uri<=file.uri)},parent=file.dir(),_context.prev=1,_context.next=2,_solidLogic.store.fetcher.load(parent);case 2:if(siblings=(siblings=_solidLogic.store.each(parent,ns.ldp("contains"))).filter(younger),!(_folder=lastOrFirst(siblings))){_context.next=3;break}return _context.abrupt("return",_folder);case 3:_context.next=6;break;case 4:if(_context.prev=4,!(_t=_context.catch(1)).response||!_t.response.status||404!==_t.response.status){_context.next=5;break}debug.log("Error 404 for chat parent file "+parent),_context.next=6;break;case 5:throw debug.log("*** Error NON 404 for chat parent file "+parent),new Error("*** ".concat(_t.message," for chat folder ").concat(parent));case 6:if(0!==level){_context.next=7;break}return _context.abrupt("return",null);case 7:return _context.next=8,previousPeriod(parent,level-1);case 8:if(uncle=_context.sent){_context.next=9;break}return _context.abrupt("return",null);case 9:return _context.next=10,_solidLogic.store.fetcher.load(uncle);case 10:return cousins=_solidLogic.store.each(uncle,ns.ldp("contains")),result=lastOrFirst(cousins),_context.abrupt("return",result);case 11:case"end":return _context.stop()}},_callee,null,[[1,4]])}))).apply(this,arguments)},previousPeriod=function _previousPeriod2(_x4,_x5){return _previousPeriod.apply(this,arguments)},folder=this.leafDocumentFromDate(date).dir();case 1:return _context2.next=2,previousPeriod(folder,3);case 2:if(!(found=_context2.sent)){_context2.next=6;break}return leafDocument=_solidLogic.store.sym(found.uri+this.leafFileName),nextDate=this.dateFromLeafDocument(leafDocument),_context2.next=3,emptyLeaf(leafDocument);case 3:if(_context2.sent){_context2.next=4;break}return _context2.abrupt("return",nextDate);case 4:date=nextDate,folder=this.leafDocumentFromDate(date).dir();case 5:_context2.next=7;break;case 6:return _context2.abrupt("return",null);case 7:_context2.next=1;break;case 8:case"end":return _context2.stop()}},_callee2,this)})),function loadPrevious(_x2,_x3){return _loadPrevious.apply(this,arguments)})},{key:"firstLeaf",value:(_firstLeaf=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(backwards){var folderStore,folderFetcher,earliestSubfolder,_earliestSubfolder,y,month,d,leafDocument,leafObjects,msg,sortMe;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _earliestSubfolder=function _earliestSubfolder3(){return(_earliestSubfolder=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(parent){var suitable,kids;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return suitable=function _suitable2(x){var tail=x.uri.slice(0,-1).split("/").slice(-1)[0];return!!"0123456789".includes(tail[0])},delete folderFetcher.requested[parent.uri],_context3.next=1,folderFetcher.load(parent,{force:!0});case 1:if(0!==(kids=(kids=folderStore.each(parent,ns.ldp("contains"))).filter(suitable)).length){_context3.next=2;break}throw new Error(" @@@  No children to         parent2 "+parent);case 2:return kids.sort(),backwards&&kids.reverse(),_context3.abrupt("return",kids[0]);case 3:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)},earliestSubfolder=function _earliestSubfolder2(_x7){return _earliestSubfolder.apply(this,arguments)},folderStore=$rdf.graph(),folderFetcher=new $rdf.Fetcher(folderStore),_context4.next=1,earliestSubfolder(this.root.dir());case 1:return y=_context4.sent,_context4.next=2,earliestSubfolder(y);case 2:return month=_context4.sent,_context4.next=3,earliestSubfolder(month);case 3:return d=_context4.sent,leafDocument=$rdf.sym(d.uri+"chat.ttl"),_context4.next=4,folderFetcher.load(leafDocument);case 4:if(0!==(leafObjects=folderStore.each(this.root,this.membershipProperty,null,leafDocument)).length){_context4.next=5;break}throw msg="  INCONSISTENCY -- no chat leafObject in file "+leafDocument,debug.trace(msg),new Error(msg);case 5:return(sortMe=leafObjects.map(function(leafObject){return[folderStore.any(leafObject,ns.dct("created")),leafObject]})).sort(),backwards&&sortMe.reverse(),_context4.abrupt("return",sortMe[0][1]);case 6:case"end":return _context4.stop()}},_callee4,this)})),function firstLeaf(_x6){return _firstLeaf.apply(this,arguments)})}]);var _firstLeaf,_loadPrevious}()},"./lib/chat/infinite.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.desktopNotification=desktopNotification,exports.infiniteMessageArea=function infiniteMessageArea(_x7,_x8,_x9,_x0){return _infiniteMessageArea.apply(this,arguments)},exports.insertMessageIntoTable=insertMessageIntoTable;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),$rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),_chatLogic=__webpack_require__("./lib/chat/chatLogic.js"),_message=__webpack_require__("./lib/chat/message.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t4 in e)"default"!==_t4&&{}.hasOwnProperty.call(e,_t4)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t4))&&(i.get||i.set)?o(f,_t4,i):f[_t4]=e[_t4]);return f})(e,t)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function desktopNotification(str){"Notification"in window?"granted"===Notification.permission?new Notification(str):"denied"!==Notification.permission&&Notification.requestPermission().then(function(permission){"granted"===permission&&new Notification(str)}):debug.warn("This browser does no t support desktop notification")}function insertMessageIntoTable(_x,_x2,_x3,_x4,_x5,_x6){return _insertMessageIntoTable.apply(this,arguments)}function _insertMessageIntoTable(){return(_insertMessageIntoTable=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(channelObject,messageTable,message,fresh,options,userContext){var messageRow,done,ele,newestFirst,dateString;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=1,(0,_message.renderMessageRow)(channelObject,message,fresh,options,userContext);case 1:messageRow=_context.sent,options.selectedMessage&&options.selectedMessage.sameTerm(message)&&(messageRow.style.backgroundColor="yellow",options.selectedElement=messageRow,messageTable.selectedElement=messageRow),done=!1,ele=messageTable.firstChild;case 2:if(ele){_context.next=3;break}return _context.abrupt("continue",5);case 3:if(newestFirst=!0===options.newestfirst,!((dateString=messageRow.AJAR_date)>ele.AJAR_date&&newestFirst||dateString<ele.AJAR_date&&!newestFirst)){_context.next=4;break}return messageTable.insertBefore(messageRow,ele),done=!0,_context.abrupt("continue",5);case 4:ele=ele.nextSibling,_context.next=2;break;case 5:done||messageTable.appendChild(messageRow);case 6:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}function _infiniteMessageArea(){return _infiniteMessageArea=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee13(dom,wasStore,chatChannel,options){var syncMessages,_syncMessages,addMessage,_addMessage,insertPreviousMessages,_insertPreviousMessages,removePreviousMessages,createMessageTable,_createMessageTable,renderMessageTable,_renderMessageTable,addNewChatDocumentIfNewDay,_addNewChatDocumentIfNewDay,appendCurrentMessages,_appendCurrentMessages,loadMoreWhereNeeded,_loadMoreWhereNeeded,loadInitialContent,_loadInitialContent,newestFirst,channelObject,dateFolder,div,statusArea,userContext,liveMessageTable,threadRootMessage,earliest,latest,thread,threadTime,lock;return _regenerator.default.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _loadInitialContent=function _loadInitialContent3(){return(_loadInitialContent=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee12(){var yank,fixScroll,live,selectedDocument,threadRootDocument,initialDocment,now,todayDocument,selectedMessageTable,selectedDate;return _regenerator.default.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(fixScroll=function _fixScroll(){options.selectedElement?options.selectedElement.scrollIntoView({block:"center"}):liveMessageTable.inputRow.scrollIntoView&&liveMessageTable.inputRow.scrollIntoView(newestFirst)},yank=function _yank(){selectedMessageTable&&selectedMessageTable.selectedElement&&selectedMessageTable.selectedElement.scrollIntoView({block:"center"})},options.selectedMessage&&(selectedDocument=options.selectedMessage.doc()),threadRootMessage&&(threadRootDocument=threadRootMessage.doc()),(initialDocment=selectedDocument||threadRootDocument)&&(now=new Date,todayDocument=dateFolder.leafDocumentFromDate(now),live=todayDocument.sameTerm(initialDocment)),!initialDocment||live){_context12.next=2;break}return selectedDate=dateFolder.dateFromLeafDocument(initialDocment),_context12.next=1,createMessageTable(selectedDate,live);case 1:selectedMessageTable=_context12.sent,div.appendChild(selectedMessageTable),earliest.messageTable=selectedMessageTable,latest.messageTable=selectedMessageTable,yank(),setTimeout(yank,1e3),_context12.next=4;break;case 2:return _context12.next=3,appendCurrentMessages();case 3:earliest.messageTable=liveMessageTable,latest.messageTable=liveMessageTable;case 4:return _context12.next=5,loadMoreWhereNeeded(null,fixScroll);case 5:div.addEventListener("scroll",loadMoreWhereNeeded),options.solo&&document.body.addEventListener("scroll",loadMoreWhereNeeded);case 6:case"end":return _context12.stop()}},_callee12)}))).apply(this,arguments)},loadInitialContent=function _loadInitialContent2(){return _loadInitialContent.apply(this,arguments)},_loadMoreWhereNeeded=function _loadMoreWhereNeeded3(){return(_loadMoreWhereNeeded=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee11(event,fixScroll){var freeze,magicZone,done,scrollBottom,scrollTop;return _regenerator.default.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(!lock){_context11.next=1;break}return _context11.abrupt("return");case 1:lock=!0,freeze=!fixScroll,magicZone=150;case 2:if(!(div.scrollTop<magicZone&&earliest.messageTable&&!earliest.messageTable.initial&&earliest.messageTable.extendBackwards)){_context11.next=6;break}if(0!==div.scrollHeight){_context11.next=3;break}return setTimeout(loadMoreWhereNeeded,2e3),lock=!1,_context11.abrupt("return");case 3:return scrollBottom=div.scrollHeight-div.scrollTop,_context11.next=4,earliest.messageTable.extendBackwards();case 4:if(done=_context11.sent,freeze&&(div.scrollTop=div.scrollHeight-scrollBottom),fixScroll&&fixScroll(),!done){_context11.next=5;break}return _context11.abrupt("continue",6);case 5:_context11.next=2;break;case 6:if(!(options.selectedMessage&&div.scrollHeight-div.scrollTop-div.clientHeight<magicZone&&latest.messageTable&&!latest.messageTable.final&&latest.messageTable.extendForwards)){_context11.next=9;break}return scrollTop=div.scrollTop,_context11.next=7,latest.messageTable.extendForwards();case 7:if(done=_context11.sent,freeze&&(div.scrollTop=scrollTop),fixScroll&&fixScroll(),!done){_context11.next=8;break}return _context11.abrupt("continue",9);case 8:_context11.next=6;break;case 9:lock=!1;case 10:case"end":return _context11.stop()}},_callee11)}))).apply(this,arguments)},loadMoreWhereNeeded=function _loadMoreWhereNeeded2(_x18,_x19){return _loadMoreWhereNeeded.apply(this,arguments)},_appendCurrentMessages=function _appendCurrentMessage2(){return(_appendCurrentMessages=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee10(){var now,chatDocument,messageTable;return _regenerator.default.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return now=new Date,chatDocument=dateFolder.leafDocumentFromDate(now),_context10.next=1,createMessageTable(now,!0);case 1:return messageTable=_context10.sent,div.appendChild(messageTable),div.refresh=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee1(){return _regenerator.default.wrap(function(_context1){for(;;)switch(_context1.prev=_context1.next){case 0:return _context1.next=1,addNewChatDocumentIfNewDay(new Date);case 1:return _context1.next=2,syncMessages(chatChannel,messageTable);case 2:desktopNotification(chatChannel);case 3:case"end":return _context1.stop()}},_callee1)})),_solidLogic.store.updater.addDownstreamChangeListener(chatDocument,div.refresh),liveMessageTable=messageTable,latest.messageTable=liveMessageTable,_context10.abrupt("return",messageTable);case 2:case"end":return _context10.stop()}},_callee10)}))).apply(this,arguments)},appendCurrentMessages=function _appendCurrentMessage(){return _appendCurrentMessages.apply(this,arguments)},_addNewChatDocumentIfNewDay=function _addNewChatDocumentIf2(){return(_addNewChatDocumentIfNewDay=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee0(){var newChatDocument,oldChatDocument,sts;return _regenerator.default.wrap(function(_context0){for(;;)switch(_context0.prev=_context0.next){case 0:if((newChatDocument=dateFolder.leafDocumentFromDate(new Date)).sameTerm(latest.messageTable.chatDocument)){_context0.next=2;break}return liveMessageTable.inputRow&&(liveMessageTable.removeChild(liveMessageTable.inputRow),delete liveMessageTable.inputRow),oldChatDocument=latest.messageTable.chatDocument,_context0.next=1,appendCurrentMessages();case 1:if(!_solidLogic.store.holds(oldChatDocument,ns.rdfs("seeAlso"),newChatDocument,oldChatDocument)){sts=[$rdf.st(oldChatDocument,ns.rdfs("seeAlso"),newChatDocument,oldChatDocument)];try{_solidLogic.store.updater.update([],sts)}catch(err){alert("Unable to link old chat file to new one:"+err)}}case 2:case"end":return _context0.stop()}},_callee0)}))).apply(this,arguments)},addNewChatDocumentIfNewDay=function _addNewChatDocumentIf(){return _addNewChatDocumentIfNewDay.apply(this,arguments)},_renderMessageTable=function _renderMessageTable3(){return _renderMessageTable=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee9(date,live){var scrollBackbutton,scrollForwardButton,extendBackwards,_extendBackwards,setScrollBackbuttonIcon,extendForwards,_extendForwards,setScrollForwardButtonIcon,_scrollForwardButtonHandler,messageTable,chatDocument,tr,titleTR,dateCell,scrollForwardButtonCell,sts,_iterator2,_step2,st,_t3;return _regenerator.default.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:_scrollForwardButtonHandler=function _scrollForwardButtonH2(){return(_scrollForwardButtonHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(_event){return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!messageTable.extendedForwards){_context8.next=1;break}removePreviousMessages(!1,messageTable),messageTable.extendedForwards=!1,setScrollForwardButtonIcon(),_context8.next=3;break;case 1:return _context8.next=2,extendForwards();case 2:latest.messageTable.scrollIntoView(newestFirst);case 3:case"end":return _context8.stop()}},_callee8)}))).apply(this,arguments)},setScrollForwardButtonIcon=function _setScrollForwardButt(){if(scrollForwardButton){var sense=messageTable.extendedForwards?!newestFirst:newestFirst,scrollForwardIcon=messageTable.final?"noun_T-Block_1114657_000000.svg":function getScrollForwardButtonIcon(sense){return sense?"noun_1369237.svg":"noun_1369241.svg"}(sense);scrollForwardButton.firstChild.setAttribute("src",_iconBase.icons.iconBase+scrollForwardIcon)}},_extendForwards=function _extendForwards3(){return(_extendForwards=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(){var done;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=1,insertPreviousMessages(!1);case 1:return done=_context7.sent,_context7.abrupt("return",done);case 2:case"end":return _context7.stop()}},_callee7)}))).apply(this,arguments)},extendForwards=function _extendForwards2(){return _extendForwards.apply(this,arguments)},setScrollBackbuttonIcon=function _setScrollBackbuttonI(){if(scrollBackbutton){var sense=messageTable.extendedBack?!newestFirst:newestFirst,scrollBackIcon=messageTable.initial?"noun_T-Block_1114655_000000.svg":function getScrollbackIcon(sense){return sense?"noun_1369241.svg":"noun_1369237.svg"}(sense);scrollBackbutton.firstChild.setAttribute("src",_iconBase.icons.iconBase+scrollBackIcon)}},_extendBackwards=function _extendBackwards3(){return(_extendBackwards=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(){var done;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=1,insertPreviousMessages(!0);case 1:return(done=_context6.sent)?(scrollBackbutton&&(scrollBackbutton.firstChild.setAttribute("src",_iconBase.icons.iconBase+"noun_T-Block_1114655_000000.svg"),scrollBackbutton.disabled=!0),messageTable.initial=!0):messageTable.extendedBack=!0,setScrollBackbuttonIcon(),_context6.abrupt("return",done);case 2:case"end":return _context6.stop()}},_callee6)}))).apply(this,arguments)},extendBackwards=function _extendBackwards2(){return _extendBackwards.apply(this,arguments)},scrollBackbutton=null,scrollForwardButton=null,(messageTable=dom.createElement("table")).style.width="100%",messageTable.extendBackwards=extendBackwards,messageTable.extendForwards=extendForwards,messageTable.date=date,chatDocument=dateFolder.leafDocumentFromDate(date),messageTable.chatDocument=chatDocument,messageTable.fresh=!1,messageTable.setAttribute("style","width: 100%;"),live&&(messageTable.final=!0,liveMessageTable=messageTable,latest.messageTable=messageTable,tr=(0,_message.renderMessageEditor)(channelObject,messageTable,userContext,options),newestFirst?messageTable.insertBefore(tr,messageTable.firstChild):messageTable.appendChild(tr),messageTable.inputRow=tr),titleTR=dom.createElement("tr"),titleTR.appendChild(dom.createElement("td")),(dateCell=titleTR.appendChild(dom.createElement("td"))).style="text-align: center; vertical-align: middle; color: #888; font-style: italic;",dateCell.textContent=widgets.shortDate(date.toISOString(),!0),scrollForwardButtonCell=titleTR.appendChild(dom.createElement("td")),options.includeRemoveButton&&scrollForwardButtonCell.appendChild(widgets.cancelButton(dom,function(_e){div.parentNode.removeChild(div)})),messageTable.extendedForwards=!1,newestFirst?messageTable.appendChild(titleTR):messageTable.insertBefore(titleTR,messageTable.firstChild),sts=_solidLogic.store.statementsMatching(null,ns.wf("message"),null,chatDocument),!live&&sts.length,_iterator2=_createForOfIteratorHelper(sts),_context9.prev=1,_iterator2.s();case 2:if((_step2=_iterator2.n()).done){_context9.next=4;break}return st=_step2.value,_context9.next=3,addMessage(st.object,messageTable);case 3:_context9.next=2;break;case 4:_context9.next=6;break;case 5:_context9.prev=5,_t3=_context9.catch(1),_iterator2.e(_t3);case 6:return _context9.prev=6,_iterator2.f(),_context9.finish(6);case 7:return messageTable.fresh=!0,_context9.abrupt("return",messageTable);case 8:case"end":return _context9.stop()}},_callee9,null,[[1,5,6,7]])})),_renderMessageTable.apply(this,arguments)},renderMessageTable=function _renderMessageTable2(_x16,_x17){return _renderMessageTable.apply(this,arguments)},_createMessageTable=function _createMessageTable3(){return(_createMessageTable=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(date,live){var chatDocument,messageTable,statusTR,_t2;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return chatDocument=dateFolder.leafDocumentFromDate(date),_context5.prev=1,_context5.next=2,_solidLogic.store.fetcher.createIfNotExists(chatDocument);case 2:_context5.next=7;break;case 3:if(_context5.prev=3,_t2=_context5.catch(1),messageTable=dom.createElement("table"),statusTR=messageTable.appendChild(dom.createElement("tr")),!_t2.response||!_t2.response.status||404!==_t2.response.status){_context5.next=5;break}return _context5.next=4,renderMessageTable(date,live);case 4:return _context5.abrupt("return",_context5.sent);case 5:debug.log("*** Error NON 404 for chat file "+chatDocument),statusTR.appendChild(widgets.errorMessageBlock(dom,_t2,"pink"));case 6:return _context5.abrupt("return",statusTR);case 7:return _context5.next=8,renderMessageTable(date,live);case 8:return _context5.abrupt("return",_context5.sent);case 9:case"end":return _context5.stop()}},_callee5,null,[[1,3]])}))).apply(this,arguments)},createMessageTable=function _createMessageTable2(_x14,_x15){return _createMessageTable.apply(this,arguments)},removePreviousMessages=function _removePreviousMessag(backwards,messageTable){if(backwards?newestFirst:!newestFirst)for(;messageTable.nextSibling;)div.removeChild(messageTable.nextSibling);else for(;messageTable.previousSibling;)div.removeChild(messageTable.previousSibling);(backwards?earliest:latest).messageTable=messageTable},_insertPreviousMessages=function _insertPreviousMessag2(){return(_insertPreviousMessages=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(backwards){var extremity,date,live,todayDoc,doc,newMessageTable;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(date=(extremity=backwards?earliest:latest).messageTable.date,!(backwards&&earliest.limit&&date<=earliest.limit)){_context4.next=2;break}if(liveMessageTable){_context4.next=1;break}return _context4.next=1,appendCurrentMessages();case 1:return _context4.abrupt("return",!0);case 2:return _context4.next=3,dateFolder.loadPrevious(date,backwards);case 3:if((date=_context4.sent)||backwards||liveMessageTable){_context4.next=4;break}return _context4.next=4,appendCurrentMessages();case 4:if(date){_context4.next=5;break}return _context4.abrupt("return",!0);case 5:return live=!1,backwards||(todayDoc=dateFolder.leafDocumentFromDate(new Date),doc=dateFolder.leafDocumentFromDate(date),live=doc.sameTerm(todayDoc)),_context4.next=6,createMessageTable(date,live);case 6:return newMessageTable=_context4.sent,extremity.messageTable=newMessageTable,(backwards?newestFirst:!newestFirst)?div.appendChild(newMessageTable):div.insertBefore(newMessageTable,div.firstChild),_context4.abrupt("return",live);case 7:case"end":return _context4.stop()}},_callee4)}))).apply(this,arguments)},insertPreviousMessages=function _insertPreviousMessag(_x13){return _insertPreviousMessages.apply(this,arguments)},_addMessage=function _addMessage3(){return _addMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(message,messageTable){var thread,id;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(0,_chatLogic.isDeleted)(message)||options.showDeletedMessages){_context3.next=1;break}return _context3.abrupt("return");case 1:if(thread=_solidLogic.store.any(null,ns.sioc("has_member"),message,message.doc()),(id=_solidLogic.store.any(message,ns.sioc("id"),null,message.doc()))&&!thread&&(thread=_solidLogic.store.any(null,ns.sioc("has_member"),id,message.doc())),!options.thread){_context3.next=5;break}if(!_solidLogic.store.holds(message,ns.sioc("has_reply"),options.thread)){_context3.next=2;break}_context3.next=4;break;case 2:if(!thread||!thread.sameTerm(options.thread)){_context3.next=3;break}_context3.next=4;break;case 3:return _context3.abrupt("return");case 4:_context3.next=6;break;case 5:if(!thread){_context3.next=6;break}return _context3.abrupt("return");case 6:if(messageTable.fresh){_context3.next=7;break}return _context3.next=7,insertMessageIntoTable(channelObject,messageTable,message,messageTable.fresh,options,userContext);case 7:case"end":return _context3.stop()}},_callee3)})),_addMessage.apply(this,arguments)},addMessage=function _addMessage2(_x11,_x12){return _addMessage.apply(this,arguments)},_syncMessages=function _syncMessages3(){return _syncMessages=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(chatChannel,messageTable){var displayed,ele,ele2,messages,stored,_iterator,_step,m,_t;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:for(displayed={},ele=messageTable.firstChild;ele;ele=ele.nextSibling)ele.AJAR_subject&&(displayed[ele.AJAR_subject.uri]=!0);messages=_solidLogic.store.each(chatChannel,ns.wf("message"),null,messageTable.chatDocument),stored={},_iterator=_createForOfIteratorHelper(messages),_context2.prev=1,_iterator.s();case 2:if((_step=_iterator.n()).done){_context2.next=4;break}if(m=_step.value,stored[m.uri]=!0,displayed[m.uri]){_context2.next=3;break}return _context2.next=3,addMessage(m,messageTable);case 3:_context2.next=2;break;case 4:_context2.next=6;break;case 5:_context2.prev=5,_t=_context2.catch(1),_iterator.e(_t);case 6:return _context2.prev=6,_iterator.f(),_context2.finish(6);case 7:for(ele=messageTable.firstChild;ele;)ele2=ele.nextSibling,ele.AJAR_subject&&!stored[ele.AJAR_subject.uri]&&messageTable.removeChild(ele),ele=ele2;for(ele=messageTable.firstChild;ele;ele=ele.nextSibling)ele.AJAR_subject&&widgets.refreshTree(ele);case 8:case"end":return _context2.stop()}},_callee2,null,[[1,5,6,7]])})),_syncMessages.apply(this,arguments)},syncMessages=function _syncMessages2(_x1,_x10){return _syncMessages.apply(this,arguments)},(options=options||{}).authorDateOnLeft=!1,newestFirst="1"===options.newestFirst||!0===options.newestFirst,channelObject=new _chatLogic.ChatChannel(chatChannel,options),dateFolder=channelObject.dateFolder,div=dom.createElement("div"),channelObject.div=div,statusArea=div.appendChild(dom.createElement("div")),userContext={dom,statusArea,div:statusArea},earliest={messageTable:null},latest={messageTable:null},options.thread&&(thread=options.thread,(threadRootMessage=_solidLogic.store.any(null,ns.sioc("has_reply"),thread,thread.doc()))&&(threadTime=_solidLogic.store.any(threadRootMessage,ns.dct("created"),null,threadRootMessage.doc()))&&(earliest.limit=new Date(threadTime.value))),lock=!1,_context13.next=1,loadInitialContent();case 1:return _context13.abrupt("return",div);case 2:case"end":return _context13.stop()}},_callee13)})),_infiniteMessageArea.apply(this,arguments)}},"./lib/chat/keys.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.generatePrivateKey=generatePrivateKey,exports.generatePublicKey=generatePublicKey,exports.getPrivateKey=function getPrivateKey(_x2){return _getPrivateKey.apply(this,arguments)},exports.getPublicKey=function getPublicKey(_x){return _getPublicKey.apply(this,arguments)};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_secp256k=__webpack_require__("./node_modules/@noble/curves/secp256k1.js"),_utils=__webpack_require__("./node_modules/@noble/hashes/utils.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),$rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),_accessData=__webpack_require__("./lib/utils/keyHelpers/accessData.js"),_acl=__webpack_require__("./lib/utils/keyHelpers/acl.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}function generatePrivateKey(){return(0,_utils.bytesToHex)(_secp256k.schnorr.utils.randomPrivateKey())}function generatePublicKey(privateKey){return(0,_utils.bytesToHex)(_secp256k.schnorr.getPublicKey(privateKey))}function _getPublicKey(){return(_getPublicKey=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(webId){var publicKeyDoc,key;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=1,_solidLogic.store.fetcher.load(webId);case 1:return _context2.next=2,(0,_accessData.pubKeyUrl)(webId);case 2:return publicKeyDoc=_context2.sent,_context2.prev=3,_context2.next=4,_solidLogic.store.fetcher.load(publicKeyDoc);case 4:return key=_solidLogic.store.any(webId,ns.solid("publicKey")),_context2.abrupt("return",null==key?void 0:key.value);case 5:return _context2.prev=5,_context2.catch(3),_context2.abrupt("return",void 0);case 6:case"end":return _context2.stop()}},_callee2,null,[[3,5]])}))).apply(this,arguments)}function _getPrivateKey(){return(_getPrivateKey=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(webId){var publicKeyDoc,privateKeyDoc,publicKey,privateKey,validPublicKey,del,add,newPublicKey,keyContainer;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=1,_solidLogic.store.fetcher.load(webId);case 1:return _context3.next=2,(0,_accessData.pubKeyUrl)(webId);case 2:return publicKeyDoc=_context3.sent,_context3.next=3,(0,_accessData.privKeyUrl)(webId);case 3:return privateKeyDoc=_context3.sent,_context3.next=4,(0,_accessData.getExistingPublicKey)(webId,publicKeyDoc);case 4:return publicKey=_context3.sent,_context3.next=5,(0,_accessData.getExistingPrivateKey)(webId,privateKeyDoc);case 5:if(privateKey=_context3.sent,validPublicKey=!0,privateKey&&publicKey!==generatePublicKey(privateKey)&&confirm("This is strange the publicKey is not valid for\n"+(null==webId?void 0:webId.uri)+"'shall we repair keeping the private key ?")&&(validPublicKey=!1),privateKey&&publicKey&&validPublicKey){_context3.next=8;break}if(del=[],add=[],privateKey){_context3.next=6;break}return privateKey=generatePrivateKey(),add=[$rdf.st(webId,ns.solid("privateKey"),$rdf.literal(privateKey),_solidLogic.store.sym(privateKeyDoc))],_context3.next=6,saveKey(privateKeyDoc,[],add,webId.uri);case 6:if(publicKey&&validPublicKey){_context3.next=7;break}return del=[],publicKey&&(del=[$rdf.st(webId,ns.solid("publicKey"),$rdf.lit(publicKey),_solidLogic.store.sym(publicKeyDoc))],debug.log("delete invalid publicKey "+del)),newPublicKey=generatePublicKey(privateKey),add=[$rdf.st(webId,ns.solid("publicKey"),$rdf.literal(newPublicKey),_solidLogic.store.sym(publicKeyDoc))],_context3.next=7,saveKey(publicKeyDoc,del,add);case 7:return keyContainer=privateKeyDoc.substring(0,privateKeyDoc.lastIndexOf("/")+1),_context3.next=8,(0,_acl.setAcl)(keyContainer,(0,_acl.keyContainerAclBody)(webId.uri));case 8:return _context3.abrupt("return",privateKey);case 9:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)}var deleteKeyAcl=function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(keyDoc){var keyAclDoc,response,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=1,_solidLogic.store.fetcher.load(keyDoc);case 1:if(!(keyAclDoc=_solidLogic.store.any(_solidLogic.store.sym(keyDoc),_solidLogic.store.sym("http://www.iana.org/assignments/link-relations/acl")))){_context.next=6;break}return _context.prev=2,_context.next=3,_solidLogic.store.fetcher.webOperation("DELETE",keyAclDoc.value);case 3:response=_context.sent,debug.log("delete keyAcl"+keyAclDoc.value+" "+response.status),_context.next=6;break;case 4:if(_context.prev=4,404===(_t=_context.catch(2)).response.status){_context.next=5;break}throw new Error(_t);case 5:debug.log("delete keyAcl"+keyAclDoc.value+" "+_t.response.status);case 6:case"end":return _context.stop()}},_callee,null,[[2,4]])}));return function deleteKeyAcl(_x3){return _ref.apply(this,arguments)}}();function saveKey(_x4,_x5,_x6){return _saveKey.apply(this,arguments)}function _saveKey(){return _saveKey=(0,_asyncToGenerator2.default)(function(keyDoc,del,add){var me=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return _regenerator.default.mark(function _callee4(){var aclBody;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=1,deleteKeyAcl(keyDoc);case 1:return _context4.next=2,_solidLogic.store.updater.updateMany(del,add);case 2:return aclBody=(0,_acl.keyAclBody)(keyDoc,me),_context4.next=3,(0,_acl.setAcl)(keyDoc,aclBody);case 3:case"end":return _context4.stop()}},_callee4)})()}),_saveKey.apply(this,arguments)}},"./lib/chat/message.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.creatorAndDate=creatorAndDate,exports.creatorAndDateHorizontal=creatorAndDateHorizontal,exports.elementForImageURI=elementForImageURI,exports.renderMessageEditor=renderMessageEditor,exports.renderMessageRow=function renderMessageRow(_x,_x2,_x3,_x4,_x5){return _renderMessageRow.apply(this,arguments)},exports.switchToEditor=function switchToEditor(_x6,_x7,_x8,_x9){return _switchToEditor.apply(this,arguments)};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_infinite=__webpack_require__("./lib/chat/infinite.js"),_messageTools=__webpack_require__("./lib/chat/messageTools.js"),_bookmarks=__webpack_require__("./lib/chat/bookmarks.js"),_chatLogic=__webpack_require__("./lib/chat/chatLogic.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_login=__webpack_require__("./lib/login/login.js"),_index=__webpack_require__("./lib/media/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),pad=_interopRequireWildcard(__webpack_require__("./lib/pad.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),_signature=__webpack_require__("./lib/chat/signature.js"),_keys=__webpack_require__("./lib/chat/keys.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t8 in e)"default"!==_t8&&{}.hasOwnProperty.call(e,_t8)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t8))&&(i.get||i.set)?o(f,_t8,i):f[_t8]=e[_t8]);return f})(e,t)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_defineProperty2.default)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var dom=window.document,messageBodyStyle=style.messageBodyStyle,label=utils.label;function elementForImageURI(imageUri,options){var img=dom.createElement("img"),height="10";options.inlineImageHeightEms&&(height=(""+options.inlineImageHeightEms).trim()),img.setAttribute("style","max-height: "+height+"em; border-radius: 1em; margin: 0.7em;"),imageUri&&img.setAttribute("src",imageUri);var anchor=dom.createElement("a");return anchor.setAttribute("href",imageUri),anchor.setAttribute("target","images"),anchor.appendChild(img),widgets.makeDraggable(img,$rdf.sym(imageUri)),anchor}var anchor=function anchor(text,term){var a=dom.createElement("a");return term&&term.uri&&(a.setAttribute("href",term.uri),a.addEventListener("click",widgets.openHrefInOutlineMode,!0),a.setAttribute("style","color: #3B5998; text-decoration: none; ")),a.textContent=text,a};function nickname(person){var s=_solidLogic.store.any(person,ns.foaf("nick"));return s?""+s.value:""+label(person)}function creatorAndDate(td1,creator,date,message){var nickAnchor=td1.appendChild(anchor(nickname(creator),creator));creator.uri&&_solidLogic.store.fetcher.nowOrWhenFetched(creator.doc(),void 0,function(_ok,_body){nickAnchor.textContent=nickname(creator)}),td1.appendChild(dom.createElement("br")),td1.appendChild(anchor(date,message))}function creatorAndDateHorizontal(td1,creator,date,message){var nickAnchor=td1.appendChild(anchor(label(creator),creator));creator.uri&&_solidLogic.store.fetcher.nowOrWhenFetched(creator.doc(),void 0,function(_ok,_body){nickAnchor.textContent=nickname(creator)});var dateBit=td1.appendChild(anchor(date,message));dateBit.style.fontSize="80%",dateBit.style.marginLeft="1em",td1.appendChild(dom.createElement("br"))}function _renderMessageRow(){return _renderMessageRow=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee9(channelObject,message,fresh,options,userContext){var unsignedMessage,colorizeByAuthor,creator,date,latestVersion,latestVersionCreator,msgId,content,versions,replies,thread,straightReplies,_iterator2,_step2,reply,signature,msg,originalMessage,edited,sortDate,messageRow,td1,img,bothDates,td2,text,isURI,para,_img,anc,bgcolor,getBgColor,strip,td3,toolsButton;return _regenerator.default.wrap(function(_context0){for(;;)switch(_context0.prev=_context0.next){case 0:return getBgColor=function _getBgColor(fresh){return fresh?"#e8ffe8":"white"},unsignedMessage=!1,colorizeByAuthor="1"===options.colorizeByAuthor||!0===options.colorizeByAuthor,creator=_solidLogic.store.any(message,ns.foaf("maker")),date=_solidLogic.store.any(message,ns.dct("created")),_context0.next=1,(0,_chatLogic.mostRecentVersion)(message);case 1:return latestVersion=_context0.sent,latestVersionCreator=_solidLogic.store.any(latestVersion,ns.foaf("maker")),msgId=creator.uri===(null==latestVersionCreator?void 0:latestVersionCreator.uri)?latestVersion:message,content=_solidLogic.store.any(msgId,ns.sioc("content")),_context0.next=2,(0,_chatLogic.allVersions)(msgId);case 2:(versions=_context0.sent).length>1&&debug.log("renderMessageRow versions: ",versions.join(",  ")),replies=versions.map(function(version){return _solidLogic.store.each(version,ns.sioc("has_reply"))}).flat(),thread=null,straightReplies=[],_iterator2=_createForOfIteratorHelper(replies);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;)reply=_step2.value,_solidLogic.store.holds(reply,ns.rdf("type"),ns.sioc("Thread"))?(thread=reply,debug.log("renderMessageRow: found thread: "+thread)):straightReplies.push(reply)}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return straightReplies.length>1&&debug.log("renderMessageRow: found normal replies: ",straightReplies),thread||(thread=_solidLogic.store.any(null,ns.sioc("has_member"),message)),signature=_solidLogic.store.any(msgId,$rdf.sym("".concat(_signature.SEC,"proofValue"))),(msg=(0,_signature.getBlankMsg)()).id=msgId.uri,msg.created=_solidLogic.store.any(msgId,ns.dct("created")).value,msg.content=content.value,msg.maker=creator.uri,null!=signature&&signature.value?(0,_keys.getPublicKey)(creator).then(function(publicKey){publicKey||debug.warn("message is signed but "+creator.uri+" is missing publicKey");null!=publicKey&&publicKey.match(/[0-9A-Fa-f]{6}/g)?null!=signature&&signature.value&&!(0,_signature.verifySignature)(null==signature?void 0:signature.value,msg,publicKey)&&debug.warn("invalid signature\n"+msg.id):debug.warn("invalid publicKey hex string\n"+creator.uri+"\n"+publicKey)}):(unsignedMessage=!0,debug.warn(msgId.uri+" is unsigned")),_context0.next=3,(0,_chatLogic.originalVersion)(message);case 3:return originalMessage=_context0.sent,edited=!message.sameTerm(originalMessage),sortDate=_solidLogic.store.the(originalMessage,ns.dct("created"),null,originalMessage.doc())||_solidLogic.store.the(message,ns.dct("created"),null,message.doc()),messageRow=dom.createElement("tr"),unsignedMessage&&messageRow.setAttribute("style","background-color: red"),messageRow.AJAR_date=sortDate.value,messageRow.AJAR_subject=message,td1=dom.createElement("td"),messageRow.appendChild(td1),options.authorDateOnLeft?creatorAndDate(td1,creator,widgets.shortDate(sortDate.value),message):((img=dom.createElement("img")).setAttribute("style","max-height: 2.5em; max-width: 2.5em; border-radius: 0.5em; margin: auto;"),widgets.setImage(img,creator),td1.appendChild(img)),bothDates=widgets.shortDate(sortDate.value),edited&&(bothDates+=" ... "+widgets.shortDate(date.value)),td2=messageRow.appendChild(dom.createElement("td")),options.authorDateOnLeft||creatorAndDateHorizontal(td2,creator,bothDates,message),text=content?content.value.trim():"??? no content?",isURI=/^https?:\/[^ <>]*$/i.test(text),para=null,isURI?/\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(text)&&options.expandImagesInline?(_img=elementForImageURI(text,options),td2.appendChild(_img)):(anc=td2.appendChild(dom.createElement("a")),para=anc.appendChild(dom.createElement("p")),anc.href=text,para.textContent=text,td2.appendChild(anc)):(para=dom.createElement("p"),td2.appendChild(para),para.textContent=text),para&&(bgcolor=colorizeByAuthor?pad.lightColorHash(creator):getBgColor(fresh),para.setAttribute("style",messageBodyStyle+"background-color: "+bgcolor+";")),_context0.next=4,(0,_messageTools.sentimentStripLinked)(message,message.doc());case 4:return(strip=_context0.sent).children.length&&(td2.appendChild(dom.createElement("br")),td2.appendChild(strip)),td3=dom.createElement("td"),messageRow.appendChild(td3),toolsButton=widgets.button(dom,_iconBase.icons.iconBase+"noun_243787.svg","..."),td3.appendChild(toolsButton),toolsButton.addEventListener("click",function(){var _ref4=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(_event){var toolsTR,tools,toolsTD;return _regenerator.default.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(!messageRow.toolTR){_context9.next=1;break}return messageRow.parentNode.removeChild(messageRow.toolTR),delete messageRow.toolTR,_context9.abrupt("return");case 1:return toolsTR=dom.createElement("tr"),_context9.next=2,(0,_messageTools.messageToolbar)(message,messageRow,_objectSpread(_objectSpread({},userContext),{},{chatOptions:options}),channelObject);case 2:(tools=_context9.sent).style="border: 0.05em solid #888; border-radius: 0 0 0.7em 0.7em;  border-top: 0; height:3.5em; background-color: #fff;",messageRow.nextSibling?messageRow.parentElement.insertBefore(toolsTR,messageRow.nextSibling):messageRow.parentElement.appendChild(toolsTR),messageRow.toolTR=toolsTR,toolsTR.appendChild(dom.createElement("td")),toolsTD=toolsTR.appendChild(dom.createElement("td")),toolsTR.appendChild(dom.createElement("td")),toolsTD.appendChild(tools);case 3:case"end":return _context9.stop()}},_callee8)}));return function(_x18){return _ref4.apply(this,arguments)}}()),thread&&options.showThread&&td3.appendChild(widgets.button(dom,_iconBase.icons.iconBase+"noun_1180164.svg","see thread",function(_e){options.showThread(thread,options)})),_context0.abrupt("return",messageRow);case 5:case"end":return _context0.stop()}},_callee9)})),_renderMessageRow.apply(this,arguments)}function _switchToEditor(){return(_switchToEditor=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee0(messageRow,message,channelObject,userContext){var messageTable,editRow,_t3,_t4,_t5,_t6,_t7;return _regenerator.default.wrap(function(_context1){for(;;)switch(_context1.prev=_context1.next){case 0:return messageTable=messageRow.parentNode,_t3=renderMessageEditor,_t4=channelObject,_t5=messageTable,_t6=userContext,_t7=channelObject.options,_context1.next=1,(0,_chatLogic.mostRecentVersion)(message);case 1:editRow=_t3(_t4,_t5,_t6,_t7,_context1.sent),messageTable.insertBefore(editRow,messageRow),editRow.originalRow=messageRow,messageRow.style.visibility="hidden";case 2:case"end":return _context1.stop()}},_callee0)}))).apply(this,arguments)}function renderMessageEditor(channelObject,messageTable,userContext,options,originalMessage){function handleFieldInput(_x0){return _handleFieldInput.apply(this,arguments)}function _handleFieldInput(){return(_handleFieldInput=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(_event){return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=1,sendMessage(field.value,!0);case 1:case"end":return _context6.stop()}},_callee5)}))).apply(this,arguments)}function sendMessage(_x1,_x10){return _sendMessage.apply(this,arguments)}function _sendMessage(){return _sendMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(text,fromMainField){var sendComplete,_sendComplete,message,_t2;return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _sendComplete=function _sendComplete3(){return _sendComplete=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(message,_text2){var oldRow;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=1,(0,_infinite.insertMessageIntoTable)(channelObject,messageTable,message,!1,options,userContext);case 1:originalMessage?((oldRow=messageEditor.originalRow).parentNode?oldRow.parentNode.removeChild(oldRow):(debug.warn("No parentNode on old message "+oldRow.textContent),oldRow.style.backgroundColor="#fee",oldRow.style.visibility="hidden"),messageEditor.parentNode.removeChild(messageEditor)):fromMainField&&(field.value="",field.setAttribute("style",messageBodyStyle),field.disabled=!1,field.scrollIntoView(options.newestFirst),field.focus(),field.select());case 2:case"end":return _context7.stop()}},_callee6)})),_sendComplete.apply(this,arguments)},sendComplete=function _sendComplete2(_x16,_x17){return _sendComplete.apply(this,arguments)},fromMainField&&(field.setAttribute("style",messageBodyStyle+"color: #bbb;"),field.disabled=!0),_context8.prev=1,_context8.next=2,channelObject.updateMessage(text,originalMessage,null,options.thread);case 2:message=_context8.sent,_context8.next=4;break;case 3:return _context8.prev=3,_t2=_context8.catch(1),(userContext.statusArea||messageEditor).appendChild(widgets.errorMessageBlock(dom,"Error writing message: "+_t2)),_context8.abrupt("return");case 4:return _context8.next=5,sendComplete(message,text);case 5:case"end":return _context8.stop()}},_callee7,null,[[1,3]])})),_sendMessage.apply(this,arguments)}function droppedFileHandler(files){var base=messageTable.chatDocument.dir().uri;widgets.uploadFiles(_solidLogic.store.fetcher,files,base+"Files",base+"Pictures",function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(theFile,destURI){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=1,sendMessage(destURI);case 1:case"end":return _context2.stop()}},_callee)}));return function(_x11,_x12){return _ref.apply(this,arguments)}}())}var sortDate,sendIcon,droppedURIHandler=function(){var _ref2=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(uris){var _iterator,_step,uri,_t;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:_iterator=_createForOfIteratorHelper(uris),_context3.prev=1,_iterator.s();case 2:if((_step=_iterator.n()).done){_context3.next=4;break}return uri=_step.value,_context3.next=3,sendMessage(uri);case 3:_context3.next=2;break;case 4:_context3.next=6;break;case 5:_context3.prev=5,_t=_context3.catch(1),_iterator.e(_t);case 6:return _context3.prev=6,_iterator.f(),_context3.finish(6);case 7:case"end":return _context3.stop()}},_callee2,null,[[1,5,6,7]])}));return function droppedURIHandler(_x13){return _ref2.apply(this,arguments)}}();originalMessage?(sortDate=_solidLogic.store.anyValue(originalMessage,ns.dct("created"),null,originalMessage.doc()),sendIcon=_iconBase.icons.iconBase+"noun_1180158.svg"):(sendIcon=_iconBase.icons.iconBase+"noun_383448.svg",sortDate="9999-01-01T00:00:00Z");var field,sendButton,messageEditor=dom.createElement("tr"),lhs=dom.createElement("td"),middle=dom.createElement("td"),rhs=dom.createElement("td");messageEditor.appendChild(lhs),messageEditor.appendChild(middle),messageEditor.appendChild(rhs),messageEditor.AJAR_date=sortDate;var context={div:middle,dom};return(0,_login.ensureLoggedIn)(context).then(function(context){!function turnOnInput(){function _tookPicture(){return(_tookPicture=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(imageDoc){return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!imageDoc){_context5.next=1;break}return _context5.next=1,sendMessage(imageDoc.uri);case 1:case"end":return _context5.stop()}},_callee4)}))).apply(this,arguments)}if(options.menuHandler){var _menuButton=widgets.button(dom,_iconBase.icons.iconBase+"noun_243787.svg","More");_menuButton.setAttribute("style",style.buttonStyle+"float: right;"),rhs.appendChild(_menuButton)}options.menuHandler;var me=_solidLogic.authn.currentUser();if(creatorAndDate(lhs,me,"",null),field=dom.createElement("textarea"),middle.innerHTML="",middle.appendChild(field),field.rows=3,originalMessage&&(field.value=_solidLogic.store.anyValue(originalMessage,ns.sioc("content"),null,originalMessage.doc())),field.setAttribute("style",messageBodyStyle+"background-color: #eef;"),field.addEventListener("keydown",function(){var _ref3=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(e){return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if("Enter"!==e.code){_context4.next=1;break}if(!(!e.shiftKey&&!options.shiftEnterSendsMessage||e.shiftKey&&options.shiftEnterSendsMessage)){_context4.next=1;break}return _context4.next=1,handleFieldInput(e);case 1:case"end":return _context4.stop()}},_callee3)}));return function(_x15){return _ref3.apply(this,arguments)}}(),!1),widgets.makeDropTarget(field,droppedURIHandler,droppedFileHandler),rhs.innerHTML="",(sendButton=widgets.button(dom,sendIcon,"Send")).style.float="right",sendButton.addEventListener("click",function(_event){return handleFieldInput()},!1),rhs.appendChild(sendButton),originalMessage){var cancelButton=rhs.appendChild(widgets.cancelButton(dom));cancelButton.style.float="left",cancelButton.addEventListener("click",function(_event){return function revertEditing(messageEditor){messageEditor.originalRow.style.visibility="visible",messageEditor.parentNode.removeChild(messageEditor)}(messageEditor)},!1),rhs.appendChild(cancelButton)}var chatDocument=channelObject.dateFolder.leafDocumentFromDate(new Date);middle.appendChild(_index.media.cameraButton(dom,_solidLogic.store,function getImageDoc(){return $rdf.sym(chatDocument.dir().uri+"Image_"+Date.now()+".png")},function tookPicture(_x14){return _tookPicture.apply(this,arguments)})),pad.recordParticipation(channelObject.channel,channelObject.channel.doc())}(),Object.assign(context,userContext),(0,_bookmarks.findBookmarkDocument)(context).then(function(_context){})}),messageEditor}},"./lib/chat/messageTools.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActionClassFromEmoji=function ActionClassFromEmoji(emoji){for(var a in emojiMap)if(emojiMap[a]===emoji)return rdf.sym(a.slice(1,-1));return null},exports.emojiFromAction=emojiFromAction,exports.emojiFromActionClass=emojiFromActionClass,exports.messageToolbar=function messageToolbar(_x5,_x6,_x7,_x8){return _messageToolbar.apply(this,arguments)},exports.sentimentStrip=function sentimentStrip(_x,_x2){return _sentimentStrip.apply(this,arguments)},exports.sentimentStripLinked=function sentimentStripLinked(_x3,_x4){return _sentimentStripLinked.apply(this,arguments)};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_slicedToArray2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/slicedToArray.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),_bookmarks=__webpack_require__("./lib/chat/bookmarks.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_chatLogic=__webpack_require__("./lib/chat/chatLogic.js"),_message=__webpack_require__("./lib/chat/message.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t7 in e)"default"!==_t7&&{}.hasOwnProperty.call(e,_t7)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t7))&&(i.get||i.set)?o(f,_t7,i):f[_t7]=e[_t7]);return f})(e,t)}var dom=window.document,emojiMap={};function emojiFromActionClass(action){return emojiMap[action]||null}function emojiFromAction(action){var content=_solidLogic.store.any(action,ns.sioc("content"),null,action.doc());if(content)return content;var klass=_solidLogic.store.any(action,ns.rdf("type"),null,action.doc());if(klass){var em=emojiFromActionClass(klass);if(em)return em}return"⬜️"}function _sentimentStrip(){return(_sentimentStrip=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(target,doc){var versions,actions,strings;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=1,(0,_chatLogic.allVersions)(target);case 1:return versions=_context.sent,actions=versions.map(function(version){return _solidLogic.store.each(null,ns.schema("target"),version,doc)}).flat(),strings=actions.map(function(action){return emojiFromAction(action)||""}),_context.abrupt("return",dom.createTextNode(strings.join(" ")));case 2:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}function _sentimentStripLinked(){return _sentimentStripLinked=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(target,doc){var strip,refresh,_refresh;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _refresh=function _refresh3(){return(_refresh=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(){var versions,actions,sentiments;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(strip.innerHTML="",!(0,_chatLogic.isDeleted)(target)){_context2.next=1;break}return _context2.abrupt("return",strip);case 1:return _context2.next=2,(0,_chatLogic.allVersions)(target);case 2:if(versions=_context2.sent,0!==(actions=versions.map(function(version){return _solidLogic.store.each(null,ns.schema("target"),version,doc)}).flat()).length){_context2.next=3;break}return _context2.abrupt("return",strip);case 3:(sentiments=actions.map(function(a){return[_solidLogic.store.any(a,ns.rdf("type"),null,doc),_solidLogic.store.any(a,ns.sioc("content"),null,doc),_solidLogic.store.any(a,ns.schema("agent"),null,doc)]})).sort(),sentiments.forEach(function(ss){var res,_ss=(0,_slicedToArray2.default)(ss,3),theClass=_ss[0],content=_ss[1],agent=_ss[2];agent?(res=dom.createElement("a")).setAttribute("href",agent.uri):res=dom.createTextNode(""),res.textContent=content||emojiMap[theClass]||"⬜️",strip.appendChild(res)});case 4:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)},refresh=function _refresh2(){return _refresh.apply(this,arguments)},strip=dom.createElement("span"),refresh().then(debug.log("sentimentStripLinked: sentimentStripLinked async refreshed")),strip.refresh=refresh,_context3.abrupt("return",strip);case 1:case"end":return _context3.stop()}},_callee3)})),_sentimentStripLinked.apply(this,arguments)}function _messageToolbar(){return _messageToolbar=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee0(message,messageRow,userContext,channelObject){var deleteMessage,_deleteMessage,editMessage,_editMessage,replyInThread,_replyInThread,div,closeToolbar,deleteThingThen,_deleteThingThen,me,sentimentButton,context1,cancelButton,_t2,_t3,_t4,_t5,_t6;return _regenerator.default.wrap(function(_context0){for(;;)switch(_context0.prev=_context0.next){case 0:return sentimentButton=function _sentimentButton(context,target,icon,actionClass,doc,mutuallyExclusive){function setColor(){button.style.backgroundColor=action?"yellow":"white"}var action,button=widgets.button(dom,icon,utils.label(actionClass),function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(_event){var insertMe,dirty,i,a;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!action){_context4.next=2;break}return _context4.next=1,deleteThingThen(action);case 1:action=null,setColor(),_context4.next=8;break;case 2:return action=widgets.newThing(doc),insertMe=[rdf.st(action,ns.schema("agent"),context.me,doc),rdf.st(action,ns.rdf("type"),actionClass,doc),rdf.st(action,ns.schema("target"),target,doc)],_context4.next=3,_solidLogic.store.updater.update([],insertMe);case 3:if(setColor(),!mutuallyExclusive){_context4.next=8;break}dirty=!1,i=0;case 4:if(!(i<mutuallyExclusive.length)){_context4.next=7;break}if(!(a=existingAction(mutuallyExclusive[i]))){_context4.next=6;break}return _context4.next=5,deleteThingThen(a);case 5:dirty=!0;case 6:i++,_context4.next=4;break;case 7:dirty&&widgets.refreshTree(messageRow);case 8:case"end":return _context4.stop()}},_callee4)}));return function(_x1){return _ref.apply(this,arguments)}}());function existingAction(actionClass){var actions=_solidLogic.store.each(null,ns.schema("agent"),context.me,doc).filter(function(x){return _solidLogic.store.holds(x,ns.rdf("type"),actionClass,doc)}).filter(function(x){return _solidLogic.store.holds(x,ns.schema("target"),target,doc)});return actions.length?actions[0]:null}function refresh(){action=existingAction(actionClass),setColor()}return button.refresh=refresh,refresh(),button},_deleteThingThen=function _deleteThingThen3(){return(_deleteThingThen=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee9(x){return _regenerator.default.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=1,_solidLogic.store.updater.update(_solidLogic.store.connectedStatements(x),[]);case 1:case"end":return _context9.stop()}},_callee9)}))).apply(this,arguments)},deleteThingThen=function _deleteThingThen2(_x0){return _deleteThingThen.apply(this,arguments)},closeToolbar=function _closeToolbar(){div.parentElement.parentElement.removeChild(div.parentElement)},_replyInThread=function _replyInThread3(){return(_replyInThread=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(){var thread,options;return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=1,channelObject.createThread(message);case 1:if(thread=_context8.sent,options=userContext.chatOptions){_context8.next=2;break}throw new Error("replyInThread: missing options");case 2:options.showThread(thread,options),closeToolbar();case 3:case"end":return _context8.stop()}},_callee8)}))).apply(this,arguments)},replyInThread=function _replyInThread2(){return _replyInThread.apply(this,arguments)},_editMessage=function _editMessage3(){return _editMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(messageRow){return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(me.value!==_solidLogic.store.any(message,ns.foaf("maker")).value){_context7.next=1;break}return closeToolbar(),_context7.next=1,(0,_message.switchToEditor)(messageRow,message,channelObject,userContext);case 1:case"end":return _context7.stop()}},_callee7)})),_editMessage.apply(this,arguments)},editMessage=function _editMessage2(_x9){return _editMessage.apply(this,arguments)},_deleteMessage=function _deleteMessage3(){return(_deleteMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(){var author,msg,_t;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(author=_solidLogic.store.any(message,ns.foaf("maker")),me){_context6.next=1;break}alert("You can't delete the message, you are not logged in."),_context6.next=7;break;case 1:if(!me.sameTerm(author)){_context6.next=6;break}return _context6.prev=2,_context6.next=3,channelObject.deleteMessage(message);case 3:_context6.next=5;break;case 4:_context6.prev=4,_t=_context6.catch(2),msg="Error deleting messaage "+_t,debug.warn(msg),alert(msg),(userContext.statusArea||messageRow.parentNode).appendChild(widgets.errorMessageBlock(dom,msg));case 5:messageRow.parentNode.removeChild(messageRow),_context6.next=7;break;case 6:alert("You can't delete the message, you are not logged in as the author, "+author);case 7:closeToolbar();case 8:case"end":return _context6.stop()}},_callee6,null,[[2,4]])}))).apply(this,arguments)},deleteMessage=function _deleteMessage2(){return _deleteMessage.apply(this,arguments)},div=dom.createElement("div"),_context0.next=1,(0,_chatLogic.mostRecentVersion)(message).value;case 1:if(_t2=_context0.sent,_t3=ns.schema("dateDeleted").value,_t2!==_t3){_context0.next=2;break}return _context0.abrupt("return",div);case 2:if((me=_solidLogic.authn.currentUser())&&_solidLogic.store.holds(message,ns.foaf("maker"),me)&&(div.appendChild(widgets.deleteButtonWithCheck(dom,div,"message",deleteMessage)),div.appendChild(widgets.button(dom,_iconBase.icons.iconBase+"noun_253504.svg","edit",function(){return editMessage(messageRow)}))),(0,_bookmarks.renderBookmarksButton)(userContext).then(function(bookmarkButton){bookmarkButton&&div.appendChild(bookmarkButton)}),me=_solidLogic.authn.currentUser(),!(_t4=me)){_context0.next=4;break}return _context0.next=3,(0,_chatLogic.mostRecentVersion)(message).value;case 3:_t5=_context0.sent,_t6=ns.schema("dateDeleted").value,_t4=_t5!==_t6;case 4:if(!_t4){_context0.next=5;break}context1={me,dom,div},div.appendChild(sentimentButton(context1,message,_iconBase.icons.iconBase+"noun_1384132.svg",ns.schema("AgreeAction"),message.doc(),[ns.schema("DisagreeAction")])),div.appendChild(sentimentButton(context1,message,_iconBase.icons.iconBase+"noun_1384135.svg",ns.schema("DisagreeAction"),message.doc(),[ns.schema("AgreeAction")]));case 5:return _solidLogic.store.any(message,ns.dct("created"))&&div.appendChild(widgets.button(dom,_iconBase.icons.iconBase+"noun-reply-5506924.svg","Reply in thread",(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(){return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=1,replyInThread();case 1:case"end":return _context5.stop()}},_callee5)})))),(cancelButton=div.appendChild(widgets.cancelButton(dom))).style.float="right",cancelButton.firstChild.style.opacity="0.3",cancelButton.addEventListener("click",closeToolbar),_context0.abrupt("return",div);case 6:case"end":return _context0.stop()}},_callee0)})),_messageToolbar.apply(this,arguments)}emojiMap[ns.schema("AgreeAction")]="👍",emojiMap[ns.schema("DisagreeAction")]="👎",emojiMap[ns.schema("EndorseAction")]="⭐️",emojiMap[ns.schema("LikeAction")]="❤️"},"./lib/chat/signature.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SEC=void 0,exports.getBlankMsg=function getBlankMsg(){return{id:"",created:"",dateDeleted:"",content:"",maker:"",sig:""}},exports.getMsgHash=getMsgHash,exports.serializeMsg=serializeMsg,exports.signMsg=function signMsg(message,key){return(0,_utils.bytesToHex)(_secp256k.schnorr.sign(getMsgHash(message),key))},exports.utf8Encoder=exports.utf8Decoder=void 0,exports.verifySignature=function verifySignature(sig,message,pubKey){return _secp256k.schnorr.verify(sig,getMsgHash(message),pubKey)};var _secp256k=__webpack_require__("./node_modules/@noble/curves/secp256k1.js"),_utils=__webpack_require__("./node_modules/@noble/hashes/utils.js"),_sha=__webpack_require__("./node_modules/@noble/hashes/sha256.js"),utf8Encoder=(exports.utf8Decoder=new TextDecoder("utf-8"),exports.utf8Encoder=new TextEncoder);exports.SEC="https://w3id.org/security#";function serializeMsg(msg){return JSON.stringify(msg)}function getMsgHash(message){var msgHash=(0,_sha.sha256)(utf8Encoder.encode(serializeMsg(message)));return(0,_utils.bytesToHex)(msgHash)}},"./lib/create/create.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.newThingUI=function newThingUI(createContext,dataBrowserContext,thePanes){var dom=createContext.dom,div=createContext.div;if(createContext.me&&!createContext.me.uri)throw new Error("newThingUI:  Invalid userid: "+createContext.me);var iconStyle="padding: 0.7em; width: 2em; height: 2em;",star=div.appendChild(dom.createElement("img")),visible=!1;star.setAttribute("src",_iconBase.icons.iconBase+"noun_34653_green.svg"),star.setAttribute("style",iconStyle),star.setAttribute("title","Add another tool");var complain=function complain(message){var pre=div.appendChild(dom.createElement("pre"));pre.setAttribute("style","background-color: pink"),pre.appendChild(dom.createTextNode(message))};function styleTheIcons(style){for(var i=0;i<iconArray.length;i++){var st=iconStyle+style;iconArray[i].disabled&&(st+="opacity: 0.3;"),iconArray[i].setAttribute("style",st)}}function selectNewTool(_event){visible=!visible,star.setAttribute("style",iconStyle+(visible?"background-color: yellow;":"")),styleTheIcons(visible?"":"display: none;")}star.addEventListener("click",selectNewTool);var iconArray=[],mintingPanes=Object.values(thePanes).filter(function(pane){return pane.mintNew}),mintingClassMap=mintingPanes.reduce(function(classMap,pane){return pane.mintClass&&(classMap[pane.mintClass.uri]=(classMap[pane.mintClass.uri]||0)+1),classMap},{});mintingPanes.forEach(function(pane){var icon=createContext.div.appendChild(dom.createElement("img"));icon.setAttribute("src",pane.icon);var noun=pane.mintClass?mintingClassMap[pane.mintClass.uri]>1?"".concat(utils.label(pane.mintClass)," (using ").concat(pane.name," pane)"):utils.label(pane.mintClass):pane.name+" @@";icon.setAttribute("title","Make new "+noun),icon.setAttribute("style",iconStyle+"display: none;"),iconArray.push(icon),icon.disabled||icon.addEventListener("click",function(e){!function selectTool(icon){styleTheIcons("display: none;"),icon.setAttribute("style",iconStyle+"background-color: yellow;")}(icon),function makeNewAppInstance(options){return new Promise(function(resolve,reject){var selectUI;function callbackWS(ws,newBase){(0,_login.ensureLoadedProfile)(createContext).then(function(_context){var newPaneOptions=Object.assign({newBase,folder:options.folder||void 0,workspace:ws},options);for(var opt in options)newPaneOptions[opt]=options[opt];debug.log("newThingUI: Minting new ".concat(newPaneOptions.pane.name," at ").concat(newPaneOptions.newBase)),options.pane.mintNew(dataBrowserContext,newPaneOptions).then(function(newPaneOptions){if(!newPaneOptions||!newPaneOptions.newInstance)throw new Error("Cannot mint new - missing newInstance");if(newPaneOptions.folder){var isPackage=newPaneOptions.newInstance.uri.slice(newPaneOptions.folder.uri.length).includes("/");debug.log("  new thing is packge? "+isPackage),isPackage?kb.add(newPaneOptions.folder,ns.ldp("contains"),kb.sym(newPaneOptions.newBase),newPaneOptions.folder.doc()):kb.add(newPaneOptions.folder,ns.ldp("contains"),newPaneOptions.newInstance,newPaneOptions.folder.doc()),newPaneOptions.refreshTarget&&newPaneOptions.refreshTarget.refresh&&newPaneOptions.refreshTarget.refresh()}else{var p=options.div.appendChild(dom.createElement("p"));p.setAttribute("style","font-size: 120%;"),p.innerHTML="Your <a target='_blank' href='"+newPaneOptions.newInstance.uri+"'><b>new "+options.noun+"</b></a> is ready to be set up. <br/><br/><a target='_blank' href='"+newPaneOptions.newInstance.uri+"'>Go to your new "+options.noun+".</a>"}selectNewTool()}).catch(function(err){complain(err),reject(err)})},function(err){complain("Error logging on: "+err)})}var pa=options.pane;options.noun=pa.mintClass?utils.label(pa.mintClass):pa.name,options.appPathSegment=options.noun.slice(0,1).toUpperCase()+options.noun.slice(1),options.folder?widgets.askName(dom,kb,options.div,ns.foaf("name"),null,options.noun).then(function gotName(name){if(name){var uri=options.folder.uri;uri.endsWith("/")||(uri+="/"),callbackWS(null,uri=uri+encodeURIComponent(name)+"/")}else selectNewTool()}):(selectUI=(0,_login.selectWorkspace)(dom,{noun:options.noun,appPathSegment:options.appPathSegment},callbackWS),options.div.appendChild(selectUI))})}({event:e,folder:createContext.folder||null,iconEle:icon,pane,noun,noIndexHTML:!0,div:createContext.div,me:createContext.me,dom:createContext.dom,refreshTarget:createContext.refreshTarget})})})};var _solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),_login=__webpack_require__("./lib/login/login.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var kb=_solidLogic.solidLogicSingleton.store},"./lib/create/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=void 0;var _create=__webpack_require__("./lib/create/create.js");exports.create={newThingUI:_create.newThingUI}},"./lib/create/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./lib/debug.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.error=function error(){var _console3;(_console3=console).error.apply(_console3,arguments)},exports.log=function log(){var _console;(_console=console).log.apply(_console,arguments)},exports.trace=function trace(){var _console4;(_console4=console).trace.apply(_console4,arguments)},exports.warn=function warn(){var _console2;(_console2=console).warn.apply(_console2,arguments)}},"./lib/footer/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createControllerInfoBlock=createControllerInfoBlock,exports.initFooter=function initFooter(_x,_x2){return _initFooter.apply(this,arguments)},exports.rebuildFooter=rebuildFooter;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),style=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t2 in e)"default"!==_t2&&{}.hasOwnProperty.call(e,_t2)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t2))&&(i.get||i.set)?o(f,_t2,i):f[_t2]=e[_t2]);return f}(e,t)}(__webpack_require__("./lib/style.js")),_headerFooterHelpers=__webpack_require__("./lib/utils/headerFooterHelpers.js");var DEFAULT_SOLID_PROJECT_URL="https://solidproject.org",DEFAULT_SOLID_PROJECT_NAME="solidproject.org";function _initFooter(){return(_initFooter=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(store,options){var footer,pod,podOwner;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(footer=document.getElementById("PageFooter")){_context2.next=1;break}return _context2.abrupt("return");case 1:return pod=(0,_headerFooterHelpers.getPod)(),_context2.next=2,(0,_headerFooterHelpers.getPodOwner)(pod,store);case 2:podOwner=_context2.sent,rebuildFooter(footer,store,pod,podOwner,options)(),_solidLogic.authSession.onLogin(rebuildFooter(footer,store,pod,podOwner,options)),_solidLogic.authSession.onLogout(rebuildFooter(footer,store,pod,podOwner,options));case 3:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)}function rebuildFooter(footer,store,pod,podOwner,options){return(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var user,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return user=_solidLogic.authn.currentUser(),footer.innerHTML="",_t=footer,_context.next=1,createControllerInfoBlock(store,user,pod,podOwner,options);case 1:_t.appendChild.call(_t,_context.sent);case 2:case"end":return _context.stop()}},_callee)}))}function createControllerInfoBlock(store,user,pod,podOwner,options){var profileLinkContainer=document.createElement("div");if(!pod||!podOwner||user&&user.equals(podOwner))return profileLinkContainer;profileLinkContainer.setAttribute("style",style.footer);var podLinkPre=document.createElement("span");podLinkPre.innerText="You're visiting ";var podLink=document.createElement("a");podLink.href=pod.uri,podLink.innerText="the Pod";var profileLinkPre=document.createElement("span");profileLinkPre.innerText=" controlled by ";var profileLink=document.createElement("a");profileLink.href=podOwner.uri,profileLink.innerText=(0,_headerFooterHelpers.getName)(store,podOwner);var solidProjectLinkPre=document.createElement("span");solidProjectLinkPre.innerText=". For more info, check out ";var solidProjectLink=document.createElement("a");solidProjectLink.href=options&&options.solidProjectUrl?options.solidProjectUrl:DEFAULT_SOLID_PROJECT_URL,solidProjectLink.innerText=options&&options.solidProjectName?options.solidProjectName:DEFAULT_SOLID_PROJECT_NAME;var solidProjectLinkPost=document.createElement("span");return solidProjectLinkPost.innerText=".",profileLinkContainer.appendChild(podLinkPre),profileLinkContainer.appendChild(podLink),profileLinkContainer.appendChild(profileLinkPre),profileLinkContainer.appendChild(profileLink),profileLinkContainer.appendChild(solidProjectLinkPre),profileLinkContainer.appendChild(solidProjectLink),profileLinkContainer.appendChild(solidProjectLinkPost),profileLinkContainer}},"./lib/header/empty-profile.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.emptyProfile=void 0;exports.emptyProfile='\n<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26" fill="none">\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M13 25C19.6274 25 25 19.6274 25 13C25 6.37258 19.6274 1 13 1C6.37258 1 1 6.37258 1 13C1 19.6274 6.37258 25 13 25Z" fill="#D8D8D8" stroke="#8B8B8B"/>\n    <mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="26" height="26">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M13 25C19.6274 25 25 19.6274 25 13C25 6.37258 19.6274 1 13 1C6.37258 1 1 6.37258 1 13C1 19.6274 6.37258 25 13 25Z" fill="white" stroke="white"/>\n    </mask>\n    <g mask="url(#mask0)">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M17.0468 10.4586C17.0468 14.4979 15.4281 16.9214 12.9999 16.9214C10.5718 16.9214 8.95298 14.4979 8.95298 10.4586C8.95298 6.41931 12.9999 6.41931 12.9999 6.41931C12.9999 6.41931 17.0468 6.41931 17.0468 10.4586ZM4.09668 23.3842C6.52483 17.7293 12.9999 17.7293 12.9999 17.7293C12.9999 17.7293 19.475 17.7293 21.9031 23.3842C21.9031 23.3842 17.8481 25 12.9999 25C8.15169 25 4.09668 23.3842 4.09668 23.3842Z" fill="#8B8B8B"/>\n    </g>\n</svg>'},"./lib/header/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createBanner=createBanner,exports.createHelpMenu=createHelpMenu,exports.createLoginSignUpButtons=createLoginSignUpButtons,exports.createUserMenu=createUserMenu,exports.createUserMenuButton=createUserMenuButton,exports.createUserMenuItem=createUserMenuItem,exports.createUserMenuLink=createUserMenuLink,exports.getProfileImg=getProfileImg,exports.initHeader=function initHeader(_x,_x2,_x3){return _initHeader.apply(this,arguments)},exports.rebuildHeader=rebuildHeader;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_index=__webpack_require__("./lib/index.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_login=__webpack_require__("./lib/login/login.js"),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_emptyProfile=__webpack_require__("./lib/header/empty-profile.js"),_headerFooterHelpers=__webpack_require__("./lib/utils/headerFooterHelpers.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}var DEFAULT_HELP_MENU_ICON=_index.icons.iconBase+"noun_help.svg";function _initHeader(){return(_initHeader=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(store,userMenuList,options){var header,pod;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(header=document.getElementById("PageHeader")){_context2.next=1;break}return _context2.abrupt("return");case 1:pod=(0,_headerFooterHelpers.getPod)(),rebuildHeader(header,store,pod,userMenuList,options)(),_solidLogic.authSession.onLogout(rebuildHeader(header,store,pod,userMenuList,options)),_solidLogic.authSession.onLogin(rebuildHeader(header,store,pod,userMenuList,options));case 2:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)}function rebuildHeader(header,store,pod,userMenuList,options){return(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var user,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return user=_solidLogic.authn.currentUser(),header.innerHTML="",_t=header,_context.next=1,createBanner(store,pod,user,userMenuList,options);case 1:_t.appendChild.call(_t,_context.sent);case 2:case"end":return _context.stop()}},_callee)}))}function createBanner(_x4,_x5,_x6,_x7,_x8){return _createBanner.apply(this,arguments)}function _createBanner(){return(_createBanner=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(store,pod,user,userMenuList,options){var podLink,image,userMenu,banner,leftSideOfHeader,helpMenu,_t2;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if((podLink=document.createElement("a")).href=pod.uri,podLink.setAttribute("style",style.headerBannerLink),image=document.createElement("img"),options&&(image.src=options.logo?options.logo:"https://solidproject.org/assets/img/solid-emblem.svg"),image.setAttribute("style",style.headerBannerIcon),podLink.appendChild(image),!user){_context3.next=2;break}return _context3.next=1,createUserMenu(store,user,userMenuList);case 1:_t2=_context3.sent,_context3.next=3;break;case 2:_t2=createLoginSignUpButtons();case 3:return userMenu=_t2,(banner=document.createElement("div")).setAttribute("style",style.headerBanner),banner.appendChild(podLink),(leftSideOfHeader=document.createElement("div")).setAttribute("style",style.headerBannerRightMenu),leftSideOfHeader.appendChild(userMenu),options&&options.helpMenuList&&(helpMenu=createHelpMenu(options,options.helpMenuList),leftSideOfHeader.appendChild(helpMenu)),banner.appendChild(leftSideOfHeader),_context3.abrupt("return",banner);case 4:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)}function createHelpMenu(options,helpMenuItems){if(helpMenuItems){var helpMenuList=document.createElement("ul");helpMenuList.setAttribute("style",style.headerUserMenuList),helpMenuItems.forEach(function(menuItem){"url"===(menuItem.url?"url":"onclick")?helpMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label,menuItem.url,menuItem.target))):helpMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label,menuItem.onclick)))});var helpMenu=document.createElement("nav");helpMenu.setAttribute("style",style.headerUserMenuNavigationMenuNotDisplayed),helpMenu.setAttribute("aria-hidden","true"),helpMenu.setAttribute("id","helperNav"),helpMenu.appendChild(helpMenuList);var helpMenuContainer=document.createElement("div");helpMenuContainer.setAttribute("style",style.headerBannerUserMenu),helpMenuContainer.appendChild(helpMenu);var helpMenuTrigger=document.createElement("button");helpMenuTrigger.setAttribute("style",style.headerUserMenuTrigger),helpMenuTrigger.type="button";var helpMenuIcon=document.createElement("img");helpMenuIcon.src=options&&options.helpIcon?options.helpIcon:_index.icons.iconBase+DEFAULT_HELP_MENU_ICON,helpMenuIcon.setAttribute("style",style.headerUserMenuTriggerImg),helpMenuContainer.appendChild(helpMenuTrigger),helpMenuTrigger.appendChild(helpMenuIcon);var throttledMenuToggle=(0,_headerFooterHelpers.throttle)(function(event){return toggleMenu(event,helpMenuTrigger,helpMenu)},50);helpMenuTrigger.addEventListener("click",throttledMenuToggle);var timer=setTimeout(function(){return null},0);return helpMenuContainer.addEventListener("mouseover",function(event){clearTimeout(timer),throttledMenuToggle(event);var nav=document.getElementById("helperNav");null==nav||nav.setAttribute("style",style.headerUserMenuNavigationMenu)}),helpMenuContainer.addEventListener("mouseout",function(event){timer=setTimeout(function(){return throttledMenuToggle(event)},200);var nav=document.getElementById("helperNav");null==nav||nav.setAttribute("style",style.headerUserMenuNavigationMenuNotDisplayed)}),helpMenuContainer}}function createLoginSignUpButtons(){var profileLoginButtonPre=document.createElement("div");return profileLoginButtonPre.setAttribute("style",style.headerBannerLogin),profileLoginButtonPre.appendChild((0,_login.loginStatusBox)(document,null,{})),profileLoginButtonPre}function createUserMenuButton(label,onClick){var button=document.createElement("button");return button.setAttribute("style",style.headerUserMenuButton),button.onmouseover=function(){button.setAttribute("style",style.headerUserMenuButtonHover)},button.onmouseout=function(){button.setAttribute("style",style.headerUserMenuButton)},button.addEventListener("click",onClick),button.innerText=label,button}function createUserMenuLink(label,href,target){var link=document.createElement("a");return link.setAttribute("style",style.headerUserMenuLink),link.onmouseover=function(){link.setAttribute("style",style.headerUserMenuLinkHover)},link.onmouseout=function(){link.setAttribute("style",style.headerUserMenuLink)},link.href=href,link.innerText=label,target&&(link.target=target),link}function createUserMenu(_x9,_x0,_x1){return _createUserMenu.apply(this,arguments)}function _createUserMenu(){return(_createUserMenu=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(store,user,userMenuList){var fetcher,loggedInMenuList,loggedInMenu,loggedInMenuTrigger,profileImg,loggedInMenuContainer,throttledMenuToggle,timer;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!(fetcher=store.fetcher)){_context4.next=1;break}return _context4.next=1,fetcher.load(user);case 1:return(loggedInMenuList=document.createElement("ul")).setAttribute("style",style.headerUserMenuList),userMenuList&&userMenuList.forEach(function(menuItem){"url"===(menuItem.url?"url":"onclick")?loggedInMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label,menuItem.url,menuItem.target))):loggedInMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label,menuItem.onclick)))}),(loggedInMenu=document.createElement("nav")).setAttribute("style",style.headerUserMenuNavigationMenuNotDisplayed),loggedInMenu.setAttribute("aria-hidden","true"),loggedInMenu.setAttribute("id","loggedInNav"),loggedInMenu.appendChild(loggedInMenuList),(loggedInMenuTrigger=document.createElement("button")).setAttribute("style",style.headerUserMenuTrigger),loggedInMenuTrigger.type="button","string"==typeof(profileImg=getProfileImg(store,user))?loggedInMenuTrigger.innerHTML=profileImg:loggedInMenuTrigger.appendChild(profileImg),(loggedInMenuContainer=document.createElement("div")).setAttribute("style",style.headerBannerUserMenuNotDisplayed),loggedInMenuContainer.appendChild(loggedInMenuTrigger),loggedInMenuContainer.appendChild(loggedInMenu),throttledMenuToggle=(0,_headerFooterHelpers.throttle)(function(event){return toggleMenu(event,loggedInMenuTrigger,loggedInMenu)},50),loggedInMenuTrigger.addEventListener("click",throttledMenuToggle),timer=setTimeout(function(){return null},0),loggedInMenuContainer.addEventListener("mouseover",function(event){clearTimeout(timer),throttledMenuToggle(event);var nav=document.getElementById("loggedInNav");null==nav||nav.setAttribute("style",style.headerUserMenuNavigationMenu)}),loggedInMenuContainer.addEventListener("mouseout",function(event){timer=setTimeout(function(){return throttledMenuToggle(event)},200);var nav=document.getElementById("loggedInNav");null==nav||nav.setAttribute("style",style.headerUserMenuNavigationMenuNotDisplayed)}),_context4.abrupt("return",loggedInMenuContainer);case 2:case"end":return _context4.stop()}},_callee4)}))).apply(this,arguments)}function createUserMenuItem(child){var menuProfileItem=document.createElement("li");return menuProfileItem.setAttribute("style",style.headerUserMenuListItem),menuProfileItem.appendChild(child),menuProfileItem}function getProfileImg(store,user){var profileUrl=null;try{if(!(profileUrl=widgets.findImage(user)))return _emptyProfile.emptyProfile}catch(_unused){return _emptyProfile.emptyProfile}var profileImage=document.createElement("div");return profileImage.setAttribute("style",style.headerUserMenuPhoto),profileImage.style.backgroundImage="url(".concat(profileUrl,")"),profileImage}function toggleMenu(event,trigger,menu){var isExpanded="true"===trigger.getAttribute("aria-expanded"),expand="mouseover"===event.type,close="mouseout"===event.type;isExpanded&&expand||!isExpanded&&close||(trigger.setAttribute("aria-expanded",(!isExpanded).toString()),menu.setAttribute("aria-hidden",isExpanded.toString()))}},"./lib/iconBase.js":(module,exports,__webpack_require__)=>{"use strict";module=__webpack_require__.nmd(module),Object.defineProperty(exports,"__esModule",{value:!0}),exports.originalIconBase=exports.icons=exports.iconBase=void 0;var _debug=__webpack_require__("./lib/debug.js"),icons=exports.icons=module.scriptURI?{iconBase:module.scriptURI.slice(0,module.scriptURI.lastIndexOf("/"))+"/icons/",originalIconBase:module.scriptURI.slice(0,module.scriptURI.lastIndexOf("/"))+"/originalIcons/"}:"undefined"!=typeof $SolidTestEnvironment&&$SolidTestEnvironment.iconBase?{iconBase:$SolidTestEnvironment.iconBase,originalIconBase:$SolidTestEnvironment.originalIconBase}:{iconBase:"https://solidos.github.io/solid-ui/src/icons/",originalIconBase:"https://solidos.github.io/solid-ui/src/originalIcons/"};(0,_debug.log)("   icons.iconBase is set to : "+icons.iconBase);exports.iconBase=icons.iconBase,exports.originalIconBase=icons.originalIconBase},"./lib/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"acl",{enumerable:!0,get:function get(){return _index.acl}}),Object.defineProperty(exports,"aclControl",{enumerable:!0,get:function get(){return _index.aclControl}}),Object.defineProperty(exports,"authn",{enumerable:!0,get:function get(){return _solidLogic.authn}}),Object.defineProperty(exports,"create",{enumerable:!0,get:function get(){return _index2.create}}),exports.dom=exports.createTypes=void 0,Object.defineProperty(exports,"icons",{enumerable:!0,get:function get(){return _iconBase.icons}}),Object.defineProperty(exports,"infiniteMessageArea",{enumerable:!0,get:function get(){return _infinite.infiniteMessageArea}}),Object.defineProperty(exports,"initFooter",{enumerable:!0,get:function get(){return _footer.initFooter}}),Object.defineProperty(exports,"initHeader",{enumerable:!0,get:function get(){return _header.initHeader}}),exports.login=exports.log=exports.language=void 0,Object.defineProperty(exports,"matrix",{enumerable:!0,get:function get(){return _index3.matrix}}),Object.defineProperty(exports,"media",{enumerable:!0,get:function get(){return _index4.media}}),Object.defineProperty(exports,"messageArea",{enumerable:!0,get:function get(){return _messageArea.messageArea}}),exports.rdf=exports.preferences=exports.participation=exports.pad=exports.ns=void 0,Object.defineProperty(exports,"store",{enumerable:!0,get:function get(){return _solidLogic.store}}),exports.style=void 0,Object.defineProperty(exports,"table",{enumerable:!0,get:function get(){return _table.renderTableViewPane}}),exports.utils=exports.tabs=void 0,Object.defineProperty(exports,"versionInfo",{enumerable:!0,get:function get(){return _versionInfo.default}}),exports.widgets=void 0;var rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js"));exports.rdf=rdf;var ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js"));exports.ns=ns;var _index=__webpack_require__("./lib/acl/index.js"),_index2=__webpack_require__("./lib/create/index.js"),_iconBase=__webpack_require__("./lib/iconBase.js"),language=_interopRequireWildcard(__webpack_require__("./lib/widgets/forms/autocomplete/language.js"));exports.language=language;var log=_interopRequireWildcard(__webpack_require__("./lib/log.js"));exports.log=log;var _index3=__webpack_require__("./lib/matrix/index.js"),_index4=__webpack_require__("./lib/media/index.js"),_messageArea=__webpack_require__("./lib/messageArea.js"),_infinite=__webpack_require__("./lib/chat/infinite.js"),pad=_interopRequireWildcard(__webpack_require__("./lib/pad.js"));exports.pad=pad;var participation=_interopRequireWildcard(__webpack_require__("./lib/participation.js"));exports.participation=participation;var preferences=_interopRequireWildcard(__webpack_require__("./lib/preferences.js"));exports.preferences=preferences;var style=_interopRequireWildcard(__webpack_require__("./lib/style.js"));exports.style=style;var _table=__webpack_require__("./lib/table.js"),tabs=_interopRequireWildcard(__webpack_require__("./lib/tabs.js"));exports.tabs=tabs;var utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js"));exports.utils=utils;var login=_interopRequireWildcard(__webpack_require__("./lib/login/login.js"));exports.login=login;var widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));exports.widgets=widgets;var _versionInfo=_interopRequireDefault(__webpack_require__("./lib/versionInfo.js")),_header=__webpack_require__("./lib/header/index.js"),_footer=__webpack_require__("./lib/footer/index.js"),createTypes=_interopRequireWildcard(__webpack_require__("./lib/create/types.js"));exports.createTypes=createTypes;var _solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var dom=exports.dom=window?window.document:null;"undefined"!=typeof window&&(window.UI={authn:_solidLogic.authn,store:_solidLogic.store,ns,rdf,acl:_index.acl,aclControl:_index.aclControl,create:_index2.create,createTypes,dom,icons:_iconBase.icons,language,log,login,matrix:_index3.matrix,media:_index4.media,messageArea:_messageArea.messageArea,infiniteMessageArea:_infinite.infiniteMessageArea,pad,participation,preferences,style,table:_table.renderTableViewPane,tabs,utils,widgets,versionInfo:_versionInfo.default,initHeader:_header.initHeader,initFooter:_footer.initFooter})},"./lib/log.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LogLevel=void 0,exports.alert=function alert(message){_window&&void 0!==_window.alert?_window.alert(message):warn(message)},exports.clear=function clear(){var _dom2,logArea=null===(_dom2=_dom)||void 0===_dom2?void 0:_dom2.getElementById("status");if(!logArea)return;logArea.innerHTML=""},exports.debug=debug,exports.dumpHTML=function dumpHTML(){var _dom3;if(!_dom)return;var level=_level;_level=TALL,debug((null===(_dom3=_dom)||void 0===_dom3||null===(_dom3=_dom3.body)||void 0===_dom3?void 0:_dom3.innerHTML)||""),_level=level},exports.error=function error(message){log(message,TERROR,"eror")},exports.escapeForXML=escapeForXML,exports.info=function info(message){log(message,TINFO,"info")},exports.logAscending=function logAscending(){_ascending=!0},exports.logDescending=function logDescending(){_ascending=!1},exports.msg=function msg(message){log(message)},exports.setInternals=function setInternals(window,document){_window=window,_dom=document},exports.setLevel=function setLevel(level){_level=TALL,debug("Log level is now "+level),_level=level},exports.success=function success(message){log(message,TSUCCESS,"good")},exports.warn=warn;var TERROR=1,TWARN=2,TMESG=4,TSUCCESS=8,TINFO=16,TDEBUG=32,TALL=63,_level=(exports.LogLevel=function(LogLevel){return LogLevel[LogLevel.Error=1]="Error",LogLevel[LogLevel.Warning=2]="Warning",LogLevel[LogLevel.Message=4]="Message",LogLevel[LogLevel.Success=8]="Success",LogLevel[LogLevel.Info=16]="Info",LogLevel[LogLevel.Debug=32]="Debug",LogLevel[LogLevel.All=63]="All",LogLevel}({}),TERROR+TWARN+TMESG),_ascending=!1,_dom=document,_window=window;function log(str){var typestr=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mesg";if(_level&(arguments.length>1&&void 0!==arguments[1]?arguments[1]:TMESG))if(void 0!==_dom){var logArea=_dom.getElementById("status");if(!logArea)return;var addendum=_dom.createElement("span");addendum.setAttribute("class",typestr);var now=new Date;addendum.innerHTML="".concat(now.getHours(),":").concat(now.getMinutes(),":").concat(now.getSeconds()," [").concat(typestr,"] ").concat(escapeForXML(str),"<br/>"),_ascending?logArea.insertBefore(addendum,logArea.firstChild):logArea.appendChild(addendum)}else"undefined"!=typeof console&&console.log(str)}function warn(message){log(message,TWARN,"warn")}function debug(message){log(message,TDEBUG,"dbug")}function escapeForXML(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},"./lib/login/login.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ensureLoadedPreferences=ensureLoadedPreferences,exports.ensureLoadedProfile=ensureLoadedProfile,exports.ensureLoggedIn=ensureLoggedIn,exports.filterAvailablePanes=function filterAvailablePanes(_x11){return _filterAvailablePanes.apply(this,arguments)},exports.findAppInstances=function findAppInstances(_x3,_x4,_x5){return _findAppInstances.apply(this,arguments)},exports.getUserRoles=getUserRoles,exports.loginStatusBox=loginStatusBox,exports.newAppInstance=function newAppInstance(dom,appDetails,callback){var gotWS=function gotWS(ws,base){callback(ws,base)},div=dom.createElement("div"),b=dom.createElement("button");return b.setAttribute("type","button"),div.appendChild(b),b.innerHTML="Make new ".concat(appDetails.noun),b.addEventListener("click",function(_event){div.appendChild(selectWorkspace(dom,appDetails,gotWS))},!1),div.appendChild(b),div},exports.registrationControl=function registrationControl(_x6,_x7,_x8){return _registrationControl.apply(this,arguments)},exports.registrationList=function registrationList(_x9,_x0){return _registrationList.apply(this,arguments)},exports.renderScopeHeadingRow=renderScopeHeadingRow,exports.renderSignInPopup=renderSignInPopup,exports.scopeLabel=scopeLabel,exports.selectWorkspace=selectWorkspace;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_log=__webpack_require__("./lib/log.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_signup=__webpack_require__("./lib/signup/signup.js"),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t1 in e)"default"!==_t1&&{}.hasOwnProperty.call(e,_t1)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t1))&&(i.get||i.set)?o(f,_t1,i):f[_t1]=e[_t1]);return f})(e,t)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}_solidLogic.solidLogicSingleton.store;var _solidLogicSingleton$=_solidLogic.solidLogicSingleton.profile,loadPreferences=_solidLogicSingleton$.loadPreferences,loadProfile=_solidLogicSingleton$.loadProfile,_solidLogicSingleton$2=_solidLogic.solidLogicSingleton.typeIndex,getScopedAppInstances=_solidLogicSingleton$2.getScopedAppInstances,getRegistrations=_solidLogicSingleton$2.getRegistrations,loadAllTypeIndexes=_solidLogicSingleton$2.loadAllTypeIndexes,getScopedAppsFromIndex=_solidLogicSingleton$2.getScopedAppsFromIndex,deleteTypeIndexRegistration=_solidLogicSingleton$2.deleteTypeIndexRegistration;function ensureLoggedIn(context){var me=_solidLogic.authn.currentUser();return me?(_solidLogic.authn.saveUser(me,context),Promise.resolve(context)):new Promise(function(resolve){_solidLogic.authn.checkUser().then(function(webId){if(webId)return debug.log("logIn: Already logged in as ".concat(webId)),resolve(context);if(!context.div||!context.dom)return resolve(context);var box=loginStatusBox(context.dom,function(webIdUri){_solidLogic.authn.saveUser(webIdUri,context),resolve(context)});context.div.appendChild(box)})})}function ensureLoadedPreferences(_x){return _ensureLoadedPreferences.apply(this,arguments)}function _ensureLoadedPreferences(){return(_ensureLoadedPreferences=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(context){var preferencesFile,m2,_t4;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!context.preferencesFile){_context4.next=1;break}return _context4.abrupt("return",Promise.resolve(context));case 1:return _context4.prev=1,_context4.next=2,ensureLoadedProfile(context);case 2:return context=_context4.sent,_context4.next=3,loadPreferences(context.me);case 3:preferencesFile=_context4.sent,context.preferencesFile=preferencesFile,_context4.next=11;break;case 4:if(_context4.prev=4,!((_t4=_context4.catch(1))instanceof _solidLogic.UnauthorizedError)){_context4.next=5;break}m2="Ooops - you are not authenticated (properly logged in) to for me to read your preference file.  Try loggin out and logging in?",(0,_log.alert)(m2),_context4.next=11;break;case 5:if(!(_t4 instanceof _solidLogic.CrossOriginForbiddenError)){_context4.next=6;break}return m2="Unauthorized: Assuming preference file blocked for origin ".concat(window.location.origin),context.preferencesFileError=m2,_context4.abrupt("return",context);case 6:if(!(_t4 instanceof _solidLogic.SameOriginForbiddenError)){_context4.next=7;break}return m2="You are not authorized to read your preference file. This may be because you are using an untrusted web app.",debug.warn(m2),_context4.abrupt("return",context);case 7:if(!(_t4 instanceof _solidLogic.NotEditableError)){_context4.next=8;break}return m2="You are not authorized to edit your preference file. This may be because you are using an untrusted web app.",debug.warn(m2),_context4.abrupt("return",context);case 8:if(!(_t4 instanceof _solidLogic.WebOperationError)){_context4.next=9;break}m2="You are not authorized to edit your preference file. This may be because you are using an untrusted web app.",debug.warn(m2),_context4.next=11;break;case 9:if(!(_t4 instanceof _solidLogic.FetchError)){_context4.next=10;break}m2="Strange: Error ".concat(_t4.status," trying to read your preference file.").concat(_t4.message),(0,_log.alert)(m2),_context4.next=11;break;case 10:throw new Error("(via loadPrefs) ".concat(_t4));case 11:return _context4.abrupt("return",context);case 12:case"end":return _context4.stop()}},_callee4,null,[[1,4]])}))).apply(this,arguments)}function ensureLoadedProfile(_x2){return _ensureLoadedProfile.apply(this,arguments)}function _ensureLoadedProfile(){return(_ensureLoadedProfile=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(context){var logInContext,_t5;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!context.publicProfile){_context5.next=1;break}return _context5.abrupt("return",context);case 1:return _context5.prev=1,_context5.next=2,ensureLoggedIn(context);case 2:if((logInContext=_context5.sent).me){_context5.next=3;break}throw new Error("Could not log in");case 3:return _context5.next=4,loadProfile(logInContext.me);case 4:context.publicProfile=_context5.sent,_context5.next=6;break;case 5:throw _context5.prev=5,_t5=_context5.catch(1),context.div&&context.dom&&context.div.appendChild(widgets.errorMessageBlock(context.dom,_t5.message)),new Error("Can't log in: ".concat(_t5));case 6:return _context5.abrupt("return",context);case 7:case"end":return _context5.stop()}},_callee5,null,[[1,5]])}))).apply(this,arguments)}function _findAppInstances(){return(_findAppInstances=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(context,theClass,isPublic){var items,_t6;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!context.me){_context6.next=2;break}return _context6.next=1,getScopedAppInstances(theClass,context.me);case 1:_t6=_context6.sent,_context6.next=3;break;case 2:_t6=[];case 3:return items=_t6,!0===isPublic?items=items.filter(function(item){return"public"===item.scope.label}):!1===isPublic&&(items=items.filter(function(item){return"private"===item.scope.label})),context.instances=items.map(function(item){return item.instance}),_context6.abrupt("return",context);case 4:case"end":return _context6.stop()}},_callee6)}))).apply(this,arguments)}function scopeLabel(context,scope){var name=context.me&&context.me.sameTerm(scope.agent)?"":utils.label(scope.agent)+" ";return"".concat(name).concat(scope.label)}function _registrationControl(){return(_registrationControl=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(context,instance,theClass){var registrationStatements,renderScopeCheckbox,dom,box,me,scopes,msg,tbody,form,_iterator,_step,scope,_t7;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(renderScopeCheckbox=function _renderScopeCheckbox(scope){var statements=registrationStatements(scope.index),name=scopeLabel(context,scope),label="".concat(name," link to this ").concat(context.noun);return widgets.buildCheckboxForm(context.dom,_solidLogic.solidLogicSingleton.store,label,null,statements,form,scope.index)},registrationStatements=function _registrationStatemen(index){var registrations=getRegistrations(instance,theClass),reg=registrations.length?registrations[0]:widgets.newThing(index);return[(0,_rdflib.st)(reg,ns.solid("instance"),instance,index),(0,_rdflib.st)(reg,ns.solid("forClass"),theClass,index)]},(dom=context.dom)&&context.div){_context7.next=1;break}throw new Error("registrationControl: need dom and div");case 1:if(box=dom.createElement("div"),context.div.appendChild(box),context.me=_solidLogic.authn.currentUser(),me=context.me){_context7.next=2;break}return box.innerHTML='<p style="margin:2em;">(Log in to save a link to this)</p>',_context7.abrupt("return",context);case 2:return _context7.prev=2,_context7.next=3,loadAllTypeIndexes(me);case 3:scopes=_context7.sent,_context7.next=5;break;case 4:return _context7.prev=4,_t7=_context7.catch(2),context.div&&context.preferencesFileError?(msg="(Lists of stuff not available)",context.div.appendChild(dom.createElement("p")).textContent=msg):context.div&&(msg="registrationControl: Type indexes not available: ".concat(_t7),context.div.appendChild(widgets.errorMessageBlock(context.dom,_t7))),debug.log(msg),_context7.abrupt("return",context);case 5:box.innerHTML="<table><tbody></tbody></table>",box.setAttribute("style","font-size: 120%; text-align: right; padding: 1em; border: solid gray 0.05em;"),tbody=box.children[0].children[0],form=new _rdflib.BlankNode,_iterator=_createForOfIteratorHelper(scopes);try{for(_iterator.s();!(_step=_iterator.n()).done;)scope=_step.value,tbody.appendChild(dom.createElement("tr")).appendChild(renderScopeCheckbox(scope))}catch(err){_iterator.e(err)}finally{_iterator.f()}return _context7.abrupt("return",context);case 6:case"end":return _context7.stop()}},_callee7,null,[[2,4]])}))).apply(this,arguments)}function renderScopeHeadingRow(context,store,scope){var dom=context.dom,name=scopeLabel(context,scope),row=dom.createElement("tr"),cell=row.appendChild(dom.createElement("td"));cell.setAttribute("colspan","3"),cell.style.backgoundColor={private:"#fee",public:"#efe"}[scope.label]||"white";var header=cell.appendChild(dom.createElement("h3"));return header.textContent=name+" links",header.style.textAlign="left",row}function _registrationList(){return _registrationList=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee9(context,options){var dom,div,box,scopes,table,tbody,_iterator2,_step2,scope,headingRow,items,_iterator3,_step3,_loop,_t8,_t9;return _regenerator.default.wrap(function(_context0){for(;;)switch(_context0.prev=_context0.next){case 0:if(dom=context.dom,div=context.div,box=dom.createElement("div"),div.appendChild(box),context.me=_solidLogic.authn.currentUser(),context.me){_context0.next=1;break}return box.innerHTML='<p style="margin:2em;">(Log in list your stuff)</p>',_context0.abrupt("return",context);case 1:return _context0.next=2,loadAllTypeIndexes(context.me);case 2:scopes=_context0.sent,box.innerHTML="<table><tbody></tbody></table>",box.setAttribute("style","font-size: 120%; text-align: right; padding: 1em; border: solid #eee 0.5em;"),table=box.firstChild,tbody=table.firstChild,_iterator2=_createForOfIteratorHelper(scopes),_context0.prev=3,_iterator2.s();case 4:if((_step2=_iterator2.n()).done){_context0.next=13;break}return scope=_step2.value,headingRow=renderScopeHeadingRow(context,0,scope),tbody.appendChild(headingRow),_context0.next=5,getScopedAppsFromIndex(scope,options.type||null);case 5:0===(items=_context0.sent).length&&(headingRow.style.display="none"),_iterator3=_createForOfIteratorHelper(items),_context0.prev=6,_loop=_regenerator.default.mark(function _loop(){var item,row;return _regenerator.default.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:item=_step3.value,row=widgets.personTR(dom,ns.solid("instance"),item.instance,{deleteFunction:function(){var _deleteFunction=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(){return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=1,deleteTypeIndexRegistration(item);case 1:tbody.removeChild(row);case 2:case"end":return _context8.stop()}},_callee8)}));return function deleteFunction(){return _deleteFunction.apply(this,arguments)}}()}),row.children[0].style.paddingLeft="3em",tbody.appendChild(row);case 1:case"end":return _context9.stop()}},_loop)}),_iterator3.s();case 7:if((_step3=_iterator3.n()).done){_context0.next=9;break}return _context0.delegateYield(_loop(),"t0",8);case 8:_context0.next=7;break;case 9:_context0.next=11;break;case 10:_context0.prev=10,_t8=_context0.catch(6),_iterator3.e(_t8);case 11:return _context0.prev=11,_iterator3.f(),_context0.finish(11);case 12:_context0.next=4;break;case 13:_context0.next=15;break;case 14:_context0.prev=14,_t9=_context0.catch(3),_iterator2.e(_t9);case 15:return _context0.prev=15,_iterator2.f(),_context0.finish(15);case 16:return _context0.abrupt("return",context);case 17:case"end":return _context0.stop()}},_callee9,null,[[3,14,15,16],[6,10,11,12]])})),_registrationList.apply(this,arguments)}function renderSignInPopup(dom){var issuerPopup=dom.createElement("div");issuerPopup.setAttribute("style","position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center;"),dom.body.appendChild(issuerPopup);var issuerPopupBox=dom.createElement("div");issuerPopupBox.setAttribute("style","\n      background-color: white;\n      box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -webkit-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -moz-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -o-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n      min-width: 400px;\n      padding: 10px;\n      z-index : 10;\n    "),issuerPopup.appendChild(issuerPopupBox);var issuerPopupBoxTopMenu=dom.createElement("div");issuerPopupBoxTopMenu.setAttribute("style","\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: space-between;\n    "),issuerPopupBox.appendChild(issuerPopupBoxTopMenu);var issuerPopupBoxLabel=dom.createElement("label");issuerPopupBoxLabel.setAttribute("style","margin-right: 5px; font-weight: 800"),issuerPopupBoxLabel.innerText="Select an identity provider";var issuerPopupBoxCloseButton=dom.createElement("button");issuerPopupBoxCloseButton.innerHTML='<img src="https://solidos.github.io/solid-ui/src/icons/noun_1180156.svg" style="width: 2em; height: 2em;" title="Cancel">',issuerPopupBoxCloseButton.setAttribute("style","background-color: transparent; border: none;"),issuerPopupBoxCloseButton.addEventListener("click",function(){issuerPopup.remove()}),issuerPopupBoxTopMenu.appendChild(issuerPopupBoxLabel),issuerPopupBoxTopMenu.appendChild(issuerPopupBoxCloseButton);var loginToIssuer=function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(issuerUri){var preLoginRedirectHash,locationUrl,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_solidLogic.solidLogicSingleton.store.updater.flagAuthorizationMetadata(),(preLoginRedirectHash=new URL(window.location.href).hash)&&window.localStorage.setItem("preLoginRedirectHash",preLoginRedirectHash),window.localStorage.setItem("loginIssuer",issuerUri),(locationUrl=new URL(window.location.href)).hash="",_context.next=1,_solidLogic.authSession.login({redirectUrl:locationUrl.href,oidcIssuer:issuerUri});case 1:_context.next=3;break;case 2:_context.prev=2,_t=_context.catch(0),(0,_log.alert)(_t.message);case 3:case"end":return _context.stop()}},_callee,null,[[0,2]])}));return function loginToIssuer(_x1){return _ref.apply(this,arguments)}}(),issuerTextContainer=dom.createElement("div");issuerTextContainer.setAttribute("style","\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    ");var issuerTextInputContainer=dom.createElement("div");issuerTextInputContainer.setAttribute("style","\n      display: flex;\n      flex-direction: row;\n    ");var issuerTextLabel=dom.createElement("label");issuerTextLabel.innerText="Enter the URL of your identity provider:",issuerTextLabel.setAttribute("style","color: #888");var issuerTextInput=dom.createElement("input");issuerTextInput.setAttribute("type","text"),issuerTextInput.setAttribute("style","margin-left: 0 !important; flex: 1; margin-right: 5px !important"),issuerTextInput.setAttribute("placeholder","https://example.com"),issuerTextInput.value=localStorage.getItem("loginIssuer")||"";var issuerTextGoButton=dom.createElement("button");issuerTextGoButton.innerText="Go",issuerTextGoButton.setAttribute("style","margin-top: 12px; margin-bottom: 12px;"),issuerTextGoButton.addEventListener("click",function(){loginToIssuer(issuerTextInput.value)}),issuerTextContainer.appendChild(issuerTextLabel),issuerTextInputContainer.appendChild(issuerTextInput),issuerTextInputContainer.appendChild(issuerTextGoButton),issuerTextContainer.appendChild(issuerTextInputContainer),issuerPopupBox.appendChild(issuerTextContainer);var issuerButtonContainer=dom.createElement("div");issuerButtonContainer.setAttribute("style","\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    ");var issuerBottonLabel=dom.createElement("label");issuerBottonLabel.innerText="Or pick an identity provider from the list below:",issuerBottonLabel.setAttribute("style","color: #888"),issuerButtonContainer.appendChild(issuerBottonLabel),(0,_solidLogic.getSuggestedIssuers)().forEach(function(issuerInfo){var issuerButton=dom.createElement("button");issuerButton.innerText=issuerInfo.name,issuerButton.setAttribute("style","height: 38px; margin-top: 10px"),issuerButton.addEventListener("click",function(){loginToIssuer(issuerInfo.uri)}),issuerButtonContainer.appendChild(issuerButton)}),issuerPopupBox.appendChild(issuerButtonContainer)}function loginStatusBox(dom){var listener=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},me=(0,_solidLogic.offlineTestID)(),box=dom.createElement("div");function setIt(newidURI){newidURI&&(me=_solidLogic.authn.saveUser(newidURI),box.refresh(),listener&&listener(me.uri))}function logoutButtonHandler(_event){var oldMe=me;_solidLogic.authSession.logout().then(function(){var message="Your WebID was ".concat(oldMe,". It has been forgotten.");me=null;try{(0,_log.alert)(message)}catch(e){window.alert(message)}box.refresh(),listener&&listener(null)},function(err){(0,_log.alert)("Fail to log out:"+err)})}function trackSession(){me=_solidLogic.authn.currentUser(),box.refresh()}return box.refresh=function(){var sessionInfo=_solidLogic.authSession.info;((me=sessionInfo&&sessionInfo.webId&&sessionInfo.isLoggedIn?_solidLogic.solidLogicSingleton.store.sym(sessionInfo.webId):null)&&box.me!==me.uri||!me&&box.me)&&(widgets.clearElement(box),me?box.appendChild(function logoutButton(me,options){var signInButtonStyle=options.buttonStyle||style.signInAndUpButtonStyle,logoutLabel="WebID logout";if(me){var nick=_solidLogic.solidLogicSingleton.store.any(me,ns.foaf("nick"))||_solidLogic.solidLogicSingleton.store.any(me,ns.foaf("name"));nick&&(logoutLabel="Logout "+nick.value)}var signOutButton=dom.createElement("input");return signOutButton.setAttribute("type","button"),signOutButton.setAttribute("value",logoutLabel),signOutButton.setAttribute("style","".concat(signInButtonStyle)),signOutButton.addEventListener("click",logoutButtonHandler,!1),signOutButton}(me,options)):box.appendChild(function signInOrSignUpBox(dom,setUserCallback){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},signInButtonStyle=(options=options||{}).buttonStyle||style.signInAndUpButtonStyle,box=dom.createElement("div");debug.log("widgets.signInOrSignUpBox"),box.setUserCallback=setUserCallback,box.setAttribute("class","SolidSignInOrSignUpBox"),box.setAttribute("style","display:flex;");var signInPopUpButton=dom.createElement("input");box.appendChild(signInPopUpButton),signInPopUpButton.setAttribute("type","button"),signInPopUpButton.setAttribute("value","Log in"),signInPopUpButton.setAttribute("style","".concat(signInButtonStyle).concat(style.headerBannerLoginInput)+style.signUpBackground),_solidLogic.authSession.onLogin(function(){var me=_solidLogic.authn.currentUser();if(me){var webIdURI=me.uri,divs=dom.getElementsByClassName("SolidSignInOrSignUpBox");debug.log("Logged in, ".concat(divs.length," panels to be serviced"));for(var i=0;i<divs.length;i++){var div=divs[i];if(div.setUserCallback)try{div.setUserCallback(webIdURI);var parent=div.parentNode;parent&&parent.removeChild(div)}catch(e){debug.log("## Error satisfying login box: ".concat(e)),div.appendChild(widgets.errorMessageBlock(dom,e))}}}}),signInPopUpButton.addEventListener("click",function(){var offline=(0,_solidLogic.offlineTestID)();if(offline)return setUserCallback(offline.uri);renderSignInPopup(dom)},!1);var signupButton=dom.createElement("input");return box.appendChild(signupButton),signupButton.setAttribute("type","button"),signupButton.setAttribute("value","Sign Up for Solid"),signupButton.setAttribute("style","".concat(signInButtonStyle).concat(style.headerBannerLoginInput)+style.signInBackground),signupButton.addEventListener("click",function(_event){(new _signup.Signup).signup().then(function(uri){debug.log("signInOrSignUpBox signed up "+uri),setUserCallback(uri)})},!1),box}(dom,setIt,options))),box.me=me?me.uri:null},box.refresh(),trackSession(),_solidLogic.authSession.onLogin(trackSession),_solidLogic.authSession.onLogout(trackSession),box.me="99999",box.refresh(),box}function selectWorkspace(dom,appDetails,callbackWS){var noun=appDetails.noun,appPathSegment=appDetails.appPathSegment,me=(0,_solidLogic.offlineTestID)(),box=dom.createElement("div"),context={me,dom,div:box};function say(s,background){box.appendChild(widgets.errorMessageBlock(dom,s,background))}function figureOutBase(ws){var newBaseString,newBaseNode=_solidLogic.solidLogicSingleton.store.any(ws,ns.space("uriPrefix"));"/"!==(newBaseString=newBaseNode?newBaseNode.value:ws.uri.split("#")[0]).slice(-1)&&(debug.log("".concat(appPathSegment,": No / at end of uriPrefix ").concat(newBaseString)),newBaseString="".concat(newBaseString,"/"));var now=new Date;return newBaseString+="".concat(appPathSegment,"/id").concat(now.getTime(),"/")}return ensureLoadedPreferences(context).then(function displayOptions(context){function _makeNewWorkspace(){return _makeNewWorkspace=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(_event){var row,cell,newBase,newWs,newData,_t3;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return row=table.appendChild(dom.createElement("tr")),(cell=row.appendChild(dom.createElement("td"))).setAttribute("colspan","3"),cell.style.padding="0.5em",_t3=encodeURI,_context3.next=1,widgets.askName(dom,_solidLogic.solidLogicSingleton.store,cell,ns.solid("URL"),ns.space("Workspace"),"Workspace");case 1:if(newBase=_t3(_context3.sent),newWs=widgets.newThing(context.preferencesFile),newData=[(0,_rdflib.st)(context.me,ns.space("workspace"),newWs,context.preferencesFile),(0,_rdflib.st)(newWs,ns.space("uriPrefix"),newBase,context.preferencesFile)],_solidLogic.solidLogicSingleton.store.updater){_context3.next=2;break}throw new Error("store has no updater");case 2:return _context3.next=3,_solidLogic.solidLogicSingleton.store.updater.update([],newData);case 3:case"end":return _context3.stop()}},_callee3)})),_makeNewWorkspace.apply(this,arguments)}var id=context.me,preferencesFile=context.preferencesFile,newBase=null,w=_solidLogic.solidLogicSingleton.store.each(id,ns.space("workspace"),void 0,preferencesFile),storages=_solidLogic.solidLogicSingleton.store.each(id,ns.space("storage"));0===w.length&&storages&&(say("You don't seem to have any workspaces. You have ".concat(storages.length," storage spaces."),"white"),storages.map(function(s){return w=w.concat(_solidLogic.solidLogicSingleton.store.each(s,ns.ldp("contains")))}).filter(function(file){return file.id?["public","private"].includes(file.id().toLowerCase()):""})),1===w.length&&(say("Workspace used: ".concat(w[0].uri),"white"),newBase=figureOutBase(w[0]));var table=dom.createElement("table");table.setAttribute("style","border-collapse:separate; border-spacing: 0.5em;"),box.appendChild(table),box.appendChild(dom.createElement("hr"));var p=box.appendChild(dom.createElement("p"));p.setAttribute("style",style.commentStyle),p.textContent="Where would you like to store the data for the ".concat(noun,"?\n    Give the URL of the folder where you would like the data stored.\n    It can be anywhere in solid world - this URI is just an idea.");var baseField=box.appendChild(dom.createElement("input"));baseField.setAttribute("type","text"),baseField.setAttribute("style",style.textInputStyle),baseField.size=80,baseField.label="base URL",baseField.autocomplete="on",newBase&&(baseField.value=newBase),context.baseField=baseField,box.appendChild(dom.createElement("br"));var col1,col2,col3,tr,ws,localStyle,comment,button=box.appendChild(dom.createElement("button"));button.setAttribute("style",style.buttonStyle),button.textContent="Start new ".concat(noun," at this URI"),button.addEventListener("click",function(_event){var newBase=baseField.value.replace(" ","%20");"/"!==newBase.slice(-1)&&(newBase+="/"),callbackWS(null,newBase)}),w=w.filter(function(x){return!_solidLogic.solidLogicSingleton.store.holds(x,ns.rdf("type"),ns.space("MasterWorkspace"))});for(var cellStyle="height: 3em; margin: 1em; padding: 1em white; border-radius: 0.3em;",deselectedStyle="".concat(cellStyle,"border: 0px;"),i=0;i<w.length;i++){if(ws=w[i],tr=dom.createElement("tr"),0===i&&((col1=dom.createElement("td")).setAttribute("rowspan","".concat(w.length)),col1.textContent="Choose a workspace for this:",col1.setAttribute("style","vertical-align:middle;"),tr.appendChild(col1)),col2=dom.createElement("td"),!(localStyle=_solidLogic.solidLogicSingleton.store.anyValue(ws,ns.ui("style")))){var bgcolor="#".concat((16777215&function hash(x){return x.split("").reduce(function(a,b){return(a=(a<<5)-a+b.charCodeAt(0))&a},0)}(ws.uri)|12632256).toString(16));localStyle="color: black ; background-color: ".concat(bgcolor,";")}col2.setAttribute("style",deselectedStyle+localStyle),tr.target=ws.uri;var label=_solidLogic.solidLogicSingleton.store.any(ws,ns.rdfs("label"));label||(label=ws.uri.split("/").slice(-1)[0]||ws.uri.split("/").slice(-2)[0]),col2.textContent=label||"???",tr.appendChild(col2),0===i&&((col3=dom.createElement("td")).setAttribute("rowspan","".concat(w.length,"1")),col3.setAttribute("style","width:50%;"),tr.appendChild(col3)),table.appendChild(tr),comment=(comment=_solidLogic.solidLogicSingleton.store.any(ws,ns.rdfs("comment")))?comment.value:"Use this workspace",col2.addEventListener("click",function(_event){col3.textContent=comment?comment.value:"",col3.setAttribute("style",deselectedStyle+localStyle);var button=dom.createElement("button");button.textContent="Continue";var newBase=figureOutBase(ws);baseField.value=newBase,button.addEventListener("click",function(_event){button.disabled=!0,callbackWS(ws,newBase),button.textContent="----\x3e"},!0),col3.appendChild(button)},!0)}var trLast=dom.createElement("tr");(col2=dom.createElement("td")).setAttribute("style",cellStyle),col2.textContent="+ Make a new workspace",col2.addEventListener("click",function makeNewWorkspace(_x10){return _makeNewWorkspace.apply(this,arguments)}),trLast.appendChild(col2),table.appendChild(trLast)}).catch(function(err){box.appendChild(widgets.errorMessageBlock(context.dom,err))}),box}function getUserRoles(){return _getUserRoles.apply(this,arguments)}function _getUserRoles(){return(_getUserRoles=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee0(){var _yield$ensureLoadedPr,me,preferencesFile,preferencesFileError,_t0;return _regenerator.default.wrap(function(_context1){for(;;)switch(_context1.prev=_context1.next){case 0:return _context1.prev=0,_context1.next=1,ensureLoadedPreferences({});case 1:if(_yield$ensureLoadedPr=_context1.sent,me=_yield$ensureLoadedPr.me,preferencesFile=_yield$ensureLoadedPr.preferencesFile,preferencesFileError=_yield$ensureLoadedPr.preferencesFileError,preferencesFile&&!preferencesFileError){_context1.next=2;break}throw new Error(preferencesFileError);case 2:return _context1.abrupt("return",_solidLogic.solidLogicSingleton.store.each(me,ns.rdf("type"),null,preferencesFile.doc()));case 3:return _context1.prev=3,_t0=_context1.catch(0),debug.warn("Unable to fetch your preferences - this was the error: ",_t0),_context1.abrupt("return",[]);case 4:case"end":return _context1.stop()}},_callee0,null,[[0,3]])}))).apply(this,arguments)}function _filterAvailablePanes(){return(_filterAvailablePanes=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee1(panes){var userRoles;return _regenerator.default.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=1,getUserRoles();case 1:return userRoles=_context10.sent,_context10.abrupt("return",panes.filter(function(pane){return isMatchingAudience(pane,userRoles)}));case 2:case"end":return _context10.stop()}},_callee1)}))).apply(this,arguments)}function isMatchingAudience(pane,userRoles){return(pane.audience||[]).reduce(function(isMatch,audienceRole){return isMatch&&!!userRoles.find(function(role){return role.equals(audienceRole)})},!0)}_solidLogic.authSession.onLogout((0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(){var issuer,wellKnownUri,wellKnownResult,openidConfiguration;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!(issuer=window.localStorage.getItem("loginIssuer"))){_context2.next=6;break}return _context2.prev=1,_solidLogic.solidLogicSingleton.store.updater.flagAuthorizationMetadata(),(wellKnownUri=new URL(issuer)).pathname="/.well-known/openid-configuration",_context2.next=2,fetch(wellKnownUri.toString());case 2:if(200!==(wellKnownResult=_context2.sent).status){_context2.next=4;break}return _context2.next=3,wellKnownResult.json();case 3:if(!(openidConfiguration=_context2.sent)||!openidConfiguration.end_session_endpoint){_context2.next=4;break}return _context2.next=4,fetch(openidConfiguration.end_session_endpoint,{credentials:"include"});case 4:_context2.next=6;break;case 5:_context2.prev=5,_context2.catch(1);case 6:window.location.reload();case 7:case"end":return _context2.stop()}},_callee2,null,[[1,5]])})))},"./lib/matrix/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.matrix=void 0;var _matrix=__webpack_require__("./lib/matrix/matrix.js");exports.matrix={matrixForQuery:_matrix.matrixForQuery}},"./lib/matrix/matrix.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.matrixForQuery=function matrixForQuery(dom,query,vx,vy,vvalue,options,whenDone){var matrix=dom.createElement("table"),header=dom.createElement("tr");header.appendChild(dom.createElement("td")).setAttribute("class","MatrixCorner"),matrix.appendChild(header),matrix.lastHeader=header;var columns=[],rows=[],setCell=function setCell(cell,x,y,value){for(;cell.firstChild;)cell.removeChild(cell.firstChild);cell.setAttribute("style",""),cell.style.textAlign="center",options.cellFunction?options.cellFunction(cell,x,y,value):(cell.textContent=utils.label(value),cell.setAttribute("style","padding: 0.3em")),delete cell.old},rowFor=function rowFor(y1){var y=y1.toNT();if(rows[y])return rows[y];var tr=dom.createElement("tr"),header=tr.appendChild(dom.createElement("td"));header.setAttribute("style","padding: 0.3em;"),header.textContent=utils.label(y1),"NamedNode"===y1.termType&&kb.fetcher.nowOrWhenFetched(y1.uri.split("#")[0],void 0,function(ok,_body,_response){ok&&(header.textContent=utils.label(y1))});for(var i=0;i<columns.length;i++)setCell(tr.appendChild(dom.createElement("td")),$rdf.fromNT(columns[i]),y1,null);tr.dataValueNT=y,rows[y]=tr;for(var ele=matrix.lastHeader.nextSibling;ele;ele=ele.nextSibling)if(y>ele.dataValueNT&&options&&options.yDecreasing||y<ele.dataValueNT&&(!options||!options.yDecreasing))return matrix.insertBefore(tr,ele);return matrix.appendChild(tr)},columnNumberFor=function columnNumberFor(x1){for(var xNT=x1.toNT(),col=null,i=0;i<columns.length;i++){if(columns[i]===xNT)return i;if(xNT>columns[i]&&options.xDecreasing||xNT<columns[i]&&!options.xDecreasing){columns=columns.slice(0,i).concat([xNT]).concat(columns.slice(i)),col=i;break}}null===col&&(col=columns.length,columns.push(xNT));for(var row=matrix.firstChild;row;row=row.nextSibling){var y=row.dataValueNT,td=dom.createElement("td");if(td.style.textAlign="center",row===matrix.firstChild?td.textContent=utils.label(x1):setCell(td,x1,$rdf.fromNT(y),null),col===columns.length-1)row.appendChild(td);else{for(var t=row.firstChild,j=0;j<col+1;j++)t=t.nextSibling;row.insertBefore(td,t)}}return col},clearOldCells=function clearOldCells(){var row,cell,colsUsed=[],rowsUsed=[];if(options.set_y)for(var k=0;k<options.set_y.length;k++)rowsUsed[options.set_y[k]]=!0;if(options.set_x)for(var _k=0;_k<options.set_x.length;_k++)colsUsed[columnNumberFor(options.set_x[_k])+1]=!0;for(var i=1;i<matrix.children.length;i++){row=matrix.children[i];for(var j=1;j<row.children.length;j++)if((cell=row.children[j]).old){var y=$rdf.fromNT(row.dataValueNT),x=$rdf.fromNT(columns[j-1]);setCell(cell,x,y,null)}else rowsUsed[row.dataValueNT]=!0,colsUsed[j]=!0}for(var _i=0;_i<matrix.children.length;_i++)if(row=matrix.children[_i],_i>0&&!rowsUsed[row.dataValueNT])delete rows[row.dataValueNT],matrix.removeChild(row);else for(var _j=row.children.length-1;_j>0;_j--){var _cell=row.children[_j];colsUsed[_j]||row.removeChild(_cell)}for(var newcolumns=[],_j2=0;_j2<columns.length;_j2++)colsUsed[_j2+1]&&newcolumns.push(columns[_j2]);columns=newcolumns};matrix.refresh=function(){!function markOldCells(){for(var i=1;i<matrix.children.length;i++)for(var row=matrix.children[i],j=1;j<row.children.length;j++)row.children[j].old=!0}(),kb.query(query,addCellFromBindings,void 0,clearOldCells)};var addCellFromBindings=function addCellFromBindings(bindings){var x=bindings[vx.toString()],y=bindings[vy.toString()],value=bindings[vvalue.toString()],row=rowFor(y),colNo=columnNumberFor(x),cell=row.children[colNo+1];setCell(cell,x,y,value)};if(options.set_y)for(var k=0;k<options.set_y.length;k++)rowFor(options.set_y[k]);if(options.set_x)for(var _k2=0;_k2<options.set_x.length;_k2++)columnNumberFor(options.set_x[_k2]);return kb.query(query,addCellFromBindings,void 0,whenDone),matrix};var utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),$rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var kb=__webpack_require__("./node_modules/solid-logic/lib/index.js").solidLogicSingleton.store},"./lib/media/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.media=void 0;var _mediaCapture=__webpack_require__("./lib/media/media-capture.js");exports.media={cameraCaptureControl:_mediaCapture.cameraCaptureControl,cameraButton:_mediaCapture.cameraButton}},"./lib/media/media-capture.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.cameraButton=function cameraButton(dom,store,getImageDoc,doneCallback){var control,div=dom.createElement("div"),but=widgets.button(dom,cameraIcon,"Take picture");function restoreButton(_x){return _restoreButton.apply(this,arguments)}function _restoreButton(){return(_restoreButton=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(imageDoc){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:div.removeChild(control),div.appendChild(but),doneCallback(imageDoc);case 1:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}return div.appendChild(but),but.addEventListener("click",function(_event){div.removeChild(but),control=cameraCaptureControl(dom,store,getImageDoc,restoreButton),div.appendChild(control)}),div},exports.cameraCaptureControl=cameraCaptureControl;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var cameraIcon=_iconBase.icons.iconBase+"noun_Camera_1618446_000000.svg",retakeIcon=_iconBase.icons.iconBase+"noun_479395.svg",contentType="image/png";function cameraCaptureControl(dom,store,getImageDoc,doneCallback){var destination,imageBlob,player,canvas,div=dom.createElement("div"),table=div.appendChild(dom.createElement("table")),main=table.appendChild(dom.createElement("tr")).appendChild(dom.createElement("td"));main.setAttribute("colspan","4");var buttons=table.appendChild(dom.createElement("tr"));buttons.appendChild(dom.createElement("td")).appendChild(widgets.cancelButton(dom)).addEventListener("click",function(_event){stopVideo(),doneCallback(null)});var retakeButton=buttons.appendChild(dom.createElement("td")).appendChild(widgets.button(dom,retakeIcon,"Retake"));retakeButton.addEventListener("click",function(_event){!function retake(){main.removeChild(canvas),displayPlayer()}()}),retakeButton.style.visibility="collapse";var shutterButton=buttons.appendChild(dom.createElement("td")).appendChild(widgets.button(dom,_iconBase.icons.iconBase+"noun_10636.svg","Snap"));shutterButton.addEventListener("click",function grabCanvas(){(canvas=dom.createElement("canvas")).setAttribute("width",style.canvasWidth),canvas.setAttribute("height",style.canvasHeight),canvas.setAttribute("style",style.controlStyle),main.appendChild(canvas),canvas.getContext("2d").drawImage(player,0,0,canvas.width,canvas.height),player.parentNode.removeChild(player),canvas.toBlob(function(blob){var msg="got blob type ".concat(blob.type," size ").concat(blob.size);debug.log(msg),destination=getImageDoc(),imageBlob=blob,function reviewImage(){sendButton.style.visibility="visible",retakeButton.style.visibility="visible",shutterButton.style.visibility="collapse"}()},contentType)}),shutterButton.style.visibility="collapse";var sendButton=buttons.appendChild(dom.createElement("td")).appendChild(widgets.continueButton(dom));function displayPlayer(){if((player=main.appendChild(dom.createElement("video"))).setAttribute("controls","1"),player.setAttribute("autoplay","1"),player.setAttribute("style",style.controlStyle),!navigator.mediaDevices)throw new Error("navigator.mediaDevices not available");navigator.mediaDevices.getUserMedia(constraints).then(function(stream){player.srcObject=stream,shutterButton.style.visibility="visible",sendButton.style.visibility="collapse",retakeButton.style.visibility="collapse"})}sendButton.addEventListener("click",function(_event){!function saveBlob(blob,destination){var contentType=blob.type;debug.log("Putting "+blob.size+" bytes of "+contentType+" to "+destination),store.fetcher.webOperation("PUT",destination.uri,{data:blob,contentType}).then(function(_resp){debug.log("ok saved "+destination),stopVideo(),doneCallback(destination)},function(err){stopVideo(),alert(err)})}(imageBlob,destination)}),sendButton.style.visibility="collapse";var constraints={video:!0};function stopVideo(){player&&player.srcObject&&player.srcObject.getVideoTracks().forEach(function(track){return track.stop()})}return displayPlayer(),div}},"./lib/messageArea.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.messageArea=function messageArea(dom,kb,subject,messageStore,options){kb=kb||_solidLogic.solidLogicSingleton.store,messageStore=messageStore.doc();var messageTable,me,ns=UI.ns,WF=rdf.Namespace("http://www.w3.org/2005/01/wf/flow#"),DCT=rdf.Namespace("http://purl.org/dc/terms/"),newestFirst=!!(options=options||{}).newestFirst,messageBodyStyle="white-space: pre-wrap; width: 90%; font-size:100%; border: 0.07em solid #eee; padding: .2em 0.5em; margin: 0.1em 1em 0.1em 1em;",div=dom.createElement("div"),updater=_solidLogic.solidLogicSingleton.store.updater,anchor=function anchor(text,term){var a=dom.createElement("a");return term&&term.uri&&(a.setAttribute("href",term.uri),a.addEventListener("click",UI.widgets.openHrefInOutlineMode,!0),a.setAttribute("style","color: #3B5998; text-decoration: none; ")),a.textContent=text,a},mention=function mention(message,style){var pre=dom.createElement("pre");return pre.setAttribute("style",style||"color: grey"),div.appendChild(pre),pre.appendChild(dom.createTextNode(message)),pre},announce={log:function log(message){mention(message,"color: #111;")},warn:function warn(message){mention(message,"color: #880;")},error:function error(message){mention(message,"color: #800;")}};function nick(person){var s=_solidLogic.solidLogicSingleton.store.any(person,UI.ns.foaf("nick"));return s?""+s.value:""+utils.label(person)}function creatorAndDate(td1,creator,date,message){var nickAnchor=td1.appendChild(anchor(nick(creator),creator));creator.uri&&_solidLogic.solidLogicSingleton.store.fetcher.nowOrWhenFetched(creator.doc(),void 0,function(_ok,_body){nickAnchor.textContent=nick(creator)}),td1.appendChild(dom.createElement("br")),td1.appendChild(anchor(date,message))}function syncMessages(about,messageTable){var ele,ele2,displayed={};for(ele=messageTable.firstChild;ele;ele=ele.nextSibling)ele.AJAR_subject&&(displayed[ele.AJAR_subject.uri]=!0);var messages=kb.each(about,ns.wf("message")),stored={};for(messages.forEach(function(m){stored[m.uri]=!0,displayed[m.uri]||addMessage(m)}),ele=messageTable.firstChild;ele;)ele2=ele.nextSibling,ele.AJAR_subject&&!stored[ele.AJAR_subject.uri]&&messageTable.removeChild(ele),ele=ele2}var addMessage=function addMessage(message){var bindings={"?msg":message,"?creator":kb.any(message,ns.foaf("maker")),"?date":kb.any(message,DCT("created")),"?content":kb.any(message,ns.sioc("content"))};renderMessage(bindings,!0)},renderMessage=function renderMessage(bindings,fresh){var creator=bindings["?creator"],message=bindings["?msg"],date=bindings["?date"],content=bindings["?content"],dateString=date.value,tr=dom.createElement("tr");tr.AJAR_date=dateString,tr.AJAR_subject=message;for(var done=!1,ele=messageTable.firstChild;ele;ele=ele.nextSibling)if(dateString>ele.AJAR_date&&newestFirst||dateString<ele.AJAR_date&&!newestFirst){messageTable.insertBefore(tr,ele),done=!0;break}done||messageTable.appendChild(tr);var td1=dom.createElement("td");tr.appendChild(td1),creatorAndDate(td1,creator,UI.widgets.shortDate(dateString),message);var td2=dom.createElement("td");tr.appendChild(td2);var pre=dom.createElement("p");pre.setAttribute("style",messageBodyStyle+(fresh?"background-color: #e8ffe8;":"background-color: #white;")),td2.appendChild(pre),pre.textContent=content.value;var td3=dom.createElement("td");tr.appendChild(td3);var delButton=dom.createElement("button");td3.appendChild(delButton),delButton.textContent="-",tr.setAttribute("class","hoverControl"),delButton.setAttribute("class","hoverControlHide"),delButton.setAttribute("style","color: red;"),delButton.addEventListener("click",function(_event){td3.removeChild(delButton);var cancelButton=dom.createElement("button");cancelButton.textContent="cancel",td3.appendChild(cancelButton).addEventListener("click",function(_event){td3.removeChild(sureButton),td3.removeChild(cancelButton),td3.appendChild(delButton)},!1);var sureButton=dom.createElement("button");sureButton.textContent="Delete message",td3.appendChild(sureButton).addEventListener("click",function(_event){td3.removeChild(sureButton),td3.removeChild(cancelButton),function deleteMessage(message){var deletions=kb.statementsMatching(message).concat(kb.statementsMatching(void 0,void 0,message));updater.update(deletions,[],function(uri,ok,body){ok?syncMessages(subject,messageTable):announce.error("Cant delete messages:"+body)})}(message)},!1)},!1)};(messageTable=dom.createElement("table")).fresh=!1,div.appendChild(messageTable),messageTable.setAttribute("style","width: 100%;");var query,tr=function newMessageForm(){var form=dom.createElement("tr"),lhs=dom.createElement("td"),middle=dom.createElement("td"),rhs=dom.createElement("td");form.appendChild(lhs),form.appendChild(middle),form.appendChild(rhs),form.AJAR_date="9999-01-01T00:00:00Z";var field,sendButton,sendMessage=function sendMessage(){field.setAttribute("class","pendingedit"),field.disabled=!0;var sts=[],now=new Date,timestamp=""+now.getTime(),dateStamp=rdf.term(now),message=kb.sym(messageStore.uri+"#Msg"+timestamp);sts.push(new rdf.Statement(subject,ns.wf("message"),message,messageStore)),sts.push(new rdf.Statement(message,ns.sioc("content"),kb.literal(field.value),messageStore)),sts.push(new rdf.Statement(message,DCT("created"),dateStamp,messageStore)),me&&sts.push(new rdf.Statement(message,ns.foaf("maker"),me,messageStore)),updater.update([],sts,function sendComplete(uri,success,body){if(success){var bindings={"?msg":message,"?content":kb.literal(field.value),"?date":dateStamp,"?creator":me};renderMessage(bindings,!1),field.value="",field.setAttribute("class",""),field.disabled=!1}else form.appendChild(UI.widgets.errorMessageBlock(dom,"Error writing message: "+body))})};form.appendChild(dom.createElement("br"));var context={div:middle,dom};return login.ensureLoggedIn(context).then(function(context){me=context.me,function turnOnInput(){creatorAndDate(lhs,me,"",null),field=dom.createElement("textarea"),middle.innerHTML="",middle.appendChild(field),field.rows=3,field.setAttribute("style",messageBodyStyle+"background-color: #eef;"),field.addEventListener("keyup",function(e){13===e.keyCode&&(e.altKey||sendMessage())},!1),rhs.innerHTML="",(sendButton=UI.widgets.button(dom,UI.icons.iconBase+"noun_383448.svg","Send")).setAttribute("style",UI.style.buttonStyle+"float: right;"),sendButton.addEventListener("click",sendMessage,!1),rhs.appendChild(sendButton)}()}),form}();newestFirst?messageTable.insertBefore(tr,messageTable.firstChild):messageTable.appendChild(tr);if(options.query)query=options.query;else{query=new rdf.Query("Messages");var v={};["msg","date","creator","content"].forEach(function(x){query.vars.push(v[x]=rdf.variable(x))}),query.pat.add(subject,WF("message"),v.msg),query.pat.add(v.msg,ns.dct("created"),v.date),query.pat.add(v.msg,ns.foaf("maker"),v.creator),query.pat.add(v.msg,ns.sioc("content"),v.content)}return kb.query(query,renderMessage,void 0,function doneQuery(){messageTable.fresh=!0}),div.refresh=function(){syncMessages(subject,messageTable)},div};var _iconBase=__webpack_require__("./lib/iconBase.js"),login=_interopRequireWildcard(__webpack_require__("./lib/login/login.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var UI={icons:_iconBase.icons,ns,rdf,style,widgets}},"./lib/ns.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js"),_solidNamespace=_interopRequireDefault(__webpack_require__("./node_modules/solid-namespace/index.js")),$rdf=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./node_modules/rdflib/esm/index.js"));module.exports=(0,_solidNamespace.default)($rdf)},"./lib/pad.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChunks=getChunks,exports.lightColorHash=lightColorHash,Object.defineProperty(exports,"manageParticipation",{enumerable:!0,get:function get(){return _participation.manageParticipation}}),exports.notepad=function notepad(dom,padDoc,subject,me,options){var exists=(options=options||{}).exists,table=dom.createElement("table"),kb=store;if(me&&!me.uri)throw new Error("UI.pad.notepad:  Invalid userid");var updater=store.updater,PAD=(0,_rdflib.Namespace)("http://www.w3.org/ns/pim/pad#");table.setAttribute("style",style.notepadStyle);var upstreamStatus=null,downstreamStatus=null;if(options.statusArea){var tr=options.statusArea.appendChild(dom.createElement("table")).appendChild(dom.createElement("tr"));upstreamStatus=tr.appendChild(dom.createElement("td")),downstreamStatus=tr.appendChild(dom.createElement("td")),upstreamStatus&&upstreamStatus.setAttribute("style",style.upstreamStatus),downstreamStatus&&downstreamStatus.setAttribute("style",style.downstreamStatus)}var complain=function complain(message){var upstream=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,_debug.log)(message),options.statusArea&&(upstream?upstreamStatus:downstreamStatus).appendChild((0,_widgets.errorMessageBlock)(dom,message,"pink"))},clearStatus=function clearStatus(_upsteam){options.statusArea&&(options.statusArea.innerHTML="")},setPartStyle=function setPartStyle(part,colors,pending){var chunk=part.subject;colors=colors||"";var baseStyle=style.baseStyle,headingCore=style.headingCore,headingStyle=style.headingStyle,author=kb.any(chunk,ns.dc("author"));!colors&&author&&(colors="color: "+(pending?"#888":"black")+"; background-color: "+lightColorHash(author)+";");var indent=kb.any(chunk,PAD("indent")),localStyle=(indent=indent?indent.value:0)>=0?baseStyle+"text-indent: "+3*indent+"em;":headingCore+headingStyle[-1-indent];part.setAttribute("style",localStyle+colors)},removePart=function removePart(part){var chunk=part.subject;if(!chunk)throw new Error("No chunk for line to be deleted!");var prev=kb.any(void 0,PAD("next"),chunk),next=kb.any(chunk,PAD("next"));if(prev.sameTerm(subject)&&next.sameTerm(subject))(0,_debug.log)("You can't delete the only line.");else{var del=kb.statementsMatching(chunk,void 0,void 0,padDoc).concat(kb.statementsMatching(void 0,void 0,chunk,padDoc)),ins=[(0,_rdflib.st)(prev,PAD("next"),next,padDoc)];if(chunk instanceof _rdflib.NamedNode){var label=chunk.uri.slice(-4);(0,_debug.log)("Deleting line "+label)}if(!updater)throw new Error("have no updater");updater.update(del,ins,function(uri,ok,errorMessage,response){if(ok){var row=part.parentNode;if(row){var before=row.previousSibling;row.parentNode&&row.parentNode.removeChild(row),before&&before.firstChild&&before.firstChild.focus()}}else if(response&&409===response.status)setPartStyle(part,"color: black;  background-color: #ffd;"),part.state=0,(0,_utils.beep)(.5,512),setTimeout(function(){reloadAndSync()},1e3);else{(0,_debug.log)("    removePart FAILED "+chunk+": "+errorMessage),(0,_debug.log)("    removePart was deleteing :'"+del),setPartStyle(part,"color: black;  background-color: #fdd;");var res=response?response.status:" [no response field] ";complain("Error "+res+" saving changes: "+errorMessage.true)}})}},addListeners=function addListeners(part,chunk){part.addEventListener("keydown",function(event){if(!updater)throw new Error("no updater");var queueProperty,queue;switch(event.keyCode){case 13:var before=event.shiftKey;if((0,_debug.log)("enter"),before?(queue=kb.any(void 0,PAD("next"),chunk),queueProperty="newlinesAfter"):(queue=kb.any(chunk,PAD("next")),queueProperty="newlinesBefore"),queue[queueProperty]=queue[queueProperty]||0,queue[queueProperty]+=1,queue[queueProperty]>1)return void(0,_debug.log)("    queueing newline queue = "+queue[queueProperty]);(0,_debug.log)("    go ahead line before "+queue[queueProperty]),_newChunk(part,before);break;case 8:if(0===part.value.length)switch((0,_debug.log)("Delete key line "+chunk.uri.slice(-4)+" state "+part.state),part.state){case 1:case 2:return void(part.state=4);case 3:case 4:return;case void 0:case 0:part.state=3,removePart(part),event.preventDefault();break;default:throw new Error("pad: Unexpected state "+part)}break;case 9:var delta=event.shiftKey?-1:1;!function changeIndent(part,chunk,delta){var del=kb.statementsMatching(chunk,PAD("indent")),current=del.length?Number(del[0].object.value):0;if(!(current+delta<-3)){var newIndent=current+delta,ins=(0,_rdflib.st)(chunk,PAD("indent"),newIndent,padDoc);if(!updater)throw new Error("no updater");updater.update(del,ins,function(uri,ok,errorBody){ok?setPartStyle(part):((0,_debug.log)("Indent change FAILED '"+newIndent+"' for "+padDoc+": "+errorBody),setPartStyle(part,"color: black;  background-color: #fdd;"),updater.requestDownstreamAction(padDoc,reloadAndSync))})}}(part,chunk,delta),event.preventDefault();break;case 27:(0,_debug.log)("escape"),updater.requestDownstreamAction(padDoc,reloadAndSync),event.preventDefault();break;case 38:part.parentNode.previousSibling&&(part.parentNode.previousSibling.firstChild.focus(),event.preventDefault());break;case 40:part.parentNode.nextSibling&&(part.parentNode.nextSibling.firstChild.focus(),event.preventDefault())}});var _updateStore=function updateStore(part){var chunk=part.subject;setPartStyle(part,void 0,!0);var ins,old=kb.any(chunk,ns.sioc("content")).value,del=[(0,_rdflib.st)(chunk,ns.sioc("content"),old,padDoc)];part.value&&(ins=[(0,_rdflib.st)(chunk,ns.sioc("content"),part.value,padDoc)]);var newOne=part.value;if(part.lastSent&&old!==part.lastSent)throw new Error("Out of order, last sent expected '"+old+"' but found '"+part.lastSent+"'");if(part.lastSent=newOne,!updater)throw new Error("no updater");updater.update(del,ins,function(uri,ok,errorBody,xhr){ok?(clearStatus(),setPartStyle(part),(0,_debug.log)("    Patch ok '"+old+"' -> '"+newOne+"' "),4===part.state?(part.state=3,removePart(part)):3===part.state||(2===part.state?(part.state=1,_updateStore(part)):part.state=0)):((0,_debug.log)("    patch FAILED "+xhr.status+" for '"+old+"' -> '"+newOne+"': "+errorBody),409===xhr.status?(setPartStyle(part,"color: black;  background-color: #fdd;"),part.state=0,(0,_utils.beep)(.5,512),setTimeout(function(){updater.requestDownstreamAction(padDoc,reloadAndSync)},1e3)):(setPartStyle(part,"color: black;  background-color: #fdd;"),part.state=0,complain("    Error "+xhr.status+" sending data: "+errorBody,!0),(0,_utils.beep)(1,128)))})};part.addEventListener("input",function inputChangeListener(_event){switch(setPartStyle(part,void 0,!0),(0,_debug.log)("Input event state "+part.state+" value '"+part.value+"'"),part.state){case 3:case 4:case 2:return;case 1:return void(part.state=2);case 0:case void 0:part.state=1,_updateStore(part)}})},newPartAfter=function newPartAfter(tr1,chunk,before){var text=kb.any(chunk,ns.sioc("content"));text=text?text.value:"";var tr=dom.createElement("tr");before?table.insertBefore(tr,tr1):tr1&&tr1.nextSibling?table.insertBefore(tr,tr1.nextSibling):table.appendChild(tr);var part=tr.appendChild(dom.createElement("input"));return part.subject=chunk,part.setAttribute("type","text"),part.value=text,me?(setPartStyle(part,""),addListeners(part,chunk)):(setPartStyle(part,"color: #222; background-color: #fff"),(0,_debug.log)("Note can't add listeners - not logged in")),part},_newChunk=function newChunk(ele,before){var here,prev,next,queue,tr1,kb=store,indent=0,queueProperty=null;ele?("input"!==ele.tagName.toLowerCase()&&(0,_debug.log)("return pressed when current document is: "+ele.tagName),here=ele.subject,indent=(indent=kb.any(here,PAD("indent")))?Number(indent.value):0,before?(prev=kb.any(void 0,PAD("next"),here),next=here,queue=prev,queueProperty="newlinesAfter"):(prev=here,next=kb.any(here,PAD("next")),queue=next,queueProperty="newlinesBefore"),tr1=ele.parentNode):(prev=subject,next=subject,tr1=void 0);var chunk=(0,_widgets.newThing)(padDoc),label=chunk.uri.slice(-4),del=[(0,_rdflib.st)(prev,PAD("next"),next,padDoc)],ins=[(0,_rdflib.st)(prev,PAD("next"),chunk,padDoc),(0,_rdflib.st)(chunk,PAD("next"),next,padDoc),(0,_rdflib.st)(chunk,ns.dc("author"),me,padDoc),(0,_rdflib.st)(chunk,ns.sioc("content"),"",padDoc)];if(indent>0&&ins.push((0,_rdflib.st)(chunk,PAD("indent"),indent,padDoc)),(0,_debug.log)("    Fresh chunk "+label+" proposed"),!updater)throw new Error("no updater");updater.update(del,ins,function(uri,ok,errorBody,_xhr){if(ok){var newPart=newPartAfter(tr1,chunk,before);setPartStyle(newPart),newPart.focus(),queueProperty&&((0,_debug.log)("    Fresh chunk "+label+" updated, queue = "+queue[queueProperty]),queue[queueProperty]-=1,queue[queueProperty]>0&&((0,_debug.log)("    Implementing queued newlines = "+next.newLinesBefore),_newChunk(newPart,before)))}else(0,_debug.log)("    ERROR writing new line "+label+": "+errorBody)})},consistencyCheck=function consistencyCheck(){var found={},failed=0;function complain2(msg){complain(msg),failed++}if(!kb.the(subject,PAD("next")))return complain2("No initial next pointer"),!1;for(var chunk,prev=subject;(chunk=kb.the(prev,PAD("next")))||complain2("No next pointer from "+prev),!chunk.sameTerm(subject);){prev=chunk;var label=chunk.uri.split("#")[1];if(found[chunk.uri])return complain2("Loop!"),!1;found[chunk.uri]=!0;var k=kb.each(chunk,PAD("next")).length;1!==k&&complain2("Should be 1 not "+k+" next pointer for "+label),(k=kb.each(chunk,PAD("indent")).length)>1&&complain2("Should be 0 or 1 not "+k+" indent for "+label),1!==(k=kb.each(chunk,ns.sioc("content")).length)&&complain2("Should be 1 not "+k+" contents for "+label),1!==(k=kb.each(chunk,ns.dc("author")).length)&&complain2("Should be 1 not "+k+" author for "+label),kb.statementsMatching(void 0,ns.sioc("contents")).forEach(function(st){found[st.subject.value]||complain2("Loose chunk! "+st.subject.value)})}return!failed},sync=function sync(){if(1!==kb.each(subject,PAD("next")).length){var msg="Pad: Inconsistent data - NEXT pointers: "+kb.each(subject,PAD("next")).length;return(0,_debug.log)(msg),void(options.statusArea&&(options.statusArea.textContent+=msg))}for(var row,manif=[],chunk=kb.the(subject,PAD("next"));!chunk.sameTerm(subject);chunk=kb.the(chunk,PAD("next")))for(var i=0;i<table.children.length;i++){var _tr=table.children[i];_tr.firstChild&&_tr.firstChild.subject.sameTerm(chunk)&&(manif[chunk.uri]=_tr.firstChild)}for(var _i=table.children.length-1;_i>=0;_i--)manif[(row=table.children[_i]).firstChild.subject.uri]||table.removeChild(row);row=table.firstChild;for(var _chunk=kb.the(subject,PAD("next"));!_chunk.sameTerm(subject);_chunk=kb.the(_chunk,PAD("next"))){var text=kb.any(_chunk,ns.sioc("content")).value;if(row&&manif[_chunk.uri]){var part=row.firstChild;text!==part.value&&(part.value=text),setPartStyle(part),part.state=0,delete part.lastSent,row=row.nextSibling}else newPartAfter(row,_chunk,!0)}},_refreshTree=function refreshTree(root){if(root.refresh)root.refresh();else for(var i=0;i<root.children.length;i++)_refreshTree(root.children[i])},reloading=!1,reloadAndSync=function reloadAndSync(){if(reloading)(0,_debug.log)("   Already reloading - stop");else{reloading=!0;var retryTimeout=1e3,_tryReload=function tryReload(){if((0,_debug.log)("try reload - timeout = "+retryTimeout),!updater)throw new Error("no updater");updater.reload(updater.store,padDoc,function(ok,message,xhr){reloading=!1,ok?function checkAndSync(){(0,_debug.log)("    reloaded OK"),clearStatus(),consistencyCheck()?_refreshTree(table):complain("CONSISTENCY CHECK FAILED")}():0===xhr.status?(complain("Network error refreshing the pad. Retrying in "+retryTimeout/1e3),reloading=!0,retryTimeout*=2,setTimeout(_tryReload,retryTimeout)):complain("Error "+xhr.status+"refreshing the pad:"+message+". Stopped. "+padDoc)})};_tryReload()}};table.refresh=sync,table.reloadAndSync=reloadAndSync,me||(0,_debug.log)("Warning: must be logged in for pad to be edited");if(exists)(0,_debug.log)("Existing pad."),consistencyCheck()?(sync(),kb.holds(subject,PAD("next"),subject)&&_newChunk()):(0,_debug.log)(table.textContent="Inconsistent data. Abort");else{(0,_debug.log)("No pad exists - making new one.");var insertables=[(0,_rdflib.st)(subject,ns.rdf("type"),PAD("Notepad"),padDoc),(0,_rdflib.st)(subject,ns.dc("author"),me,padDoc),(0,_rdflib.st)(subject,ns.dc("created"),new Date,padDoc),(0,_rdflib.st)(subject,PAD("next"),subject,padDoc)];if(!updater)throw new Error("no updater");updater.update([],insertables,function(uri,ok,errorBody){ok?((0,_debug.log)("Initial pad created"),_newChunk()):complain(errorBody||"")})}return table},exports.notepadToHTML=function notepadToHTML(pad,kb){var chunks=getChunks(pad,kb),html="<html>\n  <head>\n",title=kb.anyValue(pad,ns.dct("title"));title&&(html+="    <title>".concat(xmlEncode(title),"</title>\n"));html+="  </head>\n  <body>\n";var level=0;function decreaseLevel(indent){for(;level>indent;level--)html+="</ul>\n"}return chunks.forEach(function(chunk){var indent=kb.anyJS(chunk,PAD("indent")),rawContent=kb.anyJS(chunk,ns.sioc("content"));if(rawContent){var content=xmlEncode(rawContent);if(indent<0){decreaseLevel(0);var h=indent>=-3?4+indent:1;html+="\n<h".concat(h,">").concat(content,"</h").concat(h,">\n")}else indent>0?(decreaseLevel(indent),function increaseLevel(indent){for(;level<indent;level++)html+="<ul>\n"}(indent),html+="<li>".concat(content,"</li>\n")):(decreaseLevel(indent),html+="<p>".concat(content,"</p>\n"))}}),decreaseLevel(0),html+="  </body>\n</html>\n"},Object.defineProperty(exports,"participationObject",{enumerable:!0,get:function get(){return _participation.participationObject}}),Object.defineProperty(exports,"recordParticipation",{enumerable:!0,get:function get(){return _participation.recordParticipation}}),Object.defineProperty(exports,"renderParticipants",{enumerable:!0,get:function get(){return _participation.renderParticipants}}),exports.xmlEncode=xmlEncode;_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/inherits.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/wrapNativeSuper.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js"));var ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_widgets=__webpack_require__("./lib/widgets/index.js"),_utils=__webpack_require__("./lib/utils/index.js"),_debug=__webpack_require__("./lib/debug.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_participation=__webpack_require__("./lib/participation.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var store=_solidLogic.solidLogicSingleton.store,PAD=(0,_rdflib.Namespace)("http://www.w3.org/ns/pim/pad#");function lightColorHash(author){return author&&author.uri?"#"+(16777215&function hash(x){return x.split("").reduce(function(a,b){return(a=(a<<5)-a+b.charCodeAt(0))&a},0)}(author.uri)|12632256).toString(16):"#ffffff"}function getChunks(subject,kb){for(var chunks=[],chunk=kb.the(subject,PAD("next"));!chunk.sameTerm(subject);chunk=kb.the(chunk,PAD("next")))chunks.push(chunk);return chunks}function xmlEncode(str){return str.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}},"./lib/participation.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.manageParticipation=function manageParticipation(dom,container,padDoc,subject,me,options){var table=dom.createElement("table");container.appendChild(table),renderParticipants(dom,table,padDoc,subject,me,options);try{recordParticipation(subject,padDoc,table)}catch(e){container.appendChild((0,_widgets.errorMessageBlock)(dom,"Error recording your participation: "+e))}return table},exports.participationObject=function participationObject(subject,padDoc,me){return new Promise(function(resolve,reject){if(!me)throw new Error("No user id");var parps=store.each(subject,ns.wf("participation")).filter(function(pn){return store.holds(pn,ns.wf("participant"),me)});if(parps.length>1){var _step,candidates=[],_iterator=function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}(parps);try{for(_iterator.s();!(_step=_iterator.n()).done;){var participation=_step.value,date=store.anyValue(participation,ns.cal("dtstart"));date&&candidates.push([date,participation])}}catch(err){_iterator.e(err)}finally{_iterator.f()}candidates.sort(),debug.warn("Multiple participation objects, picking earliest, in "+padDoc),resolve(candidates[0][1])}if(parps.length)resolve(parps[0]);else{var _participation2=(0,_widgets.newThing)(padDoc),ins=[(0,_rdflib.st)(subject,ns.wf("participation"),_participation2,padDoc),(0,_rdflib.st)(_participation2,ns.wf("participant"),me,padDoc),(0,_rdflib.st)(_participation2,ns.cal("dtstart"),new Date,padDoc),(0,_rdflib.st)(_participation2,ns.ui("backgroundColor"),(0,_pad.lightColorHash)(me),padDoc)];store.updater.update([],ins,function(uri,ok,errorMessage){ok?resolve(_participation2):reject(new Error("Error recording your participation: "+errorMessage))}),resolve(_participation2)}})},exports.recordParticipation=recordParticipation,exports.renderParticipants=renderParticipants;_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/inherits.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/wrapNativeSuper.js")),_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js"));var _debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),debug=_debug,_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_widgets=__webpack_require__("./lib/widgets/index.js"),_utils=__webpack_require__("./lib/utils/index.js"),_pad=__webpack_require__("./lib/pad.js"),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_styleConstants=_interopRequireDefault(__webpack_require__("./lib/styleConstants.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var store=_solidLogic.solidLogicSingleton.store;function renderParticipants(dom,table,unused1,subject,unused2,options){table.setAttribute("style",style.participantsStyle);var newRowForParticipation=function newRowForParticipation(parp){var tr,person=store.any(parp,ns.wf("participant"));if(!person)return(tr=dom.createElement("tr")).textContent="???",tr;var bg=store.anyValue(parp,ns.ui("backgroundColor"))||_styleConstants.default.participationDefaultBackground,block=dom.createElement("div");block.setAttribute("style",style.participantsBlock),block.style.backgroundColor=bg,tr=(0,_widgets.personTR)(dom,null,person,options),table.appendChild(tr);var td=dom.createElement("td");return td.setAttribute("style",style.personTableTD),td.appendChild(block),tr.insertBefore(td,tr.firstChild),tr},syncTable=function syncTable(){var parps=store.each(subject,ns.wf("participation")).map(function(parp){return(0,_debug.log)("in participants"),[store.anyValue(parp,ns.cal("dtstart"))||"9999-12-31",parp]});parps.sort();var participations=parps.map(function(p){return p[1]});(0,_utils.syncTableToArray)(table,participations,newRowForParticipation)};return table.refresh=syncTable,syncTable(),table}function recordParticipation(subject,padDoc,refreshable){var me=_solidLogic.authn.currentUser();if(me){var parps=store.each(subject,ns.wf("participation")).filter(function(pn){return store.holds(pn,ns.wf("participant"),me)});if(parps.length>1)throw new Error("Multiple records of your participation");if(parps.length)return parps[0];if(!store.updater.editable(padDoc))return debug.log("Not recording participation, as no write access as "+me+" to "+padDoc),null;var participation=(0,_widgets.newThing)(padDoc),ins=[(0,_rdflib.st)(subject,ns.wf("participation"),participation,padDoc),(0,_rdflib.st)(participation,ns.wf("participant"),me,padDoc),(0,_rdflib.st)(participation,ns.cal("dtstart"),new Date,padDoc),(0,_rdflib.st)(participation,ns.ui("backgroundColor"),(0,_pad.lightColorHash)(me),padDoc)];return store.updater.update([],ins,function(uri,ok,errorMessage){if(!ok)throw new Error("Error recording your participation: "+errorMessage);refreshable&&refreshable.refresh&&refreshable.refresh()}),participation}}},"./lib/preferences.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=function get(k){return value[k]},exports.getPreferencesForClass=function getPreferencesForClass(subject,theClass,predicates,context){return new Promise(function(resolve,reject){recordSharedPreferences(subject,context).then(function(context){var sharedPreferences=context.sharedPreferences;if(context.me)participation.participationObject(subject,subject.doc(),context.me).then(function(participation){recordPersonalDefaults(theClass,context).then(function(context){var results=[],personalDefaults=context.personalDefaults;predicates.forEach(function(pred){var v1=kb.any(participation,pred)||kb.any(sharedPreferences,pred)||kb.any(personalDefaults,pred);v1&&(results[pred.uri]=toJS(v1))}),resolve(results)},reject)},reject);else{var results=[];predicates.forEach(function(pred){var v1=kb.any(sharedPreferences,pred);v1&&(results[pred.uri]=toJS(v1))}),resolve(results)}})})},exports.recordPersonalDefaults=recordPersonalDefaults,exports.recordSharedPreferences=recordSharedPreferences,exports.renderPreferencesForm=function renderPreferencesForm(subject,theClass,preferencesForm,context){var prefContainer=context.dom.createElement("div");return participation.participationObject(subject,subject.doc(),context.me).then(function(participation){var dom=context.dom;function heading(text){prefContainer.appendChild(dom.createElement("h5")).textContent=text}heading("My view of this "+context.noun),widgets.appendForm(dom,prefContainer,{},participation,preferencesForm,subject.doc(),function(ok,mes){ok||widgets.complain(context,mes)}),heading("Everyone's  view of this "+context.noun),recordSharedPreferences(subject,context).then(function(context){var sharedPreferences=context.sharedPreferences;widgets.appendForm(dom,prefContainer,{},sharedPreferences,preferencesForm,subject.doc(),function(ok,mes){ok||widgets.complain(context,mes)}),heading("My default view of any "+context.noun),recordPersonalDefaults(theClass,context).then(function(context){widgets.appendForm(dom,prefContainer,{},context.personalDefaults,preferencesForm,context.preferencesFile,function(ok,mes){ok||widgets.complain(context,mes)})},function(err){widgets.complain(context,err)})})},function(err){prefContainer.appendChild(widgets.errorMessageBlock(context.dom,err))}),prefContainer},exports.set=function set(k,v){if("string"!=typeof v)throw debug.log("Non-string value of preference "+k+": "+v),new Error("Non-string value of preference "+k+": "+v);this.value[k]=v},exports.value=void 0;var $rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_login=__webpack_require__("./lib/login/login.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),participation=_interopRequireWildcard(__webpack_require__("./lib/participation.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var kb=_solidLogic.store,value=exports.value=[];function recordSharedPreferences(subject,context){return new Promise(function(resolve,reject){var sharedPreferences=kb.any(subject,ns.ui("sharedPreferences"));if(sharedPreferences)context.sharedPreferences=sharedPreferences,resolve(context);else{kb.updater.editable(subject.doc())||(debug.log(" Cant make shared preferences, may not change ".concat(subject.doc)),resolve(context));var sp=$rdf.sym(subject.doc().uri+"#SharedPreferences"),ins=[$rdf.st(subject,ns.ui("sharedPreferences"),sp,subject.doc())];debug.log("Creating shared preferences "+sp),kb.updater.update([],ins,function(uri,ok,errorMessage){ok?(context.sharedPreferences=sp,resolve(context)):reject(new Error("Error creating shared prefs: "+errorMessage))})}})}function recordPersonalDefaults(theClass,context){return new Promise(function(resolve,reject){(0,_login.ensureLoadedPreferences)(context).then(function(context){if(context.preferencesFile){var prefs,reg,regs=kb.each(null,ns.solid("forClass"),theClass,context.preferencesFile),ins=[];if(regs.length){if(regs.forEach(function(r){prefs=prefs||kb.any(r,ns.solid("personalDefaults"))}),prefs)return context.personalDefaults=prefs,void resolve(context);prefs=widgets.newThing(context.preferencesFile),reg=regs[0]}else reg=widgets.newThing(context.preferencesFile),ins=[$rdf.st(reg,ns.rdf("type"),ns.solid("TypeRegistration"),context.preferencesFile),$rdf.st(reg,ns.solid("forClass"),theClass,context.preferencesFile)];prefs=widgets.newThing(context.preferencesFile),ins.push($rdf.st(reg,ns.solid("personalDefaults"),prefs,context.preferencesFile)),kb.updater.update([],ins,function(uri,ok,errm){ok?(context.personalDefaults=prefs,resolve(context)):reject(new Error("Setting preferences for "+theClass+": "+errm))})}else debug.log("Not doing private class preferences as no access to preferences file. "+context.preferencesFileError)},function(err){reject(err)})})}function toJS(term){return term.datatype?term.datatype.equals(ns.xsd("boolean"))?"1"===term.value:term.datatype.equals(ns.xsd("dateTime"))||term.datatype.equals(ns.xsd("date"))?new Date(term.value):term.datatype.equals(ns.xsd("integer"))||term.datatype.equals(ns.xsd("float"))||term.datatype.equals(ns.xsd("decimal"))?Number(term.value):term.value:term}},"./lib/signup/config-default.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default={authEndpoint:"",fallbackAuthEndpoint:"https://databox.me/",signupEndpoint:"https://solidproject.org/use-solid/",signupWindowHeight:600,signupWindowWidth:1024,key:"",cert:""}},"./lib/signup/signup.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Signup=Signup;var _configDefault=_interopRequireDefault(__webpack_require__("./lib/signup/config-default.js"));function Signup(config){this.config=config||_configDefault.default}Signup.prototype.listen=function listen(){return new Promise(function(resolve,reject){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";(0,window[eventMethod])("attachEvent"===eventMethod?"onmessage":"message",function(e){var u=e.data;if("User:"===u.slice(0,5)){var user=u.slice(5,u.length);return user&&user.length>0&&"http"===user.slice(0,4)?resolve(user):reject(user)}},!0)})},Signup.prototype.signup=function signup(signupUrl){signupUrl=signupUrl||this.config.signupEndpoint;var width=this.config.signupWindowWidth,height=this.config.signupWindowHeight,leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),windowUrl=signupUrl+"?origin="+encodeURIComponent(window.location.origin),windowSpecs="resizable,scrollbars,status,width="+width+",height="+height+",left="+leftPosition+",top="+topPosition;window.open(windowUrl,"Solid signup",windowSpecs);var self=this;return new Promise(function(resolve){self.listen().then(function(webid){return resolve(webid)})})}},"./lib/style.js":(module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.style=void 0;var _styleConstants=_interopRequireDefault(__webpack_require__("./lib/styleConstants.js")),style=exports.style={checkboxStyle:"color: black; font-size: 100%; padding-left: 0.5 em; padding-right: 0.5 em;",checkboxInputStyle:"font-size: 150%; height: 1.2em; width: 1.2em; background-color: #eef; border-radius:0.2em; margin: 0.1em;",fieldLabelStyle:"color: #3B5998; text-decoration: none;",formSelectStyle:"background-color: #eef; padding: 0.5em;  border: .05em solid #88c; border-radius:0.2em; font-size: 100%; margin:0.4em;",textInputStyle:"background-color: #eef; padding: 0.5em;  border: .05em solid #88c; border-radius:0.2em; font-size: 100%; margin:0.4em;",textInputStyleUneditable:"background-color: white; padding: 0.5em;  border: .05em solid white; border-radius:0.2em; font-size: 100%; margin:0.4em;",buttonStyle:"background-color: #fff; padding: 0.7em;  border: .01em solid white; border-radius:0.2em; font-size: 100%; margin: 0.3em;",commentStyle:"padding: 0.7em;  border: none; font-size: 100%; white-space: pre-wrap;",iconStyle:"width: 3em; height: 3em; margin: 0.1em; border-radius: 1em;",smallButtonStyle:"margin: 0.2em; width: 1em; height:1em;",classIconStyle:"width: 3em; height: 3em; margin: 0.1em; border-radius: 0.2em; border: 0.1em solid green; padding: 0.2em; background-color: #efe;",confirmPopupStyle:"padding: 0.7em; border-radius: 0.2em; border: 0.1em solid orange; background-color: white; box-shadow: 0.5em 0.9em #888;",messageBodyStyle:"white-space: pre-wrap; width: 99%; font-size:100%; border: 0.07em solid #eee; border-radius:0.2em; padding: .3em 0.5em; margin: 0.1em;",pendingeditModifier:"color: #bbb;",personaBarStyle:"width: 100%; height: 4em; background-color: #eee; vertical-align: middle;",searchInputStyle:"border: 0.1em solid #444; border-radius: 0.2em; width: 100%; font-size: 100%; padding: 0.1em 0.6em; margin 0.2em;",autocompleteRowStyle:"border: 0.2em solid straw;",signInAndUpButtonStyle:"padding: 1em; border-radius:0.2em; font-size: 100%;",headerBannerLoginInput:"margin: 0.75em 0 0.75em 0.5em !important; padding: 0.5em !important;",signUpBackground:"background-color: #eef;",signInBackground:"background-color: #efe;",heading1Style:"font-size: 180%; font-weight: bold; color: #888888; padding: 0.5em; margin: 0.7em 0.0m;",heading2Style:"font-size: 130%; font-weight: bold; color: #888888; padding: 0.4em; margin: 0.7em 0.0em;",heading3Style:"font-size: 120%; font-weight: bold; color: #888888; padding: 0.3em; margin: 0.7em 0.0em;",heading4Style:"font-size: 110%; font-weight: bold; color: #888888; padding: 0.2em; margin: 0.7em 0.0em;",formHeadingStyle:"font-size: 110%; font-weight: bold; color: #888888; padding: 0.2em;  margin: 0.7em 0.0em;",formTextInput:"font-size: 100%; margin: 0.1em; padding: 0.1em;",formGroupStyle:["padding-left: 0em; border: 0.0em solid ".concat(_styleConstants.default.formBorderColor,"; border-radius: 0.2em;"),"padding-left: 2em; border: 0.05em solid ".concat(_styleConstants.default.formBorderColor,"; border-radius: 0.2em;"),"padding-left: 2em; border: 0.1em solid ".concat(_styleConstants.default.formBorderColor,"; border-radius: 0.2em;"),"padding-left: 2em; border: 0.2em solid ".concat(_styleConstants.default.formBorderColor,"; border-radius: 0.2em;")],formFieldLabelStyle:"color: ".concat(_styleConstants.default.lowProfileLinkColor,"; text-decoration: none;"),formFieldNameBoxStyle:"padding: 0.3em; vertical-align: middle; width:".concat(_styleConstants.default.formFieldNameBoxWidth,";"),multilineTextInputStyle:"font-size:100%; white-space: pre-wrap; background-color: #eef; border: 0.07em solid gray; padding: 1em 0.5em; margin: 1em 1em;",renderAsDivStyle:"display: flex; align-items: center; justify-content: space-between; height: 2.5em; padding: 1em;",imageDivStyle:"width:2.5em; padding:0.5em; height: 2.5em;",linkDivStyle:"width:2em; padding:0.5em; height: 4em;",aclControlBoxContainer:"margin: 1em;",aclControlBoxHeader:"font-size: 120%; margin: 0 0 1rem;",aclControlBoxStatus:"display: none; margin: 1rem 0;",aclControlBoxStatusRevealed:"display: block;",aclGroupContent:"maxWidth: 650;",accessGroupList:"display: grid; grid-template-columns: 1fr; margin: 1em; width: 100%;",accessGroupListItem:"display: grid; grid-template-columns: 100px auto 30%;",defaultsController:"display: flex;",defaultsControllerNotice:"color: #888; flexGrow: 1; fontSize: 80%;",bigButton:"background-color: white; border: 0.1em solid #888; border-radius: 0.3em; max-width: 50%; padding-bottom: 1em; padding-top: 1em;",group:"color: #888;",group1:"color: green;",group2:"color: #cc0;",group3:"color: orange;",group5:"color: red;",group9:"color: blue;",group13:"color: purple;",trustedAppAddApplicationsTable:"background-color: #eee;",trustedAppCancelButton:"float: right;",trustedAppControllerI:"border-color: orange; border-radius: 1em; border-width: 0.1em;",temporaryStatusInit:"background: green;",temporaryStatusEnd:"background: transparent; transition: background 5s linear;",headerUserMenuLink:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em;  width: 100%; text-decoration: none;",headerUserMenuLinkHover:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em;  width: 100%; text-decoration: none; background-image: linear-gradient(to right, #7C4DFF 0%, #18A9E6 50%, #01C9EA 100%);",headerUserMenuTrigger:"background: none; border: 0; cursor: pointer; width: 60px; height: 60px;",headerUserMenuTriggerImg:"border-radius: 50%; height: 56px; width: 28px !important;",headerUserMenuButton:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em; width: 100%;",headerUserMenuButtonHover:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em; width: 100%; background-image: linear-gradient(to right, #7C4DFF 0%, #18A9E6 50%, #01C9EA 100%);",headerUserMenuList:"list-style: none; margin: 0; padding: 0;",headerUserMenuListDisplay:"list-style: none; margin: 0; padding: 0; display:true;",headerUserMenuNavigationMenu:"background: white; border: solid 1px #000000; border-right: 0; position: absolute; right: 0; top: 60px; width: 200px; z-index: 1; display: true;",headerUserMenuNavigationMenuNotDisplayed:"background: white; border: solid 1px #000000; border-right: 0; position: absolute; right: 0; top: 60px; width: 200px; z-index: 1; display: none;",headerUserMenuListItem:"border-bottom: solid 1px #000000;",headerUserMenuPhoto:"border-radius: 50%; background-position: center; background-repeat: no-repeat; background-size: cover; height: 50px; width: 50px;",headerBanner:"box-shadow: 0px 1px 4px #000000; display: flex; justify-content: space-between; padding: 0 1.5em; margin-bottom: 4px;",headerBannerLink:"display: block;",headerBannerRightMenu:"display: flex;",headerBannerLogin:"margin-left: auto;",allChildrenVisible:"display:true;",headerBannerUserMenu:"border-left: solid 1px #000000; margin-left: auto;",headerBannerHelpMenu:"border-left: solid 1px #000000; margin-left: auto;",headerBannerIcon:"background-size: 65px 60px !important; height: 60px !important; width: 65px !important;",footer:"border-top: solid 1px $divider-color; font-size: 0.9em; padding: 0.5em 1.5em;",primaryButton:"background-color: #7c4dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",primaryButtonHover:"background-color: #9f7dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",primaryButtonNoBorder:"background-color: #ffffff; color: #7c4dff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",primaryButtonNoBorderHover:"background-color: #7c4dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",secondaryButton:"background-color: #01c9ea; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",secondaryButtonHover:"background-color: #37cde6; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",secondaryButtonNoBorder:"background-color: #ffffff; color: #01c9ea; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",secondaryButtonNoBorderHover:"background-color: #01c9ea; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",controlStyle:"border-radius: 0.5em; margin: 0.8em; width:".concat(_styleConstants.default.mediaModuleCanvasWidth,"; height:").concat(_styleConstants.default.mediaModuleCanvasHeight,";"),dragEvent:"background-color: #ccc; border: 0.25em dashed black; border-radius: 0.3em;",dropEvent:"background-color: white; border: 0em solid black;",restoreStyle:"background-color: white;",errorCancelButton:"width: 2em; height: 2em; align: right;",errorMessageBlockStyle:"margin: 0.1em; padding: 0.5em; border: 0.05em solid gray; color:black;",notepadStyle:"padding: 1em; overflow: auto; resize: horizontal; min-width: 40em;",upstreamStatus:"width: 50%;",downstreamStatus:"width: 50%;",baseStyle:"font-size: 100%; font-family: monospace; width: 100%; border: none; white-space: pre-wrap;",headingCore:"font-family: sans-serif; font-weight: bold;  border: none;",headingStyle:["font-size: 110%; padding-top: 0.5em; padding-bottom: 0.5em; width: 100%;","font-size: 120%; padding-top: 1em; padding-bottom: 1em; width: 100%;","font-size: 150%; padding-top: 1em; padding-bottom: 1em; width: 100%;"],participantsStyle:"margin: 0.8em;",participantsBlock:"height: 1.5em; width: 1.5em; margin: 0.3em; border 0.01em solid #888;",personTableTD:"vertical-align: middle;",tabsNavElement:"margin: 0;",tabsRootElement:"display: flex; height: 100%; width: 100%;",tabsMainElement:"margin: 0; width:100%; height: 100%;",tabContainer:"list-style-type: none; display: flex; height: 100%; width: 100%; margin: 0; padding: 0;",makeNewSlot:"background: none; border: none; font: inherit; cursor: pointer;",ellipsis:"position: absolute; right: 0; bottom: 0; width: 20%; background: none; color: inherit; border: none; padding: 0; font: inherit; cursor: pointer; outline: inherit;"};style.setStyle=function setStyle(ele,styleName){ele.style=style[styleName]},module.exports=style},"./lib/styleConstants.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default={highlightColor:"#7C4DFF",formBorderColor:"#888888",formHeadingColor:"#888888",lowProfileLinkColor:"#3B5998",formFieldNameBoxWidth:"8em",mediaModuleCanvasWidth:"640",mediaModuleCanvasHeight:"480",textInputSize:20,tabBorderRadius:"0.2em",textInputBackgroundColor:"#eef",textInputBackgroundColorUneditable:"#fff",textInputColor:"#000",textInputColorPending:"#888",defaultErrorBackgroundColor:"#fee",participationDefaultBackground:"white",basicMaxLength:"4096"}},"./lib/style_multiSelect.js":(module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.style=void 0;var style=exports.style={multiselect__container:"\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n        background-color: #fff;\n        border-radius: 2px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n                box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        min-height: 36px;\n        padding: 4px 8px 0 8px;\n        position: relative;\n        width: 354px;\n        margin-bottom: 5px;\n        font-size: 100%\n    ",multiselect__wrapper:"\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -ms-flex-wrap: wrap;\n            flex-wrap: wrap;\n        height: 100%;\n        width: 100%;\n    ",multiselect__clear_btn:"\n        cursor: pointer;\n        align-items: center;\n        margin-bottom: 4px;\n        margin-left: 4px;\n    ",multiselect__options:"\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n    ",multiselect__options_visible:"\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n        max-height: 200px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        opacity: 1;\n        transition: max-height 0.2s ease;\n    ",multiselect__options_ul:"\n        list-style: none;\n        margin: 0;\n        padding: 2px 0;\n        max-height: 200px;\n        overflow: auto;\n    ",multiselect__options_ul_li:"\n        cursor: pointer;\n        padding: 4px 8px;\n    ",multiselect__options_ul_li_hover:"\n        background-color: #dedede;\n    ",multiselect__options_ul_p_multiselect__options_no_results:"\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    ",multiselect__options_ul_p_multiselect__options_no_data:"\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    ",multiselect__options_ul_li_multiselect__options_selected:"\n        background-color: #656565;\n        color: #fff;\n    ",multiselect__options_ul_li_multiselect__options_selected_hover:"\n    background-color: #656565;\n    ",multiselect__options_ul_li_arrow_selected:"\n        border: 2px solid rgba(101, 101, 101, 0.5);\n    ",multiselect__selected:"\n        background-color: #656565;\n        border-radius: 2px;\n        color: #fff;\n        margin-bottom: 4px;\n        margin-right: 4px;\n        padding: 4px 8px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n    ",multiselect__selected_multiselect__remove_btn:"\n        cursor: pointer;\n        display: flex;\n        margin-left: 6px;\n    ",multiselect__input:"\n        border: none;\n        -ms-flex-preferred-size: 40%;\n            flex-basis: 40%;\n        -webkit-box-flex: 1;\n            -ms-flex-positive: 1;\n                flex-grow: 1;\n        height: 5px;        \n        margin-bottom: 4px;\n        min-width: 40%;\n        outline: none;      \n    "};style.setStyle=function setStyle(ele,styleName){ele.style=style[styleName]},module.exports=style},"./lib/table.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderTableViewPane=function renderTableViewPane(doc,options){var allType,types,typeSelectorDiv,addColumnDiv,sourceDocument=options.sourceDocument,tableClass=options.tableClass,givenQuery=options.query,ns=UI.ns,kb=_solidLogic.store,rowsLookup={},FORBIDDEN_COLUMNS={"http://www.w3.org/2002/07/owl#sameAs":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},XSD_NUMBER_TYPES={"http://www.w3.org/2001/XMLSchema#decimal":!0,"http://www.w3.org/2001/XMLSchema#float":!0,"http://www.w3.org/2001/XMLSchema#double":!0,"http://www.w3.org/2001/XMLSchema#integer":!0,"http://www.w3.org/2001/XMLSchema#nonNegativeInteger":!0,"http://www.w3.org/2001/XMLSchema#positiveInteger":!0,"http://www.w3.org/2001/XMLSchema#nonPositiveInteger":!0,"http://www.w3.org/2001/XMLSchema#negativeInteger":!0,"http://www.w3.org/2001/XMLSchema#long":!0,"http://www.w3.org/2001/XMLSchema#int":!0,"http://www.w3.org/2001/XMLSchema#short":!0,"http://www.w3.org/2001/XMLSchema#byte":!0,"http://www.w3.org/2001/XMLSchema#unsignedLong":!0,"http://www.w3.org/2001/XMLSchema#unsignedInt":!0,"http://www.w3.org/2001/XMLSchema#unsignedShort":!0,"http://www.w3.org/2001/XMLSchema#unsignedByte":!0},XSD_DATE_TYPES={"http://www.w3.org/2001/XMLSchema#dateTime":!0,"http://www.w3.org/2001/XMLSchema#date":!0},IMAGE_TYPES={"http://xmlns.com/foaf/0.1/Image":!0,"http://purl.org/dc/terms/Image":!0},keyVariable=options.keyVariable||"?_row",subjectIdCounter=0,lastQuery=null,mostCommonType=null,resultDiv=doc.createElement("div");resultDiv.className="tableViewPane",resultDiv.appendChild(function generateControlBar(){var result=doc.createElement("table");result.setAttribute("class","toolbar");var tr=doc.createElement("tr");return typeSelectorDiv=doc.createElement("td"),tr.appendChild(typeSelectorDiv),addColumnDiv=doc.createElement("td"),tr.appendChild(addColumnDiv),result.appendChild(tr),result}());var table,tableDiv=doc.createElement("div");if(resultDiv.appendChild(tableDiv),resultDiv.refresh=function(){runQuery(table.query,table.logicalRows,table.columns,table)},givenQuery)table=renderTableForQuery(givenQuery),tableDiv.appendChild(table);else{var s=function calculateTable(){var subjects,types,s=function discoverTypes(){for(var types={},subjectList=kb.statementsMatching(void 0,UI.ns.rdf("type"),tableClass,sourceDocument),subjects={},i=0;i<subjectList.length;++i){var type=subjectList[i].object;if("NamedNode"===type.termType){var typeObj=getTypeForObject(types,type);type.uri in subjects||(subjects[type.uri]=[]),subjects[type.uri].push(subjectList[i].subject),typeObj.addUse()}}return[subjects,types]}();for(var typeUrl in subjects=s[0],types=s[1],subjects){var subjectList=subjects[typeUrl];identifyColumnsForType(types[typeUrl],subjectList)}var allType=new SubjectType(null);return[allType,objectToArray(types)]}();allType=s[0],types=s[1],tableClass||typeSelectorDiv.appendChild(function generateTypeSelector(allType,types){var resultDiv=doc.createElement("div");resultDiv.appendChild(doc.createTextNode("Select type: "));var dropdown=doc.createElement("select");for(var uri in dropdown.appendChild(optionElement("All types","null")),types)dropdown.appendChild(optionElement(types[uri].getLabel(),uri));return dropdown.addEventListener("click",function(){(function typeSelectorChanged(selectedType){buildFilteredTable(selectedType)})("null"===dropdown.value?allType:types[dropdown.value])},!1),resultDiv.appendChild(dropdown),resultDiv}(allType,types)),mostCommonType=function getMostCommonType(types){var typeUri,bestCount=-1,best=null;for(typeUri in types){var type=types[typeUri];type.useCount>bestCount&&(best=type,bestCount=type.useCount)}return best}(types),buildFilteredTable(mostCommonType||allType)}return resultDiv;function generateQuery(type){var query=new rdf.Query,rowVar=kb.variable(keyVariable.slice(1));return function addSelectToQuery(query,type){for(var selectedColumns=type.getColumns(),i=0;i<selectedColumns.length;++i){var variable=kb.variable("_col"+i);query.vars.push(variable),selectedColumns[i].setVariable(variable)}}(query,type),function addWhereToQuery(query,rowVar,type){var queryType=type.type;queryType||(queryType=kb.variable("_any")),query.pat.add(rowVar,UI.ns.rdf("type"),queryType)}(query,rowVar,type),function addColumnsToQuery(query,rowVar,type){for(var selectedColumns=type.getColumns(),i=0;i<selectedColumns.length;++i){var column=selectedColumns[i],formula=kb.formula();formula.add(rowVar,column.predicate,column.getVariable()),query.pat.optional.push(formula)}}(query,rowVar,type),query}function buildFilteredTable(type){clearElement(addColumnDiv),addColumnDiv.appendChild(function generateColumnAddDropdown(type){var resultDiv=doc.createElement("div"),unusedColumns=type.getUnusedColumns();if(unusedColumns.sort(function(a,b){var aLabel=a.sortKey(),bLabel=b.sortKey();return(aLabel>bLabel)-(aLabel<bLabel)}),unusedColumns.length>0){resultDiv.appendChild(doc.createTextNode("Add column: "));var dropdown=doc.createElement("select");dropdown.appendChild(optionElement("","-1"));for(var i=0;i<unusedColumns.length;++i){var column=unusedColumns[i];dropdown.appendChild(optionElement(column.getLabel(),""+i))}resultDiv.appendChild(dropdown),dropdown.addEventListener("click",function(){var columnIndex=Number(dropdown.value);columnIndex>=0&&(type.addColumn(unusedColumns[columnIndex]),buildFilteredTable(type))},!1)}return resultDiv}(type)),function updateTable(query,type){lastQuery&&(lastQuery.running=!1);var htmlTable=renderTableForQuery(query,type);clearElement(tableDiv),tableDiv.appendChild(htmlTable),lastQuery=query}(generateQuery(type),type)}function clearElement(element){for(;element.childNodes.length>0;)element.removeChild(element.childNodes[0])}function SubjectType(type){this.type=type,this.columns=null,this.allColumns=[],this.useCount=0,this.getAllColumns=function(){return this.allColumns},this.getColumns=function(){if(!this.columns){var allColumns=this.getAllColumns();this.columns=allColumns.slice(0,7)}return this.columns},this.getUnusedColumns=function(){for(var allColumns=this.getAllColumns(),columns=this.getColumns(),result=[],i=0;i<allColumns.length;++i)-1===columns.indexOf(allColumns[i])&&result.push(allColumns[i]);return result},this.addColumn=function(column){this.columns.push(column)},this.removeColumn=function(column){this.columns=this.columns.filter(function(x){return x!==column})},this.getLabel=function(){return utils.label(this.type)},this.addUse=function(){this.useCount+=1}}function Column(){this.useCount=0,this.checkedAnyValues=!1,this.possiblyLiteral=!0,this.possiblyNumber=!0,this.constraints=[],this.checkValue=function(term){var termType=term.termType;if(this.possiblyLiteral&&"Literal"!==termType&&"NamedNode"!==termType)this.possiblyNumber=!1,this.possiblyLiteral=!1;else if(this.possiblyNumber){if("Literal"!==termType)this.possiblyNumber=!1;else term.value.match(/^-?\d+(\.\d*)?$/)||(this.possiblyNumber=!1)}this.checkedAnyValues=!0},this.getVariable=function(){return this.variable},this.setVariable=function(variable){this.variable=variable},this.getKey=function(){return this.variable.toString()},this.addUse=function(){this.useCount+=1},this.getHints=function(){return options&&options.hints&&this.variable&&options.hints[this.variable.toNT()]?options.hints[this.variable.toNT()]:{}},this.getLabel=function(){return this.getHints().label?this.getHints().label:this.predicate?this.predicate.sameTerm(ns.rdf("type"))&&this.superClass?utils.label(this.superClass,!0):utils.label(this.predicate):this.variable?this.variable.toString():"unlabeled column?"},this.setPredicate=function(predicate,inverse,other){inverse?(this.inverse=predicate,this.constraints=this.constraints.concat(kb.each(predicate,UI.ns.rdfs("domain"))),predicate.sameTerm(ns.rdfs("subClassOf"))&&"NamedNode"===other.termType&&(this.superClass=other,this.alternatives=kb.each(void 0,ns.rdfs("subClassOf"),other))):(this.predicate=predicate,this.constraints=this.constraints.concat(kb.each(predicate,UI.ns.rdfs("range"))))},this.getConstraints=function(){return this.constraints},this.filterFunction=function(){return!0},this.sortKey=function(){return this.getLabel().toLowerCase()},this.isImageColumn=function(){for(var i=0;i<this.constraints.length;i++)if(this.constraints[i].uri in IMAGE_TYPES)return!0;return!1}}function objectToArray(obj,filter){var result=[];for(var property in obj){var value=obj[property];filter&&!filter(property,value)||result.push(value)}return result}function optionElement(label,value){var result=doc.createElement("option");return result.setAttribute("value",value),result.appendChild(doc.createTextNode(label)),result}function getColumnForPredicate(columns,predicate){var column;return predicate.uri in columns?column=columns[predicate.uri]:((column=new Column).setPredicate(predicate),columns[predicate.uri]=column),column}function getTypeForObject(types,type){var subjectType;return type.uri in types?subjectType=types[type.uri]:(subjectType=new SubjectType(type),types[type.uri]=subjectType),subjectType}function getSubjectProperties(subject,columns){for(var properties=kb.statementsMatching(subject,void 0,void 0,sourceDocument),result={},j=0;j<properties.length;++j){var predicate=properties[j].predicate;if(!(predicate.uri in FORBIDDEN_COLUMNS)){var column=getColumnForPredicate(columns,predicate);column.checkValue(properties[j].object),result[predicate.uri]=column}}return result}function identifyColumnsForType(type,subjects){for(var allColumns={},i=0;i<subjects.length;++i){var columns=getSubjectProperties(subjects[i],allColumns);for(var predicateUri in columns){columns[predicateUri].addUse()}}var allColumnsList=objectToArray(allColumns);!function sortColumns(columns){function sortFunction(a,b){return(a.useCount<b.useCount)-(a.useCount>b.useCount)}columns.sort(sortFunction)}(allColumnsList),type.allColumns=allColumnsList}function renderColumnDeleteButton(type,column){var button=doc.createElement("a");return button.appendChild(doc.createTextNode("[x]")),button.addEventListener("click",function(){type.removeColumn(column),buildFilteredTable(type)},!1),button}function applyColumnFiltersToRow(row,columns){for(var rowDisplayed=!0,c=0;c<columns.length;++c){var column=columns[c],columnKey=column.getKey(),columnValue=null;if(columnKey in row.values&&(columnValue=row.values[columnKey][0]),!column.filterFunction(columnValue)){rowDisplayed=!1;break}}var htmlRow=row._htmlRow;htmlRow.style.display=rowDisplayed?"":"none"}function applyColumnFilters(rows,columns){for(var r=0;r<rows.length;++r){applyColumnFiltersToRow(rows[r],columns)}}function literalSort(rows,column,reverse){function literalToString(colValue){return colValue?"Literal"===colValue.termType?colValue.value.toLowerCase():"NamedNode"===colValue.termType?utils.label(colValue).toLowerCase():colValue.value.toLowerCase():""}!function applyColumnSort(rows,column,sortFunction,reverse){var columnKey=column.getKey();if(rows.sort(function(row1,row2){var row1Value=null,row2Value=null;columnKey in row1.values&&(row1Value=row1.values[columnKey][0]),columnKey in row2.values&&(row2Value=row2.values[columnKey][0]);var result=sortFunction(row1Value,row2Value);return reverse?-result:result}),rows.length){for(var parentTable=rows[0]._htmlRow.parentNode,i=0;i<rows.length;++i)parentTable.removeChild(rows[i]._htmlRow);for(var _i=0;_i<rows.length;++_i)parentTable.appendChild(rows[_i]._htmlRow)}}(rows,column,function literalCompare(value1,value2){var strValue1=literalToString(value1),strValue2=literalToString(value2);return strValue1<strValue2?-1:strValue1>strValue2?1:0},reverse)}function renderLiteralSelector(rows,columns,column){var result=doc.createElement("div"),textBox=doc.createElement("input");textBox.setAttribute("type","text"),textBox.style.width="70%",result.appendChild(textBox);var sort1=doc.createElement("span");sort1.appendChild(doc.createTextNode("▼")),sort1.addEventListener("click",function(){literalSort(rows,column,!1)},!1),result.appendChild(sort1);var sort2=doc.createElement("span");sort2.appendChild(doc.createTextNode("▲")),sort2.addEventListener("click",function(){literalSort(rows,column,!0)},!1),result.appendChild(sort2);var substring=null;return column.filterFunction=function(colValue){return!substring||!!colValue&&("Literal"===colValue.termType?colValue.value:"NamedNode"===colValue.termType?utils.label(colValue):"").toLowerCase().indexOf(substring)>=0},textBox.addEventListener("keyup",function(){substring=""!==textBox.value?textBox.value.toLowerCase():null,applyColumnFilters(rows,columns)},!1),result}function renderEnumSelector(rows,columns,column,list){for(var result=doc.createElement("div"),dropdown=doc.createElement("select"),searchValue={},i=0;i<list.length;++i){var value=list[i];searchValue[value.uri]=!0}var initialSelection=getHints(column).initialSelection;initialSelection&&(searchValue=initialSelection),dropdown.setAttribute("multiple","true");for(var _i2=0;_i2<list.length;++_i2){var _value=list[_i2],ele=optionElement(utils.label(_value),_i2);searchValue[_value.uri]&&(ele.selected=!0),dropdown.appendChild(ele)}return result.appendChild(dropdown),column.filterFunction=function(colValue){return!searchValue||colValue&&searchValue[colValue.uri]},dropdown.addEventListener("click",function(){searchValue={};for(var opt=dropdown.options,_i3=0;_i3<opt.length;_i3++){var option=opt[_i3],index=Number(option.value);opt[_i3].selected&&(searchValue[list[index].uri]=!0)}applyColumnFilters(rows,columns)},!0),result}function renderNumberSelector(rows,columns,column){var result=doc.createElement("div"),minSelector=doc.createElement("input");minSelector.setAttribute("type","text"),minSelector.style.width="40px",result.appendChild(minSelector);var maxSelector=doc.createElement("input");maxSelector.setAttribute("type","text"),maxSelector.style.width="40px",result.appendChild(maxSelector);var min=null,max=null;function eventListener(){min=""===minSelector.value?null:Number(minSelector.value),max=""===maxSelector.value?null:Number(maxSelector.value),applyColumnFilters(rows,columns)}return column.filterFunction=function(colValue){return colValue&&(colValue=Number(colValue)),!(min&&(!colValue||colValue<min))&&!(max&&(!colValue||colValue>max))},minSelector.addEventListener("keyup",eventListener,!1),maxSelector.addEventListener("keyup",eventListener,!1),result}function renderTableSelector(rows,columns,column){if(column.superClass&&column.alternatives.length>0)return renderEnumSelector(rows,columns,column,column.alternatives);for(var range,cs=column.getConstraints(),i=0;i<cs.length;i++){if(range=cs[i],column.checkedAnyValues&&column.possiblyNumber||range.uri in XSD_NUMBER_TYPES)return renderNumberSelector(rows,columns,column);if("http://www.w3.org/2000/01/rdf-schema#Literal"===range.uri)return renderLiteralSelector(rows,columns,column);var choices=kb.each(range,UI.ns.owl("oneOf"));if(choices.length>0)return renderEnumSelector(rows,columns,column,choices.elements)}return function fallbackRenderTableSelector(rows,columns,column){return column.checkedAnyValues&&column.possiblyNumber?renderNumberSelector(rows,columns,column):column.possiblyLiteral?renderLiteralSelector(rows,columns,column):null}(rows,columns,column)}function linkTo(uri,linkText,hints){hints=hints||{};var result=doc.createElement("a"),linkFunction=hints.linkFunction;return result.setAttribute("href",uri),result.appendChild(doc.createTextNode(linkText)),linkFunction?result.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var uri=utils.getTarget(e).getAttribute("href");uri||debug.log("No href found \n"),linkFunction(uri)},!0):result.addEventListener("click",UI.widgets.openHrefInOutlineMode,!0),result}function getHints(column){return options&&options.hints&&column.variable&&options.hints[column.variable.toNT()]?options.hints[column.variable.toNT()]:{}}function renderValue(obj,column){var hints=getHints(column),cellFormat=hints.cellFormat;if(!cellFormat){if("Literal"===obj.termType){if(obj.datatype){if(XSD_DATE_TYPES[obj.datatype.uri])return doc.createTextNode(UI.widgets.shortDate(obj.value));if(XSD_NUMBER_TYPES[obj.datatype.uri]){var span=doc.createElement("span");return span.textContent=obj.value,span.setAttribute("style","text-align: right"),span}}return doc.createTextNode(obj.value)}if("NamedNode"===obj.termType&&column.isImageColumn())return function renderImage(obj){var result=doc.createElement("img");return result.setAttribute("src",obj.uri),result.style.height="40px",result}(obj);if("NamedNode"===obj.termType||"BlankNode"===obj.termType)return function linkToObject(obj,hints){var match=!1;return obj.uri&&(match=obj.uri.match(/^mailto:(.*)/)),linkTo(obj.uri,match?match[1]:utils.label(obj),hints)}(obj,hints);if("Collection"===obj.termType){var _span=doc.createElement("span");return _span.appendChild(doc.createTextNode("[")),obj.elements.forEach(function(x){_span.appendChild(renderValue(x,column)),_span.appendChild(doc.createTextNode(", "))}),_span.removeChild(_span.lastChild),_span.appendChild(doc.createTextNode("]")),_span}return doc.createTextNode("unknown termtype '"+obj.termType+"'!")}if("shortDate"===cellFormat)return doc.createTextNode(UI.widgets.shortDate(obj.value))}function valueInList(value,list){var i,key=null;if("Literal"===value.termType)key="value";else{if("NamedNode"!==value.termType)return list.indexOf(value)>=0;key="uri"}for(i=0;i<list.length;++i)if(list[i].termType===value.termType&&list[i][key]===value[key])return!0;return!1}function updateRow(row,columns,values){var key,needUpdate=!1;for(key in values){var value=values[key];key in row.values||(row.values[key]=[]),valueInList(value,row.values[key])||(row.values[key].push(value),needUpdate=!0)}needUpdate&&(clearElement(row._htmlRow),function renderTableRowInto(tr,row,columns,_downstream){var linkTd=doc.createElement("td");row._subject&&"uri"in row._subject&&linkTd.appendChild(linkTo(row._subject.uri,"→")),tr.appendChild(linkTd);for(var i=0;i<columns.length;++i){var column=columns[i],td=doc.createElement("td"),orig=void 0,columnKey=column.getKey();if(columnKey in row.values){var objects=row.values[columnKey],different=!1;row.originalValues&&row.originalValues[columnKey]&&objects.length!==row.originalValues[columnKey].length&&(different=!0);for(var j=0;j<objects.length;++j){var obj=objects[j];row.originalValues&&row.originalValues[columnKey]&&row.originalValues[columnKey].length>j&&(orig=row.originalValues[columnKey][j],obj.toString()!==orig.toString()&&(different=!0)),td.appendChild(renderValue(obj,column)),j!==objects.length-1&&td.appendChild(doc.createTextNode(",\n")),different&&(td.style.background="#efe")}}tr.appendChild(td)}return row._htmlRow=tr,tr}(row._htmlRow,row,columns)),applyColumnFiltersToRow(row,columns)}function getSubjectId(subject){if("uri"in subject)return subject.uri;if("_subject_id"in subject)return subject._subject_id;var result=""+subjectIdCounter;return subject._subject_id=result,++subjectIdCounter,result}function runQuery(query,rows,columns,table){query.running=!0;var startTime=Date.now(),progressMessage=doc.createElement("tr");table.appendChild(progressMessage),progressMessage.textContent="Loading ...";for(var i=0;i<rows.length;i++)rows[i].original=!0,rows[i].originalValues||(rows[i].originalValues=rows[i].values),rows[i].values={};kb.query(query,function onResult(values){if(query.running){progressMessage.textContent+=".";var rowKeyId,row=null,rowKey=null;if(keyVariable in values&&(rowKeyId=getSubjectId(rowKey=values[keyVariable]))in rowsLookup&&(row=rowsLookup[rowKeyId]),!row){var tr=doc.createElement("tr");table.appendChild(tr),row={_htmlRow:tr,_subject:rowKey,values:{}},rows.push(row),rowKey&&(rowsLookup[rowKeyId]=row)}delete row.original,updateRow(row,columns,values)}},void 0,function onDone(){progressMessage&&progressMessage.parentNode&&progressMessage.parentNode.removeChild&&(progressMessage.parentNode.removeChild(progressMessage),progressMessage=null);var elapsedTimeMS=Date.now()-startTime;debug.log("Query done: "+rows.length+" rows, "+elapsedTimeMS+"ms");for(var _i4=rows.length-1;_i4>=0;_i4--)if(rows[_i4].original){debug.log("   deleting row "+rows[_i4]._subject);var tr=rows[_i4]._htmlRow;tr.parentNode.removeChild(tr),delete rowsLookup[getSubjectId(rows[_i4]._subject)],rows.splice(_i4,1)}if(options.sortBy){var column=function getColumnForVariable(columns,variableNT){for(var predicateUri in columns){var column=columns[predicateUri];if(column.variable.toNT()===variableNT)return column}throw new Error("getColumnForVariable: no column for variable ".concat(variableNT))}(columns,options.sortBy);literalSort(rows,column,options.sortReverse)}options.onDone&&options.onDone(resultDiv)})}function inferColumnsFromFormula(columns,formula){UI.log.debug(">> processing formula");for(var i=0;i<formula.statements.length;++i){var statement=formula.statements[i];if("NamedNode"===statement.predicate.termType&&"Variable"===statement.object.termType){var variable=statement.object.toString();if(variable in columns)columns[variable].setPredicate(statement.predicate,!1,statement.subject)}if("NamedNode"===statement.predicate.termType&&"Variable"===statement.subject.termType){var _variable=statement.subject.toString();if(_variable in columns)columns[_variable].setPredicate(statement.predicate,!0,statement.object)}}for(var _i5=0;_i5<formula.optional.length;++_i5)UI.log.debug("recurse to optional subformula "+_i5),inferColumnsFromFormula(columns,formula.optional[_i5]);UI.log.debug("<< finished processing formula")}function inferColumns(query){for(var result=[],columns={},i=0;i<query.vars.length;++i){var column=new Column,queryVar=query.vars[i];UI.log.debug("column "+i+" : "+queryVar),column.setVariable(queryVar),columns[queryVar]=column,result.push(column)}return inferColumnsFromFormula(columns,query.pat),result}function renderTableForQuery(query,type){var columns;columns=givenQuery?inferColumns(query):type.getColumns();var rows=[],table=doc.createElement("table");return table.appendChild(function renderTableHeader(columns,type){var tr=doc.createElement("tr"),linkTd=doc.createElement("th");tr.appendChild(linkTd);for(var i=0;i<columns.length;++i){var th=doc.createElement("th"),column=columns[i];th.appendChild(doc.createTextNode(column.getLabel())),type&&th.appendChild(renderColumnDeleteButton(type,column)),tr.appendChild(th)}return tr}(columns,type)),table.appendChild(function renderTableSelectors(rows,columns){var tr=doc.createElement("tr");tr.className="selectors",tr.appendChild(doc.createElement("td"));for(var i=0;i<columns.length;++i){var td=doc.createElement("td"),selector=renderTableSelector(rows,columns,columns[i]);selector&&td.appendChild(selector),tr.appendChild(td)}return tr}(rows,columns)),table.logicalRows=rows,table.columns=columns,table.query=query,runQuery(query,rows,columns,table),table}};var debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),log=_interopRequireWildcard(__webpack_require__("./lib/log.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var UI={icons:_iconBase.icons,log,ns,utils,widgets}},"./lib/tabs.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.TabWidgetElement=void 0,exports.tabWidget=function tabWidget(options){var subject=options.subject,dom=options.dom||document,orientation=parseInt(options.orientation||"0"),backgroundColor=options.backgroundColor||tabsDefaultBackgroundColor,flipped=2&orientation,vertical=1&orientation,onClose=options.onClose,_getColors=function getColors(backgroundColor){return function isLight(x){for(var total=0,i=0;i<3;i++)total+=parseInt(x.slice(2*i+1,2*i+3),16);return total>384}(backgroundColor)?[colorBlend(backgroundColor,"#ffffff",.3),"#000000"]:[colorBlend(backgroundColor,"#000000",.3),"#ffffff"]}(backgroundColor),_getColors2=(0,_slicedToArray2.default)(_getColors,2),selectedColor=_getColors2[0],color=_getColors2[1],bodyMainStyle="flex: 2; width: auto; height: 100%; border: 0.1em; border-style: solid; border-color: ".concat(selectedColor,"; padding: 1em;"),rootElement=dom.createElement("div");rootElement.setAttribute("style",style.tabsRootElement),rootElement.style.flexDirection=(vertical?"row":"column")+(flipped?"-reverse":"");var navElement=rootElement.appendChild(dom.createElement("nav"));navElement.setAttribute("style",style.tabsNavElement);var mainElement=rootElement.appendChild(dom.createElement("main"));mainElement.setAttribute("style",style.tabsMainElement);var tabContainer=navElement.appendChild(dom.createElement("ul"));tabContainer.setAttribute("style",style.tabContainer),tabContainer.style.flexDirection="".concat(vertical?"column":"row");var bodyContainer=mainElement;rootElement.tabContainer=tabContainer,rootElement.bodyContainer=bodyContainer;var corners=["0.2em","0.2em","0","0"],cornersPrepped=corners.concat(corners).slice(orientation,orientation+4),cornersStyle="border-radius: ".concat(cornersPrepped.join(" "),";"),margins=["0.3em","0.3em","0","0.3em"],marginsPrepped=margins.concat(margins).slice(orientation,orientation+4),marginsStyle="margin: ".concat(marginsPrepped.join(" "),";"),paddingStyle="padding: ".concat(marginsPrepped.join(" "),";"),tabStyle=cornersStyle+"position: relative; padding: 0.7em; max-width: 20em; color: ".concat(color,";"),unselectedStyle="".concat(tabStyle+marginsStyle," opacity: 50%; background-color: ").concat(backgroundColor,";"),selectedStyle="".concat(tabStyle+marginsStyle," background-color: ").concat(selectedColor,";"),shownStyle="height: 100%; width: 100%;",hiddenStyle=shownStyle+"display: none;";if(rootElement.refresh=orderedSync,orderedSync(),!options.startEmpty&&tabContainer.children.length&&options.selectedTab){var selectedTab0=Array.from(tabContainer.children).map(function(tab){return tab.firstChild}).find(function(tab){return tab.dataset.name===options.selectedTab}),selectedTabURI=options.selectedTab.uri,selectedTab1=Array.from(tabContainer.children).find(function(tab){return tab.subject&&tab.subject.uri&&tab.subject.uri===selectedTabURI}),clickMe=(selectedTab1||selectedTab0||tabContainer.children[0]).firstChild;clickMe&&clickMe.click()}else options.startEmpty||tabContainer.children[0].firstChild.click();return rootElement;function makeNewSlot(item){var ele=dom.createElement("li");ele.setAttribute("style",unselectedStyle),ele.subject=item;var div=ele.appendChild(dom.createElement("button"));if(div.setAttribute("style",style.makeNewSlot),div.onclick=function(){if(resetTabStyle(),resetBodyStyle(),ele.setAttribute("style",selectedStyle),ele.bodyTR){ele.bodyTR.setAttribute("style",shownStyle);var bodyMain=getOrCreateContainerElement(ele);options.renderMain&&ele.subject&&!1!==bodyMain.asSettings&&(bodyMain.innerHTML="loading item ..."+item,options.renderMain(bodyMain,ele.subject),bodyMain.asSettings=!1)}},options.renderTabSettings&&ele.subject){var ellipsis=dom.createElement("button");ellipsis.textContent="...",ellipsis.setAttribute("style",style.ellipsis),ellipsis.onclick=function(){if(resetTabStyle(),resetBodyStyle(),ele.setAttribute("style",selectedStyle),ele.bodyTR){ele.bodyTR.setAttribute("style",shownStyle);var bodyMain=getOrCreateContainerElement(ele);options.renderTabSettings&&ele.subject&&!0!==bodyMain.asSettings&&(bodyMain.innerHTML="loading settings ..."+item,options.renderTabSettings(bodyMain,ele.subject),bodyMain.asSettings=!0)}},ele.appendChild(ellipsis)}return options.renderTab?options.renderTab(div,item):div.innerHTML=(0,_utils.label)(item),ele;function getOrCreateContainerElement(ele){var _ele$bodyTR,bodyMain=null===(_ele$bodyTR=ele.bodyTR)||void 0===_ele$bodyTR?void 0:_ele$bodyTR.children[0];if(bodyMain)return bodyMain;var newBodyMain=ele.bodyTR.appendChild(dom.createElement("main"));return newBodyMain.setAttribute("style",bodyMainStyle),newBodyMain}}function orderedSync(){var slot,i,j,left,right,items=function getItems(){return options.items?options.items:!1!==options.ordered?_solidLogic.store.the(subject,options.predicate).elements:_solidLogic.store.each(subject,options.predicate)}(),differ=!1;for(left=0;left<tabContainer.children.length;left++)if(slot=tabContainer.children[left],left>=items.length||slot.subject&&!slot.subject.sameTerm(items[left])){differ=!0;break}if(differ||items.length!==tabContainer.children.length){for(right=tabContainer.children.length-1;right>=0&&(slot=tabContainer.children[right],j=right-tabContainer.children.length+items.length,!slot.subject||slot.subject.sameTerm(items[j]));right--);for(var insertables=items.slice(left,right-tabContainer.children.length+items.length+1);right>=left;)tabContainer.removeChild(tabContainer.children[left]),bodyContainer.removeChild(bodyContainer.children[left]),right-=1;for(i=0;i<insertables.length;i++){var newSlot=makeNewSlot(insertables[i]),newBodyDiv=dom.createElement("div");newSlot.bodyTR=newBodyDiv,left===tabContainer.children.length?(tabContainer.appendChild(newSlot),bodyContainer.appendChild(newBodyDiv)):(tabContainer.insertBefore(newSlot,tabContainer.children[left+i]),bodyContainer.insertBefore(newBodyDiv,bodyContainer.children[left+i]))}onClose&&function addCancelButton(tabContainer){if(tabContainer.dataset.onCloseSet){var existingCancelButton=tabContainer.querySelector(".unstyled");tabContainer.removeChild(existingCancelButton)}var extraTab=dom.createElement("li");extraTab.classList.add("unstyled");var tabCancelButton=(0,_widgets.cancelButton)(dom,onClose);tabCancelButton.setAttribute("style",tabCancelButton.getAttribute("style")+paddingStyle),extraTab.appendChild(tabCancelButton),tabContainer.appendChild(extraTab),tabContainer.dataset.onCloseSet="true"}(tabContainer)}}function resetTabStyle(){for(var i=0;i<tabContainer.children.length;i++){var _tab=tabContainer.children[i];_tab.classList.contains("unstyled")||_tab.setAttribute("style",unselectedStyle)}}function resetBodyStyle(){for(var i=0;i<bodyContainer.children.length;i++)bodyContainer.children[i].setAttribute("style",hiddenStyle)}};var _slicedToArray2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/slicedToArray.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_possibleConstructorReturn2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),_getPrototypeOf2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),_inherits2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/inherits.js")),_wrapNativeSuper2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/wrapNativeSuper.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),_widgets=__webpack_require__("./lib/widgets/index.js"),_utils=__webpack_require__("./lib/utils/index.js"),style=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/style.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js");function _callSuper(t,o,e){return o=(0,_getPrototypeOf2.default)(o),(0,_possibleConstructorReturn2.default)(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],(0,_getPrototypeOf2.default)(t).constructor):o.apply(t,e))}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}exports.TabWidgetElement=function(_HTMLElement2){function TabWidgetElement(){var _this2;(0,_classCallCheck2.default)(this,TabWidgetElement);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return _this2=_callSuper(this,TabWidgetElement,[].concat(args)),(0,_defineProperty2.default)(_this2,"bodyContainer",void 0),(0,_defineProperty2.default)(_this2,"refresh",void 0),(0,_defineProperty2.default)(_this2,"tabContainer",void 0),_this2}return(0,_inherits2.default)(TabWidgetElement,_HTMLElement2),(0,_createClass2.default)(TabWidgetElement)}((0,_wrapNativeSuper2.default)(HTMLElement));var tabsDefaultBackgroundColor="#ddddcc";function colorBlend(a,b,mix){for(var ca,cb,str="#",hex="0123456789abcdef",i=0;i<3;i++){ca=parseInt(a.slice(2*i+1,2*i+3),16),cb=parseInt(b.slice(2*i+1,2*i+3),16);var res2=parseInt((""+(ca*(1-mix)+cb*mix)).split(".")[0]),h=parseInt((""+res2/16).split(".")[0]),l=parseInt((""+res2%16).split(".")[0]);str+=hex[h]+hex[l]}return str}},"./lib/utils/headerFooterHelpers.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getName=function getName(store,user){return store.anyValue(user,_.ns.vcard("fn"),null,user.doc())||store.anyValue(user,_.ns.foaf("name"),null,user.doc())||user.uri},exports.getPod=function getPod(){return(0,_rdflib.sym)(document.location.origin).site()},exports.getPodOwner=function getPodOwner(_x,_x2){return _getPodOwner.apply(this,arguments)},exports.throttle=function throttle(func,wait){var context,args,result,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},timeout=null,previous=0,later=function later(){previous=options.leading?Date.now():0,timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=Date.now();previous||options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_=__webpack_require__("./lib/index.js");function _getPodOwner(){return(_getPodOwner=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(pod,store){var response,containerTurtle,podOwner,guess,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.prev=0,store.any(pod,null,_.ns.ldp("Container"),pod)){_context.next=2;break}return _context.next=1,store.fetcher.webOperation("GET",pod.uri,store.fetcher.initFetchOptions(pod.uri,{headers:{accept:"text/turtle"}}));case 1:response=_context.sent,containerTurtle=response.responseText,(0,_rdflib.parse)(containerTurtle,store,pod.uri,"text/turtle");case 2:_context.next=4;break;case 3:return _context.prev=3,_t=_context.catch(0),console.error("Error loading pod "+pod+": "+_t),_context.abrupt("return",null);case 4:if(store.holds(pod,_.ns.rdf("type"),_.ns.space("Storage"),pod)){_context.next=5;break}return console.warn("Pod  "+pod+" does not declare itself as a space:Storage"),_context.abrupt("return",null);case 5:if(!(podOwner=store.any(pod,_.ns.solid("owner"),null,pod)||store.any(null,_.ns.space("storage"),pod,pod))){_context.next=10;break}return _context.prev=6,_context.next=7,store.fetcher.load(podOwner.doc());case 7:_context.next=9;break;case 8:return _context.prev=8,_context.catch(6),console.warn("Unable to load profile of pod owner "+podOwner),_context.abrupt("return",null);case 9:return store.holds(podOwner,_.ns.space("storage"),pod,podOwner.doc())||console.warn("Pod owner ".concat(podOwner," does NOT list pod ").concat(pod," as their storage")),_context.abrupt("return",podOwner);case 10:return guess=(0,_rdflib.sym)("".concat(pod.uri,"profile/card#me")),_context.prev=11,_context.next=12,store.fetcher.load(guess);case 12:_context.next=14;break;case 13:return _context.prev=13,_context.catch(11),console.error("Ooops. Guessed wrong pod owner webid {$guess} : can't load it."),_context.abrupt("return",null);case 14:if(!store.holds(guess,_.ns.space("storage"),pod,guess.doc())){_context.next=15;break}return console.warn("Using guessed pod owner webid but it links back."),_context.abrupt("return",guess);case 15:return _context.abrupt("return",null);case 16:case"end":return _context.stop()}},_callee,null,[[0,3],[6,8],[11,13]])}))).apply(this,arguments)}},"./lib/utils/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.AJARImage=function AJARImage(src,alt,tt,doc){doc||(doc=document);var image=doc.createElement("img");image.setAttribute("src",src),image.addEventListener("copy",function(e){e.clipboardData.setData("text/plain",""),e.clipboardData.setData("text/html",""),e.preventDefault()}),void 0!==tt&&image.setAttribute("title",tt);return image},exports.RDFComparePredicateObject=function RDFComparePredicateObject(self,other){var x=self.predicate.compareTerm(other.predicate);return 0!==x?x:self.object.compareTerm(other.object)},exports.RDFComparePredicateSubject=function RDFComparePredicateSubject(self,other){var x=self.predicate.compareTerm(other.predicate);return 0!==x?x:self.subject.compareTerm(other.subject)},exports.addLoadEvent=function addLoadEvent(func){var oldonload=window.onload;"function"!=typeof window.onload?window.onload=func:window.onload=function(){oldonload(),func()}},exports.ancestor=function ancestor(target,tagName){var level;for(level=target;level;level=level.parentNode)try{if(level.tagName===tagName)return level}catch(e){return}return},exports.beep=function beep(){if(!audioContext)return;var ctx=new audioContext;return function(duration,frequency,type,finishedCallback){duration=+(duration||.3),type=type||"sine","function"!=typeof finishedCallback&&(finishedCallback=function finishedCallback(){});var osc=ctx.createOscillator();osc.type=type,osc.frequency.value=frequency||256,osc.connect(ctx.destination),osc.start(0),osc.stop(duration)}},exports.clearVariableNames=function clearVariableNames(){nextVariable=0},exports.emptyNode=function emptyNode(node){for(var nodes=node.childNodes,i=nodes.length-1;i>=0;i--)node.removeChild(nodes[i]);return node},exports.escapeForXML=escapeForXML,exports.findPos=findPos,exports.genUuid=function genUuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})},exports.getAbout=getAbout,exports.getEyeFocus=function getEyeFocus(element,instantly,isBottom,myWindow){myWindow||(myWindow=window);var elementPosY=findPos(element)[1],appContext=window.SolidAppContext||{},scrollDiff=appContext&&appContext.scroll||52,totalScroll=elementPosY-scrollDiff-myWindow.scrollY;if(instantly)return isBottom?void myWindow.scrollBy(0,elementPosY+element.clientHeight-(myWindow.scrollY+myWindow.innerHeight)):void myWindow.scrollBy(0,totalScroll);var id=myWindow.setInterval(function scrollAmount(){myWindow.scrollBy(0,totalScroll/10),10===++times&&myWindow.clearInterval(id)},50),times=0},exports.getTarget=function getTarget(e){var target;(e=e||window.event).target?target=e.target:e.srcElement&&(target=e.srcElement);3===target.nodeType&&(target=target.parentNode);return target},exports.getTerm=function getTerm(target){var statementTr=target.parentNode,st=statementTr?statementTr.AJAR_statement:void 0;switch(st?target.className:""){case"pred":case"pred selected":return st.predicate;case"obj":case"obj selected":return statementTr.AJAR_inverse?st.subject:st.object;case"":case"selected":return getAbout(_solidLogic.store,target);case"undetermined selected":return target.nextSibling?st.predicate:statementTr.AJAR_inverse?st.subject:st.object}},exports.hashColor=function hashColor(who){return"#"+(16777215&function hash(x){return x.split("").reduce(function(a,b){return(a=(a<<5)-a+b.charCodeAt(0))&a},0)}(who=who.uri||who)|12632256).toString(16)},exports.include=function include(document,linkstr){var lnk=document.createElement("script");return lnk.setAttribute("type","text/javascript"),lnk.setAttribute("src",linkstr),lnk},Object.defineProperty(exports,"label",{enumerable:!0,get:function get(){return _label.label}}),exports.labelForXML=function labelForXML(x){return escapeForXML((0,_label.label)(x))},exports.labelWithOntology=function labelWithOntology(x,initialCap){var t=_solidLogic.store.findTypeURIs(x);if(t[UI.ns.rdf("Predicate").uri]||t[UI.ns.rdfs("Class").uri])return(0,_label.label)(x,initialCap)+" ("+ontologyLabel(x)+")";return(0,_label.label)(x,initialCap)},exports.newVariableName=function newVariableName(){return"v"+nextVariable++},exports.ontologyLabel=ontologyLabel,exports.predParentOf=function predParentOf(node){var n=node;for(;;){if(n.getAttribute("predTR"))return n;if(!n.previousSibling||"TR"!==n.previousSibling.nodeName)return UI.log.error("Could not find predParent"),node;n=n.previousSibling}},exports.predicateLabel=predicateLabel,exports.predicateLabelForXML=function predicateLabelForXML(p,inverse){return escapeForXML(predicateLabel(p,inverse))},exports.shortName=function shortName(uri){var p=uri;"#/".indexOf(p[p.length-1])>=0&&(p=p.slice(0,-1));var pok,namespaces=[];for(var _ns in this.prefixes)namespaces[this.prefixes[_ns]]=_ns;var i,canUse=function canUse(pp){return"ns"!==pp&&(pok=pp,!0)},hash=p.lastIndexOf("#");hash>=0&&(p=p.slice(hash-1));for(;;){var slash=p.lastIndexOf("/");for(slash>=0&&(p=p.slice(slash+1)),i=0;i<p.length&&this.prefixchars.indexOf(p[i]);)i++;if((p=p.slice(0,i)).length<6&&canUse(p))return pok;if(canUse(p.slice(0,3)))return pok;if(canUse(p.slice(0,2)))return pok;if(canUse(p.slice(0,4)))return pok;if(canUse(p.slice(0,1)))return pok;if(canUse(p.slice(0,5)))return pok;for(i=0;;i++)if(canUse(p.slice(0,3)+i))return pok}},exports.stackString=function stackString(e){var i,str=e+"\n";if(!e.stack)return str+"No stack available.\n";var lines=e.stack.toString().split("\n"),toPrint=[];for(i=0;i<lines.length;i++){var line=lines[i];if(line.indexOf("ecmaunit.js")>-1)break;"("===line.charAt(0)&&(line="function"+line);var chunks=line.split("@");toPrint.push(chunks)}for(i=0;i<toPrint.length;i++)str+="  "+toPrint[i][1]+"\n    "+toPrint[i][0];return str},exports.syncTableToArray=function syncTableToArray(table,things,createNewRow){var foundOne,row,i;for(i=0;i<table.children.length;i++)(row=table.children[i]).trashMe=!0;for(var g=0;g<things.length;g++){var thing=things[g];for(foundOne=!1,i=0;i<table.children.length;i++)if((row=table.children[i]).subject&&row.subject.sameTerm(thing)){row.trashMe=!1,foundOne=!0;break}if(!foundOne){var newRow=createNewRow(thing);if(g>=table.children.length)table.appendChild(newRow);else{var ele=table.children[g];table.insertBefore(newRow,ele)}newRow.subject=thing}}for(i=0;i<table.children.length;i++)(row=table.children[i]).trashMe&&table.removeChild(row)},exports.syncTableToArrayReOrdered=function syncTableToArrayReOrdered(table,things,createNewRow){for(var elementMap={},i=0;i<table.children.length;i++){var row=table.children[i];elementMap[row.subject.toNT()]=row}for(var g=0;g<things.length;g++){var thing=things[g];if(g>=table.children.length){var newRow=createNewRow(thing);newRow.subject=thing,table.appendChild(newRow)}else{var _row=table.children[g];if(_row.subject.sameTerm(thing));else{var existingRow=elementMap[thing.toNT()];if(existingRow)table.removeChild(existingRow),table.insertBefore(existingRow,_row);else{var _newRow=createNewRow(thing);_row.before(_newRow),_newRow.subject=thing}}}}for(;table.children.length>things.length;)table.removeChild(table.children[table.children.length-1])};var log=_interopRequireWildcard(__webpack_require__("./lib/log.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),_label=__webpack_require__("./lib/utils/label.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var audioContext,UI={log,ns,rdf},nextVariable=0;function getAbout(kb,target){var level,aa;for(level=target;level&&1===level.nodeType;level=level.parentNode)if(aa=level.getAttribute("about"))return kb.fromNT(aa);UI.log.debug("getAbout: No about found")}function findPos(obj){var DocBox=obj.ownerDocument.documentElement.getBoundingClientRect(),box=obj.getBoundingClientRect();return[box.left-DocBox.left,box.top-DocBox.top]}function ontologyLabel(term){if(void 0===term.uri)return"??";var part,s=term.uri,namespaces=[],i=s.lastIndexOf("#");if(i>=0)s=s.slice(0,i+1);else{if(!((i=s.lastIndexOf("/"))>=0))return term.uri+"?!";s=s.slice(0,i+1)}for(var _ns2 in UI.ns)namespaces[UI.ns[_ns2]]=_ns2;try{return namespaces[s]}catch(e){}for(s=s.slice(0,-1);s;){if(!((i=s.lastIndexOf("/"))>=0))return term.uri+"!?";if(part=s.slice(i+1),s=s.slice(0,i),"ns"!==part&&"0123456789".indexOf(part[0])<0)return part}}function escapeForXML(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function predicateLabel(p,inverse){var lab=(0,_label.label)(p);if(inverse){var ip=_solidLogic.store.any(p,UI.ns.owl("inverseOf"))||_solidLogic.store.any(void 0,UI.ns.owl("inverseOf"),p);return ip?(0,_label.label)(ip):"type"===lab?"...":"is "+lab+" of"}return lab}"undefined"!=typeof AudioContext?audioContext=AudioContext:"undefined"!=typeof window&&(audioContext=window.AudioContext||window.webkitAudioContext)},"./lib/utils/keyHelpers/accessData.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getExistingPrivateKey=function getExistingPrivateKey(_x3,_x4){return _getExistingPrivateKey.apply(this,arguments)},exports.getExistingPublicKey=function getExistingPublicKey(_x,_x2){return _getExistingPublicKey.apply(this,arguments)},exports.getKeyIfExists=getKeyIfExists,exports.pubKeyUrl=exports.privKeyUrl=void 0;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_otherHelpers=__webpack_require__("./lib/utils/keyHelpers/otherHelpers.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}exports.pubKeyUrl=function pubKeyUrl(webId){var url;try{var root=(0,_otherHelpers.getRootIfPreferencesExist)(webId);url="".concat(root,"/profile/keys/publicKey.ttl")}catch(err){debug.error(err)}return url},exports.privKeyUrl=function privKeyUrl(webId){var url;try{var root=(0,_otherHelpers.getRootIfPreferencesExist)(webId);url="".concat(root,"/settings/keys/privateKey.ttl")}catch(err){debug.error(err)}return url};function _getExistingPublicKey(){return(_getExistingPublicKey=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(webId,publicKeyUrl){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=1,getKeyIfExists(webId,publicKeyUrl,"publicKey");case 1:return _context.abrupt("return",_context.sent);case 2:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}function _getExistingPrivateKey(){return(_getExistingPrivateKey=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(webId,privateKeyUrl){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=1,getKeyIfExists(webId,privateKeyUrl,"privateKey");case 1:return _context2.abrupt("return",_context2.sent);case 2:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)}function getKeyIfExists(_x5,_x6,_x7){return _getKeyIfExists.apply(this,arguments)}function _getKeyIfExists(){return(_getKeyIfExists=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(webId,keyUrl,keyType){var key,_t,_t2;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=1,_solidLogic.store.fetcher.load(keyUrl);case 1:return key=_solidLogic.store.any(webId,ns.solid(keyType)),_context3.abrupt("return",null==key?void 0:key.value);case 2:if(_context3.prev=2,404!==(_t=_context3.catch(0)).response.status){_context3.next=7;break}return debug.log("createIfNotExists: doc does NOT exist, will create... "+keyUrl),_context3.prev=3,_context3.next=4,_solidLogic.store.fetcher.webOperation("PUT",keyUrl,{data:"",contentType:"text/turtle"});case 4:_context3.next=6;break;case 5:throw _context3.prev=5,_t2=_context3.catch(3),debug.log("createIfNotExists doc FAILED: "+keyUrl+": "+_t2),_t2;case 6:return delete _solidLogic.store.fetcher.requested[keyUrl],_context3.abrupt("return",void 0);case 7:throw debug.log("createIfNotExists doc FAILED: "+keyUrl+": "+_t),_t;case 8:case"end":return _context3.stop()}},_callee3,null,[[0,2],[3,5]])}))).apply(this,arguments)}},"./lib/utils/keyHelpers/acl.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.keyContainerAclBody=exports.keyAclBody=void 0,exports.setAcl=function setAcl(_x,_x2){return _setAcl.apply(this,arguments)};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t2 in e)"default"!==_t2&&{}.hasOwnProperty.call(e,_t2)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t2))&&(i.get||i.set)?o(f,_t2,i):f[_t2]=e[_t2]);return f}(e,t)}(__webpack_require__("./lib/debug.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js");function _setAcl(){return(_setAcl=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(keyDoc,aclBody){var keyAclDoc,_err$response,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=1,_solidLogic.store.fetcher.load(keyDoc);case 1:if(keyAclDoc=_solidLogic.store.any(_solidLogic.store.sym(keyDoc),_solidLogic.store.sym("http://www.iana.org/assignments/link-relations/acl"))){_context.next=2;break}throw new Error("Key ACL doc not found!");case 2:return _context.prev=2,_context.next=3,_solidLogic.store.fetcher.webOperation("PUT",keyAclDoc.value,{data:aclBody,contentType:"text/turtle"});case 3:_context.next=6;break;case 4:if(_context.prev=4,404===(null==(_t=_context.catch(2))||null===(_err$response=_t.response)||void 0===_err$response?void 0:_err$response.status)){_context.next=5;break}throw new Error(_t);case 5:debug.log("delete "+keyAclDoc.value+" "+_t.response.status);case 6:case"end":return _context.stop()}},_callee,null,[[2,4]])}))).apply(this,arguments)}exports.keyContainerAclBody=function keyContainerAclBody(me){return"\n@prefix : <#>.\n@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix key: <./>.\n\n:ReadWrite\n    a acl:Authorization;\n    acl:accessTo key:;\n    acl:default key:;\n    acl:agent <".concat(me,">;\n    acl:mode acl:Read, acl:Write.\n")},exports.keyAclBody=function keyAclBody(keyDoc,me){var keyAgent="acl:agentClass foaf:Agent";return null!=me&&me.length&&(keyAgent="acl:agent <".concat(me,">")),"\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n<#Read>\n    a acl:Authorization;\n    ".concat(keyAgent,";\n    acl:accessTo <").concat(keyDoc.split("/").pop(),">;\n    acl:mode acl:Read.\n")}},"./lib/utils/keyHelpers/otherHelpers.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRootIfPreferencesExist=void 0;var _solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/ns.js"));exports.getRootIfPreferencesExist=function getRootIfPreferencesExist(webId){var _store$any,_root,root=null===(_store$any=_solidLogic.store.any(webId,ns.space("preferencesFile"),null,webId.doc()))||void 0===_store$any?void 0:_store$any.value;if(!(root=null===(_root=root)||void 0===_root?void 0:_root.split("/").slice(0,-2).join("/")))throw new Error("prefererencesFile is expected to exist in ".concat(webId));return root}},"./lib/utils/label.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.label=function label(thing){var initialCap=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function doCap(label){return initialCap?label.slice(0,1).toUpperCase()+label.slice(1):label}function cleanUp(label){var result="";"/"===label.slice(-1)&&(label=label.slice(0,-1));for(var i=0;i<label.length;i++)"_"!==label[i]&&"-"!==label[i]?(result+=label[i],i+1<label.length&&label[i].toUpperCase()!==label[i]&&label[i+1].toLowerCase()!==label[i+1]&&(result+=" ")):result+=" ";return"has "===result.slice(0,4)&&(result=result.slice(4)),doCap(result)}var label=function getWellKnownLabel(thing){return _solidLogic.store.any(thing,UI.ns.ui("label"))||_solidLogic.store.any(thing,UI.ns.link("message"))||_solidLogic.store.any(thing,UI.ns.vcard("fn"))||_solidLogic.store.any(thing,UI.ns.foaf("name"))||_solidLogic.store.any(thing,UI.ns.dct("title"))||_solidLogic.store.any(thing,UI.ns.dc("title"))||_solidLogic.store.any(thing,UI.ns.rss("title"))||_solidLogic.store.any(thing,UI.ns.contact("fullName"))||_solidLogic.store.any(thing,_solidLogic.store.sym("http://www.w3.org/2001/04/roadmap/org#name"))||_solidLogic.store.any(thing,UI.ns.cal("summary"))||_solidLogic.store.any(thing,UI.ns.foaf("nick"))||_solidLogic.store.any(thing,UI.ns.as("name"))||_solidLogic.store.any(thing,UI.ns.schema("name"))||_solidLogic.store.any(thing,UI.ns.rdfs("label"))||_solidLogic.store.any(thing,_solidLogic.store.sym("http://www.w3.org/2004/02/skos/core#prefLabel"))}(thing);if(label)return doCap(label.value);if("BlankNode"===thing.termType)return"...";if("Collection"===thing.termType)return"("+thing.elements.length+")";var s=thing.uri;if(void 0===s)return thing.toString();try{s=s.split("/").map(decodeURIComponent).join("/")}catch(e){for(var i=s.length-3;i>0;i--)for(var hex="0123456789abcefABCDEF";"%"===s[i]&&hex.indexOf(s[i+1])>=0&&hex.indexOf(s[i+2])>=0;)s=s.slice(0,i)+String.fromCharCode(parseInt(s.slice(i+1,i+3),16))+s.slice(i+3)}s=slice(s,"/profile/card#me"),s=slice(s,"#this");var hash=(s=slice(s,"#me")).indexOf("#");if(hash>=0)return cleanUp(s.slice(hash+1));var slash=s.lastIndexOf("/",s.length-2);return slash>=0&&slash<thing.uri.length?cleanUp(s.slice(slash+1)):doCap(decodeURIComponent(thing.uri))};var log=_interopRequireWildcard(__webpack_require__("./lib/log.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var UI={log,ns:_interopRequireWildcard(__webpack_require__("./lib/ns.js")),rdf:_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js"))};function slice(s,suffix){var length=-1*suffix.length;return s.slice(length)===suffix?s.slice(0,length):s}},"./lib/versionInfo.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default={buildTime:"2025-09-17T14:48:03Z",commit:"cb8980587142771cabaa94b76553aa51dced5022",npmInfo:{"'solid-ui'":"'2.6.0',",npm:"'10.8.2',",node:"'20.19.5',",acorn:"'8.15.0',",ada:"'2.9.2',",ares:"'1.34.5',",brotli:"'1.1.0',",cjs_module_lexer:"'2.1.0',",cldr:"'47.0',",icu:"'77.1',",llhttp:"'9.3.0',",modules:"'115',",napi:"'9',",nghttp2:"'1.61.0',",openssl:"'3.0.16',",simdutf:"'6.4.2',",tz:"'2025b',",undici:"'6.21.2',",unicode:"'16.0',",uv:"'1.46.0',",uvwasi:"'0.0.21',",v8:"'11.3.244.8-node.30',",zlib:"'1.3.1-470d3a2'","}":"}"}}},"./lib/widgets/buttons.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.addStyleSheet=function addStyleSheet(dom,href){for(var links=dom.querySelectorAll("link"),i=0;i<links.length;i++)if("stylesheet"===(links[i].getAttribute("rel")||"")&&(links[i].getAttribute("href")||"")===href)return;var link=dom.createElement("link");link.setAttribute("rel","stylesheet"),link.setAttribute("type","text/css"),link.setAttribute("href",href),dom.getElementsByTagName("head")[0].appendChild(link)},exports.allClassURIs=function allClassURIs(){var set={};return _solidLogic.store.statementsMatching(void 0,ns.rdf("type"),void 0).forEach(function(st){st.object.value&&(set[st.object.value]=!0)}),_solidLogic.store.statementsMatching(void 0,ns.rdfs("subClassOf"),void 0).forEach(function(st){st.object.value&&(set[st.object.value]=!0),st.subject.value&&(set[st.subject.value]=!0)}),_solidLogic.store.each(void 0,ns.rdf("type"),ns.rdfs("Class")).forEach(function(c){c.value&&(set[c.value]=!0)}),set},exports.askName=function askName(dom,kb,container,predicate,theClass,noun){return new Promise(function(resolve,_reject){var form=dom.createElement("div");predicate=predicate||ns.foaf("name");var prompt=(noun=noun||(theClass?utils.label(theClass):"  "))+" "+utils.label(predicate)+": ";form.appendChild(dom.createElement("p")).textContent=prompt;var namefield=dom.createElement("input");function gotName(){form.parentNode.removeChild(form),resolve(namefield.value.trim())}namefield.setAttribute("type","text"),namefield.setAttribute("size","100"),namefield.setAttribute("maxLength","2048"),namefield.setAttribute("style",style.textInputStyle),namefield.select(),form.appendChild(namefield),container.appendChild(form),namefield.addEventListener("keyup",function(e){13===e.keyCode&&gotName()},!1),form.appendChild(dom.createElement("br")),form.appendChild(cancelButton(dom,function(_event){form.parentNode.removeChild(form),resolve(null)})),form.appendChild(continueButton(dom,function(_event){gotName()})),namefield.focus()})},exports.attachmentList=function attachmentList(dom,subject,div){var options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};function createNewRow(target){var theTarget=target,opt={noun};return modify&&(opt.deleteFunction=function(){!function deleteAttachment(target){if(!kb.updater)throw new Error("kb has no updater");kb.updater.update((0,_rdflib.st)(subject,predicate,target,doc),[],function(uri,ok,errorBody,_xhr){ok?refresh():complain(void 0,"Error deleting one: "+errorBody)})}(theTarget)}),personTR(dom,predicate,target,opt)}var refresh=function refresh(){var things=kb.each(subject,predicate);things.sort(),utils.syncTableToArray(attachmentTable,things,createNewRow)};function droppedURIHandler(uris){var ins=[];if(uris.forEach(function(u){var target=(0,_rdflib.sym)(u);debug.log("Dropped on attachemnt "+u),ins.push((0,_rdflib.st)(subject,predicate,target,doc))}),!kb.updater)throw new Error("kb has no updater");kb.updater.update([],ins,function(uri,ok,errorBody,_xhr){ok?refresh():complain(void 0,"Error adding one: "+errorBody)})}function droppedFileHandler(files){var _options$uploadFolder,_options$uploadFolder2;(0,_dragAndDrop.uploadFiles)(kb.fetcher,files,null===(_options$uploadFolder=options.uploadFolder)||void 0===_options$uploadFolder?void 0:_options$uploadFolder.uri,null===(_options$uploadFolder2=options.uploadFolder)||void 0===_options$uploadFolder2?void 0:_options$uploadFolder2.uri,function(theFile,destURI){var ins=[(0,_rdflib.st)(subject,predicate,kb.sym(destURI),doc)];if(!kb.updater)throw new Error("kb has no updater");kb.updater.update([],ins,function(uri,ok,errorBody,_xhr){ok?refresh():complain(void 0,"Error adding link to uploaded file: "+errorBody)})})}var doc=options.doc||subject.doc();void 0===options.modify&&(options.modify=!0);var modify=options.modify,promptIcon=options.promptIcon||iconBase+"noun_748003.svg",predicate=options.predicate||ns.wf("attachment"),noun=options.noun||"attachment",kb=_solidLogic.store,attachmentOuter=div.appendChild(dom.createElement("table"));attachmentOuter.setAttribute("style","margin-top: 1em; margin-bottom: 1em;");var attachmentOne=attachmentOuter.appendChild(dom.createElement("tr")),attachmentLeft=attachmentOne.appendChild(dom.createElement("td")),attachmentTable=attachmentOne.appendChild(dom.createElement("td")).appendChild(dom.createElement("table"));if(attachmentTable.appendChild(dom.createElement("tr")),attachmentOuter.refresh=refresh,refresh(),modify){var paperclip=button(dom,promptIcon,"Drop attachments here");attachmentLeft.appendChild(paperclip);var fhandler=options.uploadFolder?droppedFileHandler:null;if((0,_dragAndDrop.makeDropTarget)(paperclip,droppedURIHandler,fhandler),(0,_dragAndDrop.makeDropTarget)(attachmentLeft,droppedURIHandler,fhandler),options.uploadFolder){var buttonDiv=fileUploadButtonDiv(dom,droppedFileHandler);attachmentLeft.appendChild(buttonDiv)}}return attachmentOuter},exports.button=button,exports.cancelButton=cancelButton,exports.clearElement=function clearElement(ele){for(;ele.firstChild;)ele.removeChild(ele.firstChild);return ele},exports.complain=complain,exports.continueButton=continueButton,exports.createLinkDiv=createLinkDiv,exports.createNameDiv=createNameDiv,exports.defaultAnnotationStore=function defaultAnnotationStore(subject){if(void 0===subject.uri)return;var s=subject.uri;if("http://"!==s.slice(0,7))return;var hash=(s=s.slice(7)).indexOf("#");if(hash>=0)s=s.slice(0,hash);else{var slash=s.lastIndexOf("/");if(slash<0)return;s=s.slice(0,slash)}return _solidLogic.store.sym("http://tabulator.org/wiki/annnotation/"+s)},exports.deleteButtonWithCheck=deleteButtonWithCheck,exports.extractLogURI=function extractLogURI(fullURI){var logPos=fullURI.search(/logFile=/),rulPos=fullURI.search(/&rulesFile=/);return fullURI.substring(logPos+8,rulPos)},exports.faviconOrDefault=faviconOrDefault,exports.fileUploadButtonDiv=fileUploadButtonDiv,exports.findImage=findImage,exports.findImageFromURI=findImageFromURI,exports.formatDateTime=formatDateTime,exports.iconForClass=void 0,exports.imagesOf=function imagesOf(x,kb){return kb.each(x,ns.sioc("avatar")).concat(kb.each(x,ns.foaf("img"))).concat(kb.each(x,ns.vcard("logo"))).concat(kb.each(x,ns.vcard("hasPhoto"))).concat(kb.each(x,ns.vcard("photo"))).concat(kb.each(x,ns.foaf("depiction")))},exports.index=void 0,exports.isAudio=function isAudio(file){return isImage(file,"audio")},exports.isImage=isImage,exports.isVideo=function isVideo(file){return isImage(file,"video")},exports.linkButton=function linkButton(dom,object){var b=dom.createElement("button");return b.setAttribute("type","button"),b.textContent="Goto "+utils.label(object),b.addEventListener("click",function(_event){dom.outlineManager.GotoSubject(object,!0,void 0,!0,void 0)},!0),b},exports.openHrefInOutlineMode=function openHrefInOutlineMode(e){e.preventDefault(),e.stopPropagation();var uri=utils.getTarget(e).getAttribute("href");if(!uri)return debug.log("openHrefInOutlineMode: No href found!\n");var dom=window.document;dom.outlineManager?dom.outlineManager.GotoSubject(_solidLogic.store.sym(uri),!0,void 0,!0,void 0):window&&window.panes&&window.panes.getOutliner?window.panes.getOutliner().GotoSubject(_solidLogic.store.sym(uri),!0,void 0,!0,void 0):debug.log("ERROR: Can't access outline manager in this config")},exports.personTR=void 0,exports.propertyTriage=function propertyTriage(kb){var possibleProperties={},dp={},op={},no=0,nd=0,nu=0,pi=kb.predicateIndex;for(var p in pi){"Literal"===pi[p][0].object.termType?(dp[p]=!0,nd++):(op[p]=!0,no++)}for(var ps=kb.each(void 0,ns.rdf("type"),ns.rdf("Property")),i=0;i<ps.length;i++){var _p=ps[i].toNT();op[_p]||dp[_p]||(dp[_p]=!0,op[_p]=!0,nu++)}return possibleProperties.op=op,possibleProperties.dp=dp,(0,_log.info)("propertyTriage: ".concat(no," non-lit, ").concat(nd," literal. ").concat(nu," unknown.")),possibleProperties},exports.refreshTree=function refreshTree(root){if(root.refresh)return void root.refresh();for(var i=0;i<root.children.length;i++)refreshTree(root.children[i])},exports.removeButton=function removeButton(dom,element){var b=dom.createElement("button");return b.setAttribute("type","button"),b.textContent="✕",b.addEventListener("click",function(_event){element.parentNode.removeChild(element)},!0),b},exports.renderAsDiv=function renderAsDiv(dom,obj,options){var div=dom.createElement("div");div.setAttribute("style",style.renderAsDivStyle);var image=(options=options||{}).image||faviconOrDefault(dom,obj);(0,_widgetHelpers.createImageDiv)(dom,div,image),createNameDiv(dom,div,options.title,obj),createLinkDiv(dom,div,obj,options),options.clickable&&options.onClickFunction&&(0,_widgetHelpers.addClickListenerToElement)(div,options.onClickFunction);if(options.wrapInATR){return(0,_widgetHelpers.wrapDivInATR)(dom,div,obj)}return div},exports.renderAsRow=renderAsRow,exports.selectorPanel=function selectorPanel(dom,kb,type,predicate,inverse,possible,options,callbackFunction,linkCallback){return selectorPanelRefresh(dom.createElement("div"),dom,kb,type,predicate,inverse,possible,options,callbackFunction,linkCallback)},exports.selectorPanelRefresh=selectorPanelRefresh,exports.setImage=setImage,exports.setName=setName,exports.shortDate=function shortDate(str,noTime){if(!str)return"???";try{var nowZ=(new Date).toISOString();return str.slice(0,10)!==nowZ.slice(0,10)||noTime?str.slice(0,4)===nowZ.slice(0,4)?["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(str.slice(5,7),10)-1]+" "+parseInt(str.slice(8,10),10):str.slice(0,10):str.slice(11,16)}catch(e){return"shortdate:"+e}},exports.shortTime=function shortTime(){return formatDateTime(new Date,"{Hours}:{Minutes}:{Seconds}.{Milliseconds}")},exports.timestamp=function timestamp(){return formatDateTime(new Date,"{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}")};var _rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_iconBase=__webpack_require__("./lib/iconBase.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_log=__webpack_require__("./lib/log.js"),_dragAndDrop=__webpack_require__("./lib/widgets/dragAndDrop.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),_error=__webpack_require__("./lib/widgets/error.js"),_widgetHelpers=__webpack_require__("./lib/widgets/widgetHelpers.js"),_iconLinks=__webpack_require__("./lib/widgets/buttons/iconLinks.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var iconBase=_iconBase.icons.iconBase,cancelIconURI=iconBase+"noun_1180156.svg",checkIconURI=iconBase+"noun_1180158.svg";function complain(context,err){if(err){var ele=function getStatusArea(context){var box=context&&context.statusArea||context&&context.div||null;if(box)return box;var dom=context&&context.dom;if(dom||"undefined"==typeof document||(dom=document),dom){var body=dom.getElementsByTagName("body")[0];return box=dom.createElement("div"),body.insertBefore(box,body.firstElementChild),context&&(context.statusArea=box),box}return null}(context);debug.log("Complaint: "+err),ele?ele.appendChild((0,_error.errorMessageBlock)(context&&context.dom||document,err)):alert(err)}}function formatDateTime(date,format){return format.split("{").map(function(s){var k=s.split("}")[0];return s?("000"+(date["get"+k]()+({Month:1}[k]||0))).slice(-({Milliseconds:3,FullYear:4}[k]||2))+s.split("}")[1]:""}).join("")}function setName(element,x){var kb=_solidLogic.store,findName=function findName(x){var name=kb.any(x,ns.vcard("fn"))||kb.any(x,ns.foaf("name"))||kb.any(x,ns.vcard("organization-name"));return name?name.value:null},name=x.sameTerm(ns.foaf("Agent"))?"Everyone":findName(x);if(element.textContent=name||utils.label(x),!name&&x.uri){if(!kb.fetcher)throw new Error("kb has no fetcher");kb.fetcher.nowOrWhenFetched(x.doc(),void 0,function(_ok){element.textContent=findName(x)||utils.label(x)})}}var iconForClass=exports.iconForClass={"solid:AppProviderClass":"noun_144.svg","solid:AppProvider":"noun_15177.svg","solid:Pod":"noun_Cabinet_1434380.svg","vcard:Group":"noun_339237.svg","vcard:Organization":"noun_143899.svg","vcard:Individual":"noun_15059.svg","schema:Person":"noun_15059.svg","foaf:Person":"noun_15059.svg","foaf:Agent":"noun_98053.svg","acl:AuthenticatedAgent":"noun_99101.svg","prov:SoftwareAgent":"noun_Robot_849764.svg","vcard:AddressBook":"noun_15695.svg","trip:Trip":"noun_581629.svg","meeting:LongChat":"noun_1689339.svg","meeting:Meeting":"noun_66617.svg","meeting:Project":"noun_1036577.svg","ui:Form":"noun_122196.svg","rdfs:Class":"class-rectangle.svg","rdf:Property":"property-diamond.svg","owl:Ontology":"noun_classification_1479198.svg","wf:Tracker":"noun_122196.svg","wf:Task":"noun_17020_gray-tick.svg","wf:Open":"noun_17020_sans-tick.svg","wf:Closed":"noun_17020.svg"};function tempSite(x){var str=x.uri.split("#")[0],p=str.indexOf("//");if(p<0)throw new Error("This URI does not have a web site part (origin)");var q=str.indexOf("/",p+2);return q<0?str.slice(0)+"/":str.slice(0,q+1)}function findImageFromURI(x){var iconDir=iconBase;return"string"!=typeof x&&x.uri?4!==x.uri.split("/").length||x.uri.split("/")[1]||x.uri.split("/")[3]?x.uri.startsWith("message:")||x.uri.startsWith("mid:")?iconDir+"noun_480183.svg":x.uri.startsWith("mailto:")?iconDir+"noun_567486.svg":x.uri.startsWith("https:")&&x.uri.indexOf("#")<0?tempSite(x)+"favicon.ico":null:iconDir+"noun_15177.svg":iconDir+"noun_10636_grey.svg"}function findImage(thing){var kb=_solidLogic.store,iconDir=iconBase;if(thing.sameTerm(ns.foaf("Agent"))||thing.sameTerm(ns.rdf("Resource")))return iconDir+"noun_98053.svg";var image=kb.any(thing,ns.sioc("avatar"))||kb.any(thing,ns.foaf("img"))||kb.any(thing,ns.vcard("logo"))||kb.any(thing,ns.vcard("hasPhoto"))||kb.any(thing,ns.vcard("photo"))||kb.any(thing,ns.foaf("depiction"));return image?image.uri:null}function trySetImage(element,thing,iconForClassMap){var kb=_solidLogic.store,explitImage=findImage(thing);if(explitImage)return element.setAttribute("src",explitImage),!0;var typeIcon=iconForClassMap[thing.uri];if(typeIcon)return element.setAttribute("src",typeIcon),element.style=style.classIconStyle,!0;var schemeIcon=findImageFromURI(thing);if(schemeIcon)return element.setAttribute("src",schemeIcon),!0;var types=kb.findTypeURIs(thing);for(var typeURI in types)if(iconForClassMap[typeURI])return element.setAttribute("src",iconForClassMap[typeURI]),!1;return element.setAttribute("src",iconBase+"noun_10636_grey.svg"),!1}function setImage(element,thing){var kb=_solidLogic.store,iconForClassMap={};for(var k in iconForClass){var pref=k.split(":")[0],id=k.split(":")[1],theClass=ns[pref](id);iconForClassMap[theClass.uri]=_rdflib.uri.join(iconForClass[k],iconBase)}if(!trySetImage(element,thing,iconForClassMap)&&thing.uri){if(!kb.fetcher)throw new Error("kb has no fetcher");kb.fetcher.nowOrWhenFetched(thing.doc(),void 0,function(ok){ok&&trySetImage(element,thing,iconForClassMap)})}}function faviconOrDefault(dom,x){var image=dom.createElement("img");image.style=style.iconStyle;if(image.setAttribute("src",iconBase+(function isOrigin(x){if(!x.uri)return!1;var parts=x.uri.split("/");return 3===parts.length||4===parts.length&&""===parts[3]}(x)?"noun_15177.svg":"noun_681601.svg")),x.uri&&x.uri.startsWith("https:")&&x.uri.indexOf("#")<0){var res=dom.createElement("object");return res.setAttribute("data",tempSite(x)+"favicon.ico"),res.setAttribute("type","image/x-icon"),res.appendChild(image),res}return setImage(image,x),image}function deleteButtonWithCheck(dom,container,noun,deleteFunction){var minusIconURI=iconBase+"noun_2188_red.svg",deleteButton=dom.createElement("img");deleteButton.setAttribute("src",minusIconURI),deleteButton.setAttribute("style",style.smallButtonStyle),deleteButton.style.float="right";var prompt="Remove this "+noun;return deleteButton.title=prompt,deleteButton.classList.add("hoverControlHide"),deleteButton.addEventListener("click",function createPopup(){var refererenceElement=dom.createElement("div");container.insertBefore(refererenceElement,deleteButton),refererenceElement.style.position="relative",refererenceElement.appendChild(function renderDeleteConfirmPopup(dom,refererenceElement,prompt,deleteFunction){function removePopup(){refererenceElement.parentElement.removeChild(refererenceElement)}function removePopupAndDoDeletion(){removePopup(),deleteFunction()}var popup=dom.createElement("div");popup.style=style.confirmPopupStyle,popup.style.position="absolute",popup.style.top="-1em",popup.style.display="grid",popup.style.gridTemplateColumns="auto auto";var affirm=dom.createElement("div");affirm.style.gridColumn="1/2",affirm.style.gridRow="1";var cancel=dom.createElement("div");cancel.style.gridColumn="1/2",cancel.style.gridRow="2";var xButton=cancelButton(dom,removePopup);popup.appendChild(xButton),xButton.style.gridColumn="1",xButton.style.gridRow="2";var cancelPrompt=popup.appendChild(dom.createElement("button"));cancelPrompt.style=style.buttonStyle,cancelPrompt.style.gridRow="2",cancelPrompt.style.gridColumn="2",cancelPrompt.textContent="Cancel";var affirmIcon=button(dom,_iconBase.icons.iconBase+"noun_925021.svg","Delete it");popup.appendChild(affirmIcon),affirmIcon.style.gridRow="1",affirmIcon.style.gridColumn="1";var sureButtonElt=popup.appendChild(dom.createElement("button"));return sureButtonElt.style=style.buttonStyle,sureButtonElt.style.gridRow="1",sureButtonElt.style.gridColumn="2",sureButtonElt.textContent=prompt,popup.appendChild(sureButtonElt),affirmIcon.addEventListener("click",removePopupAndDoDeletion),sureButtonElt.addEventListener("click",removePopupAndDoDeletion),cancelPrompt.addEventListener("click",removePopup),popup}(dom,refererenceElement,prompt,deleteFunction))}),container.classList.add("hoverControl"),container.appendChild(deleteButton),deleteButton.setAttribute("data-testid","deleteButtonWithCheck"),deleteButton}function button(dom,iconURI,text,handler){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{buttonColor:"Primary",needsBorder:!1},button=dom.createElement("button");if(button.setAttribute("type","button"),iconURI){var img=button.appendChild(dom.createElement("img"));img.setAttribute("src",iconURI),img.setAttribute("style","width: 2em; height: 2em;"),img.title=text,button.setAttribute("style",style.buttonStyle)}else button.textContent=text.toLocaleUpperCase(),button.onmouseover=function(){"Secondary"===options.buttonColor?options.needsBorder?button.setAttribute("style",style.secondaryButtonNoBorderHover):button.setAttribute("style",style.secondaryButtonHover):options.needsBorder?button.setAttribute("style",style.primaryButtonNoBorderHover):button.setAttribute("style",style.primaryButtonHover)},button.onmouseout=function(){"Secondary"===options.buttonColor?options.needsBorder?button.setAttribute("style",style.secondaryButtonNoBorder):button.setAttribute("style",style.secondaryButton):options.needsBorder?button.setAttribute("style",style.primaryButtonNoBorder):button.setAttribute("style",style.primaryButton)},"Secondary"===options.buttonColor?options.needsBorder?button.setAttribute("style",style.secondaryButtonNoBorder):button.setAttribute("style",style.secondaryButton):options.needsBorder?button.setAttribute("style",style.primaryButtonNoBorder):button.setAttribute("style",style.primaryButton);return handler&&button.addEventListener("click",handler,!1),button}function cancelButton(dom,handler){var b=button(dom,cancelIconURI,"Cancel",handler);return b.firstChild&&(b.firstChild.style.opacity="0.3"),b}function continueButton(dom,handler){return button(dom,checkIconURI,"Continue",handler)}var personTR=exports.personTR=renderAsRow;function renderAsRow(dom,pred,obj,options){var tr=dom.createElement("tr");options=options||{};var td1=tr.appendChild(dom.createElement("td")),td2=tr.appendChild(dom.createElement("td")),td3=tr.appendChild(dom.createElement("td")),image=options.image||faviconOrDefault(dom,obj);if(td1.setAttribute("style","vertical-align: middle; width:2.5em; padding:0.5em; height: 2.5em;"),td2.setAttribute("style","vertical-align: middle; text-align:left;"),td3.setAttribute("style","vertical-align: middle; width:2em; padding:0.5em; height: 4em;"),td1.appendChild(image),options.title?td2.textContent=options.title:setName(td2,obj),options.deleteFunction&&deleteButtonWithCheck(dom,td3,options.noun||"one",options.deleteFunction),obj.uri){if(!1!==options.link)td3.appendChild((0,_iconLinks.linkIcon)(dom,obj)).classList.add("HoverControlHide"),td3.appendChild(dom.createElement("br"));!1!==options.draggable&&(image.setAttribute("draggable","false"),(0,_dragAndDrop.makeDraggable)(tr,obj))}return tr.subject=obj,tr}function createNameDiv(dom,div,title,obj){var nameDiv=div.appendChild(dom.createElement("div"));title?nameDiv.textContent=title:setName(nameDiv,obj)}function createLinkDiv(dom,div,obj,options){var linkDiv=div.appendChild(dom.createElement("div"));linkDiv.setAttribute("style",style.linkDivStyle),options.deleteFunction&&deleteButtonWithCheck(dom,linkDiv,options.noun||"one",options.deleteFunction),obj.uri&&(!1!==options.link&&(0,_iconLinks.createLinkForURI)(dom,linkDiv,obj),(0,_dragAndDrop.makeDraggable)(div,obj))}function selectorPanelRefresh(list,dom,kb,type,predicate,inverse,possible,options,callbackFunction,linkCallback){var style0="border: 0.1em solid #ddd; border-bottom: none; width: 95%; height: 2em; padding: 0.5em;",selected=null;list.innerHTML="";for(var refreshItem=function refreshItem(box,x){var item,image,setStyle=function setStyle(){var already=inverse?kb.each(void 0,predicate,x):kb.each(x,predicate);iconDiv.setAttribute("class",0===already.length?"hideTillHover":""),image.setAttribute("src",options.connectIcon||iconBase+"noun_25830.svg"),image.setAttribute("title",already.length?already.length:"attach")},f=index.twoLine.widgetForClass(type);(item=f(dom,x)).setAttribute("style",style0);var nav=dom.createElement("div");nav.setAttribute("class","hideTillHover"),nav.setAttribute("style","float:right; width:10%");var a=dom.createElement("a");a.setAttribute("href",x.uri),a.setAttribute("style","float:right"),nav.appendChild(a).textContent=">",box.appendChild(nav);var iconDiv=dom.createElement("div");return iconDiv.setAttribute("style",(inverse?"float:left;":"float:right;")+" width:30px;"),image=dom.createElement("img"),setStyle(),iconDiv.appendChild(image),box.appendChild(iconDiv),item.addEventListener("click",function(event){selected===item?(item.setAttribute("style",style0),selected=null):(selected&&selected.setAttribute("style",style0),item.setAttribute("style",style0+"background-color: #ccc; color:black;"),selected=item),callbackFunction(x,event,selected===item),setStyle()},!1),image.addEventListener("click",function(event){linkCallback(x,event,inverse,setStyle)},!1),box.appendChild(item),box},i=0;i<possible.length;i++){var box=dom.createElement("div");list.appendChild(box),refreshItem(box,possible[i])}return list}var index=exports.index={};function isImage(file,kind){var what=kind||"image",typeURIs=_solidLogic.store.findTypeURIs(file),prefix=_rdflib.Util.mediaTypeClass(what+"/*").uri.split("*")[0];for(var t in typeURIs)if(t.startsWith(prefix))return!0;return{audio:"http://purl.org/dc/dcmitype/Sound",image:"http://purl.org/dc/dcmitype/Image",video:"http://purl.org/dc/dcmitype/MovingImage"}[what]in typeURIs}function fileUploadButtonDiv(dom,droppedFileHandler){var div=dom.createElement("div"),input=div.appendChild(dom.createElement("input"));input.setAttribute("type","file"),input.setAttribute("multiple","true"),input.addEventListener("change",function(event){debug.log("File drop event: ",event),event.files?droppedFileHandler(event.files):event.target&&event.target.files?droppedFileHandler(event.target.files):alert("Sorry no files .. internal error?")},!1),input.style="display:none";var buttonElt=div.appendChild(button(dom,iconBase+"noun_Upload_76574_000000.svg","Upload files",function(_event){input.click()}));return(0,_dragAndDrop.makeDropTarget)(buttonElt,null,droppedFileHandler),div}exports.index=index={line:{},twoLine:{"":function twoLineDefault(dom,x){var box=dom.createElement("div");return box.textContent=utils.label(x),box},"http://www.w3.org/2000/10/swap/pim/qif#Transaction":function twoLineTransaction(dom,x){var failed="",enc=function enc(p){var y=_solidLogic.store.any(x,ns.qu(p));return y||(failed+="@@ No value for "+p+"! "),y?utils.escapeForXML(y.value):"?"},box=dom.createElement("table");return box.innerHTML='\n      <tr>\n      <td colspan="2"> '.concat(enc("payee"),"</td>\n      < /tr>\n      < tr >\n      <td>").concat(enc("date").slice(0,10),'</td>\n      <td style = "text-align: right;">').concat(enc("amount"),"</td>\n      </tr>"),failed&&(box.innerHTML='\n      <tr>\n        <td><a href="'.concat(utils.escapeForXML(x.uri),'">').concat(utils.escapeForXML(failed),"</a></td>\n      </tr>")),box},"http://www.w3.org/ns/pim/trip#Trip":function twoLineTrip(dom,x){var enc=function enc(p){var y=_solidLogic.store.any(x,p);return y?utils.escapeForXML(y.value):"?"},box=dom.createElement("table");return box.innerHTML='\n    <tr>\n      <td colspan="2">'.concat(enc(ns.dc("title")),'</td>\n    </tr>\n    <tr style="color: #777">\n      <td>').concat(enc(ns.cal("dtstart")),"</td>\n      <td>").concat(enc(ns.cal("dtend")),"</td>\n    </tr>"),box},widgetForClass:function twoLineWidgetForClass(c){var widget=index.twoLine[c.uri],kb=_solidLogic.store;if(widget)return widget;var sup=kb.findSuperClassesNT(c);for(var cl in sup)if(widget=index.twoLine[kb.fromNT(cl).uri])return widget;return index.twoLine[""]}}}},"./lib/widgets/buttons/iconLinks.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createLinkForURI=void 0,exports.linkIcon=linkIcon;var _iconBase=__webpack_require__("./lib/iconBase.js");function linkIcon(dom,subject,iconURI){var anchor=dom.createElement("a");anchor.setAttribute("href",subject.uri),subject.uri.startsWith("http")&&anchor.setAttribute("target","_blank");var img=anchor.appendChild(dom.createElement("img"));return img.setAttribute("src",iconURI||_iconBase.originalIconBase+"go-to-this.png"),img.setAttribute("style","margin: 0.3em;"),anchor}exports.createLinkForURI=function createLinkForURI(dom,linkDiv,obj){var iconLink=linkIcon(dom,obj);linkDiv.appendChild(iconLink).classList.add("HoverControlHide"),linkDiv.appendChild(dom.createElement("br"))}},"./lib/widgets/dragAndDrop.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeDraggable=function makeDraggable(tr,obj){tr.setAttribute("draggable","true"),tr.addEventListener("dragstart",function(e){tr.style.fontWeight="bold",e.dataTransfer.setData("text/uri-list",obj.uri),e.dataTransfer.setData("text/plain",obj.uri),e.dataTransfer.setData("text/html",tr.outerHTML),debug.log("Dragstart: "+tr+" -> "+obj+"de: "+e.dataTransfer.dropEffect)},!1),tr.addEventListener("drag",function(e){e.preventDefault(),e.stopPropagation()},!1),tr.addEventListener("dragend",function(e){tr.style.fontWeight="normal",debug.log("Dragend dropeffect: "+e.dataTransfer.dropEffect),debug.log("Dragend: "+tr+" -> "+obj)},!1)},exports.makeDropTarget=function makeDropTarget(ele,droppedURIHandler,droppedFileHandler){var dragoverListener=function dragoverListener(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},dragenterListener=function dragenterListener(e){debug.log("dragenter event dropEffect: "+e.dataTransfer.dropEffect),this.localStyle&&(this.savedStyle||(this.savedStyle=style.dragEvent)),e.dataTransfer.dropEffect="link",debug.log("dragenter event dropEffect 2: "+e.dataTransfer.dropEffect)},dragleaveListener=function dragleaveListener(e){debug.log("dragleave event dropEffect: "+e.dataTransfer.dropEffect),this.savedStyle?this.localStyle=this.savedStyle:this.localStyle=style.dropEvent},dropListener=function dropListener(e){e.preventDefault&&e.preventDefault(),debug.log("Drop event. dropEffect: "+e.dataTransfer.dropEffect),debug.log("Drop event. types: "+(e.dataTransfer.types?e.dataTransfer.types.join(", "):"NOPE"));var text,uris=null;if(e.dataTransfer.types){for(var t=0;t<e.dataTransfer.types.length;t++){var type=e.dataTransfer.types[t];if("text/uri-list"===type)uris=e.dataTransfer.getData(type).split("\n"),debug.log("Dropped text/uri-list: "+uris);else if("text/plain"===type)text=e.dataTransfer.getData(type);else if("Files"===type&&droppedFileHandler){for(var files=e.dataTransfer.files,i=0;files[i];i++){var f=files[i];debug.log("Filename: "+f.name+", type: "+(f.type||"n/a")+" size: "+f.size+" bytes, last modified: "+(f.lastModifiedDate?f.lastModifiedDate.toLocaleDateString():"n/a"))}droppedFileHandler(files)}}null===uris&&text&&"http"===text.slice(0,4)&&(uris=text,debug.log("Waring: Poor man's drop: using text for URI"))}else uris=[e.dataTransfer.getData("Text")],debug.log("WARNING non-standard drop event: "+uris[0]);return debug.log("Dropped URI list (2): "+uris),uris&&droppedURIHandler(uris),this.localStyle=style.restoreStyle,!1};!function addTargetListeners(ele){ele||debug.log("@@@ addTargetListeners: ele "+ele),ele.addEventListener("dragover",dragoverListener),ele.addEventListener("dragenter",dragenterListener),ele.addEventListener("dragleave",dragleaveListener),ele.addEventListener("drop",dropListener)}(ele)},exports.uploadFiles=function uploadFiles(fetcher,files,fileBase,imageBase,successHandler){for(var i=0;files[i];i++){var f=files[i];debug.log(" dropped: Filename: "+f.name+", type: "+(f.type||"n/a")+" size: "+f.size+" bytes, last modified: "+(f.lastModifiedDate?f.lastModifiedDate.toLocaleDateString():"n/a"));var reader=new FileReader;reader.onload=function(theFile){return function(e){var data=e.target.result,suffix="";debug.log(" File read byteLength : "+data.byteLength);var contentType=theFile.type;if(theFile.type&&""!==theFile.type){var extension=mime.extension(theFile.type);extension&&"false"!==extension&&!theFile.name.endsWith("."+extension)&&theFile.type!==mime.lookup(theFile.name)&&(suffix="_."+extension)}else if(!(contentType=mime.lookup(theFile.name))){var msg="Filename needs to have an extension which gives a type we know: "+theFile.name;throw debug.log(msg),alert(msg),new Error(msg)}var folderName=theFile.type.startsWith("image/")&&imageBase||fileBase,destURI=folderName+(folderName.endsWith("/")?"":"/")+encodeURIComponent(theFile.name)+suffix;fetcher.webOperation("PUT",destURI,{data,contentType}).then(function(_response){debug.log(" Upload: put OK: "+destURI),successHandler(theFile,destURI)},function(error){var msg=" Upload: FAIL "+destURI+", Error: "+error;throw debug.log(msg),alert(msg),new Error(msg)})}}(f),reader.readAsArrayBuffer(f)}};var debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),mime=_interopRequireWildcard(__webpack_require__("./node_modules/mime-types/index.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}},"./lib/widgets/error.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.errorMessageBlock=function errorMessageBlock(dom,err,backgroundColor,err2){var div=dom.createElement("div"),errorObject=err2||err instanceof Error?err:null;errorObject?(console.error("errorMessageBlock: ".concat(errorObject," at: ").concat(errorObject.stack||"??"),errorObject),div.textContent=errorObject.message):div.textContent=err;return div.appendChild((0,_widgets.cancelButton)(dom,function(){div.parentNode&&div.parentNode.removeChild(div)})).style=style.errorCancelButton,div.setAttribute("style",style.errorMessageBlockStyle),div.style.backgroundColor=backgroundColor||_styleConstants.default.defaultErrorBackgroundColor,div};var _widgets=__webpack_require__("./lib/widgets/index.js"),style=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/style.js")),_styleConstants=_interopRequireDefault(__webpack_require__("./lib/styleConstants.js"))},"./lib/widgets/forms.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.appendForm=appendForm,Object.defineProperty(exports,"basicField",{enumerable:!0,get:function get(){return _basic.basicField}}),exports.buildCheckboxForm=buildCheckboxForm,exports.editFormButton=function editFormButton(dom,container,form,dataDoc,callbackFunction){var b=dom.createElement("button");return b.setAttribute("type","button"),b.innerHTML="Edit "+utils.label(ns.ui("Form")),b.addEventListener("click",function(_e){appendForm(dom,container,{},form,ns.ui("FormForm"),dataDoc,callbackFunction).setAttribute("style",ns.ui("FormForm").sameTerm(form)?"background-color: #fee;":"background-color: #ffffe7;"),b.parentNode.removeChild(b)},!0),b},Object.defineProperty(exports,"field",{enumerable:!0,get:function get(){return _fieldFunction.field}}),Object.defineProperty(exports,"fieldFunction",{enumerable:!0,get:function get(){return _fieldFunction.fieldFunction}}),Object.defineProperty(exports,"fieldLabel",{enumerable:!0,get:function get(){return _basic.fieldLabel}}),Object.defineProperty(exports,"fieldParams",{enumerable:!0,get:function get(){return _fieldParams.fieldParams}}),Object.defineProperty(exports,"fieldStore",{enumerable:!0,get:function get(){return _basic.fieldStore}}),exports.findClosest=findClosest,exports.formsFor=function formsFor(subject){var kb=_solidLogic.store;log.debug("formsFor: subject="+subject);var t1,t=kb.findTypeURIs(subject);for(t1 in t)log.debug("   type: "+t1);var bottom=kb.bottomTypeURIs(t),candidates=[];for(var b in bottom)log.debug("candidatesFor: trying bottom type ="+b),candidates=(candidates=candidates.concat(findClosest(kb,b,ns.ui("creationForm")))).concat(findClosest(kb,b,ns.ui("annotationForm")));return candidates},exports.makeDescription=makeDescription,exports.makeSelectForCategory=makeSelectForCategory,exports.makeSelectForChoice=makeSelectForChoice,exports.makeSelectForClassifierOptions=makeSelectForClassifierOptions,exports.makeSelectForNestedCategory=makeSelectForNestedCategory,exports.makeSelectForOptions=function makeSelectForOptions(dom,kb,subject,predicate,possible,options,dataDoc,callbackFunction){log.debug("Select list length now "+possible.length);for(var actual,n=0,uris={},editable=kb.updater.editable(dataDoc.uri),i=0;i<possible.length;i++){var sub=possible[i];sub.uri||debug.warn("makeSelectForOptions: option does not have an uri: ".concat(sub,", with predicate: ").concat(predicate)),sub.uri&&!(sub.uri in uris)&&(uris[sub.uri]=!0,n++)}if(0===n)return(0,_error.errorMessageBlock)(dom,"Can't do selector with no options, subject= "+subject+" property = "+predicate+".");log.debug("makeSelectForOptions: dataDoc="+dataDoc);var getActual=function getActual(){return actual={},predicate.sameTerm(ns.rdf("type"))?actual=kb.findTypeURIs(subject):kb.each(subject,predicate,null,dataDoc).forEach(function(x){x.uri&&(actual[x.uri]=!0)}),actual};actual=getActual();var select=dom.createElement("select");for(var uri in select.setAttribute("style",style.formSelectStyle),select.currentURI=null,select.refresh=function(){actual=getActual();for(var _i4=0;_i4<select.children.length;_i4++){var option=select.children[_i4];option.AJAR_uri&&(option.selected=option.AJAR_uri in actual)}select.disabled=!1},uris){var c=kb.sym(uri),option=dom.createElement("option");options.disambiguate?option.appendChild(dom.createTextNode(utils.labelWithOntology(c,!0))):option.appendChild(dom.createTextNode(utils.label(c,!0)));var backgroundColor=kb.any(c,kb.sym("http://www.w3.org/ns/ui#backgroundColor"));backgroundColor&&option.setAttribute("style","background-color: "+backgroundColor.value+"; "),option.AJAR_uri=uri,uri in actual&&(option.setAttribute("selected","true"),select.currentURI=uri),select.appendChild(option)}if(!select.currentURI){var prompt=dom.createElement("option");prompt.appendChild(dom.createTextNode(options.nullLabel)),select.insertBefore(prompt,select.firstChild),prompt.selected=!0}editable&&select.addEventListener("change",function onChange(_e){select.disabled=!0;for(var ds=[],is=[],removeValue=function removeValue(t){kb.holds(subject,predicate,t,dataDoc)&&ds.push($rdf.st(subject,predicate,t,dataDoc))},_i3=0;_i3<select.options.length;_i3++){var opt=select.options[_i3];opt.AJAR_uri&&(opt.selected&&!(opt.AJAR_uri in actual)&&is.push($rdf.st(subject,predicate,kb.sym(opt.AJAR_uri),dataDoc)),!opt.selected&&opt.AJAR_uri in actual&&removeValue(kb.sym(opt.AJAR_uri)),opt.selected&&(select.currentURI=opt.AJAR_uri))}for(var sel=select.subSelect;sel&&sel.currentURI;)removeValue(kb.sym(sel.currentURI)),sel=sel.subSelect;for(sel=select.superSelect;sel&&sel.currentURI;)removeValue(kb.sym(sel.currentURI)),sel=sel.superSelect;log.info("selectForOptions: data doc = "+dataDoc),kb.updater.update(ds,is,function(uri,ok,body){if(actual=getActual(),!ok)return select.parentNode.appendChild((0,_error.errorMessageBlock)(dom,"Error updating data in select: "+body));select.disabled=!1,callbackFunction&&callbackFunction(ok,{widget:"select",event:"change"})})},!1);return select},Object.defineProperty(exports,"mostSpecificClassURI",{enumerable:!0,get:function get(){return _fieldFunction.mostSpecificClassURI}}),exports.newButton=function newButton(dom,kb,subject,predicate,theClass,form,dataDoc,callbackFunction){var b=dom.createElement("button");return b.setAttribute("type","button"),b.innerHTML="New "+utils.label(theClass),b.addEventListener("click",function(_e){b.parentNode.appendChild(promptForNew(dom,kb,subject,predicate,theClass,form,dataDoc,callbackFunction))},!1),b},exports.newThing=newThing,exports.promptForNew=promptForNew,exports.propertiesForClass=function propertiesForClass(kb,c){var explicit=kb.each(void 0,ns.rdf("range"),c);[ns.rdfs("comment"),ns.dc("title"),ns.foaf("name"),ns.foaf("homepage")].forEach(function(x){explicit.push(x)});var members=kb.each(void 0,ns.rdf("type"),c);members.length>60&&(members=members.slice(0,60));for(var used={},i=0;i<(members.length>60?60:members.length);i++)kb.statementsMatching(members[i],void 0,void 0).forEach(function(st){used[st.predicate.uri]=!0});explicit.forEach(function(p){used[p.uri]=!0});var result=[];for(var uri in used)result.push(kb.sym(uri));return result},Object.defineProperty(exports,"renderNameValuePair",{enumerable:!0,get:function get(){return _basic.renderNameValuePair}}),exports.sortByLabel=sortByLabel,exports.sortBySequence=sortBySequence;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),buttons=_interopRequireWildcard(__webpack_require__("./lib/widgets/buttons.js")),_fieldParams=__webpack_require__("./lib/widgets/forms/fieldParams.js"),_fieldFunction=__webpack_require__("./lib/widgets/forms/fieldFunction.js"),_formStyle=__webpack_require__("./lib/widgets/forms/formStyle.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_error=__webpack_require__("./lib/widgets/error.js"),_basic=__webpack_require__("./lib/widgets/forms/basic.js"),_autocompleteField=__webpack_require__("./lib/widgets/forms/autocomplete/autocompleteField.js"),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_styleConstants=_interopRequireDefault(__webpack_require__("./lib/styleConstants.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),log=_interopRequireWildcard(__webpack_require__("./lib/log.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),$rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),_multiSelect=__webpack_require__("./lib/widgets/multiSelect.js"),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var checkMarkCharacter="✓",cancelCharacter="✕",dashCharacter="-",kb=_solidLogic.store;function refreshOpionsSubfieldinGroup(dom,already,subject,dataDoc,callbackFunction,groupDiv,subfields){for(var eles=groupDiv.children,j=0;j<subfields.length;j++){var _field=subfields[j];if((0,_fieldFunction.mostSpecificClassURI)(_field)===ns.ui("Options").uri){var newOne=(0,_fieldFunction.fieldFunction)(dom,_field)(dom,null,already,subject,_field,dataDoc,callbackFunction);debug.log("Refreshing Options field by replacing it."),groupDiv.insertBefore(newOne,eles[j]),groupDiv.removeChild(eles[j+1])}}}function booleanField(dom,container,already,subject,form,dataDoc,callbackFunction,tristate){var ui=ns.ui,kb=_solidLogic.store,property=kb.any(form,ui("property"));if(!property){var errorBlock=(0,_error.errorMessageBlock)(dom,"No property to boolean field: "+form);return container&&container.appendChild(errorBlock),errorBlock}var lab=kb.any(form,ui("label"));lab||(lab=utils.label(property,!0)),dataDoc=(0,_basic.fieldStore)(subject,property,dataDoc);var state=kb.any(subject,property);void 0===state&&(state=!1);var ins=$rdf.st(subject,property,!0,dataDoc),box=buildCheckboxForm(dom,kb,lab,$rdf.st(subject,property,!1,dataDoc),ins,form,dataDoc,tristate);return container&&container.appendChild(box),box}function addSubFormChoice(dom,selectDiv,already,subject,subForm,dataDoc,callbackFunction){(0,_fieldFunction.fieldFunction)(dom,subForm)(dom,selectDiv,already,subject,subForm,dataDoc,callbackFunction)}function appendForm(dom,container,already,subject,form,dataDoc,itemDone){return(0,_fieldFunction.fieldFunction)(dom,form)(dom,container,already,subject,form,dataDoc,itemDone)}function findClosest(kb,cla,prop){for(var agenda=[kb.sym(cla)];agenda.length>0;){var c=agenda.shift(),lists=kb.each(c,prop);if(log.debug("Lists for "+c+", "+prop+": "+lists.length),0!==lists.length)return lists;for(var supers=kb.each(c,ns.rdfs("subClassOf")),i=0;i<supers.length;i++)agenda.push(supers[i]),log.debug("findClosest: add super: "+supers[i])}return[]}function sortBySequence(list){var subfields=list.map(function(p){return[kb.any(p,ns.ui("sequence"))||9999,p]});return subfields.sort(function(a,b){return a[0]-b[0]}),subfields.map(function(pair){return pair[1]})}function sortByLabel(list){var subfields=list.map(function(p){return[utils.label(p).toLowerCase(),p]});return subfields.sort(),subfields.map(function(pair){return pair[1]})}function promptForNew(dom,kb,subject,predicate,theClass,form,dataDoc,callbackFunction){var box=dom.createElement("form");if(!form){var lists=findClosest(kb,theClass.uri,ns.ui("creationForm"));if(0===lists.length){box.appendChild(dom.createElement("p")).textContent="I am sorry, you need to provide information about a "+utils.label(theClass)+" but I don't know enough information about those to ask you.";var b=box.appendChild(dom.createElement("button"));return b.setAttribute("type","button"),b.setAttribute("style","float: right;"),b.innerHTML="Goto "+utils.label(theClass),b.addEventListener("click",function(_e){dom.outlineManager.GotoSubject(theClass,!0,void 0,!0,void 0)},!1),box}log.debug("lists[0] is "+lists[0]),form=lists[0]}log.debug("form is "+form),box.setAttribute("style","border: 0.05em solid ".concat(_styleConstants.default.formBorderColor,"; color: ").concat(_styleConstants.default.formBorderColor)),box.innerHTML="<h3>New "+utils.label(theClass)+"</h3>";var formFunction=(0,_fieldFunction.fieldFunction)(dom,form),object=newThing(dataDoc),gotButton=!1;function linkDone(uri,ok,body){return callbackFunction(ok,body)}log.info("paneUtils Object is "+object);var f=formFunction(dom,box,{},object,form,dataDoc,function itemDone(ok,body){if(!ok)return callbackFunction(ok,body);var insertMe=[];subject&&!kb.holds(subject,predicate,object,dataDoc)&&insertMe.push($rdf.st(subject,predicate,object,dataDoc)),subject&&!kb.holds(object,ns.rdf("type"),theClass,dataDoc)&&insertMe.push($rdf.st(object,ns.rdf("type"),theClass,dataDoc)),insertMe.length?kb.updater.update([],insertMe,linkDone):callbackFunction(!0,body),gotButton||(gotButton=box.appendChild(buttons.linkButton(dom,object)))});return buttons.removeButton(dom,f).setAttribute("style","float: right;"),box.AJAR_subject=object,box}function makeDescription(dom,kb,subject,predicate,dataDoc,callbackFunction){var submit,group=dom.createElement("div"),desc=kb.anyJS(subject,predicate,null,dataDoc)||"",field=dom.createElement("textarea");function saveChange(_e){submit.disabled=!0,submit.setAttribute("style","visibility: hidden; float: right;"),field.disabled=!0,field.style.color=_styleConstants.default.textInputColorPending;var ds=kb.statementsMatching(subject,predicate,null,dataDoc),is=$rdf.st(subject,predicate,field.value,dataDoc);kb.updater.update(ds,is,function(uri,ok,body){ok?(field.style.color=_styleConstants.default.textInputColor,field.disabled=!1):group.appendChild((0,_error.errorMessageBlock)(dom,"Error (while saving change to "+dataDoc.uri+"): "+body)),callbackFunction&&callbackFunction(ok,body)})}return group.appendChild(field),field.rows=desc?desc.split("\n").length+2:2,field.cols=80,field.setAttribute("style",style.multilineTextInputStyle),null!==desc?field.value=desc:field.select(),group.refresh=function(){var v=kb.any(subject,predicate,null,dataDoc);v&&v.value!==field.value&&(field.value=v.value)},kb.updater.editable(dataDoc.uri)?((submit=widgets.continueButton(dom,saveChange)).disabled=!0,submit.style.visibility="hidden",submit.style.float="right",group.appendChild(submit),field.addEventListener("keyup",function(_e){field.style.color="green",submit&&(submit.disabled=!1,submit.style.visibility="")},!0),field.addEventListener("change",saveChange,!0)):(field.disabled=!0,field.style.backgroundColor=_styleConstants.default.textInputBackgroundColorUneditable),group}function makeSelectForClassifierOptions(dom,kb,subject,predicate,possible,options,dataDoc,callbackFunction){log.debug("Select list length now "+possible.length);for(var actual,n=0,uris={},editable=kb.updater.editable(dataDoc.uri),i=0;i<possible.length;i++){var sub=possible[i];sub.uri||debug.warn("makeSelectForClassifierOptions: option does not have an uri: ".concat(sub,", with predicate: ").concat(predicate)),sub.uri&&!(sub.uri in uris)&&(uris[sub.uri]=!0,n++)}if(0===n&&!options.mint)return(0,_error.errorMessageBlock)(dom,"Can't do selector with no options, subject= "+subject+" property = "+predicate+".");log.debug("makeSelectForClassifierOptions: dataDoc="+dataDoc);var getActual=function getActual(){return actual={},predicate.sameTerm(ns.rdf("type"))?actual=kb.findTypeURIs(subject):kb.each(subject,predicate,null,dataDoc).forEach(function(x){actual[x.uri]=!0}),actual};actual=getActual();var select=dom.createElement("select");for(var uri in select.setAttribute("style",style.formSelectStyle),options.multiple&&select.setAttribute("multiple","true"),select.currentURI=null,select.refresh=function(){actual=getActual();for(var _i2=0;_i2<select.children.length;_i2++){var option=select.children[_i2];option.AJAR_uri&&(option.selected=option.AJAR_uri in actual)}select.disabled=!1},uris){var c=kb.sym(uri),option=dom.createElement("option");options.disambiguate?option.appendChild(dom.createTextNode(utils.labelWithOntology(c,!0))):option.appendChild(dom.createTextNode(utils.label(c,!0)));var backgroundColor=kb.any(c,kb.sym("http://www.w3.org/ns/ui#backgroundColor"));backgroundColor&&option.setAttribute("style","background-color: "+backgroundColor.value+"; "),option.AJAR_uri=uri,uri in actual&&(option.setAttribute("selected","true"),select.currentURI=uri),select.appendChild(option)}if(editable&&options.mint){var mint=dom.createElement("option");mint.appendChild(dom.createTextNode(options.mint)),mint.AJAR_mint=!0,select.insertBefore(mint,select.firstChild)}if(null==select.currentURI&&!options.multiple){var prompt=dom.createElement("option");prompt.appendChild(dom.createTextNode(options.nullLabel)),select.insertBefore(prompt,select.firstChild),prompt.selected=!0}return editable&&select.addEventListener("change",function onChange(_e){select.disabled=!0;for(var newObject,ds=[],is=[],removeValue=function removeValue(t){kb.holds(subject,predicate,t,dataDoc)&&ds.push($rdf.st(subject,predicate,t,dataDoc))},_i=0;_i<select.options.length;_i++){var opt=select.options[_i];if(opt.selected&&opt.AJAR_mint){if(options.mintClass){var thisForm=promptForNew(dom,kb,subject,predicate,options.mintClass,null,dataDoc,function(ok,body){ok||callbackFunction(ok,body,{change:"new"})});select.parentNode.appendChild(thisForm),newObject=thisForm.AJAR_subject}else newObject=newThing(dataDoc);is.push($rdf.st(subject,predicate,newObject,dataDoc)),options.mintStatementsFun&&(is=is.concat(options.mintStatementsFun(newObject)))}opt.AJAR_uri&&(opt.selected&&!(opt.AJAR_uri in actual)&&is.push($rdf.st(subject,predicate,kb.sym(opt.AJAR_uri),dataDoc)),!opt.selected&&opt.AJAR_uri in actual&&removeValue(kb.sym(opt.AJAR_uri)),opt.selected&&(select.currentURI=opt.AJAR_uri))}for(var sel=select.subSelect;sel&&sel.currentURI;)removeValue(kb.sym(sel.currentURI)),sel=sel.subSelect;for(sel=select.superSelect;sel&&sel.currentURI;)removeValue(kb.sym(sel.currentURI)),sel=sel.superSelect;function doneNew(ok,_body){callbackFunction(ok,{widget:"select",event:"new"})}log.info("makeSelectForClassifierOptions: data doc = "+dataDoc),kb.updater.update(ds,is,function(uri,ok,body){if(actual=getActual(),!ok)return select.parentNode.appendChild((0,_error.errorMessageBlock)(dom,"Error updating data in select: "+body));select.disabled=!1,newObject&&(0,_fieldFunction.fieldFunction)(dom,options.subForm)(dom,select.parentNode,{},newObject,options.subForm,dataDoc,doneNew),callbackFunction&&callbackFunction(ok,{widget:"select",event:"change"})})},!1),select}function makeSelectForCategory(dom,kb,subject,category,dataDoc,callbackFunction){var subs,du=kb.any(category,ns.owl("disjointUnionOf")),multiple=!1;return du?subs=du.elements:(subs=kb.each(void 0,ns.rdfs("subClassOf"),category),multiple=!0),log.debug("Select list length "+subs.length),0===subs.length?(0,_error.errorMessageBlock)(dom,"Can't do "+(multiple?"multiple ":"")+"selector with no subclasses of category: "+category):1===subs.length?(0,_error.errorMessageBlock)(dom,"Can't do "+(multiple?"multiple ":"")+"selector with only 1 subclass of category: "+category+":"+subs[1]):makeSelectForClassifierOptions(dom,kb,subject,ns.rdf("type"),subs,{multiple,nullLabel:"* Select type *"},dataDoc,callbackFunction)}function makeSelectForNestedCategory(dom,kb,subject,category,dataDoc,callbackFunction){function update(){child&&(container.removeChild(child),child=null),select.currentURI&&kb.any(kb.sym(select.currentURI),ns.owl("disjointUnionOf"))&&(child=makeSelectForNestedCategory(dom,kb,subject,kb.sym(select.currentURI),dataDoc,callbackFunction),select.subSelect=child.firstChild,select.subSelect.superSelect=select,container.appendChild(child))}var container=dom.createElement("span"),child=null;var select=makeSelectForCategory(dom,kb,subject,category,dataDoc,function onChange(ok,body){ok&&update(),callbackFunction(ok,body)});return container.appendChild(select),update(),container}function buildCheckboxForm(dom,kb,lab,del,ins,form,dataDoc,tristate){var box=dom.createElement("div"),rhs=(0,_basic.renderNameValuePair)(dom,kb,box,form,lab),editable=kb.updater.editable(dataDoc.uri),input=dom.createElement("button"),colorCarrier=input;function fix(x){if(!x)return[];if(x.object)return x.why||(x.why=dataDoc),[x];if(x instanceof Array)return x;throw new Error("buildCheckboxForm: bad param "+x)}function holdsAll(a){return 0===a.filter(function(st){return!kb.holds(st.subject,st.predicate,st.object,st.why)}).length}if(input.style=style.checkboxInputStyle,rhs.appendChild(input),ins=fix(ins),del=fix(del),function refresh(){var state=holdsAll(ins),displayState=state;if(del.length){var negation=holdsAll(del);if(state&&negation)return box.appendChild(widgets.errorMessageBlock(dom,"Inconsistent data in dataDoc!\n"+ins+" and\n"+del)),box;if(!state&&!negation){state=null;var defa=kb.any(form,ns.ui("default"));displayState=defa?"1"===defa.value:!!tristate&&null}}input.state=state,input.textContent={true:checkMarkCharacter,false:tristate?cancelCharacter:" ",null:dashCharacter}[displayState]}(),!editable)return box;return input.addEventListener("click",function boxHandler(_e){colorCarrier.style.color="#bbb";var toDelete=!0===input.state?ins:!1===input.state?del:[];input.newState=null===input.state||!0!==input.state&&(!tristate||null);var toInsert=!0===input.newState?ins:!1===input.newState?del:[];debug.log("  Deleting  ".concat(toDelete)),debug.log("  Inserting ".concat(toInsert)),kb.updater.update(toDelete,toInsert,function(uri,success,errorBody){if(success)colorCarrier.style.color="#000",input.state=input.newState,input.textContent={true:checkMarkCharacter,false:cancelCharacter,null:dashCharacter}[input.state];else{if(toDelete.why)kb.holds(toDelete.subject,toDelete.predicate,toDelete.object,toDelete.why)&&debug.log(" @@@@@ weird if 409 - does hold statement");colorCarrier.style.color="#000",colorCarrier.style.backgroundColor="#fee",box.appendChild((0,_error.errorMessageBlock)(dom,"Checkbox: Error updating dataDoc from ".concat(input.state," to ").concat(input.newState,":\n\n").concat(errorBody)))}})},!1),box}function newThing(doc){var now=new Date;return $rdf.sym(doc.uri+"#id"+now.getTime())}function makeSelectForChoice(dom,container,kb,subject,predicate,inputPossibleOptions,selectedOptions,uiFrom,options,dataDoc,callbackFunction){for(var optionsFromClassUIfrom={},editable=kb.updater.editable(dataDoc.uri),i=0;i<inputPossibleOptions.length;i++){var sub=inputPossibleOptions[i];sub.uri&&!(sub.uri in optionsFromClassUIfrom)&&(optionsFromClassUIfrom[sub.uri]=!0)}if(0===Object.keys(optionsFromClassUIfrom).length&&!options.mint)return(0,_error.errorMessageBlock)(dom,"Can't do selector with no options, subject= "+subject+" property = "+predicate+".");log.debug("makeSelectForChoice: dataDoc="+dataDoc);var select=dom.createElement("select");for(var uri in select.setAttribute("style",style.formSelectStyle),select.setAttribute("id","formSelect"),select.currentURI=null,optionsFromClassUIfrom)select.appendChild(createOption(uri));if(editable&&options.mint){var mint=dom.createElement("option");mint.appendChild(dom.createTextNode(options.mint)),mint.AJAR_mint=!0,select.insertBefore(mint,select.firstChild)}function createOption(uri){var label,option=dom.createElement("option"),c=kb.sym(uri);label=options.disambiguate?utils.labelWithOntology(c,!0):utils.label(c,!0),option.appendChild(dom.createTextNode(label)),option.setAttribute("value",uri);var backgroundColor=kb.any(c,kb.sym("http://www.w3.org/ns/ui#backgroundColor"));return backgroundColor&&option.setAttribute("style","background-color: "+backgroundColor.value+"; "),option.AJAR_uri=uri,containsObject(c.value,selectedOptions)&&option.setAttribute("selected","true"),option}return 0===select.children.length&&select.insertBefore(function createDefaultSelectOption(){var option=dom.createElement("option");return option.appendChild(dom.createTextNode(function createDefaultSelectOptionText(){var firstSelectOptionText="--- choice ---";return predicate&&"BlankNode"!==predicate.termType&&(firstSelectOptionText="* Select for property: "+utils.label(predicate)+" *"),subject&&"BlankNode"!==subject.termType&&(firstSelectOptionText="* Select for "+utils.label(subject,!0)+" *"),firstSelectOptionText}())),option.disabled=!0,option.value=!0,option.hidden=!0,option.selected=!0,option}(),select.firstChild),select.update=function(newSelectedOptions){selectedOptions=newSelectedOptions;var _step2,ds=[],is=[],removeValue=function removeValue(t){kb.holds(subject,predicate,t,dataDoc)&&ds.push($rdf.st(subject,predicate,t,dataDoc))},addValue=function addValue(t){kb.holds(subject,predicate,t,dataDoc)||is.push($rdf.st(subject,predicate,t,dataDoc)),uiFrom&&!kb.holds(t,ns.rdf("type"),kb.sym(uiFrom),dataDoc)&&is.push($rdf.st(t,ns.rdf("type"),kb.sym(uiFrom),dataDoc))},existingValues=kb.each(subject,predicate,null,dataDoc).map(function(object){return object.value}),_iterator2=_createForOfIteratorHelper(existingValues);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var value=_step2.value;containsObject(value,selectedOptions)||removeValue($rdf.sym(value))}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var _step3,_iterator3=_createForOfIteratorHelper(selectedOptions);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _value=_step3.value;_value in existingValues||addValue($rdf.sym(_value))}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}kb.updater.update(ds,is,function(uri,ok,body){if(!ok)return select.parentNode.appendChild((0,_error.errorMessageBlock)(dom,"Error updating data in select: "+body));select.refresh(),callbackFunction&&callbackFunction(ok,{widget:"select",event:"change"})})},select.refresh=function(){select.disabled=!0;for(var newObject,is=[],_i5=0;_i5<select.options.length;_i5++){var opt=select.options[_i5];if(opt.selected&&opt.AJAR_mint){if(options.mintClass){var thisForm=promptForNew(dom,kb,subject,predicate,uiFrom,options.subForm,dataDoc,function(ok,body){ok||callbackFunction(ok,body,{change:"new"})});select.parentNode.appendChild(thisForm),newObject=thisForm.AJAR_subject}else newObject=newThing(dataDoc);is.push($rdf.st(subject,predicate,kb.sym(newObject),dataDoc)),uiFrom&&is.push($rdf.st(newObject,ns.rdf("type"),kb.sym(uiFrom),dataDoc)),options.mintStatementsFun&&(is=is.concat(options.mintStatementsFun(newObject))),select.currentURI=newObject}opt.AJAR_uri&&(opt.selected&&containsObject(opt.AJAR_uri,selectedOptions)&&(select.currentURI=opt.AJAR_uri),containsObject(opt.AJAR_uri,selectedOptions)||opt.removeAttribute("selected"),containsObject(opt.AJAR_uri,selectedOptions)&&opt.setAttribute("selected","true"))}log.info("selectForOptions: data doc = "+dataDoc),select.currentURI&&options.subForm&&!options.multiSelect&&addSubFormChoice(dom,container,{},$rdf.sym(select.currentURI),options.subForm,dataDoc,function(ok,body){ok?(kb.updater.update([],is,function(uri,success,errorBody){success||container.appendChild((0,_error.errorMessageBlock)(dom,"Error updating select: "+errorBody))}),callbackFunction&&callbackFunction(ok,{widget:"select",event:"new"})):container.appendChild((0,_error.errorMessageBlock)(dom,"Error updating data in field of select: "+body))}),select.disabled=!1},editable&&select.addEventListener("change",function onChange(_e){container.removeChild(container.lastChild),select.refresh()},!1),select}function containsObject(obj,list){var i;for(i=0;i<list.length;i++)if(list[i]===obj)return!0;return!1}_fieldFunction.field[ns.ui("AutocompleteField").uri]=_autocompleteField.autocompleteField,_fieldFunction.field[ns.ui("Form").uri]=_fieldFunction.field[ns.ui("Group").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){var box=dom.createElement("div"),ui=ns.ui;if(container&&container.appendChild(box),form){var key=subject.toNT()+"|"+form.toNT();if(already[key])return box.appendChild(dom.createTextNode("Group: see above "+key)),box;var already2={};for(var x in already)already2[x]=1;already2[key]=1;var formDoc=form.doc?form.doc():null,weight0=kb.any(form,ui("weight"),null,formDoc),weight=weight0?Number(weight0.value):1;if(weight>3||weight<0)return box.appendChild((0,_error.errorMessageBlock)(dom,"Form Group weight ".concat(weight," should be 0-3")));box.setAttribute("style",style.formGroupStyle[weight]),box.style.display="flex",box.style.flexDirection="column",box.class="form-weight-"+weight;var subfields,parts=kb.any(form,ui("parts"),null,formDoc);if(parts?subfields=parts.elements:(parts=kb.each(form,ui("part"),null,formDoc),subfields=sortBySequence(parts)),!parts)return box.appendChild((0,_error.errorMessageBlock)(dom,"No parts to form! "));for(var i=0;i<subfields.length;i++){var _field2=subfields[i],subFieldFunction=(0,_fieldFunction.fieldFunction)(dom,_field2),itemChanged=function itemChanged(ok,body){ok&&body&&body.widget&&"select"===body.widget&&refreshOpionsSubfieldinGroup(dom,already,subject,dataDoc,callbackFunction,box,subfields),callbackFunction(ok,{widget:"group",change:body})};box.appendChild(subFieldFunction(dom,null,already2,subject,_field2,dataDoc,itemChanged))}return box}},_fieldFunction.field[ns.ui("Options").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){var kb=_solidLogic.store,box=dom.createElement("div"),formDoc=form.doc?form.doc():null,ui=ns.ui;container&&container.appendChild(box);var dependingOn=kb.any(form,ui("dependingOn"));dependingOn||(dependingOn=ns.rdf("type"));var values,cases=kb.each(form,ui("case"),null,formDoc);cases||box.appendChild((0,_error.errorMessageBlock)(dom,"No cases to Options form. ")),values=dependingOn.sameTerm(ns.rdf("type"))?Object.keys(kb.findTypeURIs(subject)).map(function(uri){return $rdf.sym(uri)}):kb.each(subject,dependingOn);for(var i=0;i<cases.length;i++){for(var c=cases[i],tests=kb.each(c,ui("for"),null,formDoc),match=!1,j=0;j<tests.length;j++){var _step,_iterator=_createForOfIteratorHelper(values);try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value,test=tests[j];(value.sameTerm(tests)||value.termType===test.termType&&value.value===test.value)&&(match=!0)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}if(match){var _field3=kb.the(c,ui("use"));if(!_field3)return box.appendChild((0,_error.errorMessageBlock)(dom,'No "use" part for case in form '+form)),box;appendForm(dom,box,already,subject,_field3,dataDoc,callbackFunction);break}}return box},_fieldFunction.field[ns.ui("Multiple").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){function debugString(values){return values.map(function(x){return x.toString().slice(-7)}).join(", ")}function addItem(){return _addItem.apply(this,arguments)}function _addItem(){return(_addItem=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(){var object,toBeInserted,msg,_t;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(object=newThing(dataDoc),!ordered){_context6.next=2;break}return createListIfNecessary(),list.elements.push(object),_context6.next=1,saveListThenRefresh();case 1:_context6.next=7;break;case 2:return toBeInserted=reverse?[$rdf.st(object,property,subject,dataDoc)]:[$rdf.st(subject,property,object,dataDoc)],_context6.prev=3,_context6.next=4,kb.updater.update([],toBeInserted);case 4:_context6.next=6;break;case 5:_context6.prev=5,_t=_context6.catch(3),msg="Error adding to unordered multiple: "+_t,box.appendChild((0,_error.errorMessageBlock)(dom,msg)),debug.error(msg);case 6:refresh();case 7:case"end":return _context6.stop()}},_callee6,null,[[3,5]])}))).apply(this,arguments)}function renderItem(object){function _deleteThisItem(){return(_deleteThisItem=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(){var i,del;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!ordered){_context3.next=5;break}debug.log("pre delete: "+debugString(list.elements)),i=0;case 1:if(!(i<list.elements.length)){_context3.next=4;break}if(!list.elements[i].sameTerm(object)){_context3.next=3;break}return list.elements.splice(i,1),_context3.next=2,saveListThenRefresh();case 2:return _context3.abrupt("return");case 3:i++,_context3.next=1;break;case 4:_context3.next=6;break;case 5:kb.holds(subject,property,object,dataDoc)&&(del=[$rdf.st(subject,property,object,dataDoc)],kb.updater.update(del,[],function(uri,ok,message){ok?body.removeChild(subField):body.appendChild((0,_error.errorMessageBlock)(dom,"Multiple: delete failed: "+message))}));case 6:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)}function moveThisItem(_x,_x2){return _moveThisItem.apply(this,arguments)}function _moveThisItem(){return(_moveThisItem=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(event,upwards){var i;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:debug.log("pre move: "+debugString(list.elements)),i=0;case 1:if(!(i<list.elements.length)){_context4.next=3;break}if(!list.elements[i].sameTerm(object)){_context4.next=2;break}return _context4.abrupt("continue",3);case 2:i++,_context4.next=1;break;case 3:if(i===list.elements.length&&alert("list move: not found element for "+object),!upwards){_context4.next=5;break}if(0!==i){_context4.next=4;break}return alert("@@ boop - already at top   -temp message"),_context4.abrupt("return");case 4:list.elements.splice(i-1,2,list.elements[i],list.elements[i-1]),_context4.next=7;break;case 5:if(i!==list.elements.length-1){_context4.next=6;break}return alert("@@ boop - already at bottom   -temp message"),_context4.abrupt("return");case 6:list.elements.splice(i,2,list.elements[i+1],list.elements[i]);case 7:return _context4.next=8,saveListThenRefresh();case 8:case"end":return _context4.stop()}},_callee4)}))).apply(this,arguments)}log.debug("Multiple: render object: "+object);var subField=(0,_fieldFunction.fieldFunction)(dom,element)(dom,null,already,object,element,dataDoc,function itemDone(ok,message){debug.log("Item done callback for item ".concat(object.toString())),ok||debug.error("  Item done callback: Error: "+message),callbackFunction(ok,message)});if(subField.subject=object,kb.updater.editable(dataDoc.uri)&&(buttons.deleteButtonWithCheck(dom,subField,multipleUIlabel,function deleteThisItem(){return _deleteThisItem.apply(this,arguments)}),ordered)){var frame=dom.createElement("div");frame.style.display="grid",frame.style.gridTemplateColumns="auto 3em",frame.style.gridTemplateRows="50% 50%";var moveUpButton=buttons.button(dom,_iconBase.icons.iconBase+"noun_1369237.svg","Move Up",function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(event){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",moveThisItem(event,!0));case 1:case"end":return _context.stop()}},_callee)}));return function(_x3){return _ref.apply(this,arguments)}}()),moveDownButton=buttons.button(dom,_iconBase.icons.iconBase+"noun_1369241.svg","Move Down",function(){var _ref2=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(event){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",moveThisItem(event,!1));case 1:case"end":return _context2.stop()}},_callee2)}));return function(_x4){return _ref2.apply(this,arguments)}}()),_shim=dom.createElement("div");return _shim.appendChild(subField),frame.appendChild(_shim),frame.appendChild(moveUpButton),frame.appendChild(moveDownButton),moveUpButton.style.gridColumn=2,moveDownButton.style.gridColumn=2,moveUpButton.style.gridRow=1,moveDownButton.style.padding="0em",moveUpButton.style.padding="0em",moveDownButton.style.gridRow=2,_shim.style.gridColumn=1,_shim.style.gridRowStart="span 2",frame}return subField}var plusIconURI=_iconBase.icons.iconBase+"noun_19460_green.svg",kb=_solidLogic.store,formDoc=form.doc?form.doc():null,box=dom.createElement("div"),shim=box,ui=ns.ui;container&&container.appendChild(box);var orderedNode=kb.any(form,ui("ordered")),ordered=!!orderedNode&&$rdf.Node.toJS(orderedNode),property=kb.any(form,ui("property")),reverse=kb.anyJS(form,ui("reverse"),null,formDoc);if(!property)return box.appendChild((0,_error.errorMessageBlock)(dom,"No property to multiple: "+form)),shim;var multipleUIlabel=kb.any(form,ui("label"));multipleUIlabel||(multipleUIlabel=utils.label(property));var min=kb.any(form,ui("min"));min=min?0+min.value:0;var element=kb.any(form,ui("part"));if(!element)return box.appendChild((0,_error.errorMessageBlock)(dom,"No part to multiple: "+form)),shim;var list,values,body=box.appendChild(dom.createElement("div"));if(body.style.display="flex",body.style.flexDirection="column",values=reverse?kb.any(null,property,subject,dataDoc):kb.any(subject,property,null,dataDoc),ordered?(list=reverse?kb.any(null,property,subject,dataDoc):kb.any(subject,property,null,dataDoc),values=list?list.elements:[]):(values=reverse?kb.each(null,property,subject,dataDoc):kb.each(subject,property,null,dataDoc),list=null),kb.updater.editable(dataDoc.uri)){var tail=box.appendChild(dom.createElement("div"));tail.style.padding="0.5em";var img=tail.appendChild(dom.createElement("img"));img.setAttribute("src",plusIconURI),img.setAttribute("style","margin: 0.2em; width: 1.5em; height:1.5em"),img.title="Click to add another "+multipleUIlabel;var prompt=dom.createElement("span");prompt.textContent=(0===values.length?"Add another ":"Add ")+multipleUIlabel,tail.addEventListener("click",function(){var _ref3=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(_eventNotUsed){return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=1,addItem();case 1:case"end":return _context5.stop()}},_callee5)}));return function(_x5){return _ref3.apply(this,arguments)}}(),!0),tail.appendChild(prompt)}function createListIfNecessary(){list||(list=new $rdf.Collection,reverse?kb.add(list,property,subject,dataDoc):kb.add(subject,property,list,dataDoc))}function saveListThenRefresh(){return _saveListThenRefresh.apply(this,arguments)}function _saveListThenRefresh(){return(_saveListThenRefresh=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(){var _t2;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return debug.log("save list: "+debugString(list.elements)),createListIfNecessary(),_context7.prev=1,_context7.next=2,kb.fetcher.putBack(dataDoc);case 2:_context7.next=4;break;case 3:return _context7.prev=3,_t2=_context7.catch(1),box.appendChild((0,_error.errorMessageBlock)(dom,"Error trying to put back a list: "+_t2)),_context7.abrupt("return");case 4:refresh();case 5:case"end":return _context7.stop()}},_callee7,null,[[1,3]])}))).apply(this,arguments)}function refresh(){var vals;if(ordered){var li=reverse?kb.the(null,property,subject,dataDoc):kb.the(subject,property,null,dataDoc);vals=li?li.elements:[]}else(vals=reverse?kb.each(null,property,subject,dataDoc):kb.each(subject,property,null,dataDoc)).sort();utils.syncTableToArrayReOrdered(body,vals,renderItem)}function _asyncStuff(){return(_asyncStuff=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(){var extra,j;return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!((extra=min-values.length)>0)){_context8.next=4;break}j=0;case 1:if(!(j<extra)){_context8.next=3;break}return debug.log("Adding extra: min "+min),_context8.next=2,addItem();case 2:j++,_context8.next=1;break;case 3:return _context8.next=4,saveListThenRefresh();case 4:case"end":return _context8.stop()}},_callee8)}))).apply(this,arguments)}return body.refresh=refresh,refresh(),function asyncStuff(){return _asyncStuff.apply(this,arguments)}().then(function(){debug.log(" Multiple render: async stuff ok")},function(err){debug.error(" Multiple render: async stuff fails. #### ",err)}),shim},_fieldFunction.field[ns.ui("PhoneField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("EmailField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("ColorField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("DateField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("DateTimeField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("TimeField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("NumericField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("IntegerField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("DecimalField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("FloatField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("TextField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("SingleLineTextField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("NamedNodeURIField").uri]=_basic.basicField,_fieldFunction.field[ns.ui("MultiLineTextField").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){var ui=ns.ui,kb=_solidLogic.store,formDoc=form.doc?form.doc():null,property=kb.any(form,ui("property"));if(!property)return(0,_error.errorMessageBlock)(dom,"No property to text field: "+form);var box=dom.createElement("div");box.style.display="flex",box.style.flexDirection="row";var left=box.appendChild(dom.createElement("div"));left.style.width=_styleConstants.default.formFieldNameBoxWidth;var right=box.appendChild(dom.createElement("div"));left.appendChild((0,_basic.fieldLabel)(dom,property,form)),dataDoc=(0,_basic.fieldStore)(subject,property,dataDoc);var text=kb.anyJS(subject,property,null,dataDoc)||"",editable=kb.updater.editable(dataDoc.uri),suppressEmptyUneditable=form&&kb.anyJS(form,ns.ui("suppressEmptyUneditable"),null,formDoc);!editable&&suppressEmptyUneditable&&""===text&&(box.style.display="none");var field=makeDescription(dom,kb,subject,property,dataDoc,callbackFunction);return right.appendChild(field),container&&container.appendChild(box),box},_fieldFunction.field[ns.ui("BooleanField").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){return booleanField(dom,container,0,subject,form,dataDoc,0,!1)},_fieldFunction.field[ns.ui("TristateField").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){return booleanField(dom,container,0,subject,form,dataDoc,0,!0)},_fieldFunction.field[ns.ui("Classifier").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){var kb=_solidLogic.store,ui=ns.ui,category=kb.any(form,ui("category"));if(!category)return(0,_error.errorMessageBlock)(dom,"No category for classifier: "+form);log.debug("Classifier: dataDoc="+dataDoc);var box=makeSelectForNestedCategory(dom,kb,subject,category,dataDoc,function checkOptions(ok,body){return callbackFunction(ok,body)});return container&&container.appendChild(box),box},_fieldFunction.field[ns.ui("Choice").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){var p,ui=ns.ui,kb=_solidLogic.store,formDoc=form.doc?form.doc():null,box=dom.createElement("div");box.setAttribute("class","choiceBox"),container&&container.appendChild(box);var lhs=dom.createElement("div");lhs.setAttribute("class","formFieldName choiceBox-label"),box.appendChild(lhs);var rhs=dom.createElement("div");rhs.setAttribute("class","formFieldValue choiceBox-selectBox"),box.appendChild(rhs);var property=kb.any(form,ui("property"));if(!property)return box.appendChild((0,_error.errorMessageBlock)(dom,"No property for Choice: "+form));lhs.appendChild((0,_basic.fieldLabel)(dom,property,form));var uiFrom=kb.any(form,ui("from"));if(!uiFrom)return(0,_error.errorMessageBlock)(dom,"No 'from' for Choice: "+form);var subForm=kb.any(form,ui("use")),opts={form,subForm,disambiguate:!1};kb.any(form,ui("canMintNew"))&&(opts.mint="* Create new *");var multiSelect=kb.any(form,ui("multiselect"));multiSelect&&(opts.multiSelect=!0);var selector,dataSource=kb.each(form,ui("search-full-store")).length?null:dataDoc;return rhs.refresh=function(){var selectedOptions=kb.each(subject,property,null,dataDoc).map(function(object){return object.value}),possibleOptions=function getSelectorOptions(dataSource){var possibleProperties,possible=[];for(var x in possible=kb.each(void 0,ns.rdf("type"),uiFrom,formDoc),function findMembersNT(store,thisClass,quad){var len2,len4,m,pred,ref1,ref2,ref3,ref4,ref5,st,u,seeds={};seeds[thisClass.toNT()]=!0;var members={},ref=store.transitiveClosure(seeds,store.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(var t in ref){for(var i=0,len=(ref1=store.statementsMatching(null,store.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),store.fromNT(t),quad)).length;i<len;i++)members[(st=ref1[i]).subject.toNT()]=st;for(var l=0,len1=(ref2=store.each(null,store.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#domain"),store.fromNT(t),quad)).length;l<len1;l++)for(pred=ref2[l],m=0,len2=(ref3=store.statementsMatching(null,pred,null,quad)).length;m<len2;m++)members[(st=ref3[m]).subject.toNT()]=st;for(var q=0,len3=(ref4=store.each(null,store.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#range"),store.fromNT(t),quad)).length;q<len3;q++)for(pred=ref4[q],u=0,len4=(ref5=store.statementsMatching(null,pred,null,quad)).length;u<len4;u++)members[(st=ref5[u]).object.toNT()]=st}return members}(kb,uiFrom,dataSource))possible.push(kb.fromNT(x));if(uiFrom.sameTerm(ns.rdfs("Class")))for(p in buttons.allClassURIs())possible.push(kb.sym(p));else if(uiFrom.sameTerm(ns.rdf("Property"))){for(p in(possibleProperties=buttons.propertyTriage(kb)).op)possible.push(kb.fromNT(p));for(p in possibleProperties.dp)possible.push(kb.fromNT(p));opts.disambiguate=!0}else if(uiFrom.sameTerm(ns.owl("ObjectProperty"))){for(p in(possibleProperties=buttons.propertyTriage(kb)).op)possible.push(kb.fromNT(p));opts.disambiguate=!0}else if(uiFrom.sameTerm(ns.owl("DatatypeProperty"))){for(p in(possibleProperties=buttons.propertyTriage(kb)).dp)possible.push(kb.fromNT(p));opts.disambiguate=!0}return possible}(dataSource);if(possibleOptions.push(selectedOptions),possibleOptions=sortByLabel(possibleOptions),selector=makeSelectForChoice(dom,rhs,kb,subject,property,possibleOptions,selectedOptions,uiFrom,opts,dataDoc,callbackFunction),rhs.innerHTML="",rhs.appendChild(selector),multiSelect){var multiSelectDiv=new _multiSelect.IconicMultiSelect({placeholder:selector.selected,select:selector,container:rhs,textField:"textField",valueField:"valueField"});multiSelectDiv.init(),multiSelectDiv.subscribe(function(event){if("REMOVE_OPTION"===event.action&&(selectedOptions=selectedOptions.filter(function(value){return value!==event.value})),"CLEAR_ALL_OPTIONS"===event.action&&(selectedOptions=[]),"ADD_OPTION"===event.action)if((event.value+"").includes("Create new")){var newObject=newThing(dataDoc),is=[];is.push($rdf.st(subject,property,kb.sym(newObject),dataDoc)),uiFrom&&is.push($rdf.st(newObject,ns.rdf("type"),kb.sym(uiFrom),dataDoc)),subForm&&addSubFormChoice(dom,rhs,{},$rdf.sym(newObject),subForm,dataDoc,function(ok,body){ok?(kb.updater.update([],is,function(uri,success,errorBody){success||rhs.appendChild((0,_error.errorMessageBlock)(dom,"Error updating select: "+errorBody))}),selectedOptions.push(newObject),callbackFunction&&callbackFunction(ok,{widget:"select",event:"new"})):rhs.appendChild((0,_error.errorMessageBlock)(dom,"Error updating data in field of select: "+body))})}else selectedOptions.push(event.value);selector.update(selectedOptions)})}},rhs.refresh(),selector&&selector.refresh&&selector.refresh(),box},_fieldFunction.field[ns.ui("Comment").uri]=_fieldFunction.field[ns.ui("Heading").uri]=function(dom,container,already,subject,form,dataDoc,_callbackFunction){var ui=ns.ui,kb=_solidLogic.store,contents=kb.any(form,ui("contents"));contents||(contents="Error: No contents in comment field.");var formDoc=form.doc?form.doc():null,uri=(0,_fieldFunction.mostSpecificClassURI)(form),params=_fieldParams.fieldParams[uri]||{},box=dom.createElement("div");container&&container.appendChild(box);var p=box.appendChild(dom.createElement(params.element));p.textContent=contents,(0,_formStyle.setFieldStyle)(p,form);var suppressIfUneditable=kb.anyJS(form,ns.ui("suppressIfUneditable"),null,formDoc),editable=kb.updater.editable(dataDoc.uri);return suppressIfUneditable&&!editable&&(box.style.display="none"),box}},"./lib/widgets/forms/autocomplete/autocompleteBar.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderAutocompleteControl=function renderAutocompleteControl(_x,_x2,_x3,_x4,_x5,_x6){return _renderAutocompleteControl.apply(this,arguments)};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_iconBase=__webpack_require__("./lib/iconBase.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),utils=_interopRequireWildcard(__webpack_require__("./lib/utils/index.js")),_autocompletePicker=__webpack_require__("./lib/widgets/forms/autocomplete/autocompletePicker.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var GREEN_PLUS=_iconBase.icons.iconBase+"noun_34653_green.svg",SEARCH_ICON=_iconBase.icons.iconBase+"noun_Search_875351.svg",EDIT_ICON=_iconBase.icons.iconBase+"noun_253504.svg";function _renderAutocompleteControl(){return _renderAutocompleteControl=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(dom,person,barOptions,acOptions,addOneIdAndRefresh,deleteOne){var autoCompleteDone,_autoCompleteDone,greenButtonHandler,_greenButtonHandler,removeDecorated,displayAutocomplete,_displayAutocomplete,searchButtonHandler,_searchButtonHandler,droppedURIHandler,_droppedURIHandler,acceptButton,cancelButton,deleteButtonContainer,noun,deleteButton,editButton,editing,syncEditingStatus,decoration,decoratedAutocomplete,creationArea,plus;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(syncEditingStatus=function _syncEditingStatus(){editing?((0,_autocompletePicker.setVisible)(editButton,!1),(0,_autocompletePicker.setVisible)(acceptButton,!1),(0,_autocompletePicker.setVisible)(cancelButton,!1)):((0,_autocompletePicker.setVisible)(editButton,!0),(0,_autocompletePicker.setVisible)(acceptButton,!1),(0,_autocompletePicker.setVisible)(cancelButton,!1))},_droppedURIHandler=function _droppedURIHandler3(){return(_droppedURIHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(uris){var _iterator,_step,webid,_t2;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:_iterator=_createForOfIteratorHelper(uris),_context5.prev=1,_iterator.s();case 2:if((_step=_iterator.n()).done){_context5.next=4;break}return webid=_step.value,_context5.next=3,addOneIdAndRefresh(person,webid);case 3:_context5.next=2;break;case 4:_context5.next=6;break;case 5:_context5.prev=5,_t2=_context5.catch(1),_iterator.e(_t2);case 6:return _context5.prev=6,_iterator.f(),_context5.finish(6);case 7:case"end":return _context5.stop()}},_callee5,null,[[1,5,6,7]])}))).apply(this,arguments)},droppedURIHandler=function _droppedURIHandler2(_x1){return _droppedURIHandler.apply(this,arguments)},_searchButtonHandler=function _searchButtonHandler3(){return(_searchButtonHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(_event){return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!decoratedAutocomplete){_context4.next=1;break}creationArea.removeChild(decoratedAutocomplete),decoratedAutocomplete=void 0,_context4.next=2;break;case 1:return _context4.next=2,displayAutocomplete();case 2:case"end":return _context4.stop()}},_callee4)}))).apply(this,arguments)},searchButtonHandler=function _searchButtonHandler2(_x0){return _searchButtonHandler.apply(this,arguments)},_displayAutocomplete=function _displayAutocomplete3(){return(_displayAutocomplete=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(){var _t;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return(decoratedAutocomplete=dom.createElement("div")).setAttribute("style","display: flex; flex-flow: wrap;"),_t=decoratedAutocomplete,_context3.next=1,(0,_autocompletePicker.renderAutoComplete)(dom,acOptions,decoration,autoCompleteDone);case 1:_t.appendChild.call(_t,_context3.sent),decoratedAutocomplete.appendChild(acceptButton),decoratedAutocomplete.appendChild(cancelButton),decoratedAutocomplete.appendChild(editButton),decoratedAutocomplete.appendChild(deleteButtonContainer),creationArea.appendChild(decoratedAutocomplete);case 2:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)},displayAutocomplete=function _displayAutocomplete2(){return _displayAutocomplete.apply(this,arguments)},removeDecorated=function _removeDecorated(){decoratedAutocomplete&&(creationArea.removeChild(decoratedAutocomplete),decoratedAutocomplete=void 0)},_greenButtonHandler=function _greenButtonHandler3(){return(_greenButtonHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(_event){var webid;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=1,widgets.askName(dom,_solidLogic.store,creationArea,ns.vcard("url"),void 0,"Solid ID");case 1:if(webid=_context2.sent){_context2.next=2;break}return _context2.abrupt("return");case 2:return _context2.abrupt("return",addOneIdAndRefresh(person,webid));case 3:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)},greenButtonHandler=function _greenButtonHandler2(_x9){return _greenButtonHandler.apply(this,arguments)},_autoCompleteDone=function _autoCompleteDone3(){return(_autoCompleteDone=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(object,name){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return acOptions.permanent?((0,_autocompletePicker.setVisible)(editButton,!0),(0,_autocompletePicker.setVisible)(acceptButton,!1),(0,_autocompletePicker.setVisible)(cancelButton,!1)):removeDecorated(),_context.abrupt("return",addOneIdAndRefresh(object,name));case 1:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)},autoCompleteDone=function _autoCompleteDone2(_x7,_x8){return _autoCompleteDone.apply(this,arguments)},(acceptButton=widgets.continueButton(dom)).setAttribute("data-testid","accept-button"),(cancelButton=widgets.cancelButton(dom)).setAttribute("data-testid","cancel-button"),deleteButtonContainer=dom.createElement("div"),noun=acOptions.targetClass?utils.label(acOptions.targetClass):"item",(deleteButton=widgets.deleteButtonWithCheck(dom,deleteButtonContainer,noun,deleteOne)).setAttribute("data-testid","delete-button"),(editButton=widgets.button(dom,EDIT_ICON,"Edit",function(_event){editing=!editing,syncEditingStatus()})).setAttribute("data-testid","edit-button"),editing=!0,decoration={acceptButton,cancelButton,editButton,deleteButton},decoratedAutocomplete=void 0,(creationArea=dom.createElement("div")).style.display="flex",creationArea.style.flexDirection="row",!acOptions.permanent&&!acOptions.currentObject){_context6.next=1;break}return _context6.next=1,displayAutocomplete();case 1:return barOptions.editable&&(creationArea.style.width="100%",barOptions.manualURIEntry&&(plus=creationArea.appendChild(widgets.button(dom,GREEN_PLUS,barOptions.idNoun,greenButtonHandler)),widgets.makeDropTarget(plus,droppedURIHandler,void 0)),!barOptions.dbLookup||acOptions.currentObject||acOptions.permanent||creationArea.appendChild(widgets.button(dom,SEARCH_ICON,barOptions.idNoun,searchButtonHandler))),syncEditingStatus(),_context6.abrupt("return",creationArea);case 2:case"end":return _context6.stop()}},_callee6)})),_renderAutocompleteControl.apply(this,arguments)}},"./lib/widgets/forms/autocomplete/autocompleteField.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.autocompleteField=function autocompleteField(dom,container,already,subject,form,doc,callbackFunction){var _kb$updater;function _addOneIdAndRefresh(){return(_addOneIdAndRefresh=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(result,name){var oldValue,oldName,deletables,insertables,_kb$updater2,_t;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(name){_context.next=1;break}throw new Error("autocompleteField:  No name set.");case 1:if(!(oldValue=kb.the(subject,property,null,doc))){_context.next=2;break}if(oldName=kb.any(oldValue,labelProperty,null,doc),!(oldValue.equals(result)&&oldName&&oldName.sameTerm(name))){_context.next=2;break}return _context.abrupt("return");case 2:return deletables=oldValue?kb.statementsMatching(subject,property,oldValue,doc).concat(kb.statementsMatching(oldValue,labelProperty,null,doc)):[],insertables=[(0,_rdflib.st)(subject,property,result,doc),(0,_rdflib.st)(result,labelProperty,name,doc)],_context.prev=3,_context.next=4,null===(_kb$updater2=kb.updater)||void 0===_kb$updater2?void 0:_kb$updater2.updateMany(deletables,insertables);case 4:_context.next=6;break;case 5:return _context.prev=5,_t=_context.catch(3),callbackFunction(!1,_t),box.appendChild(widgets.errorMessageBlock(dom,"Autocomplete form data update error:"+_t,null,_t)),_context.abrupt("return");case 6:callbackFunction(!0,"");case 7:case"end":return _context.stop()}},_callee,null,[[3,5]])}))).apply(this,arguments)}function _deleteOne(){return(_deleteOne=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(_result,_name){var oldValue,deletables,insertables,_kb$updater3,e2,_t2;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(oldValue=kb.the(subject,property,null,doc)){_context2.next=1;break}return callbackFunction(!1,"NO data to elete"),box.appendChild(widgets.errorMessageBlock(dom,"Autocomplete delete: no old data!")),_context2.abrupt("return");case 1:return deletables=kb.statementsMatching(subject,property,oldValue,doc).concat(kb.statementsMatching(oldValue,labelProperty,null,doc)),insertables=[],_context2.prev=2,_context2.next=3,null===(_kb$updater3=kb.updater)||void 0===_kb$updater3?void 0:_kb$updater3.updateMany(deletables,insertables);case 3:_context2.next=5;break;case 4:return _context2.prev=4,_t2=_context2.catch(2),e2=new Error("Autocomplete form data delete error:"+_t2),callbackFunction(!1,_t2),box.appendChild(widgets.errorMessageBlock(dom,e2,null,_t2)),_context2.abrupt("return");case 5:callbackFunction(!0,"");case 6:case"end":return _context2.stop()}},_callee2,null,[[2,4]])}))).apply(this,arguments)}if("NamedNode"!==subject.termType)throw new Error("Sorry this field only works on NamedNode subjects (for editable)");var kb=_solidLogic.store,formDoc=form.doc?form.doc():null,box=dom.createElement("div");container&&container.appendChild(box);var lhs=dom.createElement("div");lhs.setAttribute("class","formFieldName"),lhs.setAttribute("style",style.formFieldNameBoxStyle),box.appendChild(lhs);var rhs=dom.createElement("div");rhs.setAttribute("class","formFieldValue"),box.appendChild(rhs);var property=kb.any(form,ns.ui("property"));if(!property)return box.appendChild(widgets.errorMessageBlock(dom,"Error: No property given for autocomplete field: "+form));var labelProperty=kb.any(form,ns.ui("labelProperty"))||ns.schema("name"),dataSource=kb.any(form,ns.ui("dataSource"));if(!dataSource)return box.appendChild(widgets.errorMessageBlock(dom,"Error: No data source given for autocomplete field: "+form));var queryParams={label:kb.anyJS(dataSource,ns.schema("name"),null,dataSource.doc()),logo:kb.any(dataSource,ns.schema("logo"),null,dataSource.doc())},targetClass=kb.any(form,ns.ui("targetClass"),null,form.doc())||kb.any(dataSource,ns.ui("targetClass"),null,dataSource.doc());targetClass&&(queryParams.targetClass=targetClass);queryParams.objectURIBase=kb.any(dataSource,ns.ui("objectURIBase"),null,dataSource.doc())||void 0;var endpoint=kb.anyJS(dataSource,ns.ui("endpoint"),null,dataSource.doc());if(endpoint){if(queryParams.endpoint=endpoint,queryParams.searchByNameQuery=kb.anyJS(dataSource,ns.ui("searchByNameQuery"),null,dataSource.doc()),!queryParams.searchByNameQuery)return box.appendChild(widgets.errorMessageBlock(dom,"Error: No searchByNameQuery given for endpoint data Source: "+form));queryParams.insitituteDetailsQuery=kb.anyJS(dataSource,ns.ui("insitituteDetailsQuery"),null,dataSource.doc())}else{var searchByNameURI=kb.anyJS(dataSource,ns.ui("searchByNameURI"));if(!searchByNameURI)return box.appendChild(widgets.errorMessageBlock(dom,"Error: No searchByNameURI OR sparql endpoint given for dataSource: "+dataSource));queryParams.searchByNameURI=searchByNameURI}var suppressEmptyUneditable=kb.anyJS(form,ns.ui("suppressEmptyUneditable"),null,formDoc),editable=null===(_kb$updater=kb.updater)||void 0===_kb$updater?void 0:_kb$updater.editable(doc.uri),autocompleteOptions={permanent:!0,targetClass:queryParams.targetClass,queryParams};autocompleteOptions.size=kb.anyJS(form,ns.ui("size"),null,formDoc)||void 0;var obj=kb.any(subject,property,void 0,doc);if(obj)autocompleteOptions.currentObject=obj,autocompleteOptions.currentName=kb.any(autocompleteOptions.currentObject,labelProperty,null,doc);else if(obj=kb.any(form,ns.ui("default")))autocompleteOptions.currentObject=obj,autocompleteOptions.currentName=kb.any(autocompleteOptions.currentObject,labelProperty,null,doc);else if(suppressEmptyUneditable&&!editable)return box.style.display="none",box;lhs.appendChild(widgets.fieldLabel(dom,property,form));var barOptions={editable,dbLookup:!0};return(0,_autocompleteBar.renderAutocompleteControl)(dom,subject,barOptions,autocompleteOptions,function addOneIdAndRefresh(_x,_x2){return _addOneIdAndRefresh.apply(this,arguments)},function deleteOne(_x3,_x4){return _deleteOne.apply(this,arguments)}).then(function(control){rhs.appendChild(control)},function(err){rhs.appendChild(widgets.errorMessageBlock(dom,"Error rendering autocomplete ".concat(form,": ").concat(err),"#fee",err))}),box};var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_autocompleteBar=__webpack_require__("./lib/widgets/forms/autocomplete/autocompleteBar.js"),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}},"./lib/widgets/forms/autocomplete/autocompletePicker.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderAutoComplete=function renderAutoComplete(_x,_x2,_x3,_x4){return _renderAutoComplete.apply(this,arguments)},exports.setVisible=setVisible;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),style=_interopRequireWildcard(__webpack_require__("./lib/style.js")),_styleConstants=_interopRequireDefault(__webpack_require__("./lib/styleConstants.js")),widgets=_interopRequireWildcard(__webpack_require__("./lib/widgets/index.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_publicData=__webpack_require__("./lib/widgets/forms/autocomplete/publicData.js"),_language=__webpack_require__("./lib/widgets/forms/autocomplete/language.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t2 in e)"default"!==_t2&&{}.hasOwnProperty.call(e,_t2)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t2))&&(i.get||i.set)?o(f,_t2,i):f[_t2]=e[_t2]);return f})(e,t)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function setVisible(element,visible){element.style.display=visible?"":"none"}function _renderAutoComplete(){return _renderAutoComplete=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(dom,acOptions,decoration,callback){var complain,finish,gotIt,_gotIt,acceptButtonHandler,_acceptButtonHandler,cancelButtonHandler,_cancelButtonHandler,nameMatch,clearList,inputEventHHandler,_inputEventHHandler,loadBindingsAndFilterByLanguage,_loadBindingsAndFilterByLanguage,filterByName,refreshList,_refreshList,initialize,targetClass,lastBindings,loadedEnough,inputEventHandlerLock,allDisplayed,lastFilter,numberOfRows,div,foundName,foundObject,table,head,cell,searchInput,size,searchInputStyle;return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(initialize=function _initialize(){acOptions.currentObject?(searchInput.value=acOptions.currentName?acOptions.currentName.value:"??? wot no name for "+acOptions.currentObject,foundName=acOptions.currentName,lastFilter=acOptions.currentName?acOptions.currentName.value:void 0,foundObject=acOptions.currentObject):(searchInput.value="",lastFilter=void 0,foundObject=void 0),decoration.deleteButton&&setVisible(decoration.deleteButton,!!acOptions.currentObject),decoration.acceptButton&&setVisible(decoration.acceptButton,!1),decoration.editButton&&setVisible(decoration.editButton,!0),decoration.cancelButton&&setVisible(decoration.cancelButton,!1),inputEventHandlerLock=!1,clearList()},_refreshList=function _refreshList3(){return _refreshList=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(){var rowForBinding,compareBindingsByName,languagePrefs,filter,slimmed,displayable,_iterator,_step,binding;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(compareBindingsByName=function _compareBindingsByNam(self,other){return other.name.value>self.name.value?1:other.name.name<self.name.value?-1:0},rowForBinding=function _rowForBinding(binding){var row=dom.createElement("tr");style.setStyle(row,"autocompleteRowStyle"),row.setAttribute("style","padding: 0.3em;"),row.style.color=allDisplayed?"#080":"#088",row.textContent=binding.name.value;var object=(0,_publicData.bindingToTerm)(binding.subject),nameTerm=(0,_publicData.bindingToTerm)(binding.name);return row.addEventListener("click",function(){var _ref=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(_event){return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:debug.log("       click row textContent: "+row.textContent),debug.log("       click name: "+nameTerm.value),object&&nameTerm&&gotIt(object,nameTerm);case 1:case"end":return _context6.stop()}},_callee6)}));return function(_x10){return _ref.apply(this,arguments)}}()),row},!inputEventHandlerLock){_context7.next=1;break}return debug.log('Ignoring "'.concat(searchInput.value,'" because of lock ')),_context7.abrupt("return");case 1:return debug.log('Setting lock at "'.concat(searchInput.value,'"')),inputEventHandlerLock=!0,_context7.next=2,(0,_language.getPreferredLanguages)();case 2:if(languagePrefs=_context7.sent,!((filter=searchInput.value.trim().toLowerCase()).length<4)){_context7.next=3;break}clearList(),numberOfRows=20,_context7.next=6;break;case 3:if(allDisplayed&&lastFilter&&filter.startsWith(lastFilter)){_context7.next=5;break}return debug.log('   Querying database at "'.concat(filter,'" cf last "').concat(lastFilter,'".')),_context7.next=4,loadBindingsAndFilterByLanguage(filter,languagePrefs);case 4:lastBindings=_context7.sent;case 5:slimmed=filterByName(filter,lastBindings),loadedEnough&&slimmed.length<=40&&(numberOfRows=slimmed.length),allDisplayed=loadedEnough&&slimmed.length<=numberOfRows,debug.log(' Filter:"'.concat(filter,'" lastBindings: ').concat(lastBindings.length,", slimmed to ").concat(slimmed.length,"; rows: ").concat(numberOfRows,", Enough? ").concat(loadedEnough,", All displayed? ").concat(allDisplayed)),(displayable=slimmed.slice(0,numberOfRows)).sort(compareBindingsByName),clearList(),_iterator=_createForOfIteratorHelper(displayable);try{for(_iterator.s();!(_step=_iterator.n()).done;)binding=_step.value,table.appendChild(rowForBinding(binding))}catch(err){_iterator.e(err)}finally{_iterator.f()}1===slimmed.length&&gotIt((0,_publicData.bindingToTerm)(slimmed[0].subject),(0,_publicData.bindingToTerm)(slimmed[0].name));case 6:inputEventHandlerLock=!1;case 7:case"end":return _context7.stop()}},_callee7)})),_refreshList.apply(this,arguments)},refreshList=function _refreshList2(){return _refreshList.apply(this,arguments)},filterByName=function _filterByName(filter,bindings){return bindings.filter(function(binding){return nameMatch(filter,binding.name.value)})},_loadBindingsAndFilterByLanguage=function _loadBindingsAndFilte2(){return(_loadBindingsAndFilterByLanguage=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(filter,languagePrefs){var bindings,slimmed,_t;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.prev=0,_context5.next=1,(0,_publicData.queryPublicDataByName)(filter,targetClass,languagePrefs||_language.defaultPreferredLanguages,acOptions.queryParams);case 1:bindings=_context5.sent,_context5.next=3;break;case 2:return _context5.prev=2,_t=_context5.catch(0),complain("Error querying db of organizations: "+_t),inputEventHandlerLock=!1,_context5.abrupt("return");case 3:return loadedEnough=bindings.length<_publicData.AUTOCOMPLETE_LIMIT,lastFilter=loadedEnough?filter:void 0,clearList(),slimmed=(0,_language.filterByLanguage)(bindings,languagePrefs),_context5.abrupt("return",slimmed);case 4:case"end":return _context5.stop()}},_callee5,null,[[0,2]])}))).apply(this,arguments)},loadBindingsAndFilterByLanguage=function _loadBindingsAndFilte(_x0,_x1){return _loadBindingsAndFilterByLanguage.apply(this,arguments)},_inputEventHHandler=function _inputEventHHandler3(){return(_inputEventHHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(_event){return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:setVisible(decoration.cancelButton,!0),refreshList();case 1:case"end":return _context4.stop()}},_callee4)}))).apply(this,arguments)},inputEventHHandler=function _inputEventHHandler2(_x9){return _inputEventHHandler.apply(this,arguments)},clearList=function _clearList(){for(;table.children.length>1;)table.removeChild(table.lastChild)},nameMatch=function _nameMatch(filter,candidate){for(var parts=filter.split(" "),j=0;j<parts.length;j++){var word=parts[j];if(candidate.toLowerCase().indexOf(word)<0)return!1}return!0},_cancelButtonHandler=function _cancelButtonHandler3(){return(_cancelButtonHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(_event){return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:debug.log("Auto complete: Canceled by user! "),acOptions.permanent?initialize():div.parentNode&&div.parentNode.removeChild(div);case 1:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)},cancelButtonHandler=function _cancelButtonHandler2(_x8){return _cancelButtonHandler.apply(this,arguments)},_acceptButtonHandler=function _acceptButtonHandler3(){return(_acceptButtonHandler=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(_event){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:foundName&&searchInput.value===foundName.value&&finish(foundObject,foundName);case 1:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)},acceptButtonHandler=function _acceptButtonHandler2(_x7){return _acceptButtonHandler.apply(this,arguments)},_gotIt=function _gotIt3(){return(_gotIt=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(object,name){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!decoration.acceptButton){_context.next=1;break}return decoration.acceptButton.disbaled=!1,setVisible(decoration.acceptButton,!0),searchInput.value=name.value,foundName=name,foundObject=object,debug.log("Auto complete: name: "+name),debug.log("Auto complete: waiting for accept "+object),clearList(),_context.abrupt("return");case 1:setVisible(decoration.cancelButton,!0),finish(object,name);case 2:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)},gotIt=function _gotIt2(_x5,_x6){return _gotIt.apply(this,arguments)},finish=function _finish(object,name){debug.log("Auto complete: finish! "+object),"Literal"===object.termType&&acOptions.queryParams.objectURIBase&&(object=_solidLogic.store.sym(acOptions.queryParams.objectURIBase.value+object.value)),clearList(),callback(object,name)},complain=function _complain(message){var errorRow=table.appendChild(dom.createElement("tr"));debug.log(message);var err=new Error(message);errorRow.appendChild(widgets.errorMessageBlock(dom,err,"pink")),style.setStyle(errorRow,"autocompleteRowStyle"),errorRow.style.padding="1em"},targetClass=acOptions.targetClass){_context8.next=1;break}throw new Error("renderAutoComplete: missing targetClass");case 1:return decoration.acceptButton&&decoration.acceptButton.addEventListener("click",acceptButtonHandler,!1),decoration.cancelButton&&decoration.cancelButton.addEventListener("click",cancelButtonHandler,!1),loadedEnough=!1,inputEventHandlerLock=!1,allDisplayed=!1,lastFilter=void 0,numberOfRows=20,div=dom.createElement("div"),foundName=void 0,foundObject=void 0,(table=div.appendChild(dom.createElement("table"))).setAttribute("data-testid","autocomplete-table"),table.setAttribute("style","max-width: 30em; margin: 0.5em;"),head=table.appendChild(dom.createElement("tr")),style.setStyle(head,"autocompleteRowStyle"),cell=head.appendChild(dom.createElement("td")),(searchInput=cell.appendChild(dom.createElement("input"))).setAttribute("type","text"),initialize(),size=acOptions.size||_styleConstants.default.textInputSize||20,searchInput.setAttribute("size",size),searchInput.setAttribute("data-testid","autocomplete-input"),searchInputStyle=style.textInputStyle||"border: 0.1em solid #444; border-radius: 0.5em; width: 100%; font-size: 100%; padding: 0.1em 0.6em",searchInput.setAttribute("style",searchInputStyle),searchInput.addEventListener("keyup",function(event){13===event.keyCode&&acceptButtonHandler(event)},!1),searchInput.addEventListener("input",inputEventHHandler),_context8.abrupt("return",div);case 2:case"end":return _context8.stop()}},_callee8)})),_renderAutoComplete.apply(this,arguments)}},"./lib/widgets/forms/autocomplete/language.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.addDefaults=addDefaults,exports.defaultPreferredLanguages=void 0,exports.filterByLanguage=function filterByLanguage(bindings,languagePrefs){var uris={};bindings.forEach(function(binding){var uri=binding.subject.value;uris[uri]=uris[uri]||[],uris[uri].push(binding)});var languagePrefs2=languagePrefs||defaultPreferredLanguages;languagePrefs2.reverse();var slimmed=[];for(var u in uris){var sortMe=uris[u].map(function(binding){var lang=binding.name["xml:lang"];return[languagePrefs2.indexOf(lang),binding]});sortMe.sort(),sortMe.reverse(),slimmed.push(sortMe[0][1])}return debug.log(" Filter by language: ".concat(bindings.length," -> ").concat(slimmed.length)),slimmed},exports.getPreferredLanguages=function getPreferredLanguages(){return _getPreferredLanguages.apply(this,arguments)},exports.getPreferredLanguagesFor=getPreferredLanguagesFor,exports.languageCodeURIBase=void 0;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var languageCodeURIBase=exports.languageCodeURIBase="https://www.w3.org/ns/iana/language-code/",defaultPreferredLanguages=exports.defaultPreferredLanguages=["en","fr","de","it","ar"];function addDefaults(array){return array||(array=[]),array.concat(defaultPreferredLanguages.filter(function(code){return!array.includes(code)}))}function getPreferredLanguagesFor(_x){return _getPreferredLanguagesFor.apply(this,arguments)}function _getPreferredLanguagesFor(){return(_getPreferredLanguagesFor=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(person){var _store$fetcher,doc,list,languageCodeArray;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return doc=person.doc(),_context.next=1,null===(_store$fetcher=_solidLogic.store.fetcher)||void 0===_store$fetcher?void 0:_store$fetcher.load(doc);case 1:if(list=_solidLogic.store.any(person,ns.schema("knowsLanguage"),null,doc)){_context.next=2;break}return _context.abrupt("return",defaultPreferredLanguages);case 2:if(languageCodeArray=[],list.elements.forEach(function(item){var lang=_solidLogic.store.any(item,ns.solid("publicId"),null,doc);if(lang)if(lang.value.startsWith(languageCodeURIBase)){var code=lang.value.slice(languageCodeURIBase.length);languageCodeArray.push(code)}else console.error("What should be a language code ".concat(lang.value," does not start with ").concat(languageCodeURIBase));else console.warn("getPreferredLanguages: No publiID of language.")}),!(languageCodeArray.length>0)){_context.next=3;break}return console.log('     User knows languages with codes: "'.concat(languageCodeArray.join(","),'"')),_context.abrupt("return",addDefaults(languageCodeArray));case 3:return _context.abrupt("return",null);case 4:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}function _getPreferredLanguages(){return(_getPreferredLanguages=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(){var me,solidLanguagePrefs;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=1,_solidLogic.authn.currentUser();case 1:if(!(me=_context2.sent)){_context2.next=3;break}return _context2.next=2,getPreferredLanguagesFor(me);case 2:if(!(solidLanguagePrefs=_context2.sent)){_context2.next=3;break}return _context2.abrupt("return",solidLanguagePrefs);case 3:if("undefined"==typeof navigator){_context2.next=5;break}if(!navigator.languages){_context2.next=4;break}return _context2.abrupt("return",addDefaults(navigator.languages.map(function(longForm){return longForm.split("-")[0]})));case 4:if(!navigator.language){_context2.next=5;break}return _context2.abrupt("return",addDefaults([navigator.language.split("-")[0]]));case 5:return _context2.abrupt("return",defaultPreferredLanguages);case 6:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)}},"./lib/widgets/forms/autocomplete/publicData.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.AUTOCOMPLETE_LIMIT=void 0,exports.ESCOResultToBindings=ESCOResultToBindings,exports.bindingToTerm=function bindingToTerm(item){var typ=item.type.toLowerCase();if("uri"===typ||"iri"===typ)return _solidLogic.store.sym(item.value);if("literal"===typ)return item["xml:lang"]?new _rdflib.Literal(item.value,item["xml:lang"]):new _rdflib.Literal(item.value);throw new Error('bindingToTerm: Unexpected type "'.concat(item.type,'" in sparql binding}'))},exports.fetcherOptionsJsonPublicData=exports.escoParameters=exports.dbpediaParameters=exports.dbPediaTypeMap=void 0,exports.getDbpediaDetails=getDbpediaDetails,exports.getWikidataDetails=getWikidataDetails,exports.getWikidataDetailsOld=function getWikidataDetailsOld(_x17,_x18,_x19){return _getWikidataDetailsOld.apply(this,arguments)},exports.getWikidataLocation=function getWikidataLocation(_x20,_x21,_x22){return _getWikidataLocation.apply(this,arguments)},exports.instituteDetailsWikidataQuery=void 0,exports.loadFromBindings=loadFromBindings,exports.loadPublicDataThing=function loadPublicDataThing(_x11,_x12,_x13){return _loadPublicDataThing.apply(this,arguments)},exports.queryESCODataByName=function queryESCODataByName(_x,_x2,_x3){return _queryESCODataByName.apply(this,arguments)},exports.queryPublicDataByName=function queryPublicDataByName(_x4,_x5,_x6,_x7){return _queryPublicDataByName.apply(this,arguments)},exports.queryPublicDataConstruct=queryPublicDataConstruct,exports.queryPublicDataSelect=queryPublicDataSelect,exports.wikidataParameters=exports.wikidataOutgoingClassMap=exports.wikidataIncomingClassMap=exports.wikidataClasses=exports.variableNameToPredicateMap=void 0;var _regenerator=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js")),_asyncToGenerator2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),_rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js")),_language=__webpack_require__("./lib/widgets/forms/autocomplete/language.js");function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t3 in e)"default"!==_t3&&{}.hasOwnProperty.call(e,_t3)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t3))&&(i.get||i.set)?o(f,_t3,i):f[_t3]=e[_t3]);return f})(e,t)}var AUTOCOMPLETE_LIMIT=exports.AUTOCOMPLETE_LIMIT=200,subjectRegexp=/\$\(subject\)/g,instituteDetailsWikidataQuery=(exports.wikidataClasses={Corporation:"http://www.wikidata.org/entity/Q6881511",EducationalOrganization:"http://www.wikidata.org/entity/Q178706",GovernmentOrganization:"http://www.wikidata.org/entity/Q327333",MedicalOrganization:"http://www.wikidata.org/entity/Q4287745",MusicGroup:"http://www.wikidata.org/entity/Q32178211",NGO:"http://www.wikidata.org/entity/Q163740",Occupation:"http://www.wikidata.org/entity/Q28640",Project:"http://www.wikidata.org/entity/Q170584",ResearchOrganization:"http://www.wikidata.org/entity/Q31855",SportsOrganization:"http://www.wikidata.org/entity/Q4438121"},exports.instituteDetailsWikidataQuery='prefix vcard: <http://www.w3.org/2006/vcard/ns#>\nCONSTRUCT\n{  wd:Q49108 vcard:fn ?itemLabel.\nwd:Q49108 rdf:type ?klass. ?klass rdfs:label ?klassLabel; rdfs:comment ?klassDescription .\nwd:Q49108 schema:logo ?logo;\n   schema:image ?image;\n   schema:logo  ?sealImage;\n   schema:subOrganization  ?subsidiary .\n      ?subsidiary rdfs:label ?subsidiaryLabel .\n ?supersidiary schema:subOrganization wd:Q49108 .\n      ?supersidiary rdfs:label ?supersidiaryLabel .\n  wd:Q49108 schema:location ?location .\n     ?location  schema:elevation  ?elevation .\n     ?location  wdt:P131  ?region .  ?region rdfs:label ?regionLabel .\n     ?location wdt:P625 ?coordinates .\n     ?location  schema:country  ?country . ?country rdfs:label ?countryLabel .\n}\nWHERE\n{  optional {wd:Q49108 rdfs:label ?itemLabel} .\n  optional {wd:Q49108 wdt:P154 ?logo .}\n  optional {wd:Q49108 wdt:P31 ?klass .}\n  optional {wd:Q49108 wdt:P158  ?sealImage .}\n  optional {wd:Q49108 wdt:P18 ?image .}\n\n  optional { wd:Q49108       wdt:P355 ?subsidiary . }\n  optional { ?supersidiary   wdt:P355 wd:Q49108. }\n\n  optional { wd:Q49108 wdt:P276 ?location .\n\n    optional { ?location  schema:eleveation  ?elevation }\n    optional { ?location  wdt:P131  ?region }\n    optional { ?location wdt:P625 ?coordinates }\n    optional {  ?location  wdt:P17  ?country }\n  }\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "fr,en,de,it". }\n}'),fetcherOptionsJsonPublicData=exports.fetcherOptionsJsonPublicData={credentials:"omit",headers:new Headers({Accept:"application/json"})},dbpediaParameters=(exports.escoParameters={label:"ESCO",logo:_solidLogic.store.sym("https://ec.europa.eu/esco/portal/static_resource2/images/logo/logo_en.gif"),searchByNameURI:"https://ec.europa.eu/esco/api/search?language=$(language)&type=occupation&text=$(name)"},exports.dbpediaParameters={label:"DBPedia",logo:_solidLogic.store.sym("https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/DBpediaLogo.svg/263px-DBpediaLogo.svg.png"),searchByNameQuery:'select distinct ?subject, ?name where {\n    ?subject a $(targetClass); rdfs:label ?name\n    FILTER regex(?name, "$(name)", "i")\n  } LIMIT $(limit)',endpoint:"https://dbpedia.org/sparql/"}),wikidataParameters=(exports.dbPediaTypeMap={AcademicInsitution:"http://umbel.org/umbel/rc/EducationalOrganization"},exports.wikidataOutgoingClassMap={AcademicInsitution:"http://www.wikidata.org/entity/Q4671277",Enterprise:"http://www.wikidata.org/entity/Q6881511",Business:"http://www.wikidata.org/entity/Q4830453",NGO:"http://www.wikidata.org/entity/Q79913",CharitableOrganization:"http://www.wikidata.org/entity/Q708676",Insitute:"http://www.wikidata.org/entity/Q1664720"},exports.wikidataParameters={label:"WikiData",limit:3e3,logo:_solidLogic.store.sym("https://www.wikimedia.org/static/images/project-logos/wikidatawiki.png"),endpoint:"https://query.wikidata.org/sparql",searchByNameQuery:'SELECT ?subject ?name\n  WHERE {\n    ?klass wdt:P279* $(targetClass) .\n    ?subject wdt:P31 ?klass .\n    ?subject rdfs:label ?name.\n    FILTER regex(?name, "$(name)", "i")\n  } LIMIT $(limit) ',insitituteDetailsQuery:'CONSTRUCT\n{  wd:Q49108 schema:name ?itemLabel;\n             schema:logo ?logo;\n              schema:logo  ?sealImage;\n             schema:subOrganization  ?subsidiary .\n                 ?subsidiary schema:name ?subsidiaryLabel .\n}\nWHERE\n{\n   wd:Q49108 # rdfs:label ?itemLabel ;\n             wdt:P154 ?logo;\n              wdt:P158  ?sealImage ;\n             wdt:P355  ?subsidiary .\n          #  ?subsidiary rdfs:label ?subsidiaryLabel .\n\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE], fr". }\n}'}),wikidataIncomingClassMap=exports.wikidataIncomingClassMap={"http://www.wikidata.org/entity/Q15936437":ns.schema("CollegeOrUniversity"),"http://www.wikidata.org/entity/Q1664720":ns.schema("EducationalOrganization"),"http://www.wikidata.org/entity/Q43229":ns.schema("Organization"),"http://www.wikidata.org/entity/Q3918":ns.schema("CollegeOrUniversity"),"http://www.wikidata.org/entity/Q170584":ns.schema("Project"),"http://www.wikidata.org/entity/Q327333":ns.schema("GovernmentOrganization"),"http://www.wikidata.org/entity/Q2221906":ns.schema("Place"),"http://www.wikidata.org/entity/Q167037":ns.schema("Corporation")},variableNameToPredicateMap=exports.variableNameToPredicateMap={targetClass:ns.rdf("type"),sealImage:ns.schema("logo"),shortName:ns.foaf("nick"),subsidiary:ns.schema("subOrganization"),city:ns.vcard("locality"),state:ns.vcard("region"),country:ns.vcard("country-name"),homepage:ns.foaf("homepage"),lat:ns.schema("latitude"),long:ns.schema("longitude")};function loadFromBindings(kb,solidSubject,bindings,doc){var predMap=arguments.length>4&&void 0!==arguments[4]?arguments[4]:variableNameToPredicateMap,results={};debug.log("loadFromBindings:  subject: ".concat(solidSubject)),debug.log("                       doc: ".concat(doc)),bindings.forEach(function(binding){for(var key in binding){var result=binding[key],combined=JSON.stringify(result);results[key]=results[key]||new Set,results[key].add(combined)}});var _loop=function _loop(key){var values=results[key];debug.log("    results ".concat(key," -> ").concat(values)),values.forEach(function(combined){var obj,result=JSON.parse(combined),type=result.type,value=result.value;if("uri"===type)obj=kb.sym(value);else{if("literal"!==type)throw new Error("loadFromBindings:  unexpected type: ".concat(type));obj=new _rdflib.Literal(value,result.language,result.datatype)}if("type"===key)wikidataIncomingClassMap[value]?obj=wikidataIncomingClassMap[value]:debug.warn("Unmapped Wikidata Class: "+value);else if("coordinates"===key){debug.log("         @@@ hey a point: "+value);var match=/.*\(([-0-9.-]*) ([-0-9.-]*)\)/.exec(value);if(match){var _float=ns.xsd("float"),latitude=new _rdflib.Literal(match[1],null,_float),longitude=new _rdflib.Literal(match[2],null,_float);kb.add(solidSubject,ns.schema("longitude"),longitude,doc),kb.add(solidSubject,ns.schema("latitude"),latitude,doc)}else debug.log("Bad coordinates syntax: "+value)}else{var pred=predMap[key]||ns.schema(key);kb.add(solidSubject,pred,obj,doc),debug.log("  public data ".concat(pred," ").concat(obj,"."))}})};for(var key in results)_loop(key)}function ESCOResultToBindings(json){return json._embedded.results.map(function(result){return{name:{value:result.title,type:"literal"},subject:{type:"IRI",value:result.uri}}})}function _queryESCODataByName(){return(_queryESCODataByName=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(filter,theClass,queryTarget){var _store$fetcher,limit,queryURI,response,text,json;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(queryTarget.searchByNameURI){_context.next=1;break}throw new Error("Missing queryTarget.searchByNameURI on queryESCODataByName");case 1:return limit=queryTarget.limit||AUTOCOMPLETE_LIMIT,queryURI=queryTarget.searchByNameURI.replace("$(name)",filter).replace("$(limit)",""+limit).replace("$(targetClass)",theClass.toNT()),debug.log("Querying ESCO data - uri: "+queryURI),_context.next=2,null===(_store$fetcher=_solidLogic.store.fetcher)||void 0===_store$fetcher?void 0:_store$fetcher.webOperation("GET",queryURI,fetcherOptionsJsonPublicData);case 2:if(response=_context.sent,text=(null==response?void 0:response.responseText)||"",debug.log("    Query result  text"+text.slice(0,500)+"..."),0!==text.length){_context.next=3;break}throw new Error("Wot no text back from ESCO query "+queryURI);case 3:return json=JSON.parse(text),debug.log("    ESCO Query result JSON"+JSON.stringify(json,null,4).slice(0,500)+"..."),_context.abrupt("return",ESCOResultToBindings(json));case 4:case"end":return _context.stop()}},_callee)}))).apply(this,arguments)}function fixWikidataJSON(str){var syntaxProblem=str.indexOf("SPARQL-QUERY");if(syntaxProblem<0)return str;debug.warn("  ### Fixing JSON with wikidata error code injection "+str.slice(syntaxProblem,syntaxProblem+200));var goodness=str.lastIndexOf("}, {");return str.slice(0,goodness)+" } ] } } "}function _queryPublicDataByName(){return(_queryPublicDataByName=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(filter,theClass,languages,queryTarget){var substituteStrings,language,sparql,queryURI,response,_store$fetcher2,text,text2,json,bindings,_t,_t2;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(substituteStrings=function _substituteStrings(template){var limit=queryTarget.limit||AUTOCOMPLETE_LIMIT;return template.replace("$(name)",filter).replace("$(limit)",""+limit).replace("$(language)",language).replace("$(targetClass)",theClass.toNT())},theClass){_context2.next=1;break}throw new Error("queryPublicDataByName: No class provided");case 1:return _context2.next=2,(0,_language.getPreferredLanguages)();case 2:if(_t=_context2.sent){_context2.next=3;break}_t=_language.defaultPreferredLanguages;case 3:if(language=_t[0]||"en",!queryTarget.searchByNameQuery){_context2.next=4;break}return sparql=substituteStrings(queryTarget.searchByNameQuery),debug.log("Querying public data - sparql: "+sparql),_context2.abrupt("return",queryPublicDataSelect(sparql,queryTarget));case 4:if(!queryTarget.searchByNameURI){_context2.next=13;break}return queryURI=substituteStrings(queryTarget.searchByNameURI),_context2.prev=5,_context2.next=6,null===(_store$fetcher2=_solidLogic.store.fetcher)||void 0===_store$fetcher2?void 0:_store$fetcher2.webOperation("GET",queryURI,fetcherOptionsJsonPublicData);case 6:response=_context2.sent,_context2.next=8;break;case 7:throw _context2.prev=7,_t2=_context2.catch(5),new Error("Exception when trying to fetch ".concat(queryURI," \n ").concat(_t2));case 8:if(text=response.responseText||"",200===response.status){_context2.next=9;break}throw new Error("HTTP error status ".concat(response.status," trying to fetch ").concat(queryURI," "));case 9:if(debug.log("    Query result  text"+text.slice(0,500)+"..."),0!==text.length){_context2.next=10;break}throw new Error("queryPublicDataByName: No text back from public data query "+queryURI);case 10:if(text2=fixWikidataJSON(text),json=JSON.parse(text2),debug.log("    API Query result JSON"+JSON.stringify(json,null,4).slice(0,500)+"..."),!json._embedded){_context2.next=11;break}return debug.log("      Looks like ESCO"),bindings=ESCOResultToBindings(json),_context2.abrupt("return",bindings);case 11:throw alert("Code me: unrecognized API return format"),new Error("*** Need to add code to parse unrecognized API JSON return\n".concat(JSON.stringify(json,null,4)));case 12:_context2.next=14;break;case 13:throw new Error("Query source must have either rest API or SPARQL endpoint.");case 14:case"end":return _context2.stop()}},_callee2,null,[[5,7]])}))).apply(this,arguments)}function queryPublicDataSelect(_x8,_x9){return _queryPublicDataSelect.apply(this,arguments)}function _queryPublicDataSelect(){return(_queryPublicDataSelect=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(sparql,queryTarget){var _store$fetcher3,myUrlWithParams,queryURI,headers,options,response,text,text2,json,bindings;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(queryTarget.endpoint){_context3.next=1;break}throw new Error("Missing queryTarget.endpoint required for queryPublicDataSelect");case 1:return(myUrlWithParams=new URL(queryTarget.endpoint)).searchParams.append("query",sparql),queryURI=myUrlWithParams.href,debug.log(" queryPublicDataSelect uri: "+queryURI),(headers=new Headers).append("Accept","application/json"),options={credentials:"omit",headers},_context3.next=2,null===(_store$fetcher3=_solidLogic.store.fetcher)||void 0===_store$fetcher3?void 0:_store$fetcher3.webOperation("GET",queryURI,options);case 2:if(response=_context3.sent,0!==(text=(null==response?void 0:response.responseText)||"").length){_context3.next=3;break}throw new Error("No text back from query "+queryURI);case 3:return text2=fixWikidataJSON(text),json=JSON.parse(text2),debug.log("    Query result JSON"+JSON.stringify(json,null,4).slice(0,100)+"..."),bindings=json.results.bindings,_context3.abrupt("return",bindings);case 4:case"end":return _context3.stop()}},_callee3)}))).apply(this,arguments)}function queryPublicDataConstruct(_x0,_x1,_x10){return _queryPublicDataConstruct.apply(this,arguments)}function _queryPublicDataConstruct(){return(_queryPublicDataConstruct=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(sparql,pubicId,queryTarget){var _store$fetcher4,myUrlWithParams,queryURI,headers,options,response,text,report;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(debug.log("queryPublicDataConstruct: sparql:",sparql),queryTarget.endpoint){_context4.next=1;break}throw new Error("Missing queryTarget.endpoint required for queryPublicDataConstruct");case 1:return(myUrlWithParams=new URL(queryTarget.endpoint)).searchParams.append("query",sparql),queryURI=myUrlWithParams.href,debug.log(" queryPublicDataConstruct uri: "+queryURI),(headers=new Headers).append("Accept","text/turtle"),options={credentials:"omit",headers},_context4.next=2,null===(_store$fetcher4=_solidLogic.store.fetcher)||void 0===_store$fetcher4?void 0:_store$fetcher4.webOperation("GET",queryURI,options);case 2:if(response=_context4.sent,text=(null==response?void 0:response.responseText)||"No response text?",report=text.length>500?text.slice(0,200)+" ... "+text.slice(-200):text,debug.log("    queryPublicDataConstruct result text:"+report),0!==text.length){_context4.next=3;break}throw new Error("queryPublicDataConstruct: No text back from construct query:"+queryURI);case 3:(0,_rdflib.parse)(text,_solidLogic.store,pubicId.uri,"text/turtle");case 4:case"end":return _context4.stop()}},_callee4)}))).apply(this,arguments)}function _loadPublicDataThing(){return(_loadPublicDataThing=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee5(kb,subject,publicDataID){var iDToFetch,headers;return _regenerator.default.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!publicDataID.uri.startsWith("https://dbpedia.org/resource/")){_context5.next=1;break}return _context5.abrupt("return",getDbpediaDetails(kb,subject,publicDataID));case 1:if(!publicDataID.uri.match(/^https?:\/\/www\.wikidata\.org\/entity\/.*/)){_context5.next=3;break}return _context5.next=2,getWikidataDetails(kb,subject,publicDataID);case 2:_context5.next=4;break;case 3:return iDToFetch=publicDataID.uri.startsWith("http:")?kb.sym("https:"+publicDataID.uri.slice(5)):publicDataID,(headers=new Headers).append("Accept","text/turtle"),_context5.abrupt("return",kb.fetcher.load(iDToFetch,{credentials:"omit",headers}));case 4:case"end":return _context5.stop()}},_callee5)}))).apply(this,arguments)}function getWikidataDetails(_x14,_x15,_x16){return _getWikidataDetails.apply(this,arguments)}function _getWikidataDetails(){return(_getWikidataDetails=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee6(kb,solidSubject,publicDataID){var subjRegexp,sparql;return _regenerator.default.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return subjRegexp=/wd:Q49108/g,sparql=instituteDetailsWikidataQuery.replace(subjRegexp,publicDataID.toNT()),_context6.next=1,queryPublicDataConstruct(sparql,publicDataID,wikidataParameters);case 1:debug.log("getWikidataDetails: loaded.",publicDataID);case 2:case"end":return _context6.stop()}},_callee6)}))).apply(this,arguments)}function _getWikidataDetailsOld(){return(_getWikidataDetailsOld=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee7(kb,solidSubject,publicDataID){var sparql,bindings;return _regenerator.default.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return sparql='select distinct *  where {\n  optional { $(subject)  wdt:P31  ?targetClass } # instance of\n  optional { $(subject)  wdt:P154  ?logo }\n  optional { $(subject)  wdt:P158  ?sealImage }\n# optional { $(subject)  wdt:P159  ?headquartersLocation }\n\noptional { $(subject)  wdt:P17  ?country }\noptional { $(subject)  wdt:P18  ?image }\noptional { $(subject)  wdt:P1813  ?shortName }\n\noptional { $(subject)  wdt:P355  ?subsidiary }\n# SERVICE wikibase:label { bd:serviceParam wikibase:language "fr,en,de,it" }\n}'.replace(subjectRegexp,publicDataID.toNT()),_context7.next=1,queryPublicDataSelect(sparql,wikidataParameters);case 1:bindings=_context7.sent,loadFromBindings(kb,publicDataID,bindings,publicDataID.doc());case 2:case"end":return _context7.stop()}},_callee7)}))).apply(this,arguments)}function _getWikidataLocation(){return(_getWikidataLocation=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee8(kb,solidSubject,publicDataID){var sparql,bindings;return _regenerator.default.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return sparql='select distinct *  where {\n\n  $(subject) wdt:P276 ?location .\n\n  optional { ?location  wdt:P2044  ?elevation }\n  optional { ?location  wdt:P131  ?region }\n  optional { ?location wdt:P625 ?coordinates }\noptional {  ?location  wdt:P17  ?country }\n\n# SERVICE wikibase:label { bd:serviceParam wikibase:language "fr,en,de,it" }\n}'.replace(subjectRegexp,publicDataID.toNT()),debug.log(" location query sparql:"+sparql),_context8.next=1,queryPublicDataSelect(sparql,wikidataParameters);case 1:bindings=_context8.sent,debug.log(" location query bindings:",bindings),loadFromBindings(kb,publicDataID,bindings,publicDataID.doc());case 2:case"end":return _context8.stop()}},_callee8)}))).apply(this,arguments)}function getDbpediaDetails(_x23,_x24,_x25){return _getDbpediaDetails.apply(this,arguments)}function _getDbpediaDetails(){return(_getDbpediaDetails=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee9(kb,solidSubject,publicDataID){var sparql,bindings;return _regenerator.default.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return sparql="select distinct ?city, ?state, ?country, ?homepage, ?logo, ?lat, ?long,  WHERE {\n    OPTIONAL { <".concat(publicDataID,"> <http://dbpedia.org/ontology/city> ?city }\n    OPTIONAL { ").concat(publicDataID," <http://dbpedia.org/ontology/state> ?state }\n    OPTIONAL { ").concat(publicDataID," <http://dbpedia.org/ontology/country> ?country }\n    OPTIONAL { ").concat(publicDataID," foaf:homepage ?homepage }\n    OPTIONAL { ").concat(publicDataID," foaf:lat ?lat; foaf:long ?long }\n    OPTIONAL { ").concat(publicDataID," <http://dbpedia.org/ontology/country> ?country }\n   }"),_context9.next=1,queryPublicDataSelect(sparql,dbpediaParameters);case 1:bindings=_context9.sent,loadFromBindings(kb,publicDataID,bindings,publicDataID.doc()),debug.log("Finished getDbpediaDetails.");case 2:case"end":return _context9.stop()}},_callee9)}))).apply(this,arguments)}},"./lib/widgets/forms/basic.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.basicField=function basicField(dom,container,already,subject,form,doc,callbackFunction){var kb=store,formDoc=form.doc?form.doc():null,box=dom.createElement("div"),property=kb.any(form,ns.ui("property"));container&&container.appendChild(box);if(!property)return box.appendChild((0,_error.errorMessageBlock)(dom,"Error: No property given for text field: "+form));var rhs=renderNameValuePair(dom,kb,box,form),suppressEmptyUneditable=kb.anyJS(form,ns.ui("suppressEmptyUneditable"),null,formDoc),uri=(0,_fieldFunction.mostSpecificClassURI)(form),params=_fieldParams.fieldParams[uri];void 0===params&&(params={style:""});var paramStyle=params.style||"",style=_style.textInputStyle+paramStyle,field=dom.createElement("input");field.style=style,rhs.appendChild(field),field.setAttribute("type",params.type?params.type:"text");var size=kb.anyJS(form,ns.ui("size"))||_styleConstants.default.textInputSize||20;field.setAttribute("size",size);var maxLength=kb.any(form,ns.ui("maxLength"));field.setAttribute("maxLength",maxLength?""+maxLength:_styleConstants.default.basicMaxLength),doc=doc||fieldStore(subject,property,doc);var obj=kb.any(subject,property,void 0,doc);obj||(obj=kb.any(form,ns.ui("default")));obj&&obj.value&&params.uriPrefix?field.value=decodeURIComponent(obj.value.replace(params.uriPrefix,"")).replace(/ /g,""):obj&&(field.value=obj.value||obj.value||"");if(field.setAttribute("style",style),!kb.updater)throw new Error("kb has no updater");if(!kb.updater.editable(doc.uri))return field.readOnly=!0,field.style=_style.textInputStyleUneditable+paramStyle,suppressEmptyUneditable&&""===field.value&&(box.style.display="none"),box;return field.addEventListener("keyup",function(_e){params.pattern&&field.setAttribute("style",style+(field.value.match(params.pattern)?"color: green;":"color: red;"))},!0),field.addEventListener("change",function(_e){if(!params.pattern||field.value.match(params.pattern)){field.disabled=!0,field.setAttribute("style",style+"color: gray;");var result,ds=kb.statementsMatching(subject,property);params.namedNode?result=kb.sym(field.value):params.uriPrefix?(result=encodeURIComponent(field.value.replace(/ /g,"")),result=kb.sym(params.uriPrefix+field.value)):result=params.dt?new _rdflib.Literal(field.value.trim(),void 0,ns.xsd(params.dt)):new _rdflib.Literal(field.value);var is=ds.map(function(statement){return(0,_rdflib.st)(statement.subject,statement.predicate,result,statement.why)});0===is.length&&(is=[(0,_rdflib.st)(subject,property,result,doc)]),function updateMany(ds,is,callback){var docs=[];if(is.forEach(function(st){docs.includes(st.why.uri)||docs.push(st.why.uri)}),ds.forEach(function(st){docs.includes(st.why.uri)||docs.push(st.why.uri)}),0===docs.length)throw new Error("updateMany has no docs to patch");if(!kb.updater)throw new Error("kb has no updater");if(1===docs.length)return kb.updater.update(ds,is,callback);var doc=docs.pop(),is1=is.filter(function(st){return st.why.uri===doc}),is2=is.filter(function(st){return st.why.uri!==doc}),ds1=ds.filter(function(st){return st.why.uri===doc}),ds2=ds.filter(function(st){return st.why.uri!==doc});kb.updater.update(ds1,is1,function(uri,ok,body){ok?updateMany(ds2,is2,callback):callback(uri,ok,body)})}(ds,is,function(uri,ok,body){ok?(field.disabled=!1,field.setAttribute("style",style)):box.appendChild((0,_error.errorMessageBlock)(dom,body)),callbackFunction(ok,body)})}},!0),box},exports.fieldLabel=fieldLabel,exports.fieldStore=fieldStore,exports.renderNameValuePair=renderNameValuePair;var _rdflib=__webpack_require__("./node_modules/rdflib/esm/index.js"),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),ns=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/ns.js")),_style=__webpack_require__("./lib/style.js"),_styleConstants=_interopRequireDefault(__webpack_require__("./lib/styleConstants.js")),_utils=__webpack_require__("./lib/utils/index.js"),_error=__webpack_require__("./lib/widgets/error.js"),_fieldFunction=__webpack_require__("./lib/widgets/forms/fieldFunction.js"),_fieldParams=__webpack_require__("./lib/widgets/forms/fieldParams.js");var store=_solidLogic.solidLogicSingleton.store;function renderNameValuePair(dom,kb,box,form,label){box.style.display="flex",box.style.flexDirection="row";var lhs=box.appendChild(dom.createElement("div"));lhs.style.width=_styleConstants.default.formFieldNameBoxWidth;var rhs=box.appendChild(dom.createElement("div"));return lhs.setAttribute("class","formFieldName"),lhs.setAttribute("style",_style.formFieldNameBoxStyle),rhs.setAttribute("class","formFieldValue"),label?lhs.appendChild(dom.createTextNode(label)):kb.any(form,ns.ui("property"))?lhs.appendChild(fieldLabel(dom,kb.any(form,ns.ui("property")),form)):(rhs.appendChild((0,_error.errorMessageBlock)(dom,"No property or label given for form field: "+form)),lhs.appendChild(dom.createTextNode("???"))),rhs}function fieldLabel(dom,property,fieldInQuestion){var lab=store.any(fieldInQuestion,ns.ui("label"));if(lab||(lab=(0,_utils.label)(property,!0)),void 0===property)return dom.createTextNode("@@Internal error: undefined property");var anchor=dom.createElement("a");return property.uri&&anchor.setAttribute("href",property.uri),anchor.setAttribute("style","color: #3B5998; text-decoration: none;"),anchor.textContent=lab,anchor}function fieldStore(subject,predicate,def){var sts=store.statementsMatching(subject,predicate);if(0===sts.length)return def;if(!store.updater)throw new Error("Store has no updater");return sts.length>0&&sts[0].why.value&&store.updater.editable(sts[0].why.value,store)?store.sym(sts[0].why.value):def}},"./lib/widgets/forms/fieldFunction.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.field=void 0,exports.fieldFunction=function fieldFunction(dom,fieldInQuestion){var uri=mostSpecificClassURI(fieldInQuestion),fun=field[uri];if((0,_log.debug)("paneUtils: Going to implement field "+fieldInQuestion+" of type "+uri),!fun)return function(dom2,container){var box=(0,_error.errorMessageBlock)(dom2,"No handler for field "+fieldInQuestion+" of type "+uri);return container&&container.appendChild(box),box};return fun},exports.mostSpecificClassURI=mostSpecificClassURI;var _solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_log=__webpack_require__("./lib/log.js"),_error=__webpack_require__("./lib/widgets/error.js"),store=_solidLogic.solidLogicSingleton.store,field=exports.field={};function mostSpecificClassURI(x){var kb=store,ft=kb.findTypeURIs(x),bot=kb.bottomTypeURIs(ft),bots=[];for(var b in bot)bots.push(b);return bots[0]}},"./lib/widgets/forms/fieldParams.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.fieldParams=void 0;var _fieldParams,_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),ns=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/ns.js")),_style=__webpack_require__("./lib/style.js");exports.fieldParams=(_fieldParams={},(0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)(_fieldParams,ns.ui("ColorField").uri,{size:9,type:"color",style:"height: 3em;",dt:"color",pattern:/^\s*#[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]([0-9a-f][0-9a-f])?\s*$/}),ns.ui("DateField").uri,{size:20,type:"date",dt:"date",pattern:/^\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?Z?\s*$/}),ns.ui("DateTimeField").uri,{size:20,type:"datetime-local",dt:"dateTime",pattern:/^\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?(T[0-2][0-9]:[0-5][0-9](:[0-5][0-9])?)?Z?\s*$/}),ns.ui("TimeField").uri,{size:10,type:"time",dt:"time",pattern:/^\s*([0-2]?[0-9]:[0-5][0-9](:[0-5][0-9])?)\s*$/}),ns.ui("IntegerField").uri,{size:12,style:"text-align: right;",dt:"integer",pattern:/^\s*-?[0-9]+\s*$/}),ns.ui("DecimalField").uri,{size:12,style:"text-align: right;",dt:"decimal",pattern:/^\s*-?[0-9]*(\.[0-9]*)?\s*$/}),ns.ui("FloatField").uri,{size:12,style:"text-align: right;",dt:"float",pattern:/^\s*-?[0-9]*(\.[0-9]*)?((e|E)-?[0-9]*)?\s*$/}),ns.ui("SingleLineTextField").uri,{}),ns.ui("NamedNodeURIField").uri,{namedNode:!0}),ns.ui("TextField").uri,{}),(0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)(_fieldParams,ns.ui("PhoneField").uri,{size:20,uriPrefix:"tel:",pattern:/^\+?[\d-]+[\d]*$/}),ns.ui("EmailField").uri,{size:30,uriPrefix:"mailto:",pattern:/^\s*.*@.*\..*\s*$/}),ns.ui("Group").uri,{style:_style.formGroupStyle}),ns.ui("Comment").uri,{element:"p",style:_style.commentStyle}),ns.ui("Heading").uri,{element:"h3",style:_style.formHeadingStyle}))},"./lib/widgets/forms/formStyle.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.setFieldStyle=function setFieldStyle(ele,field){var classUri=(0,_fieldFunction.mostSpecificClassURI)(field),params=_fieldParams.fieldParams[classUri]||{},style=_solidLogic.store.any(field,ns.ui("style"));if(!style)return void(params.style&&ele.setAttribute("style",params.style));if("Literal"===style.termType)style&&ele.setAttribute("style",style.value);else{_solidLogic.store.statementsMatching(style,null,null,field.doc()).forEach(function(st){if(st.predicate.uri&&st.predicate.uri.startsWith(STYLE_URI_PREFIX)){var cssAttribute=st.predicate.uri.slice(STYLE_URI_PREFIX.length);try{ele.style[cssAttribute]=st.object.value}catch(err){console.warn("setFieldStyle: Error setting element style ".concat(cssAttribute,' to "').concat(st.object.value,'"')),console.warn('setFieldStyle:   ... Element tagName was "'.concat(ele.tagName||"???",'"'))}}})}};var ns=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/ns.js")),_solidLogic=__webpack_require__("./node_modules/solid-logic/lib/index.js"),_fieldParams=__webpack_require__("./lib/widgets/forms/fieldParams.js"),_fieldFunction=__webpack_require__("./lib/widgets/forms/fieldFunction.js");var STYLE_URI_PREFIX="https://www.w3.org/ns/css#"},"./lib/widgets/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0});var _exportNames={publicData:!0};exports.publicData=void 0;var _peoplePicker=__webpack_require__("./lib/widgets/peoplePicker.js");Object.keys(_peoplePicker).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_peoplePicker[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _peoplePicker[key]}}))});var _dragAndDrop=__webpack_require__("./lib/widgets/dragAndDrop.js");Object.keys(_dragAndDrop).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_dragAndDrop[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _dragAndDrop[key]}}))});var _buttons=__webpack_require__("./lib/widgets/buttons.js");Object.keys(_buttons).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_buttons[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _buttons[key]}}))});var _iconLinks=__webpack_require__("./lib/widgets/buttons/iconLinks.js");Object.keys(_iconLinks).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_iconLinks[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _iconLinks[key]}}))});var _error=__webpack_require__("./lib/widgets/error.js");Object.keys(_error).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_error[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _error[key]}}))});var _forms=__webpack_require__("./lib/widgets/forms.js");Object.keys(_forms).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_forms[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _forms[key]}}))});var _autocompleteBar=__webpack_require__("./lib/widgets/forms/autocomplete/autocompleteBar.js");Object.keys(_autocompleteBar).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_autocompleteBar[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _autocompleteBar[key]}}))});var _autocompletePicker=__webpack_require__("./lib/widgets/forms/autocomplete/autocompletePicker.js");Object.keys(_autocompletePicker).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_autocompletePicker[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function get(){return _autocompletePicker[key]}}))});var _publicData=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/widgets/forms/autocomplete/publicData.js"));exports.publicData=_publicData},"./lib/widgets/multiSelect.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.IconicMultiSelect=void 0;var _toConsumableArray2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_defineProperty2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js")),style=function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f}(e,t)}(__webpack_require__("./lib/style_multiSelect.js"));exports.IconicMultiSelect=function(){return(0,_createClass2.default)(function IconicMultiSelect(_ref){var data=_ref.data,itemTemplate=_ref.itemTemplate,noData=_ref.noData,noResults=_ref.noResults,placeholder=_ref.placeholder,select=_ref.select,container=_ref.container,tagTemplate=_ref.tagTemplate,textField=_ref.textField,valueField=_ref.valueField;(0,_classCallCheck2.default)(this,IconicMultiSelect),(0,_defineProperty2.default)(this,"_data",void 0),(0,_defineProperty2.default)(this,"_domElements",void 0),(0,_defineProperty2.default)(this,"_event",function(){}),(0,_defineProperty2.default)(this,"_itemTemplate",void 0),(0,_defineProperty2.default)(this,"_multiselect",void 0),(0,_defineProperty2.default)(this,"_noData",void 0),(0,_defineProperty2.default)(this,"_noResults",void 0),(0,_defineProperty2.default)(this,"_options",[]),(0,_defineProperty2.default)(this,"_placeholder",void 0),(0,_defineProperty2.default)(this,"_select",void 0),(0,_defineProperty2.default)(this,"_selectContainer",void 0),(0,_defineProperty2.default)(this,"_selectedOptions",[]),(0,_defineProperty2.default)(this,"_tagTemplate",void 0),(0,_defineProperty2.default)(this,"_textField",void 0),(0,_defineProperty2.default)(this,"_valueField",void 0),(0,_defineProperty2.default)(this,"_cross",'\n    <svg\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z"\n        fill="currentColor"\n      />\n    </svg>\n    '),this._data=null!=data?data:[],this._itemTemplate=null!=itemTemplate?itemTemplate:null,this._noData=null!=noData?noData:"No data found.",this._noResults=null!=noResults?noResults:"No results found.",this._placeholder=null!=placeholder?placeholder:"Select...",this._select=select,this._selectContainer=container,this._tagTemplate=null!=tagTemplate?tagTemplate:null,this._textField=null!=textField?textField:null,this._valueField=null!=valueField?valueField:null},[{key:"init",value:function init(){if(!this._select||"SELECT"!==this._select.nodeName)throw new Error("The selector '".concat(this._select,"' did not select any valid select tag."));if(this._itemTemplate&&0===this._data.length)throw new Error("itemTemplate must be initialized with data from the component settings");if(this._tagTemplate&&0===this._data.length)throw new Error("tagTemplate must be initialized with data from the component settings");this._options=this._data.length>0?this._getDataFromSettings():this._getDataFromSelectTag(),this._renderMultiselect(),this._renderOptionsList(),this._domElements={clear:this._multiselect.querySelector(".multiselect__clear-btn"),input:this._multiselect.querySelector(".multiselect__input"),optionsContainer:this._multiselect.querySelector(".multiselect__options"),optionsContainerList:this._multiselect.querySelector(".multiselect__options > ul"),options:{list:this._multiselect.querySelectorAll(".multiselect__options > ul > li"),find:function find(callbackFn){for(var i=0;i<this.list.length;i++){var node=this.list[i];if(callbackFn(node))return node}},some:function some(callbackFn){for(var i=0;i<this.list.length;i++){if(callbackFn(this.list[i],i))return!0}return!1}}},this._enableEventListenners(),this._initSelectedList()}},{key:"subscribe",value:function subscribe(callback){if("function"!=typeof callback)throw new Error("parameter in the subscribe method is not a function");this._event=callback}},{key:"_addOptionToList",value:function _addOptionToList(option,index){var _this=this,html='<span class="multiselect__selected" style="'.concat(style.multiselect__selected,'" data-value="').concat(option.value,'">').concat(this._tagTemplate?this._processTemplate(this._tagTemplate,index):option.text,'<span class="multiselect__remove-btn" style="').concat(style.multiselect__remove_btn,'">').concat(this._cross,"</span></span>");this._domElements.input.insertAdjacentHTML("beforebegin",html),this._multiselect.querySelector('span[data-value="'.concat(option.value,'"]')).lastElementChild.addEventListener("click",function(){var target=_this._domElements.options.find(function(el){return el.dataset.value===option.value});_this._handleOption(target)})}},{key:"_clearSelection",value:function _clearSelection(){for(var _this2=this,_loop=function _loop(){var option=_this2._selectedOptions[i],target=_this2._domElements.options.find(function(el){return el.dataset.value===option.value});target.classList.remove("multiselect__options--selected"),target.setAttribute("style",style.multiselect__options),_this2._removeOptionFromList(target.dataset.value)},i=0;i<this._selectedOptions.length;i++)_loop();this._selectedOptions=[],this._handleClearSelectionBtn(),this._handlePlaceholder(),this._dispatchEvent({action:"CLEAR_ALL_OPTIONS",selection:this._selectedOptions})}},{key:"_closeList",value:function _closeList(){this._domElements.input.value="",this._domElements.optionsContainer.classList.remove("visible"),this._domElements.optionsContainer.setAttribute("style",style.multiselect__options),this._filterOptions(""),this._removeAllArrowSelected()}},{key:"_dispatchEvent",value:function _dispatchEvent(event){this._event(event)}},{key:"_enableEventListenners",value:function _enableEventListenners(){var _this3=this;document.addEventListener("mouseup",function(_ref2){var target=_ref2.target;_this3._multiselect.contains(target)||(_this3._filterOptions(""),_this3._closeList(),_this3._handlePlaceholder())}),this._domElements.clear.addEventListener("click",function(){_this3._clearSelection()});for(var i=0;i<this._domElements.options.list.length;i++){this._domElements.options.list[i].addEventListener("click",function(_ref3){var target=_ref3.target;_this3._handleOption(target),_this3._closeList()})}this._domElements.input.addEventListener("focus",function(){_this3._domElements.optionsContainer.classList.add("visible"),_this3._domElements.optionsContainer.setAttribute("style",style.multiselect__options_visible)}),this._domElements.input.addEventListener("input",function(_ref4){var value=_ref4.target.value;_this3._domElements.options.list.length>0&&_this3._filterOptions(value)}),this._domElements.input.addEventListener("keydown",function(e){_this3._handleArrows(e),_this3._handleBackspace(e),_this3._handleEnter(e)})}},{key:"_filterOptions",value:function _filterOptions(value){var _this4=this,isOpen=this._domElements.optionsContainer.classList.contains("visible"),valueLowerCase=value.toLowerCase();if(!isOpen&&value.length>0&&(this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",style.multiselect__options_visible)),this._domElements.options.list.length>0){for(var i=0;i<this._domElements.options.list.length;i++){var el=this._domElements.options.list[i];(this._itemTemplate?this._data[i][this._textField]:el.textContent).toLowerCase().substring(0,valueLowerCase.length)===valueLowerCase?this._domElements.optionsContainerList.appendChild(el):el.parentNode&&el.parentNode.removeChild(el)}var hasResults=this._domElements.options.some(function(el,index){return(_this4._itemTemplate?_this4._data[index][_this4._textField]:el.textContent).toLowerCase().substring(0,valueLowerCase.length)===valueLowerCase});this._showNoResults(!hasResults)}}},{key:"_generateId",value:function _generateId(length){for(var result="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<length;i++)result+=characters.charAt(Math.floor(62*Math.random()));return result}},{key:"_getDataFromSelectTag",value:function _getDataFromSelectTag(){for(var arr=[],options=this._select.options,i=0;i<options.length;i++){var item=options[i];arr.push({text:item.text,value:item.value,selected:item.hasAttribute("selected")})}return arr}},{key:"_getDataFromSettings",value:function _getDataFromSettings(){if(this._data.length>0&&this._valueField&&this._textField){var isValueFieldValid="string"==typeof this._valueField,isTextFieldValid="string"==typeof this._textField,arr=[];if(!isValueFieldValid||!isTextFieldValid)throw new Error("textField and valueField must be of type string");for(var i=0;i<this._data.length;i++){var item=this._data[i];arr.push({value:item[this._valueField],text:item[this._textField],selected:"boolean"==typeof item.selected&&item.selected})}return arr}return null}},{key:"_handleArrows",value:function _handleArrows(event){if(40===event.keyCode||38===event.keyCode){event.preventDefault();var isOpen=this._domElements.optionsContainer.classList.contains("visible"),optionsContainerList=this._multiselect.querySelector(".multiselect__options > ul");if(isOpen){var selected=this._multiselect.querySelector(".multiselect__options ul li.arrow-selected"),action={ArrowUp:"previous",Up:"previous",ArrowDown:"next",Down:"next"};if(!selected)return optionsContainerList.firstElementChild.classList.add("arrow-selected"),optionsContainerList.firstElementChild.setAttribute("style",style.multiselect__options_ul_li_arrow_selected),void optionsContainerList.firstElementChild.scrollIntoView(!1);if(selected.classList.remove("arrow-selected"),selected.setAttribute("style",style.multiselect__options_ul_li),!(selected=selected[action[event.key]+"ElementSibling"]))return(selected=optionsContainerList.children["next"===action[event.key]?0:optionsContainerList.children.length-1]).classList.add("arrow-selected"),selected.setAttribute("style",style.multiselect__options_ul_li_arrow_selected),void this._scrollIntoView(optionsContainerList,selected);selected.classList.add("arrow-selected"),selected.setAttribute("style",style.multiselect__options_ul_li_arrow_selected),this._scrollIntoView(optionsContainerList,selected)}else this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",style.multiselect__options_visible),optionsContainerList.firstElementChild.classList.add("arrow-selected"),optionsContainerList.firstElementChild.setAttribute("style",style.multiselect__options_ul_li_arrow_selected),optionsContainerList.firstElementChild.scrollIntoView(!1)}}},{key:"_handleBackspace",value:function _handleBackspace(e){if(8===e.keyCode&&""===e.target.value){var lastSelectedOption=this._selectedOptions.length>0?this._selectedOptions[this._selectedOptions.length-1]:null;if(lastSelectedOption){var targetLastSelectedOption=this._multiselect.querySelector('li[data-value="'.concat(lastSelectedOption.value,'"]'));this._handleOption(targetLastSelectedOption),0===this._selectedOptions.length&&(this._domElements.optionsContainer.classList.remove("visible"),this._domElements.optionsContainer.setAttribute("style",style.multiselect__options))}}}},{key:"_handleClearSelectionBtn",value:function _handleClearSelectionBtn(){this._selectedOptions.length>0?this._domElements.clear.style.display="flex":this._domElements.clear.style.display="none"}},{key:"_handleEnter",value:function _handleEnter(event){if(13===event.keyCode){var selected=this._multiselect.querySelector(".multiselect__options ul li.arrow-selected");selected&&(this._handleOption(selected),this._closeList())}}},{key:"_handleOption",value:function _handleOption(target){for(var dispatchEvent=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<this._selectedOptions.length;i++){if(this._selectedOptions[i].value===target.dataset.value)return target.classList.remove("multiselect__options--selected"),target.setAttribute("style",style.multiselect__options),this._selectedOptions.splice(i,1),this._removeOptionFromList(target.dataset.value),this._handleClearSelectionBtn(),this._handlePlaceholder(),dispatchEvent&&this._dispatchEvent({action:"REMOVE_OPTION",value:target.dataset.value,selection:this._selectedOptions})}for(var _i=0;_i<this._options.length;_i++){var option=this._options[_i];if(option.value===target.dataset.value)return target.classList.add("multiselect__options--selected"),target.setAttribute("style",style.multiselect__options_selected),this._selectedOptions=[].concat((0,_toConsumableArray2.default)(this._selectedOptions),[option]),this._addOptionToList(option,_i),this._handleClearSelectionBtn(),this._handlePlaceholder(),dispatchEvent&&this._dispatchEvent({action:"ADD_OPTION",value:target.dataset.value,selection:this._selectedOptions})}}},{key:"_handlePlaceholder",value:function _handlePlaceholder(){this._domElements.input.placeholder=this._placeholder}},{key:"_initSelectedList",value:function _initSelectedList(){for(var _this5=this,hasItemsSelected=!1,_loop2=function _loop2(){var option=_this5._options[i];if(option.selected){hasItemsSelected=!0;var target=_this5._domElements.options.find(function(el){return el.dataset.value===option.value});target.classList.add("multiselect__options--selected"),target.setAttribute("style",style.multiselect__options_selected),_this5._selectedOptions=[].concat((0,_toConsumableArray2.default)(_this5._selectedOptions),[option]),_this5._addOptionToList(option,i)}},i=0;i<this._options.length;i++)_loop2();hasItemsSelected&&this._handleClearSelectionBtn(),this._handlePlaceholder()}},{key:"_processTemplate",value:function _processTemplate(template,index){for(var processedTemplate=template,objAttr=template.match(/\$\{(\w+)\}/g).map(function(e){return e.replace(/\$\{|\}/g,"")}),i=0;i<objAttr.length;i++){var _this$_data$index$att,attr=objAttr[i];processedTemplate=processedTemplate.replace("${".concat(attr,"}"),null!==(_this$_data$index$att=this._data[index][attr])&&void 0!==_this$_data$index$att?_this$_data$index$att:"")}return processedTemplate}},{key:"_removeAllArrowSelected",value:function _removeAllArrowSelected(){var target=this._domElements.options.find(function(el){return el.classList.contains("arrow-selected")});target&&target.classList.remove("arrow-selected")&&target.setAttribute("style",style.multiselect__options_ul_li)}},{key:"_removeOptionFromList",value:function _removeOptionFromList(value){var optionDom=this._multiselect.querySelector('span[data-value="'.concat(value,'"]'));optionDom&&optionDom.parentNode&&optionDom.parentNode.removeChild(optionDom)}},{key:"_renderOptionsList",value:function _renderOptionsList(){var _this6=this,html='\n        <div class="multiselect__options" style="'.concat(style.multiselect__options,'">\n          <ul style="').concat(style.multiselect__options_ul,'">\n          ').concat(this._options.length>0&&!this._itemTemplate?this._options.map(function(option){return'\n              <li data-value="'.concat(option.value,'" style="').concat(style.multiselect__options_ul_li,'">').concat(option.text,"</li>\n            ")}).join(""):"","\n\n          ").concat(this._options.length>0&&this._itemTemplate?this._options.map(function(option,index){return'\n              <li data-value="'.concat(option.value,'" style="').concat(style.multiselect__options_ul_li,'">').concat(_this6._processTemplate(_this6._itemTemplate,index),"</li>\n            ")}).join(""):"","\n          ").concat(this._showNoData(0===this._options.length),"\n          </ul>\n        </div>\n      ");this._multiselect.insertAdjacentHTML("beforeend",html)}},{key:"_renderMultiselect",value:function _renderMultiselect(){this._select.style.display="none";var id="iconic-"+this._generateId(20);this._multiselect=document.createElement("div"),this._multiselect.setAttribute("id",id),this._multiselect.setAttribute("class","multiselect__container"),this._multiselect.setAttribute("style",style.multiselect__container);var html='\n        <div class="multiselect__wrapper" style="'.concat(style.multiselect__wrapper,'">\n          <input class="multiselect__input" style="').concat(style.multiselect__input,'" placeholder="').concat(this._placeholder,'" />\n        </div>\n        <span style="display: none;" class="multiselect__clear-btn" style="').concat(style.multiselect__clear_btn,'">').concat(this._cross,"</span>\n    ");this._multiselect.innerHTML=html,this._selectContainer.appendChild(this._multiselect)}},{key:"_scrollIntoView",value:function _scrollIntoView(parent,child){var rectParent=parent.getBoundingClientRect(),rectChild=child.getBoundingClientRect();rectParent.top<rectChild.bottom-child.offsetHeight||(parent.scrollTop=child.clientHeight+(child.offsetTop-child.offsetHeight)),rectParent.bottom>rectChild.top+child.offsetHeight||(parent.scrollTop=child.clientHeight+(child.offsetTop-child.offsetHeight)-(parent.offsetHeight-(child.offsetHeight+(child.offsetHeight-child.clientHeight))))}},{key:"_showNoData",value:function _showNoData(condition){return condition?'<p class="multiselect__options--no-data" style="'.concat(style.multiselect__options_ul_p_multiselect__options_no_data,'">').concat(this._noData,"</p>"):""}},{key:"_showNoResults",value:function _showNoResults(condition){var dom=this._multiselect.querySelector(".multiselect__options--no-results");if(condition){var html='<p class="multiselect__options--no-results" style="'.concat(style.multiselect__options_ul_p_multiselect__options_no_results,'">').concat(this._noResults,"</p>");!dom&&this._domElements.optionsContainerList.insertAdjacentHTML("beforeend",html)}else dom&&dom.parentNode&&dom.parentNode.removeChild(dom)}}])}()},"./lib/widgets/peoplePicker.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Person=exports.PeoplePicker=exports.GroupPicker=exports.GroupBuilder=exports.Group=void 0;var _templateObject,_taggedTemplateLiteral2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js")),_classCallCheck2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/classCallCheck.js")),_createClass2=_interopRequireDefault(__webpack_require__("./node_modules/@babel/runtime/helpers/createClass.js")),_escapeHtml=_interopRequireDefault(__webpack_require__("./node_modules/escape-html/index.js")),_uuid=_interopRequireDefault(__webpack_require__("./node_modules/uuid/dist/cjs-browser/index.js")),rdf=_interopRequireWildcard(__webpack_require__("./node_modules/rdflib/esm/index.js")),debug=_interopRequireWildcard(__webpack_require__("./lib/debug.js")),_dragAndDrop=__webpack_require__("./lib/widgets/dragAndDrop.js"),_error=__webpack_require__("./lib/widgets/error.js"),_iconBase=__webpack_require__("./lib/iconBase.js"),ns=_interopRequireWildcard(__webpack_require__("./lib/ns.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(var _t in e)"default"!==_t&&{}.hasOwnProperty.call(e,_t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t))&&(i.get||i.set)?o(f,_t,i):f[_t]=e[_t]);return f})(e,t)}var kb=__webpack_require__("./node_modules/solid-logic/lib/index.js").solidLogicSingleton.store,GroupPicker=(exports.PeoplePicker=function(){return(0,_createClass2.default)(function PeoplePicker(element,typeIndex,groupPickedCb,options){(0,_classCallCheck2.default)(this,PeoplePicker),this.options=options||{},this.element=element,this.typeIndex=typeIndex,this.groupPickedCb=groupPickedCb,this.selectedgroup=this.options.selectedgroup,this.onSelectGroup=this.onSelectGroup.bind(this)},[{key:"render",value:function render(){var _this=this,container=document.createElement("div");if(container.style.maxWidth="350px",container.style.minHeight="200px",container.style.outline="1px solid black",container.style.display="flex",this.selectedgroup){container.style.flexDirection="column";var selectedGroup=document.createElement("div");new Group(selectedGroup,this.selectedgroup).render();var changeGroupButton=document.createElement("button");changeGroupButton.textContent=(0,_escapeHtml.default)("Change group"),changeGroupButton.addEventListener("click",function(_event){_this.selectedgroup=null,_this.render()}),container.appendChild(selectedGroup),container.appendChild(changeGroupButton)}else this.findAddressBook(this.typeIndex).then(function(_ref){var book=_ref.book,chooseExistingGroupButton=document.createElement("button");chooseExistingGroupButton.textContent=(0,_escapeHtml.default)("Pick an existing group"),chooseExistingGroupButton.style.margin="auto",chooseExistingGroupButton.addEventListener("click",function(_event){new GroupPicker(container,book,_this.onSelectGroup).render()});var createNewGroupButton=document.createElement("button");createNewGroupButton.textContent=(0,_escapeHtml.default)("Create a new group"),createNewGroupButton.style.margin="auto",createNewGroupButton.addEventListener("click",function(_event){_this.createNewGroup(book,_this.options.defaultNewGroupName).then(function(_ref2){var group=_ref2.group;new GroupBuilder(_this.element,book,group,_this.onSelectGroup).render()}).catch(function(errorBody){_this.element.appendChild((0,_error.errorMessageBlock)(document,(0,_escapeHtml.default)("Error creating a new group. (".concat(errorBody,")"))))})}),container.appendChild(chooseExistingGroupButton),container.appendChild(createNewGroupButton),_this.element.innerHTML="",_this.element.appendChild(container)}).catch(function(err){_this.element.appendChild((0,_error.errorMessageBlock)(document,(0,_escapeHtml.default)("Could find your groups. (".concat(err,")"))))});return this.element.innerHTML="",this.element.appendChild(container),this}},{key:"findAddressBook",value:function findAddressBook(typeIndex){return new Promise(function(resolve,reject){kb.fetcher.nowOrWhenFetched(typeIndex,function(ok,err){if(!ok)return reject(err);var bookRegistration=kb.any(null,ns.solid("forClass"),ns.vcard("AddressBook"));if(!bookRegistration)return reject(new Error("no address book registered in the solid type index "+typeIndex));var book=kb.any(bookRegistration,ns.solid("instance"));if(!book)return reject(new Error("incomplete address book registration"));kb.fetcher.load(book).then(function(_xhr){return resolve({book})}).catch(function(err){return reject(new Error("Could not load address book "+err))})})})}},{key:"createNewGroup",value:function createNewGroup(book,defaultNewGroupName){var _indexes=indexes(book),groupIndex=_indexes.groupIndex,groupContainer=_indexes.groupContainer,group=rdf.sym("".concat(groupContainer.uri).concat(_uuid.default.v4().slice(0,8),".ttl#this")),name=defaultNewGroupName||"Untitled Group",patchPromises=[group.doc(),groupIndex].map(function(doc){var typeStatement=rdf.st(group,ns.rdf("type"),ns.vcard("Group"),doc),nameStatement=rdf.st(group,ns.vcard("fn"),name,group.doc(),doc),includesGroupStatement=rdf.st(book,ns.vcard("includesGroup"),group,doc),toIns=doc.equals(groupIndex)?[typeStatement,nameStatement,includesGroupStatement]:[typeStatement,nameStatement];return patch(doc.uri,{toIns}).then(function(){toIns.forEach(function(st){kb.add(st)})})});return Promise.all(patchPromises).then(function(){return{group}}).catch(function(err){throw debug.log("Could not create new group.  PATCH failed "+err),new Error("Couldn't create new group.  PATCH failed for (".concat(err.xhr?err.xhr.responseURL:""," )"))})}},{key:"onSelectGroup",value:function onSelectGroup(group){this.selectedgroup=group,this.groupPickedCb(group),this.render()}}])}(),exports.GroupPicker=function(){return(0,_createClass2.default)(function GroupPicker(element,book,onSelectGroup){(0,_classCallCheck2.default)(this,GroupPicker),this.element=element,this.book=book,this.onSelectGroup=onSelectGroup},[{key:"render",value:function render(){var _this2=this;return this.loadGroups().then(function(groups){var container=document.createElement("div");container.style.display="flex",container.style.flexDirection="column",groups.forEach(function(group){var groupButton=document.createElement("button");groupButton.addEventListener("click",_this2.handleClickGroup(group)),new Group(groupButton,group).render(),container.appendChild(groupButton)}),_this2.element.innerHTML="",_this2.element.appendChild(container)}).catch(function(err){_this2.element.appendChild((0,_error.errorMessageBlock)(document,(0,_escapeHtml.default)("There was an error loading your groups. (".concat(err,")"))))}),this}},{key:"loadGroups",value:function loadGroups(){var _this3=this;return new Promise(function(resolve,reject){var groupIndex=indexes(_this3.book).groupIndex;kb.fetcher.nowOrWhenFetched(groupIndex,function(ok,err){if(!ok)return reject(err);var groups=kb.each(_this3.book,ns.vcard("includesGroup"));return resolve(groups)})})}},{key:"handleClickGroup",value:function handleClickGroup(group){var _this4=this;return function(_event){_this4.onSelectGroup(group)}}}])}()),Group=exports.Group=function(){return(0,_createClass2.default)(function Group(element,group){(0,_classCallCheck2.default)(this,Group),this.element=element,this.group=group},[{key:"render",value:function render(){var container=document.createElement("div");return container.textContent=(0,_escapeHtml.default)(getWithDefault(this.group,ns.vcard("fn"),"[".concat(this.group.value,"]"))),this.element.innerHTML="",this.element.appendChild(container),this}}])}(),GroupBuilder=exports.GroupBuilder=function(){return(0,_createClass2.default)(function GroupBuilder(element,book,group,doneBuildingCb,groupChangedCb){(0,_classCallCheck2.default)(this,GroupBuilder),this.element=element,this.book=book,this.group=group,this.onGroupChanged=function(err,changeType,agent){groupChangedCb&&groupChangedCb(err,changeType,agent)},this.groupChangedCb=groupChangedCb,this.doneBuildingCb=doneBuildingCb},[{key:"refresh",value:function refresh(){}},{key:"render",value:function render(){var _this5=this,dropContainer=document.createElement("div");dropContainer.style.maxWidth="350px",dropContainer.style.minHeight="200px",dropContainer.style.outline="1px solid black",dropContainer.style.display="flex",dropContainer.style.flexDirection="column",(0,_dragAndDrop.makeDropTarget)(dropContainer,function(uris){uris.forEach(function(uri){_this5.add(uri).catch(function(err){_this5.element.appendChild((0,_error.errorMessageBlock)(document,(0,_escapeHtml.default)("Could not add the given WebId. (".concat(err,")"))))})})});var groupNameInput=document.createElement("input");groupNameInput.type="text",groupNameInput.value=getWithDefault(this.group,ns.vcard("fn"),"Untitled Group"),groupNameInput.addEventListener("change",function(event){_this5.setGroupName(event.target.value).catch(function(err){_this5.element.appendChild((0,_error.errorMessageBlock)(document,"Error changing group name. (".concat(err,")")))})});var groupNameLabel=document.createElement("label");if(groupNameLabel.textContent=(0,_escapeHtml.default)("Group Name:"),groupNameLabel.appendChild(groupNameInput),dropContainer.appendChild(groupNameLabel),kb.any(this.group,ns.vcard("hasMember")))kb.match(this.group,ns.vcard("hasMember")).forEach(function(statement){var webIdNode=statement.object,personDiv=document.createElement("div");new Person(personDiv,webIdNode,_this5.handleRemove(webIdNode)).render(),dropContainer.appendChild(personDiv)});else{var copy=document.createElement("p");copy.textContent=(0,_escapeHtml.default)(_templateObject||(_templateObject=(0,_taggedTemplateLiteral2.default)(["\n        To add someone to this group, drag and drop their WebID URL onto the box.\n      "]))),dropContainer.appendChild(copy)}var doneBuildingButton=document.createElement("button");return doneBuildingButton.textContent=(0,_escapeHtml.default)("Done"),doneBuildingButton.addEventListener("click",function(_event){_this5.doneBuildingCb(_this5.group)}),dropContainer.appendChild(doneBuildingButton),this.element.innerHTML="",this.element.appendChild(dropContainer),this}},{key:"add",value:function add(webId){var _this6=this;return new Promise(function(resolve,reject){kb.fetcher.nowOrWhenFetched(webId,function(ok,err){if(!ok)return _this6.onGroupChanged(err),reject(err);var webIdNode=rdf.namedNode(webId),rdfClass=kb.any(webIdNode,ns.rdf("type"));return rdfClass&&rdfClass.equals(ns.foaf("Person"))?resolve(webIdNode):reject(new Error("Only people supported right now. (tried to add something of type ".concat(rdfClass.value,")")))})}).then(function(webIdNode){var statement=rdf.st(_this6.group,ns.vcard("hasMember"),webIdNode);return kb.holdsStatement(statement)?webIdNode:patch(_this6.group.doc().uri,{toIns:[statement]}).then(function(){statement.why=_this6.group.doc(),kb.add(statement),_this6.onGroupChanged(null,"added",webIdNode),_this6.render()})})}},{key:"handleRemove",value:function handleRemove(webIdNode){var _this7=this;return function(_event){var statement=rdf.st(_this7.group,ns.vcard("hasMember"),webIdNode);return patch(_this7.group.doc().uri,{toDel:[statement]}).then(function(){return kb.remove(statement),_this7.onGroupChanged(null,"removed",webIdNode),_this7.render(),!0}).catch(function(err){var name=kb.any(webIdNode,ns.foaf("name")),errorMessage=name&&name.value?"Could not remove ".concat(name.value,". (").concat(err,")"):"Could not remove ".concat(webIdNode.value,". (").concat(err,")");throw new Error(errorMessage)})}}},{key:"setGroupName",value:function setGroupName(name){var _this8=this,groupIndex=indexes(this.book).groupIndex,updatePromises=[this.group.doc(),groupIndex].map(function(namedGraph){var oldNameStatements=kb.match(_this8.group,ns.vcard("fn"),null,namedGraph),newNameStatement=rdf.st(_this8.group,ns.vcard("fn"),rdf.literal(name));return patch(namedGraph.value,{toDel:oldNameStatements,toIns:[newNameStatement]}).then(function(_solidResponse){kb.removeStatements(oldNameStatements),newNameStatement.why=namedGraph,kb.add(newNameStatement)})});return Promise.all(updatePromises)}}])}(),Person=exports.Person=function(){return(0,_createClass2.default)(function Person(element,webIdNode,handleRemove){(0,_classCallCheck2.default)(this,Person),this.webIdNode=webIdNode,this.element=element,this.handleRemove=handleRemove},[{key:"render",value:function render(){var _this9=this,container=document.createElement("div");container.style.display="flex";var imgSrc=getWithDefault(this.webIdNode,ns.foaf("img"),_iconBase.iconBase+"noun_15059.svg"),profileImg=document.createElement("img");profileImg.src=(0,_escapeHtml.default)(imgSrc),profileImg.width="50",profileImg.height="50",profileImg.style.margin="5px";var name=getWithDefault(this.webIdNode,ns.foaf("name"),"[".concat(this.webIdNode,"]")),nameSpan=document.createElement("span");nameSpan.innerHTML=(0,_escapeHtml.default)(name),nameSpan.style.flexGrow="1",nameSpan.style.margin="auto 0";var removeButton=document.createElement("button");return removeButton.textContent="Remove",removeButton.addEventListener("click",function(_event){return _this9.handleRemove().catch(function(err){_this9.element.appendChild((0,_error.errorMessageBlock)(document,(0,_escapeHtml.default)("".concat(err))))})}),removeButton.style.margin="5px",container.appendChild(profileImg),container.appendChild(nameSpan),container.appendChild(removeButton),this.element.innerHTML="",this.element.appendChild(container),this}}])}();function getWithDefault(subject,predicate,defaultValue){var object=kb.any(subject,predicate);return object?object.value:defaultValue}function patch(url,_ref3){var toDel=_ref3.toDel,toIns=_ref3.toIns;return new Promise(function(resolve,reject){kb.updater.update(toDel,toIns,function(uri,success,errorMessage){if(!success)return reject(new Error("PATCH failed for resource <".concat(uri,">: ").concat(errorMessage)));resolve()})})}function indexes(book){return{groupIndex:kb.any(book,ns.vcard("groupIndex")),groupContainer:kb.sym(book.dir().uri+"Group/")}}},"./lib/widgets/widgetHelpers.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.wrapDivInATR=exports.createImageDiv=exports.addClickListenerToElement=void 0;var _style=__webpack_require__("./lib/style.js");exports.wrapDivInATR=function wrapDivInATR(dom,div,obj){var tr=dom.createElement("tr");return tr.appendChild(dom.createElement("td")).appendChild(div),tr.subject=obj,tr},exports.addClickListenerToElement=function addClickListenerToElement(div,onClickFunction){div.addEventListener("click",onClickFunction)},exports.createImageDiv=function createImageDiv(dom,div,image){var imageDiv=div.appendChild(dom.createElement("div"));imageDiv.setAttribute("style",_style.imageDivStyle),imageDiv.appendChild(image),image.setAttribute("draggable","false")}},"./node_modules/memoizerific sync recursive":module=>{function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./node_modules/memoizerific sync recursive",module.exports=webpackEmptyContext}}]);