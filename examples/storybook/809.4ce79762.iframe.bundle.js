/*! For license information please see 809.4ce79762.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunksolid_ui=self.webpackChunksolid_ui||[]).push([[809],{"./src/widgets/forms.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f6:()=>appendForm,xV:()=>newThing});var buttons=__webpack_require__("./src/widgets/buttons.ts"),src_ns=__webpack_require__("./src/ns.js"),src_style=__webpack_require__("./src/style.js");const fieldParams={[src_ns.A.ui("ColorField").uri]:{size:9,type:"color",style:"height: 3em;",dt:"color",pattern:/^\s*#[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]([0-9a-f][0-9a-f])?\s*$/},[src_ns.A.ui("DateField").uri]:{size:20,type:"date",dt:"date",pattern:/^\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?Z?\s*$/},[src_ns.A.ui("DateTimeField").uri]:{size:20,type:"datetime-local",dt:"dateTime",pattern:/^\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?(T[0-2][0-9]:[0-5][0-9](:[0-5][0-9])?)?Z?\s*$/},[src_ns.A.ui("TimeField").uri]:{size:10,type:"time",dt:"time",pattern:/^\s*([0-2]?[0-9]:[0-5][0-9](:[0-5][0-9])?)\s*$/},[src_ns.A.ui("IntegerField").uri]:{size:12,style:"text-align: right;",dt:"integer",pattern:/^\s*-?[0-9]+\s*$/},[src_ns.A.ui("DecimalField").uri]:{size:12,style:"text-align: right;",dt:"decimal",pattern:/^\s*-?[0-9]*(\.[0-9]*)?\s*$/},[src_ns.A.ui("FloatField").uri]:{size:12,style:"text-align: right;",dt:"float",pattern:/^\s*-?[0-9]*(\.[0-9]*)?((e|E)-?[0-9]*)?\s*$/},[src_ns.A.ui("SingleLineTextField").uri]:{},[src_ns.A.ui("NamedNodeURIField").uri]:{namedNode:!0},[src_ns.A.ui("TextField").uri]:{},[src_ns.A.ui("PhoneField").uri]:{size:20,uriPrefix:"tel:",pattern:/^\+?[\d-]+[\d]*$/},[src_ns.A.ui("EmailField").uri]:{size:30,uriPrefix:"mailto:",pattern:/^\s*.*@.*\..*\s*$/},[src_ns.A.ui("Group").uri]:{style:src_style.i.formGroupStyle},[src_ns.A.ui("Comment").uri]:{element:"p",style:src_style.i.commentStyle},[src_ns.A.ui("Heading").uri]:{element:"h3",style:src_style.i.formHeadingStyle}};var fieldFunction=__webpack_require__("./src/widgets/forms/fieldFunction.ts"),solid_logic_esm=__webpack_require__("./node_modules/solid-logic/dist/solid-logic.esm.js");var src_debug=__webpack_require__("./src/debug.ts"),error=__webpack_require__("./src/widgets/error.ts"),literal=__webpack_require__("./node_modules/rdflib/esm/literal.js"),esm=__webpack_require__("./node_modules/rdflib/esm/index.js"),styleConstants=__webpack_require__("./src/styleConstants.js"),utils_label=__webpack_require__("./src/utils/label.ts");const basic_store=solid_logic_esm.solidLogicSingleton.store;function renderNameValuePair(dom,kb,box,form,label){box.style.display="flex",box.style.flexDirection="row";const lhs=box.appendChild(dom.createElement("div"));lhs.style.width=styleConstants.A.formFieldNameBoxWidth;const rhs=box.appendChild(dom.createElement("div"));return lhs.setAttribute("class","formFieldName"),lhs.setAttribute("style",src_style.i.formFieldNameBoxStyle),rhs.setAttribute("class","formFieldValue"),label?lhs.appendChild(dom.createTextNode(label)):kb.any(form,src_ns.A.ui("property"))?lhs.appendChild(fieldLabel(dom,kb.any(form,src_ns.A.ui("property")),form)):(rhs.appendChild((0,error.F)(dom,"No property or label given for form field: "+form)),lhs.appendChild(dom.createTextNode("???"))),rhs}function fieldLabel(dom,property,fieldInQuestion){let lab=basic_store.any(fieldInQuestion,src_ns.A.ui("label"));if(lab||(lab=(0,utils_label.P)(property,!0)),void 0===property)return dom.createTextNode("@@Internal error: undefined property");const anchor=dom.createElement("a");return property.uri&&anchor.setAttribute("href",property.uri),anchor.setAttribute("style","color: #3B5998; text-decoration: none;"),anchor.textContent=lab,anchor}function fieldStore(subject,predicate,def){const sts=basic_store.statementsMatching(subject,predicate);if(0===sts.length)return def;if(!basic_store.updater)throw new Error("Store has no updater");return sts.length>0&&sts[0].why.value&&basic_store.updater.editable(sts[0].why.value,basic_store)?basic_store.sym(sts[0].why.value):def}function basicField(dom,container,already,subject,form,doc,callbackFunction){const kb=basic_store,formDoc=form.doc?form.doc():null,box=dom.createElement("div"),property=kb.any(form,src_ns.A.ui("property"));if(container&&container.appendChild(box),!property)return box.appendChild((0,error.F)(dom,"Error: No property given for text field: "+form));const rhs=renderNameValuePair(dom,kb,box,form),suppressEmptyUneditable=kb.anyJS(form,src_ns.A.ui("suppressEmptyUneditable"),null,formDoc),uri=(0,fieldFunction.K)(form);let params=fieldParams[uri];void 0===params&&(params={style:""});const paramStyle=params.style||"",inputStyle=src_style.i.textInputStyle+paramStyle,field=dom.createElement("input");field.style=inputStyle,rhs.appendChild(field),field.setAttribute("type",params.type?params.type:"text");const size=kb.anyJS(form,src_ns.A.ui("size"))||styleConstants.A.textInputSize||20;field.setAttribute("size",size);const maxLength=kb.any(form,src_ns.A.ui("maxLength"));field.setAttribute("maxLength",maxLength?""+maxLength:styleConstants.A.basicMaxLength),doc=doc||fieldStore(subject,property,doc);let obj=kb.any(subject,property,void 0,doc);if(obj||(obj=kb.any(form,src_ns.A.ui("default"))),obj&&obj.value&&params.uriPrefix?field.value=decodeURIComponent(obj.value.replace(params.uriPrefix,"")).replace(/ /g,""):obj&&(field.value=obj.value||obj.value||""),field.setAttribute("style",inputStyle),!kb.updater)throw new Error("kb has no updater");return kb.updater.editable(doc.uri)?(field.addEventListener("keyup",function(_e){params.pattern&&field.setAttribute("style",inputStyle+(field.value.match(params.pattern)?"color: green;":"color: red;"))},!0),field.addEventListener("change",function(_e){if(params.pattern&&!field.value.match(params.pattern))return;field.disabled=!0,field.setAttribute("style",inputStyle+"color: gray;");const ds=kb.statementsMatching(subject,property);let result;params.namedNode?result=kb.sym(field.value):params.uriPrefix?(result=encodeURIComponent(field.value.replace(/ /g,"")),result=kb.sym(params.uriPrefix+field.value)):result=params.dt?new literal.A(field.value.trim(),void 0,src_ns.A.xsd(params.dt)):new literal.A(field.value);let is=ds.map(statement=>(0,esm.st)(statement.subject,statement.predicate,result,statement.why));0===is.length&&(is=[(0,esm.st)(subject,property,result,doc)]),function updateMany(ds,is,callback){const docs=[];if(is.forEach(st=>{docs.includes(st.why.uri)||docs.push(st.why.uri)}),ds.forEach(st=>{docs.includes(st.why.uri)||docs.push(st.why.uri)}),0===docs.length)throw new Error("updateMany has no docs to patch");if(!kb.updater)throw new Error("kb has no updater");if(1===docs.length)return kb.updater.update(ds,is,callback);const doc=docs.pop(),is1=is.filter(st=>st.why.uri===doc),is2=is.filter(st=>st.why.uri!==doc),ds1=ds.filter(st=>st.why.uri===doc),ds2=ds.filter(st=>st.why.uri!==doc);kb.updater.update(ds1,is1,function(uri,ok,body){ok?updateMany(ds2,is2,callback):callback(uri,ok,body)})}(ds,is,function(uri,ok,body){ok?(field.disabled=!1,field.setAttribute("style",inputStyle)):box.appendChild((0,error.F)(dom,body)),callbackFunction(ok,body)})},!0),box):(field.readOnly=!0,field.style=src_style.i.textInputStyleUneditable+paramStyle,suppressEmptyUneditable&&""===field.value&&(box.style.display="none"),box)}var iconBase=__webpack_require__("./src/iconBase.ts"),dragAndDrop=__webpack_require__("./src/widgets/dragAndDrop.js");const languageCodeURIBase="https://www.w3.org/ns/iana/language-code/",defaultPreferredLanguages=["en","fr","de","it","ar"];function addDefaults(array){return array||(array=[]),array.concat(defaultPreferredLanguages.filter(code=>!array.includes(code)))}async function getPreferredLanguages(){const me=await solid_logic_esm.authn.currentUser();if(me){const solidLanguagePrefs=await async function getPreferredLanguagesFor(person){const doc=person.doc();await(solid_logic_esm.store.fetcher?.load(doc));const list=solid_logic_esm.store.any(person,src_ns.A.schema("knowsLanguage"),null,doc);if(!list)return defaultPreferredLanguages;const languageCodeArray=[];return list.elements.forEach(item=>{const lang=solid_logic_esm.store.any(item,src_ns.A.solid("publicId"),null,doc);if(!lang)return void console.warn("getPreferredLanguages: No publiID of language.");if(!lang.value.startsWith(languageCodeURIBase))return void console.error(`What should be a language code ${lang.value} does not start with ${languageCodeURIBase}`);const code=lang.value.slice(41);languageCodeArray.push(code)}),languageCodeArray.length>0?(console.log(`     User knows languages with codes: "${languageCodeArray.join(",")}"`),addDefaults(languageCodeArray)):null}(me);if(solidLanguagePrefs)return solidLanguagePrefs}if("undefined"!=typeof navigator){if(navigator.languages)return addDefaults(navigator.languages.map(longForm=>longForm.split("-")[0]));if(navigator.language)return addDefaults([navigator.language.split("-")[0]])}return defaultPreferredLanguages}const fetcherOptionsJsonPublicData={credentials:"omit",headers:new Headers({Accept:"application/json"})};solid_logic_esm.store.sym("https://ec.europa.eu/esco/portal/static_resource2/images/logo/logo_en.gif"),solid_logic_esm.store.sym("https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/DBpediaLogo.svg/263px-DBpediaLogo.svg.png"),solid_logic_esm.store.sym("https://www.wikimedia.org/static/images/project-logos/wikidatawiki.png"),src_ns.A.schema("CollegeOrUniversity"),src_ns.A.schema("EducationalOrganization"),src_ns.A.schema("Organization"),src_ns.A.schema("CollegeOrUniversity"),src_ns.A.schema("Project"),src_ns.A.schema("GovernmentOrganization"),src_ns.A.schema("Place"),src_ns.A.schema("Corporation"),src_ns.A.rdf("type"),src_ns.A.schema("logo"),src_ns.A.foaf("nick"),src_ns.A.schema("subOrganization"),src_ns.A.vcard("locality"),src_ns.A.vcard("region"),src_ns.A.vcard("country-name"),src_ns.A.foaf("homepage"),src_ns.A.schema("latitude"),src_ns.A.schema("longitude");function bindingToTerm(item){const typ=item.type.toLowerCase();if("uri"===typ||"iri"===typ)return solid_logic_esm.store.sym(item.value);if("literal"===typ)return item["xml:lang"]?new literal.A(item.value,item["xml:lang"]):new literal.A(item.value);throw new Error(`bindingToTerm: Unexpected type "${item.type}" in sparql binding}`)}function ESCOResultToBindings(json){return json._embedded.results.map(result=>({name:{value:result.title,type:"literal"},subject:{type:"IRI",value:result.uri}}))}function fixWikidataJSON(str){const syntaxProblem=str.indexOf("SPARQL-QUERY");if(syntaxProblem<0)return str;src_debug.R8("  ### Fixing JSON with wikidata error code injection "+str.slice(syntaxProblem,syntaxProblem+200));const goodness=str.lastIndexOf("}, {");return str.slice(0,goodness)+" } ] } } "}async function queryPublicDataSelect(sparql,queryTarget){if(!queryTarget.endpoint)throw new Error("Missing queryTarget.endpoint required for queryPublicDataSelect");const myUrlWithParams=new URL(queryTarget.endpoint);myUrlWithParams.searchParams.append("query",sparql);const queryURI=myUrlWithParams.href;src_debug.Rm(" queryPublicDataSelect uri: "+queryURI);const headers=new Headers;headers.append("Accept","application/json");const options={credentials:"omit",headers},response=await(solid_logic_esm.store.fetcher?.webOperation("GET",queryURI,options)),text=response?.responseText||"";if(0===text.length)throw new Error("No text back from query "+queryURI);const text2=fixWikidataJSON(text),json=JSON.parse(text2);src_debug.Rm("    Query result JSON"+JSON.stringify(json,null,4).slice(0,100)+"...");return json.results.bindings}function setVisible(element,visible){element.style.display=visible?"":"none"}async function renderAutoComplete(dom,acOptions,decoration,callback){function finish(object,name){src_debug.Rm("Auto complete: finish! "+object),"Literal"===object.termType&&acOptions.queryParams.objectURIBase&&(object=solid_logic_esm.store.sym(acOptions.queryParams.objectURIBase.value+object.value)),clearList(),callback(object,name)}async function gotIt(object,name){if(decoration.acceptButton)return decoration.acceptButton.disbaled=!1,setVisible(decoration.acceptButton,!0),searchInput.value=name.value,foundName=name,foundObject=object,src_debug.Rm("Auto complete: name: "+name),src_debug.Rm("Auto complete: waiting for accept "+object),void clearList();setVisible(decoration.cancelButton,!0),finish(object,name)}async function acceptButtonHandler(_event){foundName&&searchInput.value===foundName.value&&finish(foundObject,foundName)}function clearList(){for(;table.children.length>1;)table.removeChild(table.lastChild)}function initialize(){acOptions.currentObject?(searchInput.value=acOptions.currentName?acOptions.currentName.value:"??? wot no name for "+acOptions.currentObject,foundName=acOptions.currentName,lastFilter=acOptions.currentName?acOptions.currentName.value:void 0,foundObject=acOptions.currentObject):(searchInput.value="",lastFilter=void 0,foundObject=void 0),decoration.deleteButton&&setVisible(decoration.deleteButton,!!acOptions.currentObject),decoration.acceptButton&&setVisible(decoration.acceptButton,!1),decoration.editButton&&setVisible(decoration.editButton,!0),decoration.cancelButton&&setVisible(decoration.cancelButton,!1),inputEventHandlerLock=!1,clearList()}const targetClass=acOptions.targetClass;if(!targetClass)throw new Error("renderAutoComplete: missing targetClass");let lastBindings;decoration.acceptButton&&decoration.acceptButton.addEventListener("click",acceptButtonHandler,!1),decoration.cancelButton&&decoration.cancelButton.addEventListener("click",async function cancelButtonHandler(_event){src_debug.Rm("Auto complete: Canceled by user! "),acOptions.permanent?initialize():div.parentNode&&div.parentNode.removeChild(div)},!1);let lastFilter,loadedEnough=!1,inputEventHandlerLock=!1,allDisplayed=!1,numberOfRows=20;const div=dom.createElement("div");let foundName,foundObject;const table=div.appendChild(dom.createElement("table"));table.setAttribute("data-testid","autocomplete-table"),table.setAttribute("style","max-width: 30em; margin: 0.5em;");const head=table.appendChild(dom.createElement("tr"));src_style.i.setStyle(head,"autocompleteRowStyle");const searchInput=head.appendChild(dom.createElement("td")).appendChild(dom.createElement("input"));searchInput.setAttribute("type","text"),initialize();const size=acOptions.size||styleConstants.A.textInputSize||20;searchInput.setAttribute("size",size),searchInput.setAttribute("data-testid","autocomplete-input");const searchInputStyle=src_style.i.textInputStyle||"border: 0.1em solid #444; border-radius: 0.5em; width: 100%; font-size: 100%; padding: 0.1em 0.6em";return searchInput.setAttribute("style",searchInputStyle),searchInput.addEventListener("keyup",function(event){13===event.keyCode&&acceptButtonHandler()},!1),searchInput.addEventListener("input",async function inputEventHHandler(_event){setVisible(decoration.cancelButton,!0),async function refreshList(){function rowForBinding(binding){const row=dom.createElement("tr");src_style.i.setStyle(row,"autocompleteRowStyle"),row.setAttribute("style","padding: 0.3em;"),row.style.color=allDisplayed?"#080":"#088",row.textContent=binding.name.value;const object=bindingToTerm(binding.subject),nameTerm=bindingToTerm(binding.name);return row.addEventListener("click",async _event=>{src_debug.Rm("       click row textContent: "+row.textContent),src_debug.Rm("       click name: "+nameTerm.value),object&&nameTerm&&gotIt(object,nameTerm)}),row}function compareBindingsByName(self,other){return other.name.value>self.name.value?1:other.name.name<self.name.value?-1:0}if(inputEventHandlerLock)return void src_debug.Rm(`Ignoring "${searchInput.value}" because of lock `);src_debug.Rm(`Setting lock at "${searchInput.value}"`),inputEventHandlerLock=!0;const languagePrefs=await getPreferredLanguages(),filter=searchInput.value.trim().toLowerCase();if(filter.length<4)clearList(),numberOfRows=20;else{allDisplayed&&lastFilter&&filter.startsWith(lastFilter)||(src_debug.Rm(`   Querying database at "${filter}" cf last "${lastFilter}".`),lastBindings=await async function loadBindingsAndFilterByLanguage(filter,languagePrefs){let bindings;try{bindings=await async function queryPublicDataByName(filter,theClass,languages,queryTarget){function substituteStrings(template){const limit=queryTarget.limit||200;return template.replace("$(name)",filter).replace("$(limit)",""+limit).replace("$(language)",language).replace("$(targetClass)",theClass.toNT())}if(!theClass)throw new Error("queryPublicDataByName: No class provided");const language=(await getPreferredLanguages()||defaultPreferredLanguages)[0]||"en";if(queryTarget.searchByNameQuery){const sparql=substituteStrings(queryTarget.searchByNameQuery);return src_debug.Rm("Querying public data - sparql: "+sparql),queryPublicDataSelect(sparql,queryTarget)}if(queryTarget.searchByNameURI){const queryURI=substituteStrings(queryTarget.searchByNameURI);let response;try{response=await(solid_logic_esm.store.fetcher?.webOperation("GET",queryURI,fetcherOptionsJsonPublicData))}catch(err){throw new Error(`Exception when trying to fetch ${queryURI} \n ${err}`)}const text=response.responseText||"";if(200!==response.status)throw new Error(`HTTP error status ${response.status} trying to fetch ${queryURI} `);if(src_debug.Rm("    Query result  text"+text.slice(0,500)+"..."),0===text.length)throw new Error("queryPublicDataByName: No text back from public data query "+queryURI);const text2=fixWikidataJSON(text),json=JSON.parse(text2);if(src_debug.Rm("    API Query result JSON"+JSON.stringify(json,null,4).slice(0,500)+"..."),json._embedded)return src_debug.Rm("      Looks like ESCO"),ESCOResultToBindings(json);throw alert("Code me: unrecognized API return format"),new Error(`*** Need to add code to parse unrecognized API JSON return\n${JSON.stringify(json,null,4)}`)}throw new Error("Query source must have either rest API or SPARQL endpoint.")}(filter,targetClass,0,acOptions.queryParams)}catch(err){return function complain(message){const errorRow=table.appendChild(dom.createElement("tr"));src_debug.Rm(message);const err=new Error(message);errorRow.appendChild(error.F(dom,err,"pink")),src_style.i.setStyle(errorRow,"autocompleteRowStyle"),errorRow.style.padding="1em"}("Error querying db of organizations: "+err),void(inputEventHandlerLock=!1)}loadedEnough=bindings.length<200,lastFilter=loadedEnough?filter:void 0;clearList();const slimmed=function filterByLanguage(bindings,languagePrefs){const uris={};bindings.forEach(binding=>{const uri=binding.subject.value;uris[uri]=uris[uri]||[],uris[uri].push(binding)});const languagePrefs2=languagePrefs||defaultPreferredLanguages;languagePrefs2.reverse();const slimmed=[];for(const u in uris){const sortMe=uris[u].map(binding=>{const lang=binding.name["xml:lang"];return[languagePrefs2.indexOf(lang),binding]});sortMe.sort(),sortMe.reverse(),slimmed.push(sortMe[0][1])}return src_debug.Rm(` Filter by language: ${bindings.length} -> ${slimmed.length}`),slimmed}(bindings,languagePrefs);return slimmed}(filter,languagePrefs));const slimmed=function filterByName(filter,bindings){return bindings.filter(binding=>function nameMatch(filter,candidate){const parts=filter.split(" ");for(let j=0;j<parts.length;j++){const word=parts[j];if(candidate.toLowerCase().indexOf(word)<0)return!1}return!0}(filter,binding.name.value))}(filter,lastBindings);loadedEnough&&slimmed.length<=40&&(numberOfRows=slimmed.length),allDisplayed=loadedEnough&&slimmed.length<=numberOfRows,src_debug.Rm(` Filter:"${filter}" lastBindings: ${lastBindings.length}, slimmed to ${slimmed.length}; rows: ${numberOfRows}, Enough? ${loadedEnough}, All displayed? ${allDisplayed}`);const displayable=slimmed.slice(0,numberOfRows);displayable.sort(compareBindingsByName),clearList();for(const binding of displayable)table.appendChild(rowForBinding(binding));1===slimmed.length&&gotIt(bindingToTerm(slimmed[0].subject),bindingToTerm(slimmed[0].name))}inputEventHandlerLock=!1}()}),div}const GREEN_PLUS=iconBase.Pt.iconBase+"noun_34653_green.svg",SEARCH_ICON=iconBase.Pt.iconBase+"noun_Search_875351.svg",EDIT_ICON=iconBase.Pt.iconBase+"noun_253504.svg";async function renderAutocompleteControl(dom,person,barOptions,acOptions,addOneIdAndRefresh,deleteOne){async function autoCompleteDone(object,name){return acOptions.permanent?(setVisible(editButton,!0),setVisible(acceptButton,!1),setVisible(cancelButton,!1)):function removeDecorated(){decoratedAutocomplete&&(creationArea.removeChild(decoratedAutocomplete),decoratedAutocomplete=void 0)}(),addOneIdAndRefresh(object,name)}async function displayAutocomplete(){decoratedAutocomplete=dom.createElement("div"),decoratedAutocomplete.setAttribute("style","display: flex; flex-flow: wrap;"),decoratedAutocomplete.appendChild(await renderAutoComplete(dom,acOptions,decoration,autoCompleteDone)),decoratedAutocomplete.appendChild(acceptButton),decoratedAutocomplete.appendChild(cancelButton),decoratedAutocomplete.appendChild(editButton),decoratedAutocomplete.appendChild(deleteButtonContainer),creationArea.appendChild(decoratedAutocomplete)}const acceptButton=buttons.kz(dom);acceptButton.setAttribute("data-testid","accept-button");const cancelButton=buttons.x7(dom);cancelButton.setAttribute("data-testid","cancel-button");const deleteButtonContainer=dom.createElement("div"),noun=acOptions.targetClass?utils_label.P(acOptions.targetClass):"item",deleteButton=buttons.Qy(dom,deleteButtonContainer,noun,deleteOne);deleteButton.setAttribute("data-testid","delete-button");const editButton=buttons.x6(dom,EDIT_ICON,"Edit",_event=>{editing=!editing,syncEditingStatus()});editButton.setAttribute("data-testid","edit-button");let editing=!0;function syncEditingStatus(){editing?(setVisible(editButton,!1),setVisible(acceptButton,!1),setVisible(cancelButton,!1)):(setVisible(editButton,!0),setVisible(acceptButton,!1),setVisible(cancelButton,!1))}const decoration={acceptButton,cancelButton,editButton,deleteButton};let decoratedAutocomplete;const creationArea=dom.createElement("div");if(creationArea.style.display="flex",creationArea.style.flexDirection="row",(acOptions.permanent||acOptions.currentObject)&&await displayAutocomplete(),barOptions.editable){if(creationArea.style.width="100%",barOptions.manualURIEntry){const plus=creationArea.appendChild(buttons.x6(dom,GREEN_PLUS,barOptions.idNoun,async function greenButtonHandler(_event){const webid=await buttons.RG(dom,solid_logic_esm.store,creationArea,src_ns.A.vcard("url"),void 0,"Solid ID");if(webid)return addOneIdAndRefresh(person,webid)}));dragAndDrop.DK(plus,async function droppedURIHandler(uris){for(const webid of uris)await addOneIdAndRefresh(person,webid)},void 0)}!barOptions.dbLookup||acOptions.currentObject||acOptions.permanent||creationArea.appendChild(buttons.x6(dom,SEARCH_ICON,barOptions.idNoun,async function searchButtonHandler(_event){decoratedAutocomplete?(creationArea.removeChild(decoratedAutocomplete),decoratedAutocomplete=void 0):await displayAutocomplete()}))}return syncEditingStatus(),creationArea}var src_log=__webpack_require__("./src/log.ts"),node=__webpack_require__("./node_modules/rdflib/esm/node.js"),collection=__webpack_require__("./node_modules/rdflib/esm/collection.js"),src_utils=__webpack_require__("./src/utils/index.js");const style_multiSelect_style={multiselect__container:"\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n        background-color: #fff;\n        border-radius: 2px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n                box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        min-height: 36px;\n        padding: 4px 8px 0 8px;\n        position: relative;\n        width: 354px;\n        margin-bottom: 5px;\n        font-size: 100%\n    ",multiselect__wrapper:"\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -ms-flex-wrap: wrap;\n            flex-wrap: wrap;\n        height: 100%;\n        width: 100%;\n    ",multiselect__clear_btn:"\n        cursor: pointer;\n        align-items: center;\n        margin-bottom: 4px;\n        margin-left: 4px;\n    ",multiselect__options:"\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n    ",multiselect__options_visible:"\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n        max-height: 200px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        opacity: 1;\n        transition: max-height 0.2s ease;\n    ",multiselect__options_ul:"\n        list-style: none;\n        margin: 0;\n        padding: 2px 0;\n        max-height: 200px;\n        overflow: auto;\n    ",multiselect__options_ul_li:"\n        cursor: pointer;\n        padding: 4px 8px;\n    ",multiselect__options_ul_li_hover:"\n        background-color: #dedede;\n    ",multiselect__options_ul_p_multiselect__options_no_results:"\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    ",multiselect__options_ul_p_multiselect__options_no_data:"\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    ",multiselect__options_ul_li_multiselect__options_selected:"\n        background-color: #656565;\n        color: #fff;\n    ",multiselect__options_ul_li_multiselect__options_selected_hover:"\n    background-color: #656565;\n    ",multiselect__options_ul_li_arrow_selected:"\n        border: 2px solid rgba(101, 101, 101, 0.5);\n    ",multiselect__selected:"\n        background-color: #656565;\n        border-radius: 2px;\n        color: #fff;\n        margin-bottom: 4px;\n        margin-right: 4px;\n        padding: 4px 8px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n    ",multiselect__selected_multiselect__remove_btn:"\n        cursor: pointer;\n        display: flex;\n        margin-left: 6px;\n    ",multiselect__input:"\n        border: none;\n        -ms-flex-preferred-size: 40%;\n            flex-basis: 40%;\n        -webkit-box-flex: 1;\n            -ms-flex-positive: 1;\n                flex-grow: 1;\n        height: 5px;        \n        margin-bottom: 4px;\n        min-width: 40%;\n        outline: none;      \n    ",setStyle:function setStyle(ele,styleName){ele.style=style_multiSelect_style[styleName]}};class IconicMultiSelect{_data;_domElements;_event=()=>{};_itemTemplate;_multiselect;_noData;_noResults;_options=[];_placeholder;_select;_selectContainer;_selectedOptions=[];_tagTemplate;_textField;_valueField;_cross='\n    <svg\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z"\n        fill="currentColor"\n      />\n    </svg>\n    ';constructor({data,itemTemplate,noData,noResults,placeholder,select,container,tagTemplate,textField,valueField}){this._data=data??[],this._itemTemplate=itemTemplate??null,this._noData=noData??"No data found.",this._noResults=noResults??"No results found.",this._placeholder=placeholder??"Select...",this._select=select,this._selectContainer=container,this._tagTemplate=tagTemplate??null,this._textField=textField??null,this._valueField=valueField??null}init(){if(!this._select||"SELECT"!==this._select.nodeName)throw new Error(`The selector '${this._select}' did not select any valid select tag.`);if(this._itemTemplate&&0===this._data.length)throw new Error("itemTemplate must be initialized with data from the component settings");if(this._tagTemplate&&0===this._data.length)throw new Error("tagTemplate must be initialized with data from the component settings");this._options=this._data.length>0?this._getDataFromSettings():this._getDataFromSelectTag(),this._renderMultiselect(),this._renderOptionsList(),this._domElements={clear:this._multiselect.querySelector(".multiselect__clear-btn"),input:this._multiselect.querySelector(".multiselect__input"),optionsContainer:this._multiselect.querySelector(".multiselect__options"),optionsContainerList:this._multiselect.querySelector(".multiselect__options > ul"),options:{list:this._multiselect.querySelectorAll(".multiselect__options > ul > li"),find:function(callbackFn){for(let i=0;i<this.list.length;i++){const node=this.list[i];if(callbackFn(node))return node}},some:function(callbackFn){for(let i=0;i<this.list.length;i++){if(callbackFn(this.list[i],i))return!0}return!1}}},this._enableEventListenners(),this._initSelectedList()}subscribe(callback){if("function"!=typeof callback)throw new Error("parameter in the subscribe method is not a function");this._event=callback}_addOptionToList(option,index){const html=`<span class="multiselect__selected" style="${style_multiSelect_style.multiselect__selected}" data-value="${option.value}">${this._tagTemplate?this._processTemplate(this._tagTemplate,index):option.text}<span class="multiselect__remove-btn" style="${style_multiSelect_style.multiselect__remove_btn}">${this._cross}</span></span>`;this._domElements.input.insertAdjacentHTML("beforebegin",html);const{lastElementChild:removeBtn}=this._multiselect.querySelector(`span[data-value="${option.value}"]`);removeBtn.addEventListener("click",()=>{const target=this._domElements.options.find(el=>el.dataset.value===option.value);this._handleOption(target)})}_clearSelection(){for(let i=0;i<this._selectedOptions.length;i++){const option=this._selectedOptions[i],target=this._domElements.options.find(el=>el.dataset.value===option.value);target.classList.remove("multiselect__options--selected"),target.setAttribute("style",style_multiSelect_style.multiselect__options),this._removeOptionFromList(target.dataset.value)}this._selectedOptions=[],this._handleClearSelectionBtn(),this._handlePlaceholder(),this._dispatchEvent({action:"CLEAR_ALL_OPTIONS",selection:this._selectedOptions})}_closeList(){this._domElements.input.value="",this._domElements.optionsContainer.classList.remove("visible"),this._domElements.optionsContainer.setAttribute("style",style_multiSelect_style.multiselect__options),this._filterOptions(""),this._removeAllArrowSelected()}_dispatchEvent(event){this._event(event)}_enableEventListenners(){document.addEventListener("mouseup",({target})=>{this._multiselect.contains(target)||(this._filterOptions(""),this._closeList(),this._handlePlaceholder())}),this._domElements.clear.addEventListener("click",()=>{this._clearSelection()});for(let i=0;i<this._domElements.options.list.length;i++){this._domElements.options.list[i].addEventListener("click",({target})=>{this._handleOption(target),this._closeList()})}this._domElements.input.addEventListener("focus",()=>{this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",style_multiSelect_style.multiselect__options_visible)}),this._domElements.input.addEventListener("input",({target:{value}})=>{this._domElements.options.list.length>0&&this._filterOptions(value)}),this._domElements.input.addEventListener("keydown",e=>{this._handleArrows(e),this._handleBackspace(e),this._handleEnter(e)})}_filterOptions(value){const isOpen=this._domElements.optionsContainer.classList.contains("visible"),valueLowerCase=value.toLowerCase();if(!isOpen&&value.length>0&&(this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",style_multiSelect_style.multiselect__options_visible)),this._domElements.options.list.length>0){for(let i=0;i<this._domElements.options.list.length;i++){const el=this._domElements.options.list[i];(this._itemTemplate?this._data[i][this._textField]:el.textContent).toLowerCase().substring(0,valueLowerCase.length)===valueLowerCase?this._domElements.optionsContainerList.appendChild(el):el.parentNode&&el.parentNode.removeChild(el)}const hasResults=this._domElements.options.some((el,index)=>(this._itemTemplate?this._data[index][this._textField]:el.textContent).toLowerCase().substring(0,valueLowerCase.length)===valueLowerCase);this._showNoResults(!hasResults)}}_generateId(length){let result="";const characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<length;i++)result+=characters.charAt(Math.floor(62*Math.random()));return result}_getDataFromSelectTag(){const arr=[],{options}=this._select;for(let i=0;i<options.length;i++){const item=options[i];arr.push({text:item.text,value:item.value,selected:item.hasAttribute("selected")})}return arr}_getDataFromSettings(){if(this._data.length>0&&this._valueField&&this._textField){const isValueFieldValid="string"==typeof this._valueField,isTextFieldValid="string"==typeof this._textField,arr=[];if(!isValueFieldValid||!isTextFieldValid)throw new Error("textField and valueField must be of type string");for(let i=0;i<this._data.length;i++){const item=this._data[i];arr.push({value:item[this._valueField],text:item[this._textField],selected:"boolean"==typeof item.selected&&item.selected})}return arr}return null}_handleArrows(event){if(40===event.keyCode||38===event.keyCode){event.preventDefault();const isOpen=this._domElements.optionsContainer.classList.contains("visible"),optionsContainerList=this._multiselect.querySelector(".multiselect__options > ul");if(isOpen){let selected=this._multiselect.querySelector(".multiselect__options ul li.arrow-selected");const action={ArrowUp:"previous",Up:"previous",ArrowDown:"next",Down:"next"};if(!selected)return optionsContainerList.firstElementChild.classList.add("arrow-selected"),optionsContainerList.firstElementChild.setAttribute("style",style_multiSelect_style.multiselect__options_ul_li_arrow_selected),void optionsContainerList.firstElementChild.scrollIntoView(!1);if(selected.classList.remove("arrow-selected"),selected.setAttribute("style",style_multiSelect_style.multiselect__options_ul_li),selected=selected[action[event.key]+"ElementSibling"],!selected)return selected=optionsContainerList.children["next"===action[event.key]?0:optionsContainerList.children.length-1],selected.classList.add("arrow-selected"),selected.setAttribute("style",style_multiSelect_style.multiselect__options_ul_li_arrow_selected),void this._scrollIntoView(optionsContainerList,selected);selected.classList.add("arrow-selected"),selected.setAttribute("style",style_multiSelect_style.multiselect__options_ul_li_arrow_selected),this._scrollIntoView(optionsContainerList,selected)}else this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",style_multiSelect_style.multiselect__options_visible),optionsContainerList.firstElementChild.classList.add("arrow-selected"),optionsContainerList.firstElementChild.setAttribute("style",style_multiSelect_style.multiselect__options_ul_li_arrow_selected),optionsContainerList.firstElementChild.scrollIntoView(!1)}}_handleBackspace(e){if(8===e.keyCode&&""===e.target.value){const lastSelectedOption=this._selectedOptions.length>0?this._selectedOptions[this._selectedOptions.length-1]:null;if(lastSelectedOption){const targetLastSelectedOption=this._multiselect.querySelector(`li[data-value="${lastSelectedOption.value}"]`);this._handleOption(targetLastSelectedOption),0===this._selectedOptions.length&&(this._domElements.optionsContainer.classList.remove("visible"),this._domElements.optionsContainer.setAttribute("style",style_multiSelect_style.multiselect__options))}}}_handleClearSelectionBtn(){this._selectedOptions.length>0?this._domElements.clear.style.display="flex":this._domElements.clear.style.display="none"}_handleEnter(event){if(13===event.keyCode){const selected=this._multiselect.querySelector(".multiselect__options ul li.arrow-selected");selected&&(this._handleOption(selected),this._closeList())}}_handleOption(target,dispatchEvent=!0){for(let i=0;i<this._selectedOptions.length;i++){if(this._selectedOptions[i].value===target.dataset.value)return target.classList.remove("multiselect__options--selected"),target.setAttribute("style",style_multiSelect_style.multiselect__options),this._selectedOptions.splice(i,1),this._removeOptionFromList(target.dataset.value),this._handleClearSelectionBtn(),this._handlePlaceholder(),dispatchEvent&&this._dispatchEvent({action:"REMOVE_OPTION",value:target.dataset.value,selection:this._selectedOptions})}for(let i=0;i<this._options.length;i++){const option=this._options[i];if(option.value===target.dataset.value)return target.classList.add("multiselect__options--selected"),target.setAttribute("style",style_multiSelect_style.multiselect__options_selected),this._selectedOptions=[...this._selectedOptions,option],this._addOptionToList(option,i),this._handleClearSelectionBtn(),this._handlePlaceholder(),dispatchEvent&&this._dispatchEvent({action:"ADD_OPTION",value:target.dataset.value,selection:this._selectedOptions})}}_handlePlaceholder(){this._domElements.input.placeholder=this._placeholder}_initSelectedList(){let hasItemsSelected=!1;for(let i=0;i<this._options.length;i++){const option=this._options[i];if(option.selected){hasItemsSelected=!0;const target=this._domElements.options.find(el=>el.dataset.value===option.value);target.classList.add("multiselect__options--selected"),target.setAttribute("style",style_multiSelect_style.multiselect__options_selected),this._selectedOptions=[...this._selectedOptions,option],this._addOptionToList(option,i)}}hasItemsSelected&&this._handleClearSelectionBtn(),this._handlePlaceholder()}_processTemplate(template,index){let processedTemplate=template;const objAttr=template.match(/\$\{(\w+)\}/g).map(e=>e.replace(/\$\{|\}/g,""));for(let i=0;i<objAttr.length;i++){const attr=objAttr[i];processedTemplate=processedTemplate.replace(`\${${attr}}`,this._data[index][attr]??"")}return processedTemplate}_removeAllArrowSelected(){const target=this._domElements.options.find(el=>el.classList.contains("arrow-selected"));target&&target.classList.remove("arrow-selected")&&target.setAttribute("style",style_multiSelect_style.multiselect__options_ul_li)}_removeOptionFromList(value){const optionDom=this._multiselect.querySelector(`span[data-value="${value}"]`);optionDom&&optionDom.parentNode&&optionDom.parentNode.removeChild(optionDom)}_renderOptionsList(){const html=`\n        <div class="multiselect__options" style="${style_multiSelect_style.multiselect__options}">\n          <ul style="${style_multiSelect_style.multiselect__options_ul}">\n          ${this._options.length>0&&!this._itemTemplate?this._options.map(option=>`\n              <li data-value="${option.value}" style="${style_multiSelect_style.multiselect__options_ul_li}">${option.text}</li>\n            `).join(""):""}\n\n          ${this._options.length>0&&this._itemTemplate?this._options.map((option,index)=>`\n              <li data-value="${option.value}" style="${style_multiSelect_style.multiselect__options_ul_li}">${this._processTemplate(this._itemTemplate,index)}</li>\n            `).join(""):""}\n          ${this._showNoData(0===this._options.length)}\n          </ul>\n        </div>\n      `;this._multiselect.insertAdjacentHTML("beforeend",html)}_renderMultiselect(){this._select.style.display="none";const id="iconic-"+this._generateId(20);this._multiselect=document.createElement("div"),this._multiselect.setAttribute("id",id),this._multiselect.setAttribute("class","multiselect__container"),this._multiselect.setAttribute("style",style_multiSelect_style.multiselect__container);const html=`\n        <div class="multiselect__wrapper" style="${style_multiSelect_style.multiselect__wrapper}">\n          <input class="multiselect__input" style="${style_multiSelect_style.multiselect__input}" placeholder="${this._placeholder}" />\n        </div>\n        <span style="display: none;" class="multiselect__clear-btn" style="${style_multiSelect_style.multiselect__clear_btn}">${this._cross}</span>\n    `;this._multiselect.innerHTML=html,this._selectContainer.appendChild(this._multiselect)}_scrollIntoView(parent,child){const rectParent=parent.getBoundingClientRect(),rectChild=child.getBoundingClientRect();rectParent.top<rectChild.bottom-child.offsetHeight||(parent.scrollTop=child.clientHeight+(child.offsetTop-child.offsetHeight)),rectParent.bottom>rectChild.top+child.offsetHeight||(parent.scrollTop=child.clientHeight+(child.offsetTop-child.offsetHeight)-(parent.offsetHeight-(child.offsetHeight+(child.offsetHeight-child.clientHeight))))}_showNoData(condition){return condition?`<p class="multiselect__options--no-data" style="${style_multiSelect_style.multiselect__options_ul_p_multiselect__options_no_data}">${this._noData}</p>`:""}_showNoResults(condition){const dom=this._multiselect.querySelector(".multiselect__options--no-results");if(condition){const html=`<p class="multiselect__options--no-results" style="${style_multiSelect_style.multiselect__options_ul_p_multiselect__options_no_results}">${this._noResults}</p>`;!dom&&this._domElements.optionsContainerList.insertAdjacentHTML("beforeend",html)}else dom&&dom.parentNode&&dom.parentNode.removeChild(dom)}}const kb=solid_logic_esm.store;function refreshOpionsSubfieldinGroup(dom,already,subject,dataDoc,callbackFunction,groupDiv,subfields){const eles=groupDiv.children;for(let j=0;j<subfields.length;j++){const field=subfields[j];if((0,fieldFunction.K)(field)===src_ns.A.ui("Options").uri){const newOne=(0,fieldFunction.rg)(dom,field)(dom,null,already,subject,field,dataDoc,callbackFunction);src_debug.Rm("Refreshing Options field by replacing it."),groupDiv.insertBefore(newOne,eles[j]),groupDiv.removeChild(eles[j+1])}}}function booleanField(dom,container,already,subject,form,dataDoc,callbackFunction,tristate){const ui=src_ns.A.ui,kb=solid_logic_esm.store,property=kb.any(form,ui("property"));if(!property){const errorBlock=(0,error.F)(dom,"No property to boolean field: "+form);return container&&container.appendChild(errorBlock),errorBlock}let lab=kb.any(form,ui("label"));lab||(lab=utils_label.P(property,!0)),dataDoc=fieldStore(subject,property,dataDoc);let state=kb.any(subject,property);void 0===state&&(state=!1);const ins=esm.st(subject,property,!0,dataDoc),box=function buildCheckboxForm(dom,kb,lab,del,ins,form,dataDoc,tristate){const box=dom.createElement("div"),rhs=renderNameValuePair(dom,kb,box,form,lab),editable=kb.updater.editable(dataDoc.uri),input=dom.createElement("button"),colorCarrier=input;function fix(x){if(!x)return[];if(x.object)return x.why||(x.why=dataDoc),[x];if(x instanceof Array)return x;throw new Error("buildCheckboxForm: bad param "+x)}function holdsAll(a){return 0===a.filter(st=>!kb.holds(st.subject,st.predicate,st.object,st.why)).length}function refresh(){let state=holdsAll(ins),displayState=state;if(del.length){const negation=holdsAll(del);if(state&&negation)return box.appendChild(error.F(dom,"Inconsistent data in dataDoc!\n"+ins+" and\n"+del)),box;if(!state&&!negation){state=null;const defa=kb.any(form,src_ns.A.ui("default"));displayState=defa?"1"===defa.value:!!tristate&&null}}input.state=state,input.textContent={true:"✓",false:tristate?"✕":" ",null:"-"}[displayState]}if(input.style=src_style.i.checkboxInputStyle,rhs.appendChild(input),ins=fix(ins),del=fix(del),refresh(),!editable)return box;const boxHandler=function(_e){colorCarrier.style.color="#bbb";const toDelete=!0===input.state?ins:!1===input.state?del:[];input.newState=null===input.state||!0!==input.state&&(!tristate||null);const toInsert=!0===input.newState?ins:!1===input.newState?del:[];src_debug.Rm(`  Deleting  ${toDelete}`),src_debug.Rm(`  Inserting ${toInsert}`),kb.updater.update(toDelete,toInsert,function(uri,success,errorBody){if(success)colorCarrier.style.color="#000",input.state=input.newState,input.textContent={true:"✓",false:"✕",null:"-"}[input.state];else{if(toDelete.why){kb.holds(toDelete.subject,toDelete.predicate,toDelete.object,toDelete.why)&&src_debug.Rm(" @@@@@ weird if 409 - does hold statement")}colorCarrier.style.color="#000",colorCarrier.style.backgroundColor="#fee",box.appendChild((0,error.F)(dom,`Checkbox: Error updating dataDoc from ${input.state} to ${input.newState}:\n\n${errorBody}`))}})};return input.addEventListener("click",boxHandler,!1),box}(dom,kb,lab,esm.st(subject,property,!1,dataDoc),ins,form,dataDoc,tristate);return container&&container.appendChild(box),box}function addSubFormChoice(dom,selectDiv,already,subject,subForm,dataDoc,callbackFunction){(0,fieldFunction.rg)(dom,subForm)(dom,selectDiv,already,subject,subForm,dataDoc,callbackFunction)}function appendForm(dom,container,already,subject,form,dataDoc,itemDone){return(0,fieldFunction.rg)(dom,form)(dom,container,already,subject,form,dataDoc,itemDone)}function findClosest(kb,cla,prop){const agenda=[kb.sym(cla)];for(;agenda.length>0;){const c=agenda.shift(),lists=kb.each(c,prop);if(src_log.debug("Lists for "+c+", "+prop+": "+lists.length),0!==lists.length)return lists;const supers=kb.each(c,src_ns.A.rdfs("subClassOf"));for(let i=0;i<supers.length;i++)agenda.push(supers[i]),src_log.debug("findClosest: add super: "+supers[i])}return[]}function promptForNew(dom,kb,subject,predicate,theClass,form,dataDoc,callbackFunction){const box=dom.createElement("form");if(!form){const lists=findClosest(kb,theClass.uri,src_ns.A.ui("creationForm"));if(0===lists.length){box.appendChild(dom.createElement("p")).textContent="I am sorry, you need to provide information about a "+utils_label.P(theClass)+" but I don't know enough information about those to ask you.";const b=box.appendChild(dom.createElement("button"));return b.setAttribute("type","button"),b.setAttribute("style","float: right;"),b.innerHTML="Goto "+utils_label.P(theClass),b.addEventListener("click",function(_e){dom.outlineManager.GotoSubject(theClass,!0,void 0,!0,void 0)},!1),box}src_log.debug("lists[0] is "+lists[0]),form=lists[0]}src_log.debug("form is "+form),box.setAttribute("style",`border: 0.05em solid ${styleConstants.A.formBorderColor}; color: ${styleConstants.A.formBorderColor}`),box.innerHTML="<h3>New "+utils_label.P(theClass)+"</h3>";const formFunction=(0,fieldFunction.rg)(dom,form),object=newThing(dataDoc);let gotButton=!1;function linkDone(uri,ok,body){return callbackFunction(ok,body)}src_log.info("paneUtils Object is "+object);const f=formFunction(dom,box,{},object,form,dataDoc,function(ok,body){if(!ok)return callbackFunction(ok,body);const insertMe=[];subject&&!kb.holds(subject,predicate,object,dataDoc)&&insertMe.push(esm.st(subject,predicate,object,dataDoc)),subject&&!kb.holds(object,src_ns.A.rdf("type"),theClass,dataDoc)&&insertMe.push(esm.st(object,src_ns.A.rdf("type"),theClass,dataDoc)),insertMe.length?kb.updater.update([],insertMe,linkDone):callbackFunction(!0,body),gotButton||(gotButton=box.appendChild(buttons.$J(dom,object)))});return buttons.DT(dom,f).setAttribute("style","float: right;"),box.AJAR_subject=object,box}function makeSelectForCategory(dom,kb,subject,category,dataDoc,callbackFunction){const du=kb.any(category,src_ns.A.owl("disjointUnionOf"));let subs,multiple=!1;return du?subs=du.elements:(subs=kb.each(void 0,src_ns.A.rdfs("subClassOf"),category),multiple=!0),src_log.debug("Select list length "+subs.length),0===subs.length?(0,error.F)(dom,"Can't do "+(multiple?"multiple ":"")+"selector with no subclasses of category: "+category):1===subs.length?(0,error.F)(dom,"Can't do "+(multiple?"multiple ":"")+"selector with only 1 subclass of category: "+category+":"+subs[1]):function makeSelectForClassifierOptions(dom,kb,subject,predicate,possible,options,dataDoc,callbackFunction){src_log.debug("Select list length now "+possible.length);let n=0;const uris={},editable=kb.updater.editable(dataDoc.uri);for(let i=0;i<possible.length;i++){const sub=possible[i];sub.uri||src_debug.R8(`makeSelectForClassifierOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`),sub.uri&&!(sub.uri in uris)&&(uris[sub.uri]=!0,n++)}if(0===n&&!options.mint)return(0,error.F)(dom,"Can't do selector with no options, subject= "+subject+" property = "+predicate+".");let actual;src_log.debug("makeSelectForClassifierOptions: dataDoc="+dataDoc);const getActual=function(){return actual={},predicate.sameTerm(src_ns.A.rdf("type"))?actual=kb.findTypeURIs(subject):kb.each(subject,predicate,null,dataDoc).forEach(function(x){actual[x.uri]=!0}),actual};actual=getActual();const onChange=function(_e){select.disabled=!0;const ds=[];let is=[];const removeValue=function(t){kb.holds(subject,predicate,t,dataDoc)&&ds.push(esm.st(subject,predicate,t,dataDoc))};let newObject;for(let i=0;i<select.options.length;i++){const opt=select.options[i];if(opt.selected&&opt.AJAR_mint){if(options.mintClass){const thisForm=promptForNew(dom,kb,subject,predicate,options.mintClass,null,dataDoc,function(ok,body){ok||callbackFunction(ok,body,{change:"new"})});select.parentNode.appendChild(thisForm),newObject=thisForm.AJAR_subject}else newObject=newThing(dataDoc);is.push(esm.st(subject,predicate,newObject,dataDoc)),options.mintStatementsFun&&(is=is.concat(options.mintStatementsFun(newObject)))}opt.AJAR_uri&&(opt.selected&&!(opt.AJAR_uri in actual)&&is.push(esm.st(subject,predicate,kb.sym(opt.AJAR_uri),dataDoc)),!opt.selected&&opt.AJAR_uri in actual&&removeValue(kb.sym(opt.AJAR_uri)),opt.selected&&(select.currentURI=opt.AJAR_uri))}let sel=select.subSelect;for(;sel&&sel.currentURI;)removeValue(kb.sym(sel.currentURI)),sel=sel.subSelect;for(sel=select.superSelect;sel&&sel.currentURI;)removeValue(kb.sym(sel.currentURI)),sel=sel.superSelect;function doneNew(ok,_body){callbackFunction(ok,{widget:"select",event:"new"})}src_log.info("makeSelectForClassifierOptions: data doc = "+dataDoc),kb.updater.update(ds,is,function(uri,ok,body){if(actual=getActual(),!ok)return select.parentNode.appendChild((0,error.F)(dom,"Error updating data in select: "+body));select.disabled=!1,newObject&&(0,fieldFunction.rg)(dom,options.subForm)(dom,select.parentNode,{},newObject,options.subForm,dataDoc,doneNew),callbackFunction&&callbackFunction(ok,{widget:"select",event:"change"})})},select=dom.createElement("select");select.setAttribute("style",src_style.i.formSelectStyle),options.multiple&&select.setAttribute("multiple","true"),select.currentURI=null,select.refresh=function(){actual=getActual();for(let i=0;i<select.children.length;i++){const option=select.children[i];option.AJAR_uri&&(option.selected=option.AJAR_uri in actual)}select.disabled=!1};for(const uri in uris){const c=kb.sym(uri),option=dom.createElement("option");options.disambiguate?option.appendChild(dom.createTextNode(src_utils.SY(c,!0))):option.appendChild(dom.createTextNode(utils_label.P(c,!0)));const backgroundColor=kb.any(c,kb.sym("http://www.w3.org/ns/ui#backgroundColor"));backgroundColor&&option.setAttribute("style","background-color: "+backgroundColor.value+"; "),option.AJAR_uri=uri,uri in actual&&(option.setAttribute("selected","true"),select.currentURI=uri),select.appendChild(option)}if(editable&&options.mint){const mint=dom.createElement("option");mint.appendChild(dom.createTextNode(options.mint)),mint.AJAR_mint=!0,select.insertBefore(mint,select.firstChild)}if(null==select.currentURI&&!options.multiple){const prompt=dom.createElement("option");prompt.appendChild(dom.createTextNode(options.nullLabel)),select.insertBefore(prompt,select.firstChild),prompt.selected=!0}return editable&&select.addEventListener("change",onChange,!1),select}(dom,kb,subject,src_ns.A.rdf("type"),subs,{multiple,nullLabel:"* Select type *"},dataDoc,callbackFunction)}function makeSelectForNestedCategory(dom,kb,subject,category,dataDoc,callbackFunction){function update(){child&&(container.removeChild(child),child=null),select.currentURI&&kb.any(kb.sym(select.currentURI),src_ns.A.owl("disjointUnionOf"))&&(child=makeSelectForNestedCategory(dom,kb,subject,kb.sym(select.currentURI),dataDoc,callbackFunction),select.subSelect=child.firstChild,select.subSelect.superSelect=select,container.appendChild(child))}const container=dom.createElement("span");let child=null;const select=makeSelectForCategory(dom,kb,subject,category,dataDoc,function onChange(ok,body){ok&&update(),callbackFunction(ok,body)});return container.appendChild(select),update(),container}function newThing(doc){const now=new Date;return esm.sym(doc.uri+"#id"+now.getTime())}function containsObject(obj,list){let i;for(i=0;i<list.length;i++)if(list[i]===obj)return!0;return!1}fieldFunction.ZZ[src_ns.A.ui("AutocompleteField").uri]=function autocompleteField(dom,container,already,subject,form,doc,callbackFunction){if("NamedNode"!==subject.termType)throw new Error("Sorry this field only works on NamedNode subjects (for editable)");const kb=solid_logic_esm.store,formDoc=form.doc?form.doc():null,box=dom.createElement("div");container&&container.appendChild(box);const lhs=dom.createElement("div");lhs.setAttribute("class","formFieldName"),lhs.setAttribute("style",src_style.i.formFieldNameBoxStyle),box.appendChild(lhs);const rhs=dom.createElement("div");rhs.setAttribute("class","formFieldValue"),box.appendChild(rhs);const property=kb.any(form,src_ns.A.ui("property"));if(!property)return box.appendChild(error.F(dom,"Error: No property given for autocomplete field: "+form));const labelProperty=kb.any(form,src_ns.A.ui("labelProperty"))||src_ns.A.schema("name"),dataSource=kb.any(form,src_ns.A.ui("dataSource"));if(!dataSource)return box.appendChild(error.F(dom,"Error: No data source given for autocomplete field: "+form));const queryParams={label:kb.anyJS(dataSource,src_ns.A.schema("name"),null,dataSource.doc()),logo:kb.any(dataSource,src_ns.A.schema("logo"),null,dataSource.doc())},targetClass=kb.any(form,src_ns.A.ui("targetClass"),null,form.doc())||kb.any(dataSource,src_ns.A.ui("targetClass"),null,dataSource.doc());targetClass&&(queryParams.targetClass=targetClass),queryParams.objectURIBase=kb.any(dataSource,src_ns.A.ui("objectURIBase"),null,dataSource.doc())||void 0;const endpoint=kb.anyJS(dataSource,src_ns.A.ui("endpoint"),null,dataSource.doc());if(endpoint){if(queryParams.endpoint=endpoint,queryParams.searchByNameQuery=kb.anyJS(dataSource,src_ns.A.ui("searchByNameQuery"),null,dataSource.doc()),!queryParams.searchByNameQuery)return box.appendChild(error.F(dom,"Error: No searchByNameQuery given for endpoint data Source: "+form));queryParams.insitituteDetailsQuery=kb.anyJS(dataSource,src_ns.A.ui("insitituteDetailsQuery"),null,dataSource.doc())}else{const searchByNameURI=kb.anyJS(dataSource,src_ns.A.ui("searchByNameURI"));if(!searchByNameURI)return box.appendChild(error.F(dom,"Error: No searchByNameURI OR sparql endpoint given for dataSource: "+dataSource));queryParams.searchByNameURI=searchByNameURI}const suppressEmptyUneditable=kb.anyJS(form,src_ns.A.ui("suppressEmptyUneditable"),null,formDoc),editable=kb.updater?.editable(doc.uri),autocompleteOptions={permanent:!0,targetClass:queryParams.targetClass,queryParams};autocompleteOptions.size=kb.anyJS(form,src_ns.A.ui("size"),null,formDoc)||void 0;let obj=kb.any(subject,property,void 0,doc);if(obj)autocompleteOptions.currentObject=obj,autocompleteOptions.currentName=kb.any(autocompleteOptions.currentObject,labelProperty,null,doc);else if(obj=kb.any(form,src_ns.A.ui("default")),obj)autocompleteOptions.currentObject=obj,autocompleteOptions.currentName=kb.any(autocompleteOptions.currentObject,labelProperty,null,doc);else if(suppressEmptyUneditable&&!editable)return box.style.display="none",box;return lhs.appendChild(fieldLabel(dom,property,form)),renderAutocompleteControl(dom,subject,{editable,dbLookup:!0},autocompleteOptions,async function addOneIdAndRefresh(result,name){if(!name)throw new Error("autocompleteField:  No name set.");const oldValue=kb.the(subject,property,null,doc);if(oldValue){const oldName=kb.any(oldValue,labelProperty,null,doc);if(oldValue.equals(result)&&oldName&&oldName.sameTerm(name))return}const deletables=oldValue?kb.statementsMatching(subject,property,oldValue,doc).concat(kb.statementsMatching(oldValue,labelProperty,null,doc)):[],insertables=[(0,esm.st)(subject,property,result,doc),(0,esm.st)(result,labelProperty,name,doc)];try{await(kb.updater?.updateMany(deletables,insertables))}catch(err){return callbackFunction(!1,err),void box.appendChild(error.F(dom,"Autocomplete form data update error:"+err,null,err))}callbackFunction(!0,"")},async function deleteOne(_result,_name){const oldValue=kb.the(subject,property,null,doc);if(!oldValue)return callbackFunction(!1,"NO data to elete"),void box.appendChild(error.F(dom,"Autocomplete delete: no old data!"));const deletables=kb.statementsMatching(subject,property,oldValue,doc).concat(kb.statementsMatching(oldValue,labelProperty,null,doc)),insertables=[];try{await(kb.updater?.updateMany(deletables,insertables))}catch(err){const e2=new Error("Autocomplete form data delete error:"+err);return callbackFunction(!1,err),void box.appendChild(error.F(dom,e2,null,err))}callbackFunction(!0,"")}).then(control=>{rhs.appendChild(control)},err=>{rhs.appendChild(error.F(dom,`Error rendering autocomplete ${form}: ${err}`,"#fee",err))}),box},fieldFunction.ZZ[src_ns.A.ui("Form").uri]=fieldFunction.ZZ[src_ns.A.ui("Group").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){const box=dom.createElement("div"),ui=src_ns.A.ui;if(container&&container.appendChild(box),!form)return;const key=subject.toNT()+"|"+form.toNT();if(already[key])return box.appendChild(dom.createTextNode("Group: see above "+key)),box;const already2={};for(const x in already)already2[x]=1;already2[key]=1;const formDoc=form.doc?form.doc():null,weight0=kb.any(form,ui("weight"),null,formDoc),weight=weight0?Number(weight0.value):1;if(weight>3||weight<0)return box.appendChild((0,error.F)(dom,`Form Group weight ${weight} should be 0-3`));box.setAttribute("style",src_style.i.formGroupStyle[weight]),box.style.display="flex",box.style.flexDirection="column",box.class="form-weight-"+weight;let subfields,parts=kb.any(form,ui("parts"),null,formDoc);if(parts?subfields=parts.elements:(parts=kb.each(form,ui("part"),null,formDoc),subfields=function sortBySequence(list){const subfields=list.map(function(p){return[kb.any(p,src_ns.A.ui("sequence"))||9999,p]});return subfields.sort(function(a,b){return a[0]-b[0]}),subfields.map(function(pair){return pair[1]})}(parts)),!parts)return box.appendChild((0,error.F)(dom,"No parts to form! "));for(let i=0;i<subfields.length;i++){const field=subfields[i],subFieldFunction=(0,fieldFunction.rg)(dom,field),itemChanged=function(ok,body){ok&&body&&body.widget&&"select"===body.widget&&refreshOpionsSubfieldinGroup(dom,already,subject,dataDoc,callbackFunction,box,subfields),callbackFunction(ok,{widget:"group",change:body})};box.appendChild(subFieldFunction(dom,null,already2,subject,field,dataDoc,itemChanged))}return box},fieldFunction.ZZ[src_ns.A.ui("Options").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){const kb=solid_logic_esm.store,box=dom.createElement("div"),formDoc=form.doc?form.doc():null,ui=src_ns.A.ui;container&&container.appendChild(box);let dependingOn=kb.any(form,ui("dependingOn"));dependingOn||(dependingOn=src_ns.A.rdf("type"));const cases=kb.each(form,ui("case"),null,formDoc);let values;cases||box.appendChild((0,error.F)(dom,"No cases to Options form. ")),values=dependingOn.sameTerm(src_ns.A.rdf("type"))?Object.keys(kb.findTypeURIs(subject)).map(uri=>esm.sym(uri)):kb.each(subject,dependingOn);for(let i=0;i<cases.length;i++){const c=cases[i],tests=kb.each(c,ui("for"),null,formDoc);let match=!1;for(let j=0;j<tests.length;j++)for(const value of values){const test=tests[j];(value.sameTerm(tests)||value.termType===test.termType&&value.value===test.value)&&(match=!0)}if(match){const field=kb.the(c,ui("use"));if(!field)return box.appendChild((0,error.F)(dom,'No "use" part for case in form '+form)),box;appendForm(dom,box,already,subject,field,dataDoc,callbackFunction);break}}return box},fieldFunction.ZZ[src_ns.A.ui("Multiple").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){function debugString(values){return values.map(x=>x.toString().slice(-7)).join(", ")}async function addItem(){const object=newThing(dataDoc);if(ordered)createListIfNecessary(),list.elements.push(object),await saveListThenRefresh();else{const toBeInserted=reverse?[esm.st(object,property,subject,dataDoc)]:[esm.st(subject,property,object,dataDoc)];try{await kb.updater.update([],toBeInserted)}catch(err){const msg="Error adding to unordered multiple: "+err;box.appendChild((0,error.F)(dom,msg)),src_debug.z3(msg)}refresh()}}function renderItem(object){async function moveThisItem(event,upwards){let i;for(src_debug.Rm("pre move: "+debugString(list.elements)),i=0;i<list.elements.length&&!list.elements[i].sameTerm(object);i++);if(i===list.elements.length&&alert("list move: not found element for "+object),upwards){if(0===i)return void alert("@@ boop - already at top   -temp message");list.elements.splice(i-1,2,list.elements[i],list.elements[i-1])}else{if(i===list.elements.length-1)return void alert("@@ boop - already at bottom   -temp message");list.elements.splice(i,2,list.elements[i+1],list.elements[i])}await saveListThenRefresh()}src_log.debug("Multiple: render object: "+object);const subField=(0,fieldFunction.rg)(dom,element)(dom,null,already,object,element,dataDoc,function itemDone(ok,message){src_debug.Rm(`Item done callback for item ${object.toString()}`),ok||src_debug.z3("  Item done callback: Error: "+message),callbackFunction(ok,message)});if(subField.subject=object,kb.updater.editable(dataDoc.uri)&&(buttons.Qy(dom,subField,multipleUIlabel,async function deleteThisItem(){if(ordered){src_debug.Rm("pre delete: "+debugString(list.elements));for(let i=0;i<list.elements.length;i++)if(list.elements[i].sameTerm(object))return list.elements.splice(i,1),void await saveListThenRefresh()}else if(kb.holds(subject,property,object,dataDoc)){const del=[esm.st(subject,property,object,dataDoc)];kb.updater.update(del,[],function(uri,ok,message){ok?body.removeChild(subField):body.appendChild((0,error.F)(dom,"Multiple: delete failed: "+message))})}}),ordered)){const frame=dom.createElement("div");frame.style.display="grid",frame.style.gridTemplateColumns="auto 3em",frame.style.gridTemplateRows="50% 50%";const moveUpButton=buttons.x6(dom,iconBase.Pt.iconBase+"noun_1369237.svg","Move Up",async event=>moveThisItem(0,!0)),moveDownButton=buttons.x6(dom,iconBase.Pt.iconBase+"noun_1369241.svg","Move Down",async event=>moveThisItem(0,!1)),shim=dom.createElement("div");return shim.appendChild(subField),frame.appendChild(shim),frame.appendChild(moveUpButton),frame.appendChild(moveDownButton),moveUpButton.style.gridColumn=2,moveDownButton.style.gridColumn=2,moveUpButton.style.gridRow=1,moveDownButton.style.padding="0em",moveUpButton.style.padding="0em",moveDownButton.style.gridRow=2,shim.style.gridColumn=1,shim.style.gridRowStart="span 2",frame}return subField}const plusIconURI=iconBase.Pt.iconBase+"noun_19460_green.svg",kb=solid_logic_esm.store,formDoc=form.doc?form.doc():null,box=dom.createElement("div"),shim=box,ui=src_ns.A.ui;container&&container.appendChild(box);const orderedNode=kb.any(form,ui("ordered")),ordered=!!orderedNode&&node.A.toJS(orderedNode),property=kb.any(form,ui("property")),reverse=kb.anyJS(form,ui("reverse"),null,formDoc);if(!property)return box.appendChild((0,error.F)(dom,"No property to multiple: "+form)),shim;let multipleUIlabel=kb.any(form,ui("label"));multipleUIlabel||(multipleUIlabel=utils_label.P(property));let min=kb.any(form,ui("min"));min=min?0+min.value:0;const element=kb.any(form,ui("part"));if(!element)return box.appendChild((0,error.F)(dom,"No part to multiple: "+form)),shim;const body=box.appendChild(dom.createElement("div"));let list,values;if(body.style.display="flex",body.style.flexDirection="column",values=reverse?kb.any(null,property,subject,dataDoc):kb.any(subject,property,null,dataDoc),ordered?(list=reverse?kb.any(null,property,subject,dataDoc):kb.any(subject,property,null,dataDoc),values=list?list.elements:[]):(values=reverse?kb.each(null,property,subject,dataDoc):kb.each(subject,property,null,dataDoc),list=null),kb.updater.editable(dataDoc.uri)){const tail=box.appendChild(dom.createElement("div"));tail.style.padding="0.5em";const img=tail.appendChild(dom.createElement("img"));img.setAttribute("src",plusIconURI),img.setAttribute("style","margin: 0.2em; width: 1.5em; height:1.5em"),img.title="Click to add another "+multipleUIlabel;const prompt=dom.createElement("span");prompt.textContent=(0===values.length?"Add another ":"Add ")+multipleUIlabel,tail.addEventListener("click",async _eventNotUsed=>{await addItem()},!0),tail.appendChild(prompt)}function createListIfNecessary(){list||(list=new collection.A,reverse?kb.add(list,property,subject,dataDoc):kb.add(subject,property,list,dataDoc))}async function saveListThenRefresh(){src_debug.Rm("save list: "+debugString(list.elements)),createListIfNecessary();try{await kb.fetcher.putBack(dataDoc)}catch(err){return void box.appendChild((0,error.F)(dom,"Error trying to put back a list: "+err))}refresh()}function refresh(){let vals;if(ordered){const li=reverse?kb.the(null,property,subject,dataDoc):kb.the(subject,property,null,dataDoc);vals=li?li.elements:[]}else vals=reverse?kb.each(null,property,subject,dataDoc):kb.each(subject,property,null,dataDoc),vals.sort();src_utils.Of(body,vals,renderItem)}return body.refresh=refresh,refresh(),async function asyncStuff(){const extra=min-values.length;if(extra>0){for(let j=0;j<extra;j++)src_debug.Rm("Adding extra: min "+min),await addItem();await saveListThenRefresh()}}().then(()=>{src_debug.Rm(" Multiple render: async stuff ok")},err=>{src_debug.z3(" Multiple render: async stuff fails. #### ",err)}),shim},fieldFunction.ZZ[src_ns.A.ui("PhoneField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("EmailField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("ColorField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("DateField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("DateTimeField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("TimeField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("NumericField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("IntegerField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("DecimalField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("FloatField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("TextField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("SingleLineTextField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("NamedNodeURIField").uri]=basicField,fieldFunction.ZZ[src_ns.A.ui("MultiLineTextField").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){const ui=src_ns.A.ui,kb=solid_logic_esm.store,formDoc=form.doc?form.doc():null,property=kb.any(form,ui("property"));if(!property)return(0,error.F)(dom,"No property to text field: "+form);const box=dom.createElement("div");box.style.display="flex",box.style.flexDirection="row";const left=box.appendChild(dom.createElement("div"));left.style.width=styleConstants.A.formFieldNameBoxWidth;const right=box.appendChild(dom.createElement("div"));left.appendChild(fieldLabel(dom,property,form)),dataDoc=fieldStore(subject,property,dataDoc);const text=kb.anyJS(subject,property,null,dataDoc)||"",editable=kb.updater.editable(dataDoc.uri),suppressEmptyUneditable=form&&kb.anyJS(form,src_ns.A.ui("suppressEmptyUneditable"),null,formDoc);!editable&&suppressEmptyUneditable&&""===text&&(box.style.display="none");const field=function makeDescription(dom,kb,subject,predicate,dataDoc,callbackFunction){const group=dom.createElement("div"),desc=kb.anyJS(subject,predicate,null,dataDoc)||"",field=dom.createElement("textarea");group.appendChild(field),field.rows=desc?desc.split("\n").length+2:2,field.cols=80,field.setAttribute("style",src_style.i.multilineTextInputStyle),null!==desc?field.value=desc:field.select();function saveChange(_e){submit.disabled=!0,submit.setAttribute("style","visibility: hidden; float: right;"),field.disabled=!0,field.style.color=styleConstants.A.textInputColorPending;const ds=kb.statementsMatching(subject,predicate,null,dataDoc),is=esm.st(subject,predicate,field.value,dataDoc);kb.updater.update(ds,is,function(uri,ok,body){ok?(field.style.color=styleConstants.A.textInputColor,field.disabled=!1):group.appendChild((0,error.F)(dom,"Error (while saving change to "+dataDoc.uri+"): "+body)),callbackFunction&&callbackFunction(ok,body)})}group.refresh=function(){const v=kb.any(subject,predicate,null,dataDoc);v&&v.value!==field.value&&(field.value=v.value)};const editable=kb.updater.editable(dataDoc.uri);let submit;editable?(submit=buttons.kz(dom,saveChange),submit.disabled=!0,submit.style.visibility="hidden",submit.style.float="right",group.appendChild(submit),field.addEventListener("keyup",function(_e){field.style.color="green",submit&&(submit.disabled=!1,submit.style.visibility="")},!0),field.addEventListener("change",saveChange,!0)):(field.disabled=!0,field.style.backgroundColor=styleConstants.A.textInputBackgroundColorUneditable);return group}(dom,kb,subject,property,dataDoc,callbackFunction);return right.appendChild(field),container&&container.appendChild(box),box},fieldFunction.ZZ[src_ns.A.ui("BooleanField").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){return booleanField(dom,container,0,subject,form,dataDoc,0,!1)},fieldFunction.ZZ[src_ns.A.ui("TristateField").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){return booleanField(dom,container,0,subject,form,dataDoc,0,!0)},fieldFunction.ZZ[src_ns.A.ui("Classifier").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){const kb=solid_logic_esm.store,ui=src_ns.A.ui,category=kb.any(form,ui("category"));if(!category)return(0,error.F)(dom,"No category for classifier: "+form);src_log.debug("Classifier: dataDoc="+dataDoc);const box=makeSelectForNestedCategory(dom,kb,subject,category,dataDoc,function(ok,body){return callbackFunction(ok,body)});return container&&container.appendChild(box),box},fieldFunction.ZZ[src_ns.A.ui("Choice").uri]=function(dom,container,already,subject,form,dataDoc,callbackFunction){const ui=src_ns.A.ui,kb=solid_logic_esm.store,formDoc=form.doc?form.doc():null;let p;const box=dom.createElement("div");box.setAttribute("class","choiceBox"),container&&container.appendChild(box);const lhs=dom.createElement("div");lhs.setAttribute("class","formFieldName choiceBox-label"),box.appendChild(lhs);const rhs=dom.createElement("div");rhs.setAttribute("class","formFieldValue choiceBox-selectBox"),box.appendChild(rhs);const property=kb.any(form,ui("property"));if(!property)return box.appendChild((0,error.F)(dom,"No property for Choice: "+form));lhs.appendChild(fieldLabel(dom,property,form));const uiFrom=kb.any(form,ui("from"));if(!uiFrom)return(0,error.F)(dom,"No 'from' for Choice: "+form);const subForm=kb.any(form,ui("use")),opts={form,subForm,disambiguate:!1};kb.any(form,ui("canMintNew"))&&(opts.mint="* Create new *");const multiSelect=kb.any(form,ui("multiselect"));multiSelect&&(opts.multiSelect=!0);const dataSource=kb.each(form,ui("search-full-store")).length?null:dataDoc;let selector;return rhs.refresh=function(){let selectedOptions=kb.each(subject,property,null,dataDoc).map(object=>object.value),possibleOptions=function getSelectorOptions(dataSource){let possibleProperties,possible=[];possible=kb.each(void 0,src_ns.A.rdf("type"),uiFrom,formDoc);for(const x in function findMembersNT(store,thisClass,quad){let len2,len4,m,pred,ref1,ref2,ref3,ref4,ref5,st,u;const seeds={};seeds[thisClass.toNT()]=!0;const members={},ref=store.transitiveClosure(seeds,store.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(const t in ref){ref1=store.statementsMatching(null,store.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),store.fromNT(t),quad);for(let i=0,len=ref1.length;i<len;i++)st=ref1[i],members[st.subject.toNT()]=st;ref2=store.each(null,store.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#domain"),store.fromNT(t),quad);for(let l=0,len1=ref2.length;l<len1;l++)for(pred=ref2[l],ref3=store.statementsMatching(null,pred,null,quad),m=0,len2=ref3.length;m<len2;m++)st=ref3[m],members[st.subject.toNT()]=st;ref4=store.each(null,store.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#range"),store.fromNT(t),quad);for(let q=0,len3=ref4.length;q<len3;q++)for(pred=ref4[q],ref5=store.statementsMatching(null,pred,null,quad),u=0,len4=ref5.length;u<len4;u++)st=ref5[u],members[st.object.toNT()]=st}return members}(kb,uiFrom,dataSource))possible.push(kb.fromNT(x));if(uiFrom.sameTerm(src_ns.A.rdfs("Class")))for(p in buttons.Pg())possible.push(kb.sym(p));else if(uiFrom.sameTerm(src_ns.A.rdf("Property"))){for(p in possibleProperties=buttons.uA(kb),possibleProperties.op)possible.push(kb.fromNT(p));for(p in possibleProperties.dp)possible.push(kb.fromNT(p));opts.disambiguate=!0}else if(uiFrom.sameTerm(src_ns.A.owl("ObjectProperty"))){for(p in possibleProperties=buttons.uA(kb),possibleProperties.op)possible.push(kb.fromNT(p));opts.disambiguate=!0}else if(uiFrom.sameTerm(src_ns.A.owl("DatatypeProperty"))){for(p in possibleProperties=buttons.uA(kb),possibleProperties.dp)possible.push(kb.fromNT(p));opts.disambiguate=!0}return possible}(dataSource);if(possibleOptions.push(selectedOptions),possibleOptions=function sortByLabel(list){const subfields=list.map(function(p){return[utils_label.P(p).toLowerCase(),p]});return subfields.sort(),subfields.map(function(pair){return pair[1]})}(possibleOptions),selector=function makeSelectForChoice(dom,container,kb,subject,predicate,inputPossibleOptions,selectedOptions,uiFrom,options,dataDoc,callbackFunction){const optionsFromClassUIfrom={},editable=kb.updater.editable(dataDoc.uri);for(let i=0;i<inputPossibleOptions.length;i++){const sub=inputPossibleOptions[i];sub.uri&&!(sub.uri in optionsFromClassUIfrom)&&(optionsFromClassUIfrom[sub.uri]=!0)}if(0===Object.keys(optionsFromClassUIfrom).length&&!options.mint)return(0,error.F)(dom,"Can't do selector with no options, subject= "+subject+" property = "+predicate+".");function createDefaultSelectOptionText(){let firstSelectOptionText="--- choice ---";return predicate&&"BlankNode"!==predicate.termType&&(firstSelectOptionText="* Select for property: "+utils_label.P(predicate)+" *"),subject&&"BlankNode"!==subject.termType&&(firstSelectOptionText="* Select for "+utils_label.P(subject,!0)+" *"),firstSelectOptionText}function createDefaultSelectOption(){const option=dom.createElement("option");return option.appendChild(dom.createTextNode(createDefaultSelectOptionText())),option.disabled=!0,option.value=!0,option.hidden=!0,option.selected=!0,option}src_log.debug("makeSelectForChoice: dataDoc="+dataDoc);const onChange=function(_e){container.removeChild(container.lastChild),select.refresh()},select=dom.createElement("select");select.setAttribute("style",src_style.i.formSelectStyle),select.setAttribute("id","formSelect"),select.currentURI=null;for(const uri in optionsFromClassUIfrom)select.appendChild(createOption(uri));if(editable&&options.mint){const mint=dom.createElement("option");mint.appendChild(dom.createTextNode(options.mint)),mint.AJAR_mint=!0,select.insertBefore(mint,select.firstChild)}0===select.children.length&&select.insertBefore(createDefaultSelectOption(),select.firstChild);function createOption(uri){const option=dom.createElement("option"),c=kb.sym(uri);let label;label=options.disambiguate?src_utils.SY(c,!0):utils_label.P(c,!0),option.appendChild(dom.createTextNode(label)),option.setAttribute("value",uri);const backgroundColor=kb.any(c,kb.sym("http://www.w3.org/ns/ui#backgroundColor"));return backgroundColor&&option.setAttribute("style","background-color: "+backgroundColor.value+"; "),option.AJAR_uri=uri,containsObject(c.value,selectedOptions)&&option.setAttribute("selected","true"),option}select.update=function(newSelectedOptions){selectedOptions=newSelectedOptions;const ds=[],is=[],removeValue=function(t){kb.holds(subject,predicate,t,dataDoc)&&ds.push(esm.st(subject,predicate,t,dataDoc))},addValue=function(t){kb.holds(subject,predicate,t,dataDoc)||is.push(esm.st(subject,predicate,t,dataDoc)),uiFrom&&!kb.holds(t,src_ns.A.rdf("type"),kb.sym(uiFrom),dataDoc)&&is.push(esm.st(t,src_ns.A.rdf("type"),kb.sym(uiFrom),dataDoc))},existingValues=kb.each(subject,predicate,null,dataDoc).map(object=>object.value);for(const value of existingValues)containsObject(value,selectedOptions)||removeValue(esm.sym(value));for(const value of selectedOptions)value in existingValues||addValue(esm.sym(value));kb.updater.update(ds,is,function(uri,ok,body){if(!ok)return select.parentNode.appendChild((0,error.F)(dom,"Error updating data in select: "+body));select.refresh(),callbackFunction&&callbackFunction(ok,{widget:"select",event:"change"})})},select.refresh=function(){select.disabled=!0;let newObject,is=[];for(let i=0;i<select.options.length;i++){const opt=select.options[i];if(opt.selected&&opt.AJAR_mint){if(options.mintClass){const thisForm=promptForNew(dom,kb,subject,predicate,uiFrom,options.subForm,dataDoc,function(ok,body){ok||callbackFunction(ok,body,{change:"new"})});select.parentNode.appendChild(thisForm),newObject=thisForm.AJAR_subject}else newObject=newThing(dataDoc);is.push(esm.st(subject,predicate,kb.sym(newObject),dataDoc)),uiFrom&&is.push(esm.st(newObject,src_ns.A.rdf("type"),kb.sym(uiFrom),dataDoc)),options.mintStatementsFun&&(is=is.concat(options.mintStatementsFun(newObject))),select.currentURI=newObject}opt.AJAR_uri&&(opt.selected&&containsObject(opt.AJAR_uri,selectedOptions)&&(select.currentURI=opt.AJAR_uri),containsObject(opt.AJAR_uri,selectedOptions)||opt.removeAttribute("selected"),containsObject(opt.AJAR_uri,selectedOptions)&&opt.setAttribute("selected","true"))}src_log.info("selectForOptions: data doc = "+dataDoc),select.currentURI&&options.subForm&&!options.multiSelect&&addSubFormChoice(dom,container,{},esm.sym(select.currentURI),options.subForm,dataDoc,function(ok,body){ok?(kb.updater.update([],is,function(uri,success,errorBody){success||container.appendChild((0,error.F)(dom,"Error updating select: "+errorBody))}),callbackFunction&&callbackFunction(ok,{widget:"select",event:"new"})):container.appendChild((0,error.F)(dom,"Error updating data in field of select: "+body))}),select.disabled=!1},editable&&select.addEventListener("change",onChange,!1);return select}(dom,rhs,kb,subject,property,possibleOptions,selectedOptions,uiFrom,opts,dataDoc,callbackFunction),rhs.innerHTML="",rhs.appendChild(selector),multiSelect){const multiSelectDiv=new IconicMultiSelect({placeholder:selector.selected,select:selector,container:rhs,textField:"textField",valueField:"valueField"});multiSelectDiv.init(),multiSelectDiv.subscribe(function(event){if("REMOVE_OPTION"===event.action&&(selectedOptions=selectedOptions.filter(function(value){return value!==event.value})),"CLEAR_ALL_OPTIONS"===event.action&&(selectedOptions=[]),"ADD_OPTION"===event.action){if((event.value+"").includes("Create new")){const newObject=newThing(dataDoc),is=[];is.push(esm.st(subject,property,kb.sym(newObject),dataDoc)),uiFrom&&is.push(esm.st(newObject,src_ns.A.rdf("type"),kb.sym(uiFrom),dataDoc)),subForm&&addSubFormChoice(dom,rhs,{},esm.sym(newObject),subForm,dataDoc,function(ok,body){ok?(kb.updater.update([],is,function(uri,success,errorBody){success||rhs.appendChild((0,error.F)(dom,"Error updating select: "+errorBody))}),selectedOptions.push(newObject),callbackFunction&&callbackFunction(ok,{widget:"select",event:"new"})):rhs.appendChild((0,error.F)(dom,"Error updating data in field of select: "+body))})}else selectedOptions.push(event.value)}selector.update(selectedOptions)})}},rhs.refresh(),selector&&selector.refresh&&selector.refresh(),box},fieldFunction.ZZ[src_ns.A.ui("Comment").uri]=fieldFunction.ZZ[src_ns.A.ui("Heading").uri]=function(dom,container,already,subject,form,dataDoc,_callbackFunction){const ui=src_ns.A.ui,kb=solid_logic_esm.store;let contents=kb.any(form,ui("contents"));contents||(contents="Error: No contents in comment field.");const formDoc=form.doc?form.doc():null,uri=(0,fieldFunction.K)(form),params=fieldParams[uri]||{},box=dom.createElement("div");container&&container.appendChild(box);const p=box.appendChild(dom.createElement(params.element));p.textContent=contents,function setFieldStyle(ele,field){const classUri=(0,fieldFunction.K)(field),params=fieldParams[classUri]||{},style=solid_logic_esm.store.any(field,src_ns.A.ui("style"));style?"Literal"===style.termType?style&&ele.setAttribute("style",style.value):solid_logic_esm.store.statementsMatching(style,null,null,field.doc()).forEach(st=>{if(st.predicate.uri&&st.predicate.uri.startsWith("https://www.w3.org/ns/css#")){const cssAttribute=st.predicate.uri.slice(26);try{ele.style[cssAttribute]=st.object.value}catch(_err){console.warn(`setFieldStyle: Error setting element style ${cssAttribute} to "${st.object.value}"`),console.warn(`setFieldStyle:   ... Element tagName was "${ele.tagName||"???"}"`)}}}):params.style&&ele.setAttribute("style",params.style)}(p,form);const suppressIfUneditable=kb.anyJS(form,src_ns.A.ui("suppressIfUneditable"),null,formDoc),editable=kb.updater.editable(dataDoc.uri);return suppressIfUneditable&&!editable&&(box.style.display="none"),box}},"./src/widgets/forms/fieldFunction.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>mostSpecificClassURI,ZZ:()=>field,rg:()=>fieldFunction});var solid_logic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/solid-logic/dist/solid-logic.esm.js"),_log__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/log.ts"),_error__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/widgets/error.ts");const store=solid_logic__WEBPACK_IMPORTED_MODULE_0__.solidLogicSingleton.store,field={};function mostSpecificClassURI(x){const kb=store,ft=kb.findTypeURIs(x),bot=kb.bottomTypeURIs(ft),bots=[];for(const b in bot)bots.push(b);return bots[0]}function fieldFunction(dom,fieldInQuestion){const uri=mostSpecificClassURI(fieldInQuestion),fun=field[uri];return(0,_log__WEBPACK_IMPORTED_MODULE_1__.debug)("paneUtils: Going to implement field "+fieldInQuestion+" of type "+uri),fun||function(dom2,container){const box=(0,_error__WEBPACK_IMPORTED_MODULE_2__.F)(dom2,"No handler for field "+fieldInQuestion+" of type "+uri);return container&&container.appendChild(box),box}}}}]);