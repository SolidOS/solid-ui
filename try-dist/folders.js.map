{"version":3,"sources":["../src/folders.js"],"names":["UI","icons","require","log","ns","pad","rdf","store","widgets","utils","deleteRecursive","kb","folder","Promise","resolve","_reject","fetcher","load","then","promises","each","ldp","map","file","holds","console","confirm","Error","webOperation","uri","push","all","_res","forAllFiles","action","module","exports","deleteFolder","dom","docuent","document","div","createElement","table","appendChild","mainTR","p","textContent","buttonsTR","buttonsTD1","buttonsTD3","cancel","cancelButton","addEventListener","_event","parentNode","removeChild","doit","button","iconBase","deleteThem","count","msg"],"mappings":"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","sourcesContent":["/**      UI To Delete Folder and content\r\n *\r\n */\r\n/* global confirm */\r\nconst UI = {\r\n  icons: require('./iconBase'),\r\n  log: require('./log'),\r\n  ns: require('./ns'),\r\n  pad: require('./'),\r\n  rdf: require('rdflib'),\r\n  store: require('./store'),\r\n  widgets: require('./widgets'),\r\n  utils: require('./utils')\r\n}\r\n\r\nconst ns = UI.ns\r\n\r\nfunction deleteRecursive (kb, folder) {\r\n  // eslint-disable-next-line promise/param-names\r\n  return new Promise(function (resolve, _reject) {\r\n    kb.fetcher.load(folder).then(function () {\r\n      const promises = kb.each(folder, ns.ldp('contains')).map(file => {\r\n        if (kb.holds(file, ns.rdf('type'), ns.ldp('BasicContainer'))) {\r\n          return deleteRecursive(kb, file)\r\n        } else {\r\n          console.log('deleteRecirsive file: ' + file)\r\n          if (!confirm(' Really DELETE File ' + file)) {\r\n            throw new Error('User aborted delete file')\r\n          }\r\n          return kb.fetcher.webOperation('DELETE', file.uri)\r\n        }\r\n      })\r\n      console.log('deleteRecirsive folder: ' + folder)\r\n      if (!confirm(' Really DELETE folder ' + folder)) {\r\n        throw new Error('User aborted delete file')\r\n      }\r\n      promises.push(kb.fetcher.webOperation('DELETE', folder.uri))\r\n      Promise.all(promises).then(_res => {\r\n        resolve()\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\n/** Iterate over files depth first\r\n *\r\n * @param folder - The folder whose contents we iterate over\r\n * @param store - The quadstore\r\n * @param action - returns a promise.  All the promises must be resolved\r\n */\r\nfunction forAllFiles (folder, kb, action) {\r\n  // eslint-disable-next-line promise/param-names\r\n  return new Promise(function (resolve, _reject) {\r\n    kb.fetcher.load(folder).then(function () {\r\n      const promises = kb.each(folder, ns.ldp('contains')).map(file => {\r\n        if (kb.holds(file, ns.rdf('type'), ns.ldp('BasicContainer'))) {\r\n          return forAllFiles(file, kb, action)\r\n        } else {\r\n          return action(file)\r\n        }\r\n      })\r\n      promises.push(action(folder))\r\n      Promise.all(promises).then(_res => {\r\n        resolve()\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\nmodule.exports.deleteRecursive = deleteRecursive\r\n\r\n/** Delete Folder and contents\r\n *\r\n * @param {NamedNode} folder - The LDP container to be deleted\r\n * @param {DOMElement} containingElement - Where to put the user interface\r\n * @param {IndexedForumula} store - Quadstore (optional)\r\n * @param {Document} dom - The browser 'document' gloabl or equivalent (or iuse global)\r\n * @returns {DOMElement} - The control which has eben inserted in the\r\n */\r\n/* global document */\r\nmodule.exports.deleteFolder = function (folder, store, dom) {\r\n  store = store || UI.store\r\n  if (typeof docuent !== 'undefined') {\r\n    dom = dom || document\r\n  }\r\n  const div = dom.createElement('div')\r\n  const table = div.appendChild(dom.createElement('table'))\r\n  const mainTR = table.appendChild(dom.createElement('tr'))\r\n  mainTR.appendChild(dom.createElement('td')) // mainTD\r\n\r\n  const p = mainTR.appendChild(dom.createElement('p'))\r\n  p.textContent = `Are you sure you want to delete the folder ${folder}? This cannot be undone.`\r\n  const buttonsTR = table.appendChild(dom.createElement('tr'))\r\n  const buttonsTD1 = buttonsTR.appendChild(dom.createElement('td'))\r\n  buttonsTR.appendChild(dom.createElement('td')) // buttonsTD2\r\n  const buttonsTD3 = buttonsTR.appendChild(dom.createElement('td'))\r\n\r\n  const cancel = buttonsTD1.appendChild(UI.widgets.cancelButton(dom))\r\n  cancel.addEventListener(\r\n    'click',\r\n    function (_event) {\r\n      div.parentNode.removeChild(div)\r\n    },\r\n    false\r\n  )\r\n\r\n  const doit = buttonsTD3.appendChild(\r\n    UI.widgets.button(dom, UI.icons.iconBase + 'noun_925021.svg', 'Yes, delete')\r\n  )\r\n  doit.addEventListener(\r\n    'click',\r\n    function (_event) {\r\n      deleteThem(folder).then(() => {\r\n        console.log('All deleted.')\r\n      })\r\n    },\r\n    false\r\n  )\r\n\r\n  function deleteThem (folder) {\r\n    return forAllFiles(folder, file =>\r\n      store.fetcher.webOperation('DELETE', file.uri)\r\n    )\r\n  }\r\n  var count = 0\r\n  forAllFiles(folder, store, () => {\r\n    count += 1\r\n  }) // Count files\r\n    .then(() => {\r\n      const msg = ' Files to delete: ' + count\r\n      console.log(msg)\r\n      p.textContent += msg\r\n    })\r\n\r\n  return div\r\n}\r\n"],"file":"folders.js"}