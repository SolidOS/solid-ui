{"version":3,"sources":["../../src/widgets/peoplePicker.js"],"names":["PeoplePicker","element","typeIndex","groupPickedCb","options","selectedgroup","onSelectGroup","bind","container","document","createElement","style","maxWidth","minHeight","outline","display","flexDirection","selectedGroup","Group","render","changeGroupButton","textContent","addEventListener","_event","appendChild","findAddressBook","then","book","chooseExistingGroupButton","margin","GroupPicker","createNewGroupButton","createNewGroup","defaultNewGroupName","group","GroupBuilder","errorBody","innerHTML","err","loadGroups","groups","forEach","groupButton","handleClickGroup","Promise","resolve","reject","indexes","groupIndex","kb","fetcher","nowOrWhenFetched","ok","each","ns","vcard","getWithDefault","value","doneBuildingCb","groupChangedCb","onGroupChanged","changeType","agent","dropContainer","uris","map","uri","add","groupNameInput","type","event","setGroupName","target","groupNameLabel","any","match","statement","webIdNode","object","personDiv","Person","handleRemove","copy","escape","doneBuildingButton","webId","rdf","namedNode","rdfClass","equals","foaf","Error","st","holdsStatement","patch","doc","toIns","why","toDel","remove","name","errorMessage","updatePromises","namedGraph","oldNameStatements","newNameStatement","literal","_solidResponse","removeStatements","all","imgSrc","iconBase","profileImg","src","width","height","nameSpan","flexGrow","removeButton","subject","predicate","defaultValue","url","updater","update","success","groupContainer","sym","dir","bookRegistration","solid","load","_xhr","uuid","v4","slice","patchPromises","typeStatement","nameStatement","includesGroupStatement","console","log","xhr","responseURL"],"mappings":";;;;;;;;;;;;;;;;;;;AAWA;;AACA;;AACA;;AAGA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;IAEaA,Y;;;AACX,wBAAaC,OAAb,EAAsBC,SAAtB,EAAiCC,aAAjC,EAAgDC,OAAhD,EAAyD;AAAA;AACvD,SAAKA,OAAL,GAAeA,OAAO,IAAI,EAA1B;AACA,SAAKH,OAAL,GAAeA,OAAf;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKE,aAAL,GAAqB,KAAKD,OAAL,CAAaC,aAAlC,CALuD,CAKP;;AAChD,SAAKC,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACD;;;;6BAES;AAAA;;AACR,UAAMC,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAF,MAAAA,SAAS,CAACG,KAAV,CAAgBC,QAAhB,GAA2B,OAA3B;AACAJ,MAAAA,SAAS,CAACG,KAAV,CAAgBE,SAAhB,GAA4B,OAA5B;AACAL,MAAAA,SAAS,CAACG,KAAV,CAAgBG,OAAhB,GAA0B,iBAA1B;AACAN,MAAAA,SAAS,CAACG,KAAV,CAAgBI,OAAhB,GAA0B,MAA1B;;AAEA,UAAI,KAAKV,aAAT,EAAwB;AACtBG,QAAAA,SAAS,CAACG,KAAV,CAAgBK,aAAhB,GAAgC,QAAhC;AACA,YAAMC,aAAa,GAAGR,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;AACA,YAAIQ,KAAJ,CAAUD,aAAV,EAAyB,KAAKZ,aAA9B,EAA6Cc,MAA7C;AACA,YAAMC,iBAAiB,GAAGX,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAA1B;AACAU,QAAAA,iBAAiB,CAACC,WAAlB,GAAgC,4BAAO,cAAP,CAAhC;AACAD,QAAAA,iBAAiB,CAACE,gBAAlB,CAAmC,OAAnC,EAA4C,UAACC,MAAD,EAAY;AACtD,UAAA,KAAI,CAAClB,aAAL,GAAqB,IAArB;;AACA,UAAA,KAAI,CAACc,MAAL;AACD,SAHD;AAIAX,QAAAA,SAAS,CAACgB,WAAV,CAAsBP,aAAtB;AACAT,QAAAA,SAAS,CAACgB,WAAV,CAAsBJ,iBAAtB;AACD,OAZD,MAYO;AACLK,QAAAA,eAAe,CAAC,KAAKvB,SAAN,CAAf,CACGwB,IADH,CACQ,gBAAc;AAAA,cAAXC,IAAW,QAAXA,IAAW;AAClB,cAAMC,yBAAyB,GAAGnB,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAlC;AACAkB,UAAAA,yBAAyB,CAACP,WAA1B,GAAwC,4BACtC,wBADsC,CAAxC;AAGAO,UAAAA,yBAAyB,CAACjB,KAA1B,CAAgCkB,MAAhC,GAAyC,MAAzC;AACAD,UAAAA,yBAAyB,CAACN,gBAA1B,CAA2C,OAA3C,EAAoD,UAACC,MAAD,EAAY;AAC9D,gBAAIO,WAAJ,CAAgBtB,SAAhB,EAA2BmB,IAA3B,EAAiC,KAAI,CAACrB,aAAtC,EAAqDa,MAArD;AACD,WAFD;AAIA,cAAMY,oBAAoB,GAAGtB,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAA7B;AACAqB,UAAAA,oBAAoB,CAACV,WAArB,GAAmC,4BAAO,oBAAP,CAAnC;AACAU,UAAAA,oBAAoB,CAACpB,KAArB,CAA2BkB,MAA3B,GAAoC,MAApC;AACAE,UAAAA,oBAAoB,CAACT,gBAArB,CAAsC,OAAtC,EAA+C,UAACC,MAAD,EAAY;AACzDS,YAAAA,cAAc,CAACL,IAAD,EAAO,KAAI,CAACvB,OAAL,CAAa6B,mBAApB,CAAd,CACGP,IADH,CACQ,iBAAe;AAAA,kBAAZQ,KAAY,SAAZA,KAAY;AACnB,kBAAIC,YAAJ,CACE,KAAI,CAAClC,OADP,EAEE0B,IAFF,EAGEO,KAHF,EAIE,KAAI,CAAC5B,aAJP,EAKEa,MALF;AAMD,aARH,WASS,UAACiB,SAAD,EAAe;AACpB,cAAA,KAAI,CAACnC,OAAL,CAAauB,WAAb,CACE,8BACEf,QADF,EAEE,mEAAuC2B,SAAvC,OAFF,CADF;AAMD,aAhBH;AAiBD,WAlBD;AAoBA5B,UAAAA,SAAS,CAACgB,WAAV,CAAsBI,yBAAtB;AACApB,UAAAA,SAAS,CAACgB,WAAV,CAAsBO,oBAAtB;AAEA,UAAA,KAAI,CAAC9B,OAAL,CAAaoC,SAAb,GAAyB,EAAzB;;AACA,UAAA,KAAI,CAACpC,OAAL,CAAauB,WAAb,CAAyBhB,SAAzB;AACD,SAvCH,WAwCS,UAAC8B,GAAD,EAAS;AACd,UAAA,KAAI,CAACrC,OAAL,CAAauB,WAAb,CACE,8BACEf,QADF,EAEE,+DAAmC6B,GAAnC,OAFF,CADF;AAMD,SA/CH;AAgDD;;AAED,WAAKrC,OAAL,CAAaoC,SAAb,GAAyB,EAAzB;AACA,WAAKpC,OAAL,CAAauB,WAAb,CAAyBhB,SAAzB;AACA,aAAO,IAAP;AACD;;;kCAEc0B,K,EAAO;AACpB,WAAK7B,aAAL,GAAqB6B,KAArB;AACA,WAAK/B,aAAL,CAAmB+B,KAAnB;AACA,WAAKf,MAAL;AACD;;;;;;;IAGUW,W;;;AACX,uBAAa7B,OAAb,EAAsB0B,IAAtB,EAA4BrB,aAA5B,EAA2C;AAAA;AACzC,SAAKL,OAAL,GAAeA,OAAf;AACA,SAAK0B,IAAL,GAAYA,IAAZ;AACA,SAAKrB,aAAL,GAAqBA,aAArB;AACD;;;;6BAES;AAAA;;AACR,WAAKiC,UAAL,GACGb,IADH,CACQ,UAACc,MAAD,EAAY;AAChB;AACA,YAAMhC,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAF,QAAAA,SAAS,CAACG,KAAV,CAAgBI,OAAhB,GAA0B,MAA1B;AACAP,QAAAA,SAAS,CAACG,KAAV,CAAgBK,aAAhB,GAAgC,QAAhC;AACAwB,QAAAA,MAAM,CAACC,OAAP,CAAe,UAACP,KAAD,EAAW;AACxB,cAAMQ,WAAW,GAAGjC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAApB;AACAgC,UAAAA,WAAW,CAACpB,gBAAZ,CAA6B,OAA7B,EAAsC,MAAI,CAACqB,gBAAL,CAAsBT,KAAtB,CAAtC;AACA,cAAIhB,KAAJ,CAAUwB,WAAV,EAAuBR,KAAvB,EAA8Bf,MAA9B;AACAX,UAAAA,SAAS,CAACgB,WAAV,CAAsBkB,WAAtB;AACD,SALD;AAMA,QAAA,MAAI,CAACzC,OAAL,CAAaoC,SAAb,GAAyB,EAAzB;;AACA,QAAA,MAAI,CAACpC,OAAL,CAAauB,WAAb,CAAyBhB,SAAzB;AACD,OAdH,WAeS,UAAC8B,GAAD,EAAS;AACd,QAAA,MAAI,CAACrC,OAAL,CAAauB,WAAb,CACE,8BACEf,QADF,EAEE,+EAAmD6B,GAAnD,OAFF,CADF;AAMD,OAtBH;AAuBA,aAAO,IAAP;AACD;;;iCAEa;AAAA;;AACZ,aAAO,IAAIM,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAAA,uBACfC,OAAO,CAAC,MAAI,CAACpB,IAAN,CADQ;AAAA,YAC9BqB,UAD8B,YAC9BA,UAD8B;;AAEtCC,0BAAGC,OAAH,CAAWC,gBAAX,CAA4BH,UAA5B,EAAwC,UAACI,EAAD,EAAKd,GAAL,EAAa;AACnD,cAAI,CAACc,EAAL,EAAS;AACP,mBAAON,MAAM,CAACR,GAAD,CAAb;AACD;;AACD,cAAME,MAAM,GAAGS,kBAAGI,IAAH,CAAQ,MAAI,CAAC1B,IAAb,EAAmB2B,eAAGC,KAAH,CAAS,eAAT,CAAnB,CAAf;;AACA,iBAAOV,OAAO,CAACL,MAAD,CAAd;AACD,SAND;AAOD,OATM,CAAP;AAUD;;;qCAEiBN,K,EAAO;AAAA;;AACvB,aAAO,UAACX,MAAD,EAAY;AACjB,QAAA,MAAI,CAACjB,aAAL,CAAmB4B,KAAnB;AACD,OAFD;AAGD;;;;;;;IAGUhB,K;;;AACX,iBAAajB,OAAb,EAAsBiC,KAAtB,EAA6B;AAAA;AAC3B,SAAKjC,OAAL,GAAeA,OAAf;AACA,SAAKiC,KAAL,GAAaA,KAAb;AACD;;;;6BAES;AACR,UAAM1B,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAF,MAAAA,SAAS,CAACa,WAAV,GAAwB,6BACtB;AACAmC,MAAAA,cAAc,CAAC,KAAKtB,KAAN,EAAaoB,eAAGC,KAAH,CAAS,IAAT,CAAb,aAAiC,KAAKrB,KAAL,CAAWuB,KAA5C,OAFQ,CAAxB;AAIA,WAAKxD,OAAL,CAAaoC,SAAb,GAAyB,EAAzB;AACA,WAAKpC,OAAL,CAAauB,WAAb,CAAyBhB,SAAzB;AACA,aAAO,IAAP;AACD;;;;;;;IAGU2B,Y;;;AACX,wBAAalC,OAAb,EAAsB0B,IAAtB,EAA4BO,KAA5B,EAAmCwB,cAAnC,EAAmDC,cAAnD,EAAmE;AAAA;AACjE,SAAK1D,OAAL,GAAeA,OAAf;AACA,SAAK0B,IAAL,GAAYA,IAAZ;AACA,SAAKO,KAAL,GAAaA,KAAb;;AACA,SAAK0B,cAAL,GAAsB,UAACtB,GAAD,EAAMuB,UAAN,EAAkBC,KAAlB,EAA4B;AAChD,UAAIH,cAAJ,EAAoB;AAClBA,QAAAA,cAAc,CAACrB,GAAD,EAAMuB,UAAN,EAAkBC,KAAlB,CAAd;AACD;AACF,KAJD;;AAKA,SAAKH,cAAL,GAAsBA,cAAtB;AACA,SAAKD,cAAL,GAAsBA,cAAtB;AACD;;;;8BAEU,CACT;AACD;;;6BAES;AAAA;;AACR,UAAMK,aAAa,GAAGtD,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;AACAqD,MAAAA,aAAa,CAACpD,KAAd,CAAoBC,QAApB,GAA+B,OAA/B;AACAmD,MAAAA,aAAa,CAACpD,KAAd,CAAoBE,SAApB,GAAgC,OAAhC;AACAkD,MAAAA,aAAa,CAACpD,KAAd,CAAoBG,OAApB,GAA8B,iBAA9B;AACAiD,MAAAA,aAAa,CAACpD,KAAd,CAAoBI,OAApB,GAA8B,MAA9B;AACAgD,MAAAA,aAAa,CAACpD,KAAd,CAAoBK,aAApB,GAAoC,QAApC;AAEA,uCAAe+C,aAAf,EAA8B,UAACC,IAAD,EAAU;AACtCA,QAAAA,IAAI,CAACC,GAAL,CAAS,UAACC,GAAD,EAAS;AAChB,UAAA,MAAI,CAACC,GAAL,CAASD,GAAT,WAAoB,UAAC5B,GAAD,EAAS;AAC3B,YAAA,MAAI,CAACrC,OAAL,CAAauB,WAAb,CACE,8BACEf,QADF,EAEE,sEAA0C6B,GAA1C,OAFF,CADF;AAMD,WAPD;AAQD,SATD;AAUD,OAXD;AAaA,UAAM8B,cAAc,GAAG3D,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAvB;AACA0D,MAAAA,cAAc,CAACC,IAAf,GAAsB,MAAtB;AACAD,MAAAA,cAAc,CAACX,KAAf,GAAuBD,cAAc,CACnC,KAAKtB,KAD8B,EAEnCoB,eAAGC,KAAH,CAAS,IAAT,CAFmC,EAGnC,gBAHmC,CAArC;AAKAa,MAAAA,cAAc,CAAC9C,gBAAf,CAAgC,QAAhC,EAA0C,UAACgD,KAAD,EAAW;AACnD,QAAA,MAAI,CAACC,YAAL,CAAkBD,KAAK,CAACE,MAAN,CAAaf,KAA/B,WAA4C,UAACnB,GAAD,EAAS;AACnD,UAAA,MAAI,CAACrC,OAAL,CAAauB,WAAb,CACE,8BAAkBf,QAAlB,wCAA2D6B,GAA3D,OADF;AAGD,SAJD;AAKD,OAND;AAOA,UAAMmC,cAAc,GAAGhE,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAvB;AACA+D,MAAAA,cAAc,CAACpD,WAAf,GAA6B,4BAAO,aAAP,CAA7B;AACAoD,MAAAA,cAAc,CAACjD,WAAf,CAA2B4C,cAA3B;AACAL,MAAAA,aAAa,CAACvC,WAAd,CAA0BiD,cAA1B;;AAEA,UAAIxB,kBAAGyB,GAAH,CAAO,KAAKxC,KAAZ,EAAmBoB,eAAGC,KAAH,CAAS,WAAT,CAAnB,CAAJ,EAA+C;AAC7CN,0BAAG0B,KAAH,CAAS,KAAKzC,KAAd,EAAqBoB,eAAGC,KAAH,CAAS,WAAT,CAArB,EAA4Cd,OAA5C,CAAoD,UAACmC,SAAD,EAAe;AACjE,cAAMC,SAAS,GAAGD,SAAS,CAACE,MAA5B;AACA,cAAMC,SAAS,GAAGtE,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACA,cAAIsE,MAAJ,CAAWD,SAAX,EAAsBF,SAAtB,EAAiC,MAAI,CAACI,YAAL,CAAkBJ,SAAlB,CAAjC,EAA+D1D,MAA/D;AACA4C,UAAAA,aAAa,CAACvC,WAAd,CAA0BuD,SAA1B;AACD,SALD;AAMD,OAPD,MAOO;AACL,YAAMG,IAAI,GAAGzE,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAwE,QAAAA,IAAI,CAAC7D,WAAL,OAAmB8D,sBAAnB;AAGApB,QAAAA,aAAa,CAACvC,WAAd,CAA0B0D,IAA1B;AACD;;AAED,UAAME,kBAAkB,GAAG3E,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAA3B;AACA0E,MAAAA,kBAAkB,CAAC/D,WAAnB,GAAiC,4BAAO,MAAP,CAAjC;AACA+D,MAAAA,kBAAkB,CAAC9D,gBAAnB,CAAoC,OAApC,EAA6C,UAACC,MAAD,EAAY;AACvD,QAAA,MAAI,CAACmC,cAAL,CAAoB,MAAI,CAACxB,KAAzB;AACD,OAFD;AAGA6B,MAAAA,aAAa,CAACvC,WAAd,CAA0B4D,kBAA1B;AAEA,WAAKnF,OAAL,CAAaoC,SAAb,GAAyB,EAAzB;AACA,WAAKpC,OAAL,CAAauB,WAAb,CAAyBuC,aAAzB;AACA,aAAO,IAAP;AACD;;;wBAEIsB,K,EAAO;AAAA;;AACV,aAAO,IAAIzC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCG,0BAAGC,OAAH,CAAWC,gBAAX,CAA4BkC,KAA5B,EAAmC,UAACjC,EAAD,EAAKd,GAAL,EAAa;AAC9C,cAAI,CAACc,EAAL,EAAS;AACP,YAAA,MAAI,CAACQ,cAAL,CAAoBtB,GAApB;;AACA,mBAAOQ,MAAM,CAACR,GAAD,CAAb;AACD,WAJ6C,CAK9C;AACA;;;AACA,cAAMuC,SAAS,GAAGS,GAAG,CAACC,SAAJ,CAAcF,KAAd,CAAlB;;AACA,cAAMG,QAAQ,GAAGvC,kBAAGyB,GAAH,CAAOG,SAAP,EAAkBvB,eAAGgC,GAAH,CAAO,MAAP,CAAlB,CAAjB;;AACA,cAAI,CAACE,QAAD,IAAa,CAACA,QAAQ,CAACC,MAAT,CAAgBnC,eAAGoC,IAAH,CAAQ,QAAR,CAAhB,CAAlB,EAAsD;AACpD,mBAAO5C,MAAM,CACX,IAAI6C,KAAJ,4EACsEH,QAAQ,CAAC/B,KAD/E,OADW,CAAb;AAKD;;AACD,iBAAOZ,OAAO,CAACgC,SAAD,CAAd;AACD,SAjBD;AAkBD,OAnBM,EAmBJnD,IAnBI,CAmBC,UAACmD,SAAD,EAAe;AACrB,YAAMD,SAAS,GAAGU,GAAG,CAACM,EAAJ,CAAO,MAAI,CAAC1D,KAAZ,EAAmBoB,eAAGC,KAAH,CAAS,WAAT,CAAnB,EAA0CsB,SAA1C,CAAlB;;AACA,YAAI5B,kBAAG4C,cAAH,CAAkBjB,SAAlB,CAAJ,EAAkC;AAChC,iBAAOC,SAAP;AACD;;AACD,eAAOiB,KAAK,CAAC,MAAI,CAAC5D,KAAL,CAAW6D,GAAX,GAAiB7B,GAAlB,EAAuB;AAAE8B,UAAAA,KAAK,EAAE,CAACpB,SAAD;AAAT,SAAvB,CAAL,CAAoDlD,IAApD,CAAyD,YAAM;AACpEkD,UAAAA,SAAS,CAACqB,GAAV,GAAgB,MAAI,CAAC/D,KAAL,CAAW6D,GAAX,EAAhB;;AACA9C,4BAAGkB,GAAH,CAAOS,SAAP;;AACA,UAAA,MAAI,CAAChB,cAAL,CAAoB,IAApB,EAA0B,OAA1B,EAAmCiB,SAAnC;;AACA,UAAA,MAAI,CAAC1D,MAAL;AACD,SALM,CAAP;AAMD,OA9BM,CAAP;AA+BD;;;iCAEa0D,S,EAAW;AAAA;;AACvB,aAAO,UAACtD,MAAD,EAAY;AACjB,YAAMqD,SAAS,GAAGU,GAAG,CAACM,EAAJ,CAAO,MAAI,CAAC1D,KAAZ,EAAmBoB,eAAGC,KAAH,CAAS,WAAT,CAAnB,EAA0CsB,SAA1C,CAAlB;AACA,eAAOiB,KAAK,CAAC,MAAI,CAAC5D,KAAL,CAAW6D,GAAX,GAAiB7B,GAAlB,EAAuB;AAAEgC,UAAAA,KAAK,EAAE,CAACtB,SAAD;AAAT,SAAvB,CAAL,CACJlD,IADI,CACC,YAAM;AACVuB,4BAAGkD,MAAH,CAAUvB,SAAV;;AACA,UAAA,MAAI,CAAChB,cAAL,CAAoB,IAApB,EAA0B,SAA1B,EAAqCiB,SAArC;;AACA,UAAA,MAAI,CAAC1D,MAAL;;AACA,iBAAO,IAAP;AACD,SANI,WAOE,UAACmB,GAAD,EAAS;AACd,cAAM8D,IAAI,GAAGnD,kBAAGyB,GAAH,CAAOG,SAAP,EAAkBvB,eAAGoC,IAAH,CAAQ,MAAR,CAAlB,CAAb;;AACA,cAAMW,YAAY,GAChBD,IAAI,IAAIA,IAAI,CAAC3C,KAAb,8BACwB2C,IAAI,CAAC3C,KAD7B,gBACwCnB,GADxC,oCAEwBuC,SAAS,CAACpB,KAFlC,gBAE6CnB,GAF7C,MADF;AAIA,gBAAM,IAAIqD,KAAJ,CAAUU,YAAV,CAAN;AACD,SAdI,CAAP;AAeD,OAjBD;AAkBD;;;iCAEaD,I,EAAM;AAAA;;AAAA,sBACKrD,OAAO,CAAC,KAAKpB,IAAN,CADZ;AAAA,UACVqB,UADU,aACVA,UADU;;AAElB,UAAMsD,cAAc,GAAG,CAAC,KAAKpE,KAAL,CAAW6D,GAAX,EAAD,EAAmB/C,UAAnB,EAA+BiB,GAA/B,CAAmC,UAACsC,UAAD,EAAgB;AACxE,YAAMC,iBAAiB,GAAGvD,kBAAG0B,KAAH,CACxB,MAAI,CAACzC,KADmB,EAExBoB,eAAGC,KAAH,CAAS,IAAT,CAFwB,EAGxB,IAHwB,EAIxBgD,UAJwB,CAA1B;;AAMA,YAAME,gBAAgB,GAAGnB,GAAG,CAACM,EAAJ,CACvB,MAAI,CAAC1D,KADkB,EAEvBoB,eAAGC,KAAH,CAAS,IAAT,CAFuB,EAGvB+B,GAAG,CAACoB,OAAJ,CAAYN,IAAZ,CAHuB,CAAzB;AAKA,eAAON,KAAK,CAACS,UAAU,CAAC9C,KAAZ,EAAmB;AAC7ByC,UAAAA,KAAK,EAAEM,iBADsB;AAE7BR,UAAAA,KAAK,EAAE,CAACS,gBAAD;AAFsB,SAAnB,CAAL,CAGJ/E,IAHI,CAGC,UAACiF,cAAD,EAAoB;AAC1B1D,4BAAG2D,gBAAH,CAAoBJ,iBAApB;;AACAC,UAAAA,gBAAgB,CAACR,GAAjB,GAAuBM,UAAvB;;AACAtD,4BAAGkB,GAAH,CAAOsC,gBAAP;AACD,SAPM,CAAP;AAQD,OApBsB,CAAvB;AAqBA,aAAO7D,OAAO,CAACiE,GAAR,CAAYP,cAAZ,CAAP;AACD;;;KAEH;AACA;AACA;;;;;IACatB,M;;;AACX,kBAAa/E,OAAb,EAAsB4E,SAAtB,EAAiCI,YAAjC,EAA+C;AAAA;AAC7C,SAAKJ,SAAL,GAAiBA,SAAjB;AACA,SAAK5E,OAAL,GAAeA,OAAf;AACA,SAAKgF,YAAL,GAAoBA,YAApB;AACD;;;;6BAES;AAAA;;AACR,UAAMzE,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAF,MAAAA,SAAS,CAACG,KAAV,CAAgBI,OAAhB,GAA0B,MAA1B,CAFQ,CAIR;;AACA,UAAM+F,MAAM,GAAGtD,cAAc,CAC3B,KAAKqB,SADsB,EAE3BvB,eAAGoC,IAAH,CAAQ,KAAR,CAF2B,EAG3BqB,qBAAW,gBAHgB,CAA7B;AAKA,UAAMC,UAAU,GAAGvG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAnB;AACAsG,MAAAA,UAAU,CAACC,GAAX,GAAiB,4BAAOH,MAAP,CAAjB;AACAE,MAAAA,UAAU,CAACE,KAAX,GAAmB,IAAnB;AACAF,MAAAA,UAAU,CAACG,MAAX,GAAoB,IAApB;AACAH,MAAAA,UAAU,CAACrG,KAAX,CAAiBkB,MAAjB,GAA0B,KAA1B,CAdQ,CAgBR;;AACA,UAAMuE,IAAI,GAAG5C,cAAc,CACzB,KAAKqB,SADoB,EAEzBvB,eAAGoC,IAAH,CAAQ,MAAR,CAFyB,aAGrB,KAAKb,SAHgB,OAA3B;AAKA,UAAMuC,QAAQ,GAAG3G,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAjB;AACA0G,MAAAA,QAAQ,CAAC/E,SAAT,GAAqB,4BAAO+D,IAAP,CAArB;AACAgB,MAAAA,QAAQ,CAACzG,KAAT,CAAe0G,QAAf,GAA0B,GAA1B;AACAD,MAAAA,QAAQ,CAACzG,KAAT,CAAekB,MAAf,GAAwB,QAAxB;AAEA,UAAMyF,YAAY,GAAG7G,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAArB;AACA4G,MAAAA,YAAY,CAACjG,WAAb,GAA2B,QAA3B;AACAiG,MAAAA,YAAY,CAAChG,gBAAb,CAA8B,OAA9B,EAAuC,UAACC,MAAD;AAAA,eACrC,MAAI,CAAC0D,YAAL,YAA0B,UAAC3C,GAAD,EAAS;AACjC,UAAA,MAAI,CAACrC,OAAL,CAAauB,WAAb,CAAyB,8BAAkBf,QAAlB,EAA4B,sCAAU6B,GAAV,EAA5B,CAAzB;AACD,SAFD,CADqC;AAAA,OAAvC;AAKAgF,MAAAA,YAAY,CAAC3G,KAAb,CAAmBkB,MAAnB,GAA4B,KAA5B;AAEArB,MAAAA,SAAS,CAACgB,WAAV,CAAsBwF,UAAtB;AACAxG,MAAAA,SAAS,CAACgB,WAAV,CAAsB4F,QAAtB;AACA5G,MAAAA,SAAS,CAACgB,WAAV,CAAsB8F,YAAtB;AAEA,WAAKrH,OAAL,CAAaoC,SAAb,GAAyB,EAAzB;AACA,WAAKpC,OAAL,CAAauB,WAAb,CAAyBhB,SAAzB;AACA,aAAO,IAAP;AACD;;;;;;;AAGH,SAASgD,cAAT,CAAyB+D,OAAzB,EAAkCC,SAAlC,EAA6CC,YAA7C,EAA2D;AACzD,MAAM3C,MAAM,GAAG7B,kBAAGyB,GAAH,CAAO6C,OAAP,EAAgBC,SAAhB,CAAf;;AACA,SAAO1C,MAAM,GAAGA,MAAM,CAACrB,KAAV,GAAkBgE,YAA/B;AACD;;AAED,SAAS3B,KAAT,CAAgB4B,GAAhB,SAAuC;AAAA,MAAhBxB,KAAgB,SAAhBA,KAAgB;AAAA,MAATF,KAAS,SAATA,KAAS;AACrC,SAAO,IAAIpD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCG,sBAAG0E,OAAH,CAAWC,MAAX,CAAkB1B,KAAlB,EAAyBF,KAAzB,EAAgC,UAAC9B,GAAD,EAAM2D,OAAN,EAAexB,YAAf,EAAgC;AAC9D,UAAI,CAACwB,OAAL,EAAc;AACZ,eAAO/E,MAAM,CACX,IAAI6C,KAAJ,sCAAwCzB,GAAxC,gBAAiDmC,YAAjD,EADW,CAAb;AAGD;;AACDxD,MAAAA,OAAO;AACR,KAPD;AAQD,GATM,CAAP,CADqC,CAWrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AAED,SAASE,OAAT,CAAkBpB,IAAlB,EAAwB;AACtB,SAAO;AACL;AACAqB,IAAAA,UAAU,EAAEC,kBAAGyB,GAAH,CAAO/C,IAAP,EAAa2B,eAAGC,KAAH,CAAS,YAAT,CAAb,CAFP;AAGLuE,IAAAA,cAAc,EAAE7E,kBAAG8E,GAAH,CAAOpG,IAAI,CAACqG,GAAL,GAAW9D,GAAX,GAAiB,QAAxB;AAHX,GAAP;AAKD,C,CACD;AACA;;;AACO,SAASzC,eAAT,CAA0BvB,SAA1B,EAAqC;AAC1C,SAAO,IAAI0C,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCG,sBAAGC,OAAH,CAAWC,gBAAX,CAA4BjD,SAA5B,EAAuC,UAACkD,EAAD,EAAKd,GAAL,EAAa;AAClD,UAAI,CAACc,EAAL,EAAS;AACP,eAAON,MAAM,CAACR,GAAD,CAAb;AACD;;AACD,UAAM2F,gBAAgB,GAAGhF,kBAAGyB,GAAH,CACvB,IADuB,EAEvBpB,eAAG4E,KAAH,CAAS,UAAT,CAFuB,EAGvB5E,eAAGC,KAAH,CAAS,aAAT,CAHuB,CAAzB;;AAKA,UAAI,CAAC0E,gBAAL,EAAuB;AACrB,eAAOnF,MAAM,CACX,IAAI6C,KAAJ,CACE,wDAAwDzF,SAD1D,CADW,CAAb;AAKD;;AACD,UAAMyB,IAAI,GAAGsB,kBAAGyB,GAAH,CAAOuD,gBAAP,EAAyB3E,eAAG4E,KAAH,CAAS,UAAT,CAAzB,CAAb;;AACA,UAAI,CAACvG,IAAL,EAAW;AACT,eAAOmB,MAAM,CAAC,IAAI6C,KAAJ,CAAU,sCAAV,CAAD,CAAb;AACD;;AACD1C,wBAAGC,OAAH,CACGiF,IADH,CACQxG,IADR,EAEGD,IAFH,CAEQ,UAAU0G,IAAV,EAAgB;AACpB,eAAOvF,OAAO,CAAC;AAAElB,UAAAA,IAAI,EAAJA;AAAF,SAAD,CAAd;AACD,OAJH,WAKS,UAAUW,GAAV,EAAe;AACpB,eAAOQ,MAAM,CAAC,IAAI6C,KAAJ,CAAU,iCAAiCrD,GAA3C,CAAD,CAAb;AACD,OAPH;AAQD,KA5BD;AA6BD,GA9BM,CAAP;AA+BD;;AAEM,SAASN,cAAT,CAAyBL,IAAzB,EAA+BM,mBAA/B,EAAoD;AAAA,kBAClBc,OAAO,CAACpB,IAAD,CADW;AAAA,MACjDqB,UADiD,aACjDA,UADiD;AAAA,MACrC8E,cADqC,aACrCA,cADqC;;AAEzD,MAAM5F,KAAK,GAAGoD,GAAG,CAACyC,GAAJ,WACTD,cAAc,CAAC5D,GADN,SACYmE,qBAAKC,EAAL,GAAUC,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,CADZ,eAAd;AAGA,MAAMnC,IAAI,GAAGnE,mBAAmB,IAAI,gBAApC,CALyD,CAOzD;AACA;AACA;;AACA,MAAMuG,aAAa,GAAG,CAACtG,KAAK,CAAC6D,GAAN,EAAD,EAAc/C,UAAd,EAA0BiB,GAA1B,CAA8B,UAAC8B,GAAD,EAAS;AAC3D,QAAM0C,aAAa,GAAGnD,GAAG,CAACM,EAAJ,CAAO1D,KAAP,EAAcoB,eAAGgC,GAAH,CAAO,MAAP,CAAd,EAA8BhC,eAAGC,KAAH,CAAS,OAAT,CAA9B,EAAiDwC,GAAjD,CAAtB;AACA,QAAM2C,aAAa,GAAGpD,GAAG,CAACM,EAAJ,CAAO1D,KAAP,EAAcoB,eAAGC,KAAH,CAAS,IAAT,CAAd,EAA8B6C,IAA9B,EAAoClE,KAAK,CAAC6D,GAAN,EAApC,EAAiDA,GAAjD,CAAtB;AACA,QAAM4C,sBAAsB,GAAGrD,GAAG,CAACM,EAAJ,CAC7BjE,IAD6B,EAE7B2B,eAAGC,KAAH,CAAS,eAAT,CAF6B,EAG7BrB,KAH6B,EAI7B6D,GAJ6B,CAA/B;AAMA,QAAMC,KAAK,GAAGD,GAAG,CAACN,MAAJ,CAAWzC,UAAX,IACV,CAACyF,aAAD,EAAgBC,aAAhB,EAA+BC,sBAA/B,CADU,GAEV,CAACF,aAAD,EAAgBC,aAAhB,CAFJ;AAGA,WAAO5C,KAAK,CAACC,GAAG,CAAC7B,GAAL,EAAU;AAAE8B,MAAAA,KAAK,EAALA;AAAF,KAAV,CAAL,CAA0BtE,IAA1B,CAA+B,YAAM;AAC1CsE,MAAAA,KAAK,CAACvD,OAAN,CAAc,UAACmD,EAAD,EAAQ;AACpB3C,0BAAGkB,GAAH,CAAOyB,EAAP;AACD,OAFD;AAGD,KAJM,CAAP;AAKD,GAjBqB,CAAtB;AAkBA,SAAOhD,OAAO,CAACiE,GAAR,CAAY2B,aAAZ,EACJ9G,IADI,CACC;AAAA,WAAO;AAAEQ,MAAAA,KAAK,EAALA;AAAF,KAAP;AAAA,GADD,WAEE,UAACI,GAAD,EAAS;AACdsG,IAAAA,OAAO,CAACC,GAAR,CAAY,+CAA+CvG,GAA3D;AACA,UAAM,IAAIqD,KAAJ,yDAEFrD,GAAG,CAACwG,GAAJ,GAAUxG,GAAG,CAACwG,GAAJ,CAAQC,WAAlB,GAAgC,EAF9B,QAAN;AAKD,GATI,CAAP;AAUD","sourcesContent":["/**\r\n *\r\n * People Picker Pane\r\n *\r\n * This pane offers a mechanism for selecting a set of individuals, groups, or\r\n * organizations to take some action on.\r\n *\r\n * Assumptions\r\n *   - Assumes that the user has a type index entry for vcard:AddressBook.\r\n *\r\n */\r\nimport escape from 'escape-html'\r\nimport uuid from 'node-uuid'\r\nimport * as rdf from 'rdflib'\r\n// const webClient = require('solid-web-client')(rdf)\r\n\r\nimport { makeDropTarget } from './dragAndDrop'\r\nimport { errorMessageBlock } from './error'\r\nimport { iconBase } from '../iconBase'\r\nimport ns from '../ns'\r\nimport kb from '../store'\r\n\r\nexport class PeoplePicker {\r\n  constructor (element, typeIndex, groupPickedCb, options) {\r\n    this.options = options || {}\r\n    this.element = element\r\n    this.typeIndex = typeIndex\r\n    this.groupPickedCb = groupPickedCb\r\n    this.selectedgroup = this.options.selectedgroup // current selected group if any\r\n    this.onSelectGroup = this.onSelectGroup.bind(this)\r\n  }\r\n\r\n  render () {\r\n    const container = document.createElement('div')\r\n    container.style.maxWidth = '350px'\r\n    container.style.minHeight = '200px'\r\n    container.style.outline = '1px solid black'\r\n    container.style.display = 'flex'\r\n\r\n    if (this.selectedgroup) {\r\n      container.style.flexDirection = 'column'\r\n      const selectedGroup = document.createElement('div')\r\n      new Group(selectedGroup, this.selectedgroup).render()\r\n      const changeGroupButton = document.createElement('button')\r\n      changeGroupButton.textContent = escape('Change group')\r\n      changeGroupButton.addEventListener('click', (_event) => {\r\n        this.selectedgroup = null\r\n        this.render()\r\n      })\r\n      container.appendChild(selectedGroup)\r\n      container.appendChild(changeGroupButton)\r\n    } else {\r\n      findAddressBook(this.typeIndex)\r\n        .then(({ book }) => {\r\n          const chooseExistingGroupButton = document.createElement('button')\r\n          chooseExistingGroupButton.textContent = escape(\r\n            'Pick an existing group'\r\n          )\r\n          chooseExistingGroupButton.style.margin = 'auto'\r\n          chooseExistingGroupButton.addEventListener('click', (_event) => {\r\n            new GroupPicker(container, book, this.onSelectGroup).render()\r\n          })\r\n\r\n          const createNewGroupButton = document.createElement('button')\r\n          createNewGroupButton.textContent = escape('Create a new group')\r\n          createNewGroupButton.style.margin = 'auto'\r\n          createNewGroupButton.addEventListener('click', (_event) => {\r\n            createNewGroup(book, this.options.defaultNewGroupName)\r\n              .then(({ group }) => {\r\n                new GroupBuilder(\r\n                  this.element,\r\n                  book,\r\n                  group,\r\n                  this.onSelectGroup\r\n                ).render()\r\n              })\r\n              .catch((errorBody) => {\r\n                this.element.appendChild(\r\n                  errorMessageBlock(\r\n                    document,\r\n                    escape(`Error creating a new group. (${errorBody})`)\r\n                  )\r\n                )\r\n              })\r\n          })\r\n\r\n          container.appendChild(chooseExistingGroupButton)\r\n          container.appendChild(createNewGroupButton)\r\n\r\n          this.element.innerHTML = ''\r\n          this.element.appendChild(container)\r\n        })\r\n        .catch((err) => {\r\n          this.element.appendChild(\r\n            errorMessageBlock(\r\n              document,\r\n              escape(`Could find your groups. (${err})`)\r\n            )\r\n          )\r\n        })\r\n    }\r\n\r\n    this.element.innerHTML = ''\r\n    this.element.appendChild(container)\r\n    return this\r\n  }\r\n\r\n  onSelectGroup (group) {\r\n    this.selectedgroup = group\r\n    this.groupPickedCb(group)\r\n    this.render()\r\n  }\r\n}\r\n\r\nexport class GroupPicker {\r\n  constructor (element, book, onSelectGroup) {\r\n    this.element = element\r\n    this.book = book\r\n    this.onSelectGroup = onSelectGroup\r\n  }\r\n\r\n  render () {\r\n    this.loadGroups()\r\n      .then((groups) => {\r\n        // render the groups\r\n        const container = document.createElement('div')\r\n        container.style.display = 'flex'\r\n        container.style.flexDirection = 'column'\r\n        groups.forEach((group) => {\r\n          const groupButton = document.createElement('button')\r\n          groupButton.addEventListener('click', this.handleClickGroup(group))\r\n          new Group(groupButton, group).render()\r\n          container.appendChild(groupButton)\r\n        })\r\n        this.element.innerHTML = ''\r\n        this.element.appendChild(container)\r\n      })\r\n      .catch((err) => {\r\n        this.element.appendChild(\r\n          errorMessageBlock(\r\n            document,\r\n            escape(`There was an error loading your groups. (${err})`)\r\n          )\r\n        )\r\n      })\r\n    return this\r\n  }\r\n\r\n  loadGroups () {\r\n    return new Promise((resolve, reject) => {\r\n      const { groupIndex } = indexes(this.book)\r\n      kb.fetcher.nowOrWhenFetched(groupIndex, (ok, err) => {\r\n        if (!ok) {\r\n          return reject(err)\r\n        }\r\n        const groups = kb.each(this.book, ns.vcard('includesGroup'))\r\n        return resolve(groups)\r\n      })\r\n    })\r\n  }\r\n\r\n  handleClickGroup (group) {\r\n    return (_event) => {\r\n      this.onSelectGroup(group)\r\n    }\r\n  }\r\n}\r\n\r\nexport class Group {\r\n  constructor (element, group) {\r\n    this.element = element\r\n    this.group = group\r\n  }\r\n\r\n  render () {\r\n    const container = document.createElement('div')\r\n    container.textContent = escape(\r\n      // @@@@@ need to escape??\r\n      getWithDefault(this.group, ns.vcard('fn'), `[${this.group.value}]`)\r\n    )\r\n    this.element.innerHTML = ''\r\n    this.element.appendChild(container)\r\n    return this\r\n  }\r\n}\r\n\r\nexport class GroupBuilder {\r\n  constructor (element, book, group, doneBuildingCb, groupChangedCb) {\r\n    this.element = element\r\n    this.book = book\r\n    this.group = group\r\n    this.onGroupChanged = (err, changeType, agent) => {\r\n      if (groupChangedCb) {\r\n        groupChangedCb(err, changeType, agent)\r\n      }\r\n    }\r\n    this.groupChangedCb = groupChangedCb\r\n    this.doneBuildingCb = doneBuildingCb\r\n  }\r\n\r\n  refresh () {\r\n    // TODO: implement\r\n  }\r\n\r\n  render () {\r\n    const dropContainer = document.createElement('div')\r\n    dropContainer.style.maxWidth = '350px'\r\n    dropContainer.style.minHeight = '200px'\r\n    dropContainer.style.outline = '1px solid black'\r\n    dropContainer.style.display = 'flex'\r\n    dropContainer.style.flexDirection = 'column'\r\n\r\n    makeDropTarget(dropContainer, (uris) => {\r\n      uris.map((uri) => {\r\n        this.add(uri).catch((err) => {\r\n          this.element.appendChild(\r\n            errorMessageBlock(\r\n              document,\r\n              escape(`Could not add the given WebId. (${err})`)\r\n            )\r\n          )\r\n        })\r\n      })\r\n    })\r\n\r\n    const groupNameInput = document.createElement('input')\r\n    groupNameInput.type = 'text'\r\n    groupNameInput.value = getWithDefault(\r\n      this.group,\r\n      ns.vcard('fn'),\r\n      'Untitled Group'\r\n    )\r\n    groupNameInput.addEventListener('change', (event) => {\r\n      this.setGroupName(event.target.value).catch((err) => {\r\n        this.element.appendChild(\r\n          errorMessageBlock(document, `Error changing group name. (${err})`)\r\n        )\r\n      })\r\n    })\r\n    const groupNameLabel = document.createElement('label')\r\n    groupNameLabel.textContent = escape('Group Name:')\r\n    groupNameLabel.appendChild(groupNameInput)\r\n    dropContainer.appendChild(groupNameLabel)\r\n\r\n    if (kb.any(this.group, ns.vcard('hasMember'))) {\r\n      kb.match(this.group, ns.vcard('hasMember')).forEach((statement) => {\r\n        const webIdNode = statement.object\r\n        const personDiv = document.createElement('div')\r\n        new Person(personDiv, webIdNode, this.handleRemove(webIdNode)).render()\r\n        dropContainer.appendChild(personDiv)\r\n      })\r\n    } else {\r\n      const copy = document.createElement('p')\r\n      copy.textContent = escape`\r\n        To add someone to this group, drag and drop their WebID URL onto the box.\r\n      `\r\n      dropContainer.appendChild(copy)\r\n    }\r\n\r\n    const doneBuildingButton = document.createElement('button')\r\n    doneBuildingButton.textContent = escape('Done')\r\n    doneBuildingButton.addEventListener('click', (_event) => {\r\n      this.doneBuildingCb(this.group)\r\n    })\r\n    dropContainer.appendChild(doneBuildingButton)\r\n\r\n    this.element.innerHTML = ''\r\n    this.element.appendChild(dropContainer)\r\n    return this\r\n  }\r\n\r\n  add (webId) {\r\n    return new Promise((resolve, reject) => {\r\n      kb.fetcher.nowOrWhenFetched(webId, (ok, err) => {\r\n        if (!ok) {\r\n          this.onGroupChanged(err)\r\n          return reject(err)\r\n        }\r\n        // make sure it's a valid person, group, or entity (for now just handle\r\n        // webId)\r\n        const webIdNode = rdf.namedNode(webId)\r\n        const rdfClass = kb.any(webIdNode, ns.rdf('type'))\r\n        if (!rdfClass || !rdfClass.equals(ns.foaf('Person'))) {\r\n          return reject(\r\n            new Error(\r\n              `Only people supported right now. (tried to add something of type ${rdfClass.value})`\r\n            )\r\n          )\r\n        }\r\n        return resolve(webIdNode)\r\n      })\r\n    }).then((webIdNode) => {\r\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\r\n      if (kb.holdsStatement(statement)) {\r\n        return webIdNode\r\n      }\r\n      return patch(this.group.doc().uri, { toIns: [statement] }).then(() => {\r\n        statement.why = this.group.doc()\r\n        kb.add(statement)\r\n        this.onGroupChanged(null, 'added', webIdNode)\r\n        this.render()\r\n      })\r\n    })\r\n  }\r\n\r\n  handleRemove (webIdNode) {\r\n    return (_event) => {\r\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\r\n      return patch(this.group.doc().uri, { toDel: [statement] })\r\n        .then(() => {\r\n          kb.remove(statement)\r\n          this.onGroupChanged(null, 'removed', webIdNode)\r\n          this.render()\r\n          return true\r\n        })\r\n        .catch((err) => {\r\n          const name = kb.any(webIdNode, ns.foaf('name'))\r\n          const errorMessage =\r\n            name && name.value\r\n              ? `Could not remove ${name.value}. (${err})`\r\n              : `Could not remove ${webIdNode.value}. (${err})`\r\n          throw new Error(errorMessage)\r\n        })\r\n    }\r\n  }\r\n\r\n  setGroupName (name) {\r\n    const { groupIndex } = indexes(this.book)\r\n    const updatePromises = [this.group.doc(), groupIndex].map((namedGraph) => {\r\n      const oldNameStatements = kb.match(\r\n        this.group,\r\n        ns.vcard('fn'),\r\n        null,\r\n        namedGraph\r\n      )\r\n      const newNameStatement = rdf.st(\r\n        this.group,\r\n        ns.vcard('fn'),\r\n        rdf.literal(name)\r\n      )\r\n      return patch(namedGraph.value, {\r\n        toDel: oldNameStatements,\r\n        toIns: [newNameStatement]\r\n      }).then((_solidResponse) => {\r\n        kb.removeStatements(oldNameStatements)\r\n        newNameStatement.why = namedGraph\r\n        kb.add(newNameStatement)\r\n      })\r\n    })\r\n    return Promise.all(updatePromises)\r\n  }\r\n}\r\n// @ignore exporting this only for the unit test\r\n// @@ TODO maybe I should move this down at end, but for\r\n// now I will leave it where it was\r\nexport class Person {\r\n  constructor (element, webIdNode, handleRemove) {\r\n    this.webIdNode = webIdNode\r\n    this.element = element\r\n    this.handleRemove = handleRemove\r\n  }\r\n\r\n  render () {\r\n    const container = document.createElement('div')\r\n    container.style.display = 'flex'\r\n\r\n    // TODO: take a look at UI.widgets.setName\r\n    const imgSrc = getWithDefault(\r\n      this.webIdNode,\r\n      ns.foaf('img'),\r\n      iconBase + 'noun_15059.svg'\r\n    )\r\n    const profileImg = document.createElement('img')\r\n    profileImg.src = escape(imgSrc)\r\n    profileImg.width = '50'\r\n    profileImg.height = '50'\r\n    profileImg.style.margin = '5px'\r\n\r\n    // TODO: take a look at UI.widgets.setImage\r\n    const name = getWithDefault(\r\n      this.webIdNode,\r\n      ns.foaf('name'),\r\n      `[${this.webIdNode}]`\r\n    )\r\n    const nameSpan = document.createElement('span')\r\n    nameSpan.innerHTML = escape(name)\r\n    nameSpan.style.flexGrow = '1'\r\n    nameSpan.style.margin = 'auto 0'\r\n\r\n    const removeButton = document.createElement('button')\r\n    removeButton.textContent = 'Remove'\r\n    removeButton.addEventListener('click', (_event) =>\r\n      this.handleRemove().catch((err) => {\r\n        this.element.appendChild(errorMessageBlock(document, escape(`${err}`)))\r\n      })\r\n    )\r\n    removeButton.style.margin = '5px'\r\n\r\n    container.appendChild(profileImg)\r\n    container.appendChild(nameSpan)\r\n    container.appendChild(removeButton)\r\n\r\n    this.element.innerHTML = ''\r\n    this.element.appendChild(container)\r\n    return this\r\n  }\r\n}\r\n\r\nfunction getWithDefault (subject, predicate, defaultValue) {\r\n  const object = kb.any(subject, predicate)\r\n  return object ? object.value : defaultValue\r\n}\r\n\r\nfunction patch (url, { toDel, toIns }) {\r\n  return new Promise((resolve, reject) => {\r\n    kb.updater.update(toDel, toIns, (uri, success, errorMessage) => {\r\n      if (!success) {\r\n        return reject(\r\n          new Error(`PATCH failed for resource <${uri}>: ${errorMessage}`)\r\n        )\r\n      }\r\n      resolve()\r\n    })\r\n  })\r\n  // return webClient.patch(url, toDel, toIns)\r\n  //   .then(solidResponse => {\r\n  //     const status = solidResponse.xhr.status\r\n  //     if (status < 200 || status >= 400) {\r\n  //       const err = new Error(`PATCH failed for resource <${solidResponse.url}>`)\r\n  //       err.solidResponse = solidResponse\r\n  //       throw err\r\n  //     }\r\n  //   })\r\n}\r\n\r\nfunction indexes (book) {\r\n  return {\r\n    // bookIndex: book,\r\n    groupIndex: kb.any(book, ns.vcard('groupIndex')),\r\n    groupContainer: kb.sym(book.dir().uri + 'Group/')\r\n  }\r\n}\r\n// Below are functions that are exported to make testing easier\r\n// @ignore exporting this only for the unit test\r\nexport function findAddressBook (typeIndex) {\r\n  return new Promise((resolve, reject) => {\r\n    kb.fetcher.nowOrWhenFetched(typeIndex, (ok, err) => {\r\n      if (!ok) {\r\n        return reject(err)\r\n      }\r\n      const bookRegistration = kb.any(\r\n        null,\r\n        ns.solid('forClass'),\r\n        ns.vcard('AddressBook')\r\n      )\r\n      if (!bookRegistration) {\r\n        return reject(\r\n          new Error(\r\n            'no address book registered in the solid type index ' + typeIndex\r\n          )\r\n        )\r\n      }\r\n      const book = kb.any(bookRegistration, ns.solid('instance'))\r\n      if (!book) {\r\n        return reject(new Error('incomplete address book registration'))\r\n      }\r\n      kb.fetcher\r\n        .load(book)\r\n        .then(function (_xhr) {\r\n          return resolve({ book })\r\n        })\r\n        .catch(function (err) {\r\n          return reject(new Error('Could not load address book ' + err))\r\n        })\r\n    })\r\n  })\r\n}\r\n\r\nexport function createNewGroup (book, defaultNewGroupName) {\r\n  const { groupIndex, groupContainer } = indexes(book)\r\n  const group = rdf.sym(\r\n    `${groupContainer.uri}${uuid.v4().slice(0, 8)}.ttl#this`\r\n  )\r\n  const name = defaultNewGroupName || 'Untitled Group'\r\n\r\n  // NOTE that order matters here.  Unfortunately this type of update is\r\n  // non-atomic in that solid requires us to send two PATCHes, either of which\r\n  // might fail.\r\n  const patchPromises = [group.doc(), groupIndex].map((doc) => {\r\n    const typeStatement = rdf.st(group, ns.rdf('type'), ns.vcard('Group'), doc)\r\n    const nameStatement = rdf.st(group, ns.vcard('fn'), name, group.doc(), doc)\r\n    const includesGroupStatement = rdf.st(\r\n      book,\r\n      ns.vcard('includesGroup'),\r\n      group,\r\n      doc\r\n    )\r\n    const toIns = doc.equals(groupIndex)\r\n      ? [typeStatement, nameStatement, includesGroupStatement]\r\n      : [typeStatement, nameStatement]\r\n    return patch(doc.uri, { toIns }).then(() => {\r\n      toIns.forEach((st) => {\r\n        kb.add(st)\r\n      })\r\n    })\r\n  })\r\n  return Promise.all(patchPromises)\r\n    .then(() => ({ group }))\r\n    .catch((err) => {\r\n      console.log('Could not create new group.  PATCH failed ' + err)\r\n      throw new Error(\r\n        `Couldn't create new group.  PATCH failed for (${\r\n          err.xhr ? err.xhr.responseURL : ''\r\n        } )`\r\n      )\r\n    })\r\n}\r\n"],"file":"peoplePicker.js"}