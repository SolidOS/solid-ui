{"version":3,"sources":["../../src/widgets/dragAndDrop.js"],"names":["mime","require","module","exports","makeDropTarget","makeDraggable","uploadFiles","ele","droppedURIHandler","droppedFileHandler","dragoverListener","e","preventDefault","dataTransfer","dropEffect","dragenterListener","console","log","style","savedStyle","border","backgroundColor","borderRadius","dragleaveListener","dropListener","types","join","uris","text","t","length","type","getData","split","files","i","f","name","size","lastModifiedDate","toLocaleDateString","slice","addTargetListeners","addEventListener","tr","obj","setAttribute","fontWeight","setData","uri","outerHTML","stopPropagation","fetcher","fileBase","imageBase","successHandler","reader","FileReader","onload","theFile","data","target","result","suffix","byteLength","contentType","lookup","msg","alert","Error","extension","folderName","startsWith","destURI","endsWith","encodeURIComponent","webOperation","then","_response","error","readAsArrayBuffer"],"mappings":"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","sourcesContent":["/* Drag and drop common functionality\r\n */\r\nconst mime = require('mime-types')\r\n\r\n/* global FileReader alert */\r\nmodule.exports = {\r\n  makeDropTarget: makeDropTarget,\r\n  makeDraggable: makeDraggable,\r\n  uploadFiles: uploadFiles\r\n}\r\n// const UI = require('../index.js') // this package\r\n\r\nfunction makeDropTarget(ele, droppedURIHandler, droppedFileHandler) {\r\n  var dragoverListener = function(e) {\r\n    e.preventDefault() // Need else drop does not work [sic]\r\n    e.dataTransfer.dropEffect = 'copy'\r\n  }\r\n\r\n  var dragenterListener = function(e) {\r\n    console.log('dragenter event dropEffect: ' + e.dataTransfer.dropEffect)\r\n    if (this.style) {\r\n      //  necessary not sure when\r\n      if (!this.savedStyle) {\r\n        this.savedStyle = {}\r\n        this.savedStyle.border = this.style.border\r\n        this.savedStyle.backgroundColor = this.style.backgroundColor\r\n        this.savedStyle.borderRadius = this.style.borderRadius\r\n      }\r\n      this.style.backgroundColor = '#ccc'\r\n      this.style.border = '0.25em dashed black'\r\n      this.style.borderRadius = '0.3em'\r\n    }\r\n\r\n    e.dataTransfer.dropEffect = 'link'\r\n    console.log('dragenter event dropEffect 2: ' + e.dataTransfer.dropEffect)\r\n  }\r\n  var dragleaveListener = function(e) {\r\n    console.log('dragleave event dropEffect: ' + e.dataTransfer.dropEffect)\r\n    if (this.savedStyle) {\r\n      this.style.border = this.savedStyle.border\r\n      this.style.backgroundColor = this.savedStyle.backgroundColor\r\n      this.style.borderRadius = this.savedStyle.borderRadius\r\n    } else {\r\n      this.style.backgroundColor = 'white'\r\n      this.style.border = '0em solid black'\r\n    }\r\n  }\r\n\r\n  var dropListener = function(e) {\r\n    if (e.preventDefault) e.preventDefault() // stops the browser from redirecting off to the text.\r\n    console.log('Drop event. dropEffect: ' + e.dataTransfer.dropEffect)\r\n    console.log(\r\n      'Drop event. types: ' +\r\n        (e.dataTransfer.types ? e.dataTransfer.types.join(', ') : 'NOPE')\r\n    )\r\n\r\n    var uris = null\r\n    var text\r\n    if (e.dataTransfer.types) {\r\n      for (var t = 0; t < e.dataTransfer.types.length; t++) {\r\n        var type = e.dataTransfer.types[t]\r\n        if (type === 'text/uri-list') {\r\n          uris = e.dataTransfer.getData(type).split('\\n') // @ ignore those starting with #\r\n          console.log('Dropped text/uri-list: ' + uris)\r\n        } else if (type === 'text/plain') {\r\n          text = e.dataTransfer.getData(type)\r\n        } else if (type === 'Files' && droppedFileHandler) {\r\n          var files = e.dataTransfer.files // FileList object.\r\n          for (let i = 0; files[i]; i++) {\r\n            const f = files[i]\r\n            console.log(\r\n              'Filename: ' +\r\n                f.name +\r\n                ', type: ' +\r\n                (f.type || 'n/a') +\r\n                ' size: ' +\r\n                f.size +\r\n                ' bytes, last modified: ' +\r\n                (f.lastModifiedDate\r\n                  ? f.lastModifiedDate.toLocaleDateString()\r\n                  : 'n/a')\r\n            )\r\n          }\r\n          droppedFileHandler(files)\r\n        }\r\n      }\r\n      if (uris === null && text && text.slice(0, 4) === 'http') {\r\n        uris = text\r\n        console.log(\"Waring: Poor man's drop: using text for URI\") // chrome disables text/uri-list??\r\n      }\r\n    } else {\r\n      // ... however, if we're IE, we don't have the .types property, so we'll just get the Text value\r\n      uris = [e.dataTransfer.getData('Text')]\r\n      console.log('WARNING non-standard drop event: ' + uris[0])\r\n    }\r\n    console.log('Dropped URI list (2): ' + uris)\r\n    if (uris) {\r\n      droppedURIHandler(uris)\r\n    }\r\n    this.style.backgroundColor = 'white' // restore style\r\n    return false\r\n  } // dropListener\r\n\r\n  var addTargetListeners = function(ele) {\r\n    if (!ele) {\r\n      console.log('@@@ addTargetListeners: ele ' + ele)\r\n    }\r\n    ele.addEventListener('dragover', dragoverListener)\r\n    ele.addEventListener('dragenter', dragenterListener)\r\n    ele.addEventListener('dragleave', dragleaveListener)\r\n    ele.addEventListener('drop', dropListener)\r\n  }\r\n  addTargetListeners(ele, droppedURIHandler)\r\n} // listen for dropped URIs\r\n\r\n// Make an HTML element draggable as a URI-identified thing\r\n//\r\n// Possibly later set the drag image too?\r\n//\r\nfunction makeDraggable(tr, obj) {\r\n  tr.setAttribute('draggable', 'true') // Stop the image being dragged instead - just the TR\r\n\r\n  tr.addEventListener(\r\n    'dragstart',\r\n    function(e) {\r\n      tr.style.fontWeight = 'bold'\r\n      e.dataTransfer.setData('text/uri-list', obj.uri)\r\n      e.dataTransfer.setData('text/plain', obj.uri)\r\n      e.dataTransfer.setData('text/html', tr.outerHTML)\r\n      console.log(\r\n        'Dragstart: ' + tr + ' -> ' + obj + 'de: ' + e.dataTransfer.dropEffect\r\n      )\r\n    },\r\n    false\r\n  )\r\n\r\n  tr.addEventListener(\r\n    'drag',\r\n    function(e) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      // console.log('Drag: dropEffect: ' + e.dataTransfer.dropEffect)\r\n    },\r\n    false\r\n  )\r\n\r\n  tr.addEventListener(\r\n    'dragend',\r\n    function(e) {\r\n      tr.style.fontWeight = 'normal'\r\n      console.log('Dragend dropeffect: ' + e.dataTransfer.dropEffect)\r\n      console.log('Dragend: ' + tr + ' -> ' + obj)\r\n    },\r\n    false\r\n  )\r\n}\r\n\r\n/* uploadFiles\r\n **\r\n **  Generic uploader of local files to the web\r\n **   typically called from dropped file handler\r\n ** Params\r\n **  fetcher   instance of class Fetcher as in kb.fetcher\r\n **  files      Array of file objects\r\n **  fileBase   URI of folder in which to put files (except images) (no trailing slash)\r\n **  imageBase  URI of folder in which to put images\r\n **  successHandler(file, uploadedURI)    Called after each success upload\r\n **                              With file object an final URI as params\r\n */\r\nfunction uploadFiles(fetcher, files, fileBase, imageBase, successHandler) {\r\n  for (var i = 0; files[i]; i++) {\r\n    const f = files[i]\r\n    console.log(\r\n      ' dropped: Filename: ' +\r\n        f.name +\r\n        ', type: ' +\r\n        (f.type || 'n/a') +\r\n        ' size: ' +\r\n        f.size +\r\n        ' bytes, last modified: ' +\r\n        (f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a')\r\n    ) // See e.g. https://www.html5rocks.com/en/tutorials/file/dndfiles/\r\n\r\n    // @@ Add: progress bar(s)\r\n    var reader = new FileReader()\r\n    reader.onload = (function(theFile) {\r\n      return function(e) {\r\n        var data = e.target.result\r\n        var suffix = ''\r\n        console.log(' File read byteLength : ' + data.byteLength)\r\n        var contentType = theFile.type\r\n        if (!theFile.type || theFile.type === '') {\r\n          // Not known by browser\r\n          contentType = mime.lookup(theFile.name)\r\n          if (!contentType) {\r\n            const msg =\r\n              'Filename needs to have an extension which gives a type we know: ' +\r\n              theFile.name\r\n            console.log(msg)\r\n            alert(msg)\r\n            throw new Error(msg)\r\n          }\r\n        } else {\r\n          var extension = mime.extension(theFile.type)\r\n          if (theFile.type !== mime.lookup(theFile.name)) {\r\n            suffix = '_.' + extension\r\n            console.log('MIME TYPE MISMATCH -- adding extension: ' + suffix)\r\n          }\r\n        }\r\n        var folderName = theFile.type.startsWith('image/')\r\n          ? imageBase || fileBase\r\n          : fileBase\r\n        var destURI =\r\n          folderName +\r\n          (folderName.endsWith('/') ? '' : '/') +\r\n          encodeURIComponent(theFile.name) +\r\n          suffix\r\n\r\n        fetcher\r\n          .webOperation('PUT', destURI, {\r\n            data: data,\r\n            contentType: contentType\r\n          })\r\n          .then(\r\n            (_response) => {\r\n              console.log(' Upload: put OK: ' + destURI)\r\n              successHandler(theFile, destURI)\r\n            },\r\n            (error) => {\r\n              const msg = ' Upload: FAIL ' + destURI + ', Error: ' + error\r\n              console.log(msg)\r\n              alert(msg)\r\n              throw new Error(msg)\r\n            }\r\n          )\r\n      }\r\n    })(f)\r\n    reader.readAsArrayBuffer(f)\r\n  }\r\n}\r\n"],"file":"dragAndDrop.js"}