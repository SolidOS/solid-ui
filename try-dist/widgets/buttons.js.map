{"version":3,"sources":["../../src/widgets/buttons.ts"],"names":["$rdf","require","UI","icons","log","ns","store","style","utils","error","dragAndDrop","cancelIconURI","iconBase","checkIconURI","getStatusArea","context","box","statusArea","div","dom","document","body","getElementsByTagName","createElement","insertBefore","firstElementChild","complain","err","ele","console","appendChild","errorMessageBlock","alert","clearElement","firstChild","removeChild","extractLogURI","fullURI","logPos","search","rulPos","substring","shortDate","str","noTime","month","nowZ","Date","toISOString","slice","parseInt","e","formatDateTime","date","format","split","map","s","k","width","Milliseconds","FullYear","d","Month","join","timestamp","shortTime","setName","element","x","kb","findName","name","any","vcard","foaf","value","sameTerm","textContent","label","uri","fetcher","nowOrWhenFetched","doc","undefined","_ok","imagesOf","each","sioc","concat","iconForClass","tempSite","p","indexOf","Error","q","findImageFromURI","iconDir","length","startsWith","findImage","thing","rdf","image","trySetImage","iconForClassMap","explitImage","setAttribute","typeIcon","classIconStyle","schemeIcon","types","findTypeURIs","typeURI","setImage","pref","id","klass","happy","ok","faviconOrDefault","iconStyle","isOrigin","parts","res","deleteButtonWithCheck","container","noun","deleteFunction","minusIconURI","img","title","deleteButtonElt","addEventListener","_event","cancelButtonElt","buttonStyle","sureButtonElt","button","iconURI","text","handler","cancelButton","continueButton","askName","predicate","Promise","resolve","_reject","form","prompt","namefield","textInputStyle","select","gotName","parentNode","trim","keyCode","focus","linkIcon","subject","anchor","originalIconBase","personTR","pred","obj","options","tr","td1","td2","td3","link","classList","add","draggable","makeDraggable","refreshTree","root","refresh","i","children","attachmentList","modify","promptIcon","wf","attachmentOuter","attachmentOne","attachmentLeft","attachmentRight","attachmentTable","deleteAttachment","target","updater","update","st","errorBody","_xhr","createNewRow","theTarget","opt","things","sort","syncTableToArray","droppedURIHandler","uris","ins","u","sym","push","paperclip","makeDropTarget","openHrefInOutlineMode","preventDefault","stopPropagation","getTarget","getAttribute","window","outlineManager","GotoSubject","panes","getOutliner","defaultAnnotationStore","hash","slash","lastIndexOf","allClassURIs","set","statementsMatching","object","rdfs","c","propertyTriage","possibleProperties","dp","op","no","nd","nu","pi","predicateIndex","termType","ps","toNT","info","linkButton","b","removeButton","selectorPanel","type","inverse","possible","callbackFunction","linkCallback","selectorPanelRefresh","list","style0","selected","innerHTML","refreshItem","item","setStyle","already","iconDiv","connectIcon","f","index","twoLine","widgetForClass","nav","a","event","twoLineDefault","twoLineWidgetForClass","widget","sup","findSuperClassesNT","cl","fromNT","twoLineTransaction","failed","enc","y","qu","escapeForXML","twoLineTrip","dc","cal","addStyleSheet","href","links","querySelectorAll","isAudio","file","isImage","isVideo","kind","dcCLasses","audio","video","what","typeURIs","prefix","Util","mediaTypeClass","t","fileUploadButtonDiv","droppedFileHandler","input","files","buttonElt","click","line","module","exports"],"mappings":"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","sourcesContent":["import { IndexedFormula, NamedNode } from 'rdflib'\r\n\r\n/**\r\n * UI Widgets such as buttons\r\n * @packageDocumentation\r\n */\r\n\r\n/* global alert */\r\n\r\nconst $rdf = require('rdflib')\r\n\r\nvar UI = {\r\n  icons: require('../iconBase'),\r\n  log: require('../log'),\r\n  ns: require('../ns'),\r\n  store: require('../store'),\r\n  style: require('../style')\r\n  // widgets: widgets // @@\r\n}\r\n\r\nconst utils = require('../utils')\r\n\r\nconst error = require('./error')\r\nconst dragAndDrop = require('./dragAndDrop')\r\n\r\nconst cancelIconURI = UI.icons.iconBase + 'noun_1180156.svg' // black X\r\nconst checkIconURI = UI.icons.iconBase + 'noun_1180158.svg' // green checkmark; Continue\r\n\r\nexport type StatusAreaContext = {\r\n  statusArea?: HTMLElement\r\n  div?: HTMLElement\r\n  dom?: HTMLDocument\r\n}\r\nfunction getStatusArea (context?: StatusAreaContext) {\r\n  var box = (context && context.statusArea) || (context && context.div) || null\r\n  if (box) return box\r\n  let dom = context && context.dom\r\n  if (!dom && typeof document !== 'undefined') {\r\n    dom = document\r\n  }\r\n  if (dom) {\r\n    var body = dom.getElementsByTagName('body')[0]\r\n    box = dom.createElement('div')\r\n    body.insertBefore((box as unknown as HTMLElement), body.firstElementChild)\r\n    if (context) {\r\n      context.statusArea = (box as unknown as HTMLElement)\r\n    }\r\n    return box\r\n  }\r\n  return null\r\n}\r\n\r\n/**\r\n * Display an error message block\r\n */\r\nfunction complain (context: StatusAreaContext | undefined, err: string) {\r\n  if (!err) return // only if error\r\n  var ele = getStatusArea(context)\r\n  console.log('Complaint: ' + err)\r\n  if (ele) ele.appendChild(error.errorMessageBlock((context && context.dom) || document, err))\r\n  else alert(err)\r\n}\r\n\r\n/**\r\n * Remove all the children of an HTML element\r\n */\r\nfunction clearElement (ele: HTMLElement) {\r\n  while (ele.firstChild) {\r\n    ele.removeChild(ele.firstChild)\r\n  }\r\n  return ele\r\n}\r\n\r\n/**\r\n * To figure out the log URI from the full URI used to invoke the reasoner\r\n */\r\nfunction extractLogURI (fullURI) {\r\n  var logPos = fullURI.search(/logFile=/)\r\n  var rulPos = fullURI.search(/&rulesFile=/)\r\n  return fullURI.substring(logPos + 8, rulPos)\r\n}\r\n\r\n/**\r\n * By default, converts e.g. '2020-02-19T19:35:28.557Z' to '19:35'\r\n * if today is 19 Feb 2020, and to 'Feb 19' if not.\r\n * @@@ TODO This needs to be changed to local time\r\n * @param noTime Return a string like 'Feb 19' even if it's today.\r\n */\r\nfunction shortDate (str: string, noTime: boolean): string {\r\n  if (!str) return '???'\r\n  var month = [\r\n    'Jan',\r\n    'Feb',\r\n    'Mar',\r\n    'Apr',\r\n    'May',\r\n    'Jun',\r\n    'Jul',\r\n    'Aug',\r\n    'Sep',\r\n    'Oct',\r\n    'Nov',\r\n    'Dec'\r\n  ]\r\n  try {\r\n    var nowZ = new Date().toISOString()\r\n    // var nowZ = $rdf.term(now).value\r\n    // var n = now.getTimezoneOffset() // Minutes\r\n    if (str.slice(0, 10) === nowZ.slice(0, 10) && !noTime) {\r\n      return str.slice(11, 16)\r\n    }\r\n    if (str.slice(0, 4) === nowZ.slice(0, 4)) {\r\n      return (\r\n        month[parseInt(str.slice(5, 7), 10) - 1] +\r\n        ' ' +\r\n        parseInt(str.slice(8, 10), 10)\r\n      )\r\n    }\r\n    return str.slice(0, 10)\r\n  } catch (e) {\r\n    return 'shortdate:' + e\r\n  }\r\n}\r\n\r\n/**\r\n * Format a date and time\r\n * @param date for instance `new Date()`\r\n * @param format  for instance '{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\r\n * @returns for instance '2000-01-15T23:14:23.002'\r\n */\r\nfunction formatDateTime (date: Date, format: string): string {\r\n  return format\r\n    .split('{')\r\n    .map(function (s) {\r\n      var k = s.split('}')[0]\r\n      var width = { Milliseconds: 3, FullYear: 4 }\r\n      var d = { Month: 1 }\r\n      return s\r\n        ? ('000' + (date['get' + k]() + (d[k] || 0))).slice(-(width[k] || 2)) + s.split('}')[1]\r\n        : ''\r\n    })\r\n    .join('')\r\n}\r\n\r\n/**\r\n * Get a string representation of the current time\r\n * @returns for instance '2000-01-15T23:14:23.002'\r\n */\r\nfunction timestamp (): string {\r\n  return formatDateTime(\r\n    new Date(),\r\n    '{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\r\n  )\r\n}\r\n\r\n/**\r\n * Get a short string representation of the current time\r\n * @returns for instance '23:14:23.002'\r\n */\r\nfunction shortTime (): string {\r\n  return formatDateTime(\r\n    new Date(),\r\n    '{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\r\n  )\r\n}\r\n\r\n// ///////////////////// Handy UX widgets\r\n\r\n/**\r\n * Sets the best name we have and looks up a better one\r\n */\r\nfunction setName (element: HTMLElement, x: NamedNode) {\r\n  var kb = UI.store\r\n  var ns = UI.ns\r\n  var findName = function (x) {\r\n    var name =\r\n      kb.any(x, ns.vcard('fn')) ||\r\n      kb.any(x, ns.foaf('name')) ||\r\n      kb.any(x, ns.vcard('organization-name'))\r\n    return name ? name.value : null\r\n  }\r\n  var name = x.sameTerm(ns.foaf('Agent')) ? 'Everyone' : findName(x)\r\n  element.textContent = name || utils.label(x)\r\n  if (!name && x.uri) {\r\n    // Note this is only a fetch, not a lookUP of all sameAs etc\r\n    kb.fetcher.nowOrWhenFetched(x.doc(), undefined, function (_ok) {\r\n      element.textContent = findName(x) || utils.label(x) // had: (ok ? '' : '? ') +\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Set of suitable images\r\n * See also [[findImage]]\r\n * @param x The thing for which we want to find an image\r\n * @param kb The RDF store to look in\r\n * @returns It goes looking for triples in `kb`,\r\n *          `(subject: x), (predicate: see list below) (object: image-url)`\r\n *          to find any image linked from the thing with one of the following\r\n *          predicates (in order):\r\n *          * ns.sioc('avatar')\r\n *          * ns.foaf('img')\r\n *          * ns.vcard('logo')\r\n *          * ns.vcard('hasPhoto')\r\n *          * ns.vcard('photo')\r\n *          * ns.foaf('depiction')\r\n\r\n */\r\nfunction imagesOf (x: NamedNode, kb: IndexedFormula): any[] {\r\n  var ns = UI.ns\r\n  return kb\r\n    .each(x, ns.sioc('avatar'))\r\n    .concat(kb.each(x, ns.foaf('img')))\r\n    .concat(kb.each(x, ns.vcard('logo')))\r\n    .concat(kb.each(x, ns.vcard('hasPhoto')))\r\n    .concat(kb.each(x, ns.vcard('photo')))\r\n    .concat(kb.each(x, ns.foaf('depiction')))\r\n}\r\n\r\n/**\r\n * Best logo or avatar or photo etc to represent someone or some group etc\r\n */\r\nconst iconForClass = {\r\n  // Potentially extendable by other apps, panes, etc\r\n  // Relative URIs to the iconBase\r\n  'solid:AppProviderClass': 'noun_144.svg', //  @@ classs name should not contain 'Class'\r\n  'solid:AppProvider': 'noun_15177.svg', // @@\r\n  'solid:Pod': 'noun_Cabinet_1434380.svg',\r\n  'vcard:Group': 'noun_339237.svg',\r\n  'vcard:Organization': 'noun_143899.svg',\r\n  'vcard:Individual': 'noun_15059.svg',\r\n  'schema:Person': 'noun_15059.svg',\r\n  'foaf:Person': 'noun_15059.svg',\r\n  'foaf:Agent': 'noun_98053.svg',\r\n  'acl:AuthenticatedAgent': 'noun_99101.svg',\r\n  'prov:SoftwareAgent': 'noun_Robot_849764.svg', // Bot\r\n  'vcard:AddressBook': 'noun_15695.svg',\r\n  'trip:Trip': 'noun_581629.svg',\r\n  'meeting:LongChat': 'noun_1689339.svg',\r\n  'meeting:Meeting': 'noun_66617.svg',\r\n  'meeting:Project': 'noun_1036577.svg',\r\n  'ui:Form': 'noun_122196.svg',\r\n  'rdfs:Class': 'class-rectangle.svg', // For RDF developers\r\n  'rdf:Property': 'property-diamond.svg',\r\n  'owl:Ontology': 'noun_classification_1479198.svg'\r\n}\r\n\r\n/**\r\n * Returns the origin of the URI of a NamedNode\r\n */\r\nfunction tempSite (x: NamedNode) {\r\n  // use only while one in rdflib fails with origins 2019\r\n  var str = x.uri.split('#')[0]\r\n  var p = str.indexOf('//')\r\n  if (p < 0) throw new Error('This URI does not have a web site part (origin)')\r\n  var q = str.indexOf('/', p + 2)\r\n  if (q < 0) {\r\n    // no third slash?\r\n    return str.slice(0) + '/' // Add slash to a bare origin\r\n  } else {\r\n    return str.slice(0, q + 1)\r\n  }\r\n}\r\n\r\n/**\r\n * Find an image for this thing as a class\r\n */\r\nfunction findImageFromURI (x: NamedNode): string | null {\r\n  const iconDir = UI.icons.iconBase\r\n\r\n  // Special cases from URI scheme:\r\n  if (x.uri) {\r\n    if (\r\n      x.uri.split('/').length === 4 &&\r\n      !x.uri.split('/')[1] &&\r\n      !x.uri.split('/')[3]\r\n    ) {\r\n      return iconDir + 'noun_15177.svg' // App -- this is an origin\r\n    }\r\n    // Non-HTTP URI types imply types\r\n    if (x.uri.startsWith('message:') || x.uri.startsWith('mid:')) {\r\n      // message: is apple bug-- should be mid:\r\n      return iconDir + 'noun_480183.svg' // envelope  noun_567486\r\n    }\r\n    if (x.uri.startsWith('mailto:')) {\r\n      return iconDir + 'noun_567486.svg' // mailbox - an email desitination\r\n    }\r\n    // For HTTP(s) documents, we could look at the MIME type if we know it.\r\n    if (x.uri.startsWith('https:') && x.uri.indexOf('#') < 0) {\r\n      return tempSite(x) + 'favicon.ico' // was x.site().uri + ...\r\n      // Todo: make the document icon a fallback for if the favicon does not exist\r\n      // todo: pick up a possible favicon for the web page itself from a link\r\n      // was: return iconDir + 'noun_681601.svg' // document - under solid assumptions\r\n    }\r\n    return null\r\n  }\r\n\r\n  return iconDir + 'noun_10636_grey.svg' // Grey Circle -  some thing\r\n}\r\n\r\n/**\r\n * Find something we have as explicit image data for the thing\r\n * See also [[imagesOf]]\r\n * @param thing The thing for which we want to find an image\r\n * @returns The URL of a globe icon if thing equals `ns.foaf('Agent')`\r\n *          or `ns.rdf('Resource')`. Otherwise, it goes looking for\r\n *          triples in `UI.store`,\r\n *          `(subject: thing), (predicate: see list below) (object: image-url)`\r\n *          to find any image linked from the thing with one of the following\r\n *          predicates (in order):\r\n *          * ns.sioc('avatar')\r\n *          * ns.foaf('img')\r\n *          * ns.vcard('logo')\r\n *          * ns.vcard('hasPhoto')\r\n *          * ns.vcard('photo')\r\n *          * ns.foaf('depiction')\r\n */\r\nfunction findImage (thing: NamedNode): string {\r\n  const kb = UI.store\r\n  const ns = UI.ns\r\n  const iconDir = UI.icons.iconBase\r\n  if (thing.sameTerm(ns.foaf('Agent')) || thing.sameTerm(ns.rdf('Resource'))) {\r\n    return iconDir + 'noun_98053.svg' // Globe\r\n  }\r\n  const image =\r\n    kb.any(thing, ns.sioc('avatar')) ||\r\n    kb.any(thing, ns.foaf('img')) ||\r\n    kb.any(thing, ns.vcard('logo')) ||\r\n    kb.any(thing, ns.vcard('hasPhoto')) ||\r\n    kb.any(thing, ns.vcard('photo')) ||\r\n    kb.any(thing, ns.foaf('depiction'))\r\n  return image ? image.uri : null\r\n}\r\n\r\n/**\r\n * Do the best you can with the data available\r\n *\r\n * @return {Boolean} Are we happy with this icon?\r\n * Sets src AND STYLE of the image.\r\n */\r\nfunction trySetImage (element, thing, iconForClassMap) {\r\n  const kb = UI.store\r\n\r\n  const explitImage = findImage(thing)\r\n  if (explitImage) {\r\n    element.setAttribute('src', explitImage)\r\n    return true\r\n  }\r\n  // This is one of the classes we know about - the class itself?\r\n  const typeIcon = iconForClassMap[thing.uri]\r\n  if (typeIcon) {\r\n    element.setAttribute('src', typeIcon)\r\n    element.style = UI.style.classIconStyle\r\n    // element.style.border = '0.1em solid green;'\r\n    // element.style.backgroundColor = '#eeffee' // pale green\r\n    return true\r\n  }\r\n  const schemeIcon = findImageFromURI(thing)\r\n  if (schemeIcon) {\r\n    element.setAttribute('src', schemeIcon)\r\n    return true // happy with this -- don't look it up\r\n  }\r\n\r\n  // Do we have a generic icon for something in any class its in?\r\n  const types = kb.findTypeURIs(thing)\r\n  for (var typeURI in types) {\r\n    if (iconForClassMap[typeURI]) {\r\n      element.setAttribute('src', iconForClassMap[typeURI])\r\n      return false // maybe we can do better\r\n    }\r\n  }\r\n  element.setAttribute('src', UI.icons.iconBase + 'noun_10636_grey.svg') // Grey Circle -  some thing\r\n  return false // we can do better\r\n}\r\n\r\n/**\r\n * ToDo: Also add icons for *properties* like  home, work, email, range, domain, comment,\r\n */\r\nfunction setImage (element: HTMLElement, thing: NamedNode) { // 20191230a\r\n  const kb = UI.store\r\n  const ns = UI.ns\r\n\r\n  var iconForClassMap = {}\r\n  for (var k in iconForClass) {\r\n    const pref = k.split(':')[0]\r\n    const id = k.split(':')[1]\r\n    const klass = ns[pref](id)\r\n    iconForClassMap[klass.uri] = $rdf.uri.join(iconForClass[k], UI.icons.iconBase)\r\n  }\r\n\r\n  const happy = trySetImage(element, thing, iconForClassMap)\r\n  if (!happy && thing.uri) {\r\n    kb.fetcher.nowOrWhenFetched(thing.doc(), undefined, (ok) => {\r\n      if (ok) {\r\n        trySetImage(element, thing, iconForClassMap)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n// If a web page then a favicon with a fallback to\r\n// See eg http://stackoverflow.com/questions/980855/inputting-a-default-image\r\nfunction faviconOrDefault (dom: HTMLDocument, x: NamedNode) {\r\n  var image = dom.createElement('img')\r\n  ;(image as any).style = UI.style.iconStyle\r\n  var isOrigin = function (x) {\r\n    if (!x.uri) return false\r\n    var parts = x.uri.split('/')\r\n    return parts.length === 3 || (parts.length === 4 && parts[3] === '')\r\n  }\r\n  image.setAttribute(\r\n    'src',\r\n    UI.icons.iconBase + (isOrigin(x) ? 'noun_15177.svg' : 'noun_681601.svg') // App symbol vs document\r\n  )\r\n  if (x.uri && x.uri.startsWith('https:') && x.uri.indexOf('#') < 0) {\r\n    var res = dom.createElement('object') // favico with a fallback of a default image if no favicon\r\n    res.setAttribute('data', tempSite(x) + 'favicon.ico')\r\n    res.setAttribute('type', 'image/x-icon')\r\n    res.appendChild(image) // fallback\r\n    return res\r\n  } else {\r\n    setImage(image, x)\r\n    return image\r\n  }\r\n}\r\n\r\n/**\r\n * Delete button with a check you really mean it\r\n * @@ Supress check if command key held down?\r\n */\r\nfunction deleteButtonWithCheck (\r\n  dom: HTMLDocument,\r\n  container: HTMLElement,\r\n  noun: string,\r\n  deleteFunction: () => any\r\n) {\r\n  var minusIconURI = UI.icons.iconBase + 'noun_2188_red.svg' // white minus in red #cc0000 circle\r\n\r\n  // var delButton = dom.createElement('button')\r\n\r\n  var img = dom.createElement('img')\r\n  img.setAttribute('src', minusIconURI) //  plus sign\r\n  img.setAttribute('style', 'margin: 0.2em; width: 1em; height:1em')\r\n  img.title = 'Remove this ' + noun\r\n  var deleteButtonElt = img\r\n\r\n  container.appendChild(deleteButtonElt)\r\n  container.setAttribute('class', 'hoverControl') // See tabbedtab.css (sigh global CSS)\r\n  deleteButtonElt.setAttribute('class', 'hoverControlHide')\r\n  // delButton.setAttribute('style', 'color: red; margin-right: 0.3em; foat:right; text-align:right')\r\n  deleteButtonElt.addEventListener(\r\n    'click',\r\n    function (_event) {\r\n      container.removeChild(deleteButtonElt) // Ask -- are you sure?\r\n      var cancelButtonElt = dom.createElement('button')\r\n      // cancelButton.textContent = 'cancel'\r\n      cancelButtonElt.setAttribute('style', UI.style.buttonStyle)\r\n      var img = cancelButtonElt.appendChild(dom.createElement('img'))\r\n      img.setAttribute('src', cancelIconURI)\r\n      img.setAttribute('style', UI.style.buttonStyle)\r\n\r\n      container.appendChild(cancelButtonElt).addEventListener(\r\n        'click',\r\n        function (_event) {\r\n          container.removeChild(sureButtonElt)\r\n          container.removeChild(cancelButtonElt)\r\n          container.appendChild(deleteButtonElt)\r\n        },\r\n        false\r\n      )\r\n      var sureButtonElt = dom.createElement('button')\r\n      sureButtonElt.textContent = 'Delete ' + noun\r\n      sureButtonElt.setAttribute('style', UI.style.buttonStyle)\r\n      container.appendChild(sureButtonElt).addEventListener(\r\n        'click',\r\n        function (_event) {\r\n          container.removeChild(sureButtonElt)\r\n          container.removeChild(cancelButtonElt)\r\n          deleteFunction()\r\n        },\r\n        false\r\n      )\r\n    },\r\n    false\r\n  )\r\n  return deleteButtonElt\r\n}\r\n\r\n/*  Make a button\r\n *\r\n * @param dom - the DOM document object\r\n * @Param iconURI - the URI of theb icon to use\r\n * @param text - the tooltip text or possibly button contents text\r\n * @param handler <function> - A handler to called when button is clicked\r\n *\r\n * @returns <dDomElement> - the button\r\n */\r\nfunction button (dom: HTMLDocument, iconURI: string, text: string, handler: (event: any) => void) {\r\n  var button = dom.createElement('button')\r\n  button.setAttribute('type', 'button')\r\n  button.setAttribute('style', UI.style.buttonStyle)\r\n  // button.innerHTML = text  // later, user preferences may make text preferred for some\r\n  var img = button.appendChild(dom.createElement('img'))\r\n  img.setAttribute('src', iconURI)\r\n  img.setAttribute('style', 'width: 2em; height: 2em;') // trial and error. 2em disappears\r\n  img.title = text\r\n  if (handler) {\r\n    button.addEventListener('click', handler, false)\r\n  }\r\n  return button\r\n}\r\n\r\n/*  Make a cancel button\r\n *\r\n * @param dom - the DOM document object\r\n * @param handler <function> - A handler to called when button is clicked\r\n *\r\n * @returns <dDomElement> - the button\r\n */\r\nfunction cancelButton (dom: HTMLDocument, handler: (event: any) => void) {\r\n  return button(dom, cancelIconURI, 'Cancel', handler)\r\n}\r\n\r\n/*  Make a continue button\r\n *\r\n * @param dom - the DOM document object\r\n * @param handler <function> - A handler to called when button is clicked\r\n *\r\n * @returns <dDomElement> - the button\r\n */\r\nfunction continueButton (dom: HTMLDocument, handler: (event: any) => void) {\r\n  return button(dom, checkIconURI, 'Continue', handler)\r\n}\r\n\r\n/* Grab a name for a new thing\r\n *\r\n * Form to get the name of a new thing before we create it\r\n * @params klass  Misspelt to avoid clashing with the JavaScript keyword\r\n * @returns: a promise of (a name or null if cancelled)\r\n */\r\nfunction askName (\r\n  dom: HTMLDocument,\r\n  kb: IndexedFormula,\r\n  container: HTMLDocument,\r\n  predicate?: NamedNode,\r\n  klass?: NamedNode,\r\n  noun?: string) {\r\n  // eslint-disable-next-line promise/param-names\r\n  return new Promise(function (resolve, _reject) {\r\n    var form = dom.createElement('div') // form is broken as HTML behaviour can resurface on js error\r\n    // classLabel = utils.label(ns.vcard('Individual'))\r\n    predicate = predicate || UI.ns.foaf('name') // eg 'name' in user's language\r\n    noun = noun || (klass ? utils.label(klass) : '  ') // eg 'folder' in users's language\r\n    var prompt = noun + ' ' + utils.label(predicate) + ': '\r\n    form.appendChild(dom.createElement('p')).textContent = prompt\r\n    var namefield = dom.createElement('input')\r\n    namefield.setAttribute('type', 'text')\r\n    namefield.setAttribute('size', '100')\r\n    namefield.setAttribute('maxLength', '2048') // No arbitrary limits\r\n    namefield.setAttribute('style', UI.style.textInputStyle)\r\n    namefield.select() // focus next user input\r\n    form.appendChild(namefield)\r\n    container.appendChild(form)\r\n\r\n    // namefield.focus()\r\n\r\n    function gotName () {\r\n      ((form as HTMLElement).parentNode as HTMLElement).removeChild(form)\r\n      resolve(namefield.value.trim())\r\n    }\r\n\r\n    namefield.addEventListener('keyup', function (e) {\r\n      if (e.keyCode === 13) {\r\n        gotName()\r\n      }\r\n    }, false)\r\n\r\n    form.appendChild(dom.createElement('br'))\r\n\r\n    form.appendChild(cancelButton(dom, function (_event) {\r\n      ((form as HTMLElement).parentNode as HTMLElement).removeChild(form)\r\n      resolve(null)\r\n    }))\r\n\r\n    form.appendChild(continueButton(dom, function (_event) {\r\n      gotName()\r\n    }))\r\n    namefield.focus()\r\n  }) // Promise\r\n}\r\n\r\n// ////////////////////////////////////////////////////////////////\r\n\r\n/**\r\n * A little link icon\r\n */\r\nfunction linkIcon (dom: HTMLDocument, subject: NamedNode, iconURI?: string): HTMLElement {\r\n  var anchor = dom.createElement('a')\r\n  anchor.setAttribute('href', subject.uri)\r\n  if (subject.uri.startsWith('http')) {\r\n    // If diff web page\r\n    anchor.setAttribute('target', '_blank') // open in a new tab or window\r\n  } // as mailboxes and mail messages do not need new browser window\r\n  var img = anchor.appendChild(dom.createElement('img'))\r\n  img.setAttribute(\r\n    'src',\r\n    iconURI || UI.icons.originalIconBase + 'go-to-this.png'\r\n  )\r\n  img.setAttribute('style', 'margin: 0.3em;')\r\n  return anchor\r\n}\r\n\r\n/**\r\n * A TR to repreent a draggable person, etc in a list\r\n *\r\n * pred is unused param at the moment\r\n */\r\nfunction personTR (dom: HTMLDocument, pred: NamedNode, obj: NamedNode, options: any): HTMLTableRowElement {\r\n  var tr = dom.createElement('tr')\r\n  options = options || {}\r\n  // tr.predObj = [pred.uri, obj.uri]   moved to acl-control\r\n  var td1 = tr.appendChild(dom.createElement('td'))\r\n  var td2 = tr.appendChild(dom.createElement('td'))\r\n  var td3 = tr.appendChild(dom.createElement('td'))\r\n\r\n  // var image = td1.appendChild(dom.createElement('img'))\r\n  var image = faviconOrDefault(dom, obj)\r\n\r\n  td1.setAttribute('style', 'vertical-align: middle; width:2.5em; padding:0.5em; height: 2.5em;')\r\n  td2.setAttribute('style', 'vertical-align: middle; text-align:left;')\r\n  td3.setAttribute('style', 'vertical-align: middle; width:2em; padding:0.5em; height: 4em;')\r\n  td1.appendChild(image)\r\n\r\n  setName(td2, obj)\r\n  if (options.deleteFunction) {\r\n    deleteButtonWithCheck(dom, td3, options.noun || 'one', options.deleteFunction)\r\n  }\r\n  if (obj.uri) {\r\n    // blank nodes need not apply\r\n    if (options.link !== false) {\r\n      var anchor = td3.appendChild(linkIcon(dom, obj))\r\n      anchor.classList.add('HoverControlHide')\r\n      td3.appendChild(dom.createElement('br'))\r\n    }\r\n    if (options.draggable !== false) {\r\n      // default is on\r\n      image.setAttribute('draggable', 'false') // Stop the image being dragged instead - just the TR\r\n      dragAndDrop.makeDraggable(tr, obj)\r\n    }\r\n  }\r\n  ;(tr as any).subject = obj\r\n  return tr\r\n}\r\n\r\n/**\r\n * Refresh a DOM tree recursively\r\n */\r\nfunction refreshTree (root: any): void {\r\n  if (root.refresh) {\r\n    root.refresh()\r\n    return\r\n  }\r\n  for (var i = 0; i < root.children.length; i++) {\r\n    refreshTree(root.children[i])\r\n  }\r\n}\r\n\r\n/**\r\n * Options argument for [[attachmentList]] function\r\n */\r\nexport type attachmentListOptions = {\r\n  doc?: NamedNode\r\n  modify?: boolean\r\n  promptIcon?: string\r\n  predicate?: NamedNode\r\n  noun?: string\r\n}\r\n\r\n/**\r\n * Component that displays a list of resources, for instance\r\n * the attachments of a message, or the various documents related\r\n * to a meeting.\r\n * Accepts dropping URLs onto it to add attachments to it.\r\n */\r\nfunction attachmentList (dom: HTMLDocument, subject: NamedNode, div: HTMLElement, options?: attachmentListOptions) {\r\n  options = options || {}\r\n  var doc = options.doc || subject.doc()\r\n  if (options.modify === undefined) options.modify = true\r\n  var modify = options.modify\r\n  var promptIcon: string = options.promptIcon || (UI.icons.iconBase + 'noun_748003.svg' as string) //    target\r\n  // var promptIcon = options.promptIcon || (UI.icons.iconBase + 'noun_25830.svg') //  paperclip\r\n  var predicate = options.predicate || UI.ns.wf('attachment')\r\n  var noun = options.noun || 'attachment'\r\n\r\n  var kb = UI.store\r\n  var attachmentOuter = div.appendChild(dom.createElement('table'))\r\n  attachmentOuter.setAttribute('style', 'margin-top: 1em; margin-bottom: 1em;')\r\n  var attachmentOne = attachmentOuter.appendChild(dom.createElement('tr'))\r\n  var attachmentLeft = attachmentOne.appendChild(dom.createElement('td'))\r\n  var attachmentRight = attachmentOne.appendChild(dom.createElement('td'))\r\n  var attachmentTable = attachmentRight.appendChild(dom.createElement('table'))\r\n  attachmentTable.appendChild(dom.createElement('tr')) // attachmentTableTop\r\n\r\n  var deleteAttachment = function (target) {\r\n    kb.updater.update($rdf.st(subject, predicate, target, doc), [], function (\r\n      uri,\r\n      ok,\r\n      errorBody,\r\n      _xhr\r\n    ) {\r\n      if (ok) {\r\n        refresh()\r\n      } else {\r\n        complain(undefined, 'Error deleting one: ' + errorBody)\r\n      }\r\n    })\r\n  }\r\n  var createNewRow = function (target) {\r\n    var theTarget = target\r\n    var opt: any = { noun: noun }\r\n    if (modify) {\r\n      opt.deleteFunction = function () {\r\n        deleteAttachment(theTarget)\r\n      }\r\n    }\r\n    return personTR(dom, predicate, target, opt)\r\n  }\r\n  var refresh = ((attachmentTable as any).refresh = function () {\r\n    var things = kb.each(subject, predicate)\r\n    things.sort()\r\n    utils.syncTableToArray(attachmentTable, things, createNewRow)\r\n  })\r\n  ;(attachmentOuter as any).refresh = refresh // Participate in downstream changes\r\n  refresh()\r\n\r\n  var droppedURIHandler = function (uris) {\r\n    var ins: any = []\r\n    uris.map(function (u) {\r\n      var target = $rdf.sym(u) // Attachment needs text label to disinguish I think not icon.\r\n      console.log('Dropped on attachemnt ' + u) // icon was: UI.icons.iconBase + 'noun_25830.svg'\r\n      ins.push($rdf.st(subject, predicate, target, doc))\r\n    })\r\n    kb.updater.update([], ins, function (uri, ok, errorBody, _xhr) {\r\n      if (ok) {\r\n        refresh()\r\n      } else {\r\n        complain(undefined, 'Error adding one: ' + errorBody)\r\n      }\r\n    })\r\n  }\r\n  if (modify) {\r\n    var paperclip = attachmentLeft.appendChild(dom.createElement('img'))\r\n    paperclip.setAttribute('src', promptIcon)\r\n    paperclip.setAttribute('style', 'width; 2em; height: 2em; margin: 0.5em;')\r\n    paperclip.setAttribute('draggable', 'false')\r\n\r\n    dragAndDrop.makeDropTarget(attachmentLeft, droppedURIHandler)\r\n  }\r\n  return attachmentOuter\r\n}\r\n\r\n// /////////////////////////////////////////////////////////////////////////////\r\n\r\n/**\r\n * Event Handler for links within solid apps.\r\n *\r\n * Note that native links have constraints in Firefox, they\r\n * don't work with local files for instance (2011)\r\n */\r\nfunction openHrefInOutlineMode (e: Event) {\r\n  e.preventDefault()\r\n  e.stopPropagation()\r\n  var target = utils.getTarget(e)\r\n  var uri = target.getAttribute('href')\r\n  if (!uri) return console.log('openHrefInOutlineMode: No href found!\\n')\r\n  const dom = window.document\r\n  if ((dom as any).outlineManager) {\r\n    // @@ TODO Remove the use of document as a global object\r\n    ;(dom as any).outlineManager.GotoSubject(UI.store.sym(uri), true, undefined, true, undefined)\r\n  } else if (window && (window as any).panes && (window as any).panes.getOutliner) {\r\n    // @@ TODO Remove the use of window as a global object\r\n    ;(window as any).panes\r\n      .getOutliner()\r\n      .GotoSubject(UI.store.sym(uri), true, undefined, true, undefined)\r\n  } else {\r\n    console.log('ERROR: Can\\'t access outline manager in this config')\r\n  }\r\n  // dom.outlineManager.GotoSubject(UI.store.sym(uri), true, undefined, true, undefined)\r\n}\r\n\r\n/**\r\n * Make a URI in the Tabulator.org annotation store out of the URI of the thing to be annotated.\r\n *\r\n * @@ Todo: make it a personal preference.\r\n */\r\nfunction defaultAnnotationStore (subject) {\r\n  if (subject.uri === undefined) return undefined\r\n  var s = subject.uri\r\n  if (s.slice(0, 7) !== 'http://') return undefined\r\n  s = s.slice(7) // Remove\r\n  var hash = s.indexOf('#')\r\n  if (hash >= 0) s = s.slice(0, hash)\r\n  // Strip trailing\r\n  else {\r\n    var slash = s.lastIndexOf('/')\r\n    if (slash < 0) return undefined\r\n    s = s.slice(0, slash)\r\n  }\r\n  return UI.store.sym('http://tabulator.org/wiki/annnotation/' + s)\r\n}\r\n\r\n/**\r\n * Retrieve all RDF class URIs from solid-ui's RDF store\r\n * @returns an object `ret` such that `Object.keys(ret)` is\r\n * the list of all class URIs.\r\n */\r\nfunction allClassURIs (): { [uri: string]: boolean } {\r\n  var set = {}\r\n  UI.store\r\n    .statementsMatching(undefined, UI.ns.rdf('type'), undefined)\r\n    .map(function (st) {\r\n      if (st.object.uri) set[st.object.uri] = true\r\n    })\r\n  UI.store\r\n    .statementsMatching(undefined, UI.ns.rdfs('subClassOf'), undefined)\r\n    .map(function (st) {\r\n      if (st.object.uri) set[st.object.uri] = true\r\n      if (st.subject.uri) set[st.subject.uri] = true\r\n    })\r\n  UI.store\r\n    .each(undefined, UI.ns.rdf('type'), UI.ns.rdfs('Class'))\r\n    .map(function (c) {\r\n      if (c.uri) set[c.uri] = true\r\n    })\r\n  return set\r\n}\r\n\r\n/**\r\n * Figuring which properties we know about\r\n *\r\n * When the user inputs an RDF property, like for a form field\r\n * or when specifying the relationship between two arbitrary things,\r\n * then er can prompt them with properties the session knows about\r\n *\r\n * TODO: Look again by catching this somewhere. (On the kb?)\r\n * TODO: move to diff module? Not really a button.\r\n * @param {Store} kb The quadstore to be searched.\r\n */\r\n\r\nfunction propertyTriage (kb: IndexedFormula): any {\r\n  var possibleProperties: any = {}\r\n  // if (possibleProperties === undefined) possibleProperties = {}\r\n  // var kb = UI.store\r\n  var dp = {}\r\n  var op = {}\r\n  var no = 0\r\n  var nd = 0\r\n  var nu = 0\r\n  var pi = (kb as any).predicateIndex // One entry for each pred\r\n  for (var p in pi) {\r\n    var object = pi[p][0].object\r\n    if (object.termType === 'Literal') {\r\n      dp[p] = true\r\n      nd++\r\n    } else {\r\n      op[p] = true\r\n      no++\r\n    }\r\n  } // If nothing discovered, then could be either:\r\n  var ps = kb.each(undefined, UI.ns.rdf('type'), UI.ns.rdf('Property'))\r\n  for (var i = 0; i < ps.length; i++) {\r\n    p = ps[i].toNT()\r\n    // UI.log.debug('propertyTriage: unknown: ' + p)\r\n    if (!op[p] && !dp[p]) {\r\n      dp[p] = true\r\n      op[p] = true\r\n      nu++\r\n    }\r\n  }\r\n  possibleProperties.op = op\r\n  possibleProperties.dp = dp\r\n  UI.log.info(`propertyTriage: ${no} non-lit, ${nd} literal. ${nu} unknown.`)\r\n  return possibleProperties\r\n}\r\n\r\n/**\r\n * General purpose widgets\r\n */\r\n\r\n/**\r\n * A button for jumping\r\n */\r\nfunction linkButton (dom: HTMLDocument, object: NamedNode): HTMLElement {\r\n  var b = dom.createElement('button')\r\n  b.setAttribute('type', 'button')\r\n  b.textContent = 'Goto ' + utils.label(object)\r\n  b.addEventListener('click', function (_event) {\r\n    // b.parentNode.removeChild(b)\r\n    ;(dom as any).outlineManager.GotoSubject(object, true, undefined, true, undefined)\r\n  }, true)\r\n  return b\r\n}\r\n\r\n/**\r\n * A button to remove some other element from the page\r\n */\r\nfunction removeButton (dom: HTMLDocument, element: HTMLElement) {\r\n  var b = dom.createElement('button')\r\n  b.setAttribute('type', 'button')\r\n  b.textContent = '✕' // MULTIPLICATION X\r\n  b.addEventListener('click', function (_event) {\r\n    ;(element as any).parentNode.removeChild(element)\r\n  }, true)\r\n  return b\r\n}\r\n\r\n//      Description text area\r\n//\r\n// Make a box to demand a description or display existing one\r\n//\r\n// @param dom - the document DOM for the user interface\r\n// @param kb - the graph which is the knowledge base we are working with\r\n// @param subject - a term, the subject of the statement(s) being edited.\r\n// @param predicate - a term, the predicate of the statement(s) being edited\r\n// @param store - The web document being edited\r\n// @param callbackFunction - takes (boolean ok, string errorBody)\r\n\r\n// /////////////////////////////////////// Random I/O widgets /////////////\r\n\r\n// ////              Column Header Buttons\r\n//\r\n//  These are for selecting different modes, sources,styles, etc.\r\n//\r\n/*\r\nbuttons.headerButtons = function (dom, kb, name, words) {\r\n    var box = dom.createElement('table')\r\n    var i, word, s = '<tr>'\r\n    box.setAttribute('style', 'width: 90%; height: 1.5em')\r\n    for (i=0; i<words.length; i++) {\r\n        s += '<td><input type=\"radio\" name=\"' + name + '\" id=\"' + words[i] + '\" value='\r\n    }\r\n    box.innerHTML = s + '</tr>'\r\n\r\n}\r\n*/\r\n// ////////////////////////////////////////////////////////////\r\n//\r\n//     selectorPanel\r\n//\r\n//  A vertical panel for selecting connections to left or right.\r\n//\r\n//   @param inverse means this is the object rather than the subject\r\n//\r\nfunction selectorPanel (\r\n  dom: HTMLDocument,\r\n  kb: IndexedFormula,\r\n  type: NamedNode,\r\n  predicate: NamedNode,\r\n  inverse: boolean,\r\n  possible: NamedNode[],\r\n  options: { connectIcon?: string },\r\n  callbackFunction: (x: NamedNode, e: Event, selected: boolean) => void,\r\n  linkCallback: (x: NamedNode, e: Event, inverse: boolean, setStyleFunction: () => void) => void\r\n) {\r\n  return selectorPanelRefresh(\r\n    dom.createElement('div'),\r\n    dom,\r\n    kb,\r\n    type,\r\n    predicate,\r\n    inverse,\r\n    possible,\r\n    options,\r\n    callbackFunction,\r\n    linkCallback\r\n  )\r\n}\r\n\r\nfunction selectorPanelRefresh (\r\n  list: HTMLElement,\r\n  dom: HTMLDocument,\r\n  kb: IndexedFormula,\r\n  type: NamedNode,\r\n  predicate: NamedNode,\r\n  inverse: boolean,\r\n  possible: NamedNode[],\r\n  options: { connectIcon?: string },\r\n  callbackFunction: (x: NamedNode, e: Event, selected: boolean) => void,\r\n  linkCallback: (x: NamedNode, e: Event, inverse: boolean, setStyleFunction: () => void) => void\r\n) {\r\n  var style0 =\r\n    'border: 0.1em solid #ddd; border-bottom: none; width: 95%; height: 2em; padding: 0.5em;'\r\n  var selected: any = null\r\n  list.innerHTML = ''\r\n\r\n  var refreshItem = function (box: HTMLElement, x: NamedNode) {\r\n    // Scope to hold item and x\r\n    var item, image\r\n\r\n    var setStyle = function () {\r\n      var already = inverse\r\n        ? kb.each(undefined, predicate, x)\r\n        : kb.each(x, predicate)\r\n      iconDiv.setAttribute('class', already.length === 0 ? 'hideTillHover' : '') // See tabbedtab.css\r\n      image.setAttribute(\r\n        'src',\r\n        options.connectIcon || UI.icons.iconBase + 'noun_25830.svg'\r\n      )\r\n      image.setAttribute('title', already.length ? already.length : 'attach')\r\n    }\r\n    var f = index.twoLine.widgetForClass(type)\r\n    item = f(dom, x)\r\n    item.setAttribute('style', style0)\r\n\r\n    var nav = dom.createElement('div')\r\n    nav.setAttribute('class', 'hideTillHover') // See tabbedtab.css\r\n    nav.setAttribute('style', 'float:right; width:10%')\r\n\r\n    var a = dom.createElement('a')\r\n    a.setAttribute('href', x.uri)\r\n    a.setAttribute('style', 'float:right')\r\n    nav.appendChild(a).textContent = '>'\r\n    box.appendChild(nav)\r\n\r\n    var iconDiv = dom.createElement('div')\r\n    iconDiv.setAttribute(\r\n      'style',\r\n      (inverse ? 'float:left;' : 'float:right;') + ' width:30px;'\r\n    )\r\n    image = dom.createElement('img')\r\n    setStyle()\r\n    iconDiv.appendChild(image)\r\n    box.appendChild(iconDiv)\r\n\r\n    item.addEventListener('click', function (event) {\r\n      if (selected === item) {\r\n        // deselect\r\n        item.setAttribute('style', style0)\r\n        selected = null\r\n      } else {\r\n        if (selected) selected.setAttribute('style', style0)\r\n        item.setAttribute(\r\n          'style',\r\n          style0 + 'background-color: #ccc; color:black;'\r\n        )\r\n        selected = item\r\n      }\r\n      callbackFunction(x, event, selected === item)\r\n      setStyle()\r\n    }, false)\r\n\r\n    image.addEventListener('click', function (event) {\r\n      linkCallback(x, event, inverse, setStyle)\r\n    }, false)\r\n\r\n    box.appendChild(item)\r\n    return box\r\n  }\r\n\r\n  for (var i = 0; i < possible.length; i++) {\r\n    var box = dom.createElement('div')\r\n    list.appendChild(box)\r\n    refreshItem(box, possible[i])\r\n  }\r\n  return list\r\n}\r\n\r\n// ###########################################################################\r\n//\r\n//      Small compact views of things\r\n//\r\nlet index: any = {}\r\n// ///////////////////////////////////////////////////////////////////////////\r\n// We need these for anything which is a subject of an attachment.\r\n//\r\n// These should be moved to type-dependeent UI code. Related panes maybe\r\n\r\nfunction twoLineDefault (dom: HTMLDocument, x: NamedNode): HTMLElement {\r\n  // Default\r\n  var box = dom.createElement('div')\r\n  box.textContent = utils.label(x)\r\n  return box\r\n}\r\n\r\n/**\r\n * Find a function that can create a widget for a given class\r\n * @param c The RDF class for which we want a widget generator function\r\n */\r\nfunction twoLineWidgetForClass (c: NamedNode): (dom: HTMLDocument, x: NamedNode) => HTMLElement {\r\n  var widget = index.twoLine[c.uri]\r\n  var kb = UI.store\r\n  if (widget) return widget\r\n  var sup = kb.findSuperClassesNT(c)\r\n  for (var cl in sup) {\r\n    widget = index.twoLine[kb.fromNT(cl).uri]\r\n    if (widget) return widget\r\n  }\r\n  return index.twoLine['']\r\n}\r\n\r\n/**\r\n * Display a transaction\r\n * @param x Should have attributes through triples in UI.store:\r\n *          * ns.qu('payee') -> a named node\r\n *          * ns.qu('date) -> a literal\r\n *          * ns.qu('amount') -> a literal\r\n */\r\nfunction twoLineTransaction (dom: HTMLDocument, x: NamedNode): HTMLElement {\r\n  var failed = ''\r\n  var enc = function (p) {\r\n    var y = UI.store.any(x, UI.ns.qu(p))\r\n    if (!y) failed += '@@ No value for ' + p + '! '\r\n    return y ? utils.escapeForXML(y.value) : '?' // @@@@\r\n  }\r\n  var box = dom.createElement('table')\r\n  box.innerHTML = `\r\n    <tr>\r\n      <td colspan=\"2\">${enc('payee')}</td>\r\n    </tr>\r\n    <tr>\r\n      <td>${enc('date').slice(0, 10)}</td>\r\n      <td style=\"text-align: right;\">${enc('amount')}</td>\r\n    </tr>`\r\n  if (failed) {\r\n    box.innerHTML = `\r\n      <tr>\r\n        <td><a href=\"${utils.escapeForXML(x.uri)}\">${utils.escapeForXML(failed)}</a></td>\r\n      </tr>`\r\n  }\r\n  return box\r\n}\r\n\r\n/**\r\n * Display a trip\r\n * @param x Should have attributes through triples in UI.store:\r\n *          * ns.dc('title') -> a literal\r\n *          * ns.cal('dtstart') -> a literal\r\n *          * ns.cal('dtend') -> a literal\r\n */\r\nfunction twoLineTrip (\r\n  dom: HTMLDocument,\r\n  x: NamedNode\r\n): HTMLElement {\r\n  var enc = function (p) {\r\n    var y = UI.store.any(x, p)\r\n    return y ? utils.escapeForXML(y.value) : '?'\r\n  }\r\n  var box = dom.createElement('table')\r\n  box.innerHTML = `\r\n    <tr>\r\n      <td colspan=\"2\">${enc(UI.ns.dc('title'))}</td>\r\n    </tr>\r\n    <tr style=\"color: #777\">\r\n      <td>${enc(UI.ns.cal('dtstart'))}</td>\r\n      <td>${enc(UI.ns.cal('dtend'))}</td>\r\n    </tr>`\r\n  return box\r\n}\r\n\r\n/**\r\n * Stick a stylesheet link the document if not already there\r\n */\r\nfunction addStyleSheet (dom: HTMLDocument, href: string): void {\r\n  var links = dom.querySelectorAll('link')\r\n  for (var i = 0; i < links.length; i++) {\r\n    if (\r\n      (links[i].getAttribute('rel') || '') === 'stylesheet' &&\r\n      (links[i].getAttribute('href') || '') === href\r\n    ) {\r\n      return\r\n    }\r\n  }\r\n  var link = dom.createElement('link')\r\n  link.setAttribute('rel', 'stylesheet')\r\n  link.setAttribute('type', 'text/css')\r\n  link.setAttribute('href', href)\r\n  dom.getElementsByTagName('head')[0].appendChild(link)\r\n}\r\n\r\n// Figure (or guess) whether this is an image, etc\r\n//\r\nfunction isAudio (file: NamedNode) {\r\n  return isImage(file, 'audio')\r\n}\r\nfunction isVideo (file: NamedNode) {\r\n  return isImage(file, 'video')\r\n}\r\n/**\r\n *\r\n */\r\nfunction isImage (file: NamedNode, kind: string | undefined): boolean {\r\n  var dcCLasses = {\r\n    audio: 'http://purl.org/dc/dcmitype/Sound',\r\n    image: 'http://purl.org/dc/dcmitype/Image',\r\n    video: 'http://purl.org/dc/dcmitype/MovingImage'\r\n  }\r\n  var what = kind || 'image'\r\n  // See https://github.com/linkeddata/rdflib.js/blob/e367d5088c/src/formula.ts#L554\r\n  //\r\n  var typeURIs = UI.store.findTypeURIs(file)\r\n  // See https://github.com/linkeddata/rdflib.js/blob/d5000f/src/utils-js.js#L14\r\n  // e.g.'http://www.w3.org/ns/iana/media-types/audio'\r\n  var prefix: string = $rdf.Util.mediaTypeClass(what + '/*').uri.split('*')[0]\r\n  for (var t in typeURIs) {\r\n    if (t.startsWith(prefix)) return true\r\n  }\r\n  if (dcCLasses[what] in typeURIs) return true\r\n  return false\r\n}\r\n\r\n/**\r\n * File upload button\r\n * @param dom The DOM aka document\r\n * @param  droppedFileHandler Same handler function as drop, takes array of file objects\r\n * @returns {Element} - a div with a button and a inout in it\r\n * The input is hidden, as it is uglky - the user clicks on the nice icons and fires the input.\r\n */\r\n// See https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\r\nfunction fileUploadButtonDiv (\r\n  dom: HTMLDocument,\r\n  droppedFileHandler: (files: FileList) => void\r\n) {\r\n  const div = dom.createElement('div')\r\n  const input = div.appendChild(dom.createElement('input'))\r\n  input.setAttribute('type', 'file')\r\n  input.setAttribute('multiple', 'true')\r\n  input.addEventListener(\r\n    'change',\r\n    (event: any) => {\r\n      console.log('File drop event: ', event)\r\n      if (event.files) {\r\n        droppedFileHandler(event.files)\r\n      } else if (event.target && event.target.files) {\r\n        droppedFileHandler(event.target.files)\r\n      } else {\r\n        alert('Sorry no files .. internal error?')\r\n      }\r\n    },\r\n    false\r\n  )\r\n\r\n  ;(input as any).style = 'display:none'\r\n  const buttonElt = div.appendChild(\r\n    button(\r\n      dom,\r\n      UI.icons.iconBase + 'noun_Upload_76574_000000.svg',\r\n      'Upload files',\r\n      _event => {\r\n        input.click()\r\n      }\r\n    )\r\n  )\r\n  dragAndDrop.makeDropTarget(buttonElt, null, droppedFileHandler) // Can also just drop on button\r\n  return div\r\n}\r\n\r\nindex = {\r\n  line: { // Approx 80em\r\n  },\r\n  twoLine: { // Approx 40em * 2.4em\r\n    '': twoLineDefault,\r\n    'http://www.w3.org/2000/10/swap/pim/qif#Transaction': twoLineTransaction,\r\n    'http://www.w3.org/ns/pim/trip#Trip': twoLineTrip,\r\n    widgetForClass: twoLineWidgetForClass\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  addStyleSheet,\r\n  allClassURIs,\r\n  askName,\r\n  attachmentList,\r\n  button,\r\n  cancelButton,\r\n  clearElement,\r\n  complain,\r\n  continueButton,\r\n  defaultAnnotationStore,\r\n  deleteButtonWithCheck,\r\n  extractLogURI,\r\n  formatDateTime,\r\n  faviconOrDefault,\r\n  fileUploadButtonDiv,\r\n  findImage,\r\n  findImageFromURI,\r\n  iconForClass,\r\n  imagesOf,\r\n  index,\r\n  isAudio,\r\n  isImage,\r\n  isVideo,\r\n  linkButton,\r\n  linkIcon,\r\n  openHrefInOutlineMode,\r\n  personTR,\r\n  propertyTriage,\r\n  refreshTree,\r\n  removeButton,\r\n  shortDate,\r\n  shortTime,\r\n  selectorPanel,\r\n  selectorPanelRefresh,\r\n  setImage,\r\n  setName,\r\n  tempSite,\r\n  timestamp\r\n}\r\n"],"file":"buttons.js"}