{"version":3,"file":"participation.js","names":["_debug","_interopRequireWildcard","require","debug","_rdflib","ns","_widgets","_utils","_pad","style","_styleConstants","_interopRequireDefault","_solidLogic","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_createForOfIteratorHelper","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","_n","F","s","done","value","TypeError","a","u","next","_arrayLikeToArray","toString","slice","constructor","name","from","test","_callSuper","_getPrototypeOf2","_possibleConstructorReturn2","_isNativeReflectConstruct","Reflect","construct","apply","Boolean","prototype","valueOf","ParticipationTableElement","_HTMLTableElement","_this","_classCallCheck2","_len","arguments","args","_key","concat","_defineProperty2","_inherits2","_createClass2","_wrapNativeSuper2","HTMLTableElement","store","solidLogicSingleton","renderParticipants","dom","table","unused1","subject","unused2","options","setAttribute","participantsStyle","newRowForParticipation","parp","person","any","wf","tr","createElement","textContent","bg","anyValue","ui","styleConstants","participationDefaultBackground","block","participantsBlock","backgroundColor","personTR","appendChild","td","personTableTD","insertBefore","firstChild","syncTable","parps","each","map","log","cal","sort","participations","p","syncTableToArray","refresh","participationObject","padDoc","me","Promise","resolve","reject","Error","filter","pn","holds","candidates","_iterator","_step","participation","date","push","err","warn","newThing","ins","st","Date","lightColorHash","updater","update","uri","ok","errorMessage","recordParticipation","refreshable","authn","currentUser","editable","manageParticipation","container","_participation","errorMessageBlock"],"sources":["../src/participation.ts"],"sourcesContent":["/* Manage a UI for the participation of a person in any thing\n*/\n\n// import { currentUser } from './authn/authn'\nimport * as debug from './debug'\nimport { LiveStore, NamedNode, st, UpdateManager } from 'rdflib'\nimport * as ns from './ns'\nimport { personTR, newThing, errorMessageBlock } from './widgets'\nimport { syncTableToArray } from './utils'\nimport { lightColorHash } from './pad'\nimport { log } from './debug'\nimport * as style from './style'\nimport styleConstants from './styleConstants'\nimport { solidLogicSingleton, authn } from 'solid-logic'\n\ntype ParticipationOptions = {\n  deleteFunction?: () => {}\n  link?: string\n  draggable?: boolean\n}\n\nclass ParticipationTableElement extends HTMLTableElement {\n  refresh?: () => void\n}\nconst store = solidLogicSingleton.store as LiveStore\n\n/**  Manage participation in this session\n*\n*  @param {Document} dom - the web page loaded into the browser\n*  @param {HTMLTableElement} table - the table element\n*  @param {NamedNode} unused1/document - the document to render (this argument is no longer used, but left in for backwards compatibility)\n*  @param {NamedNode} subject - the thing in which the participation is happening\n*  @param {NamedNode} unused2/me - user that is logged into the pod (this argument is no longer used, but left in for backwards compatibility)\n*  @param {ParticipationOptions} options - the options that can be passed in are deleteFunction, link, and draggable; these are used by the personTR button\n*/\nexport function renderParticipants (dom: HTMLDocument, table: ParticipationTableElement, unused1: NamedNode, subject: NamedNode, unused2: NamedNode, options: ParticipationOptions) {\n  table.setAttribute('style', style.participantsStyle)\n\n  const newRowForParticipation = function (parp) {\n    const person = store.any(parp, ns.wf('participant'))\n\n    let tr\n    if (!person) {\n      tr = dom.createElement('tr')\n      tr.textContent = '???' // Don't crash - invalid part'n entry\n      return tr\n    }\n    const bg = store.anyValue(parp, ns.ui('backgroundColor')) || styleConstants.participationDefaultBackground\n\n    const block = dom.createElement('div')\n    block.setAttribute(\n      'style', style.participantsBlock)\n    block.style.backgroundColor = bg\n\n    tr = personTR(dom, null, person, options)\n    table.appendChild(tr)\n    const td = dom.createElement('td')\n    td.setAttribute('style', style.personTableTD)\n    td.appendChild(block)\n    tr.insertBefore(td, tr.firstChild)\n    return tr\n  }\n\n  const syncTable = function () {\n    const parps = store.each(subject, ns.wf('participation')).map(function (parp) {\n      log('in participants')\n      return [store.anyValue(parp as any, ns.cal('dtstart')) || '9999-12-31', parp]\n    })\n    parps.sort() // List in order of joining\n    const participations = parps.map(function (p) {\n      return p[1]\n    })\n    syncTableToArray(table, participations, newRowForParticipation)\n  }\n  table.refresh = syncTable\n  syncTable()\n  return table\n}\n\n/** Record, or find old, Participation object\n *\n * A participation object is a place to record things specifically about\n * subject and the user, such as preferences, start of membership, etc\n * @param {NamedNode} subject - the thing in which the participation is happening\n * @param {NamedNode} document -  where to record the data\n * @param {NamedNode} me - the logged in user\n *\n */\nexport function participationObject (subject: NamedNode, padDoc: NamedNode, me: NamedNode) {\n  return new Promise(function (resolve, reject) {\n    if (!me) {\n      throw new Error('No user id')\n    }\n\n    const parps = store.each(subject, ns.wf('participation')).filter(function (pn) {\n      return store.holds(pn, ns.wf('participant'), me)\n    })\n    if (parps.length > 1) { // This can happen. https://github.com/solidos/chat-pane/issues/71\n      const candidates: (string | NamedNode) [][] = []\n      for (const participation of parps) {\n        const date = store.anyValue(participation as NamedNode, ns.cal('dtstart'))\n        if (date) {\n          candidates.push([date, participation as NamedNode])\n        }\n      }\n      candidates.sort() // Pick the earliest\n      // @@ Possibly, for extra credit, delete the others, if we have write access\n      debug.warn('Multiple participation objects, picking earliest, in ' + padDoc)\n      resolve(candidates[0][1])\n      // throw new Error('Multiple records of your participation')\n    }\n    if (parps.length) {\n      // If I am not already recorded\n      resolve(parps[0]) // returns the participation object\n    } else {\n      const participation = newThing(padDoc)\n      const ins = [\n        st(subject, ns.wf('participation'), participation, padDoc),\n\n        st(participation, ns.wf('participant'), me, padDoc),\n        st(participation, ns.cal('dtstart'), new Date() as any, padDoc),\n        st(\n          participation,\n          ns.ui('backgroundColor'),\n          lightColorHash(me) as any,\n          padDoc\n        )\n      ];\n      (store.updater as UpdateManager).update([], ins, function (uri: string | null | undefined, ok: boolean, errorMessage?: string) {\n        if (!ok) {\n          reject(new Error('Error recording your participation: ' + errorMessage))\n        } else {\n          resolve(participation)\n        }\n      })\n      resolve(participation)\n    }\n  })\n}\n\n/** Record my participation and display participants\n *\n * @param {NamedNode} subject - the thing in which participation is happening\n * @param {NamedNode} padDoc - the document into which the participation should be recorded\n * @param {DOMNode} refreshable - a DOM element whose refresh() is to be called if the change works\n *\n */\nexport function recordParticipation (subject: NamedNode, padDoc: NamedNode, refreshable: any) {\n  const me = authn.currentUser()\n  if (!me) return // Not logged in\n\n  const parps = store.each(subject, ns.wf('participation')).filter(function (pn) {\n    return store.holds(pn, ns.wf('participant'), me)\n  })\n  if (parps.length > 1) {\n    throw new Error('Multiple records of your participation')\n  }\n  if (parps.length) {\n    // If I am not already recorded\n    return parps[0] // returns the participation object\n  } else {\n    if (!(store.updater as UpdateManager).editable(padDoc)) {\n      debug.log('Not recording participation, as no write access as ' + me + ' to ' + padDoc)\n      return null\n    }\n    const participation = newThing(padDoc)\n    const ins = [\n      st(subject, ns.wf('participation'), participation, padDoc),\n\n      st(participation, ns.wf('participant'), me, padDoc),\n      st(participation, ns.cal('dtstart'), new Date() as any, padDoc),\n      st(\n        participation,\n        ns.ui('backgroundColor'),\n        lightColorHash(me) as any,\n        padDoc\n      )\n    ];\n    (store.updater as UpdateManager).update([], ins, function (uri: string | null | undefined, ok: boolean, errorMessage?: string) {\n      if (!ok) {\n        throw new Error('Error recording your participation: ' + errorMessage)\n      }\n      if (refreshable && refreshable.refresh) {\n        refreshable.refresh()\n      }\n    })\n    return participation\n  }\n}\n\n/**  Record my participation and display participants\n*\n*   @param {Document} dom  - the web page loaded into the browser\n*   @param {HTMLDivElement} container - the container element where the participants should be displayed\n*   @param {NamedNode} document - the document into which the participation should be shown\n*   @param {NamedNode} subject - the thing in which participation is happening\n*   @param {NamedNode} me - the logged in user\n*   @param {ParticipationOptions} options - the options that can be passed in are deleteFunction, link, and draggable; these are used by the personTR button\n*\n*/\nexport function manageParticipation (\n  dom: Document,\n  container: HTMLDivElement,\n  padDoc: NamedNode,\n  subject: NamedNode,\n  me: NamedNode,\n  options: ParticipationOptions\n) {\n  const table = dom.createElement('table')\n  container.appendChild(table)\n  renderParticipants(dom, table, padDoc, subject, me, options)\n  let _participation\n  try {\n    _participation = recordParticipation(subject, padDoc, table)\n  } catch (e) {\n    container.appendChild(\n      errorMessageBlock(\n        dom,\n        'Error recording your participation: ' + e\n      )\n    ) // Clean up?\n  }\n  return table\n}\n"],"mappings":"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","ignoreList":[]}