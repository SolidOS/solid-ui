{"version":3,"file":"create.js","names":["_solidLogic","require","debug","_interopRequireWildcard","_iconBase","_login","ns","utils","widgets","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","kb","solidLogicSingleton","store","newThingUI","createContext","dataBrowserContext","thePanes","dom","div","me","uri","Error","iconStyle","star","appendChild","createElement","visible","setAttribute","icons","iconBase","complain","message","pre","createTextNode","styleTheIcons","style","iconArray","length","st","disabled","selectTool","icon","selectNewTool","_event","addEventListener","makeNewAppInstance","options","Promise","resolve","reject","selectUI","callbackWS","ws","newBase","ensureLoadedProfile","then","_context","newPaneOptions","assign","folder","undefined","workspace","opt","log","concat","pane","name","mintNew","newInstance","tail","slice","isPackage","includes","add","ldp","sym","doc","refreshTarget","refresh","p","innerHTML","noun","err","pa","mintClass","label","appPathSegment","toUpperCase","selectWorkspace","gotName","endsWith","encodeURIComponent","askName","foaf","mintingPanes","values","filter","mintingClassMap","reduce","classMap","forEach","push","event","iconEle","noIndexHTML"],"sources":["../../src/create/create.ts"],"sourcesContent":["/*   create.js     UI to craete new objects in the solid-app-set world\n **\n */\n\nimport { DataBrowserContext, NewPaneOptions, PaneDefinition } from 'pane-registry'\nimport { solidLogicSingleton } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile, selectWorkspace } from '../login/login'\nimport * as ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { CreateContext, NewAppInstanceOptions } from './types'\n\nconst kb = solidLogicSingleton.store\n\n/*  newThingUI -- return UI for user to select a new object, folder, etc\n **\n ** context must include:  dom, div,\n **     optional:   folder: NamedNode -- the folder where the thing is bring put\n **                (suppresses asking for a full URI or workspace)\n **\n */\nexport function newThingUI (\n  createContext: CreateContext,\n  dataBrowserContext: DataBrowserContext,\n  thePanes: Array<PaneDefinition>\n): void {\n  const dom = createContext.dom\n  const div = createContext.div\n  if (createContext.me && !createContext.me.uri) {\n    throw new Error('newThingUI:  Invalid userid: ' + createContext.me)\n  }\n\n  const iconStyle = 'padding: 0.7em; width: 2em; height: 2em;' // was: 'padding: 1em; width: 3em; height: 3em;'\n  const star = div.appendChild(dom.createElement('img'))\n  let visible = false // the inividual tools tools\n  //   noun_272948.svg = black star\n  // noun_34653_green.svg = green plus\n  star.setAttribute('src', icons.iconBase + 'noun_34653_green.svg')\n  star.setAttribute('style', iconStyle)\n  star.setAttribute('title', 'Add another tool')\n\n  const complain = function complain (message) {\n    const pre = div.appendChild(dom.createElement('pre'))\n    pre.setAttribute('style', 'background-color: pink')\n    pre.appendChild(dom.createTextNode(message))\n  }\n\n  function styleTheIcons (style) {\n    for (let i = 0; i < iconArray.length; i++) {\n      let st = iconStyle + style\n      if (iconArray[i].disabled) {\n        // @@ unused\n        st += 'opacity: 0.3;'\n      }\n      iconArray[i].setAttribute('style', st) // eg 'background-color: #ccc;'\n    }\n  }\n\n  function selectTool (icon) {\n    styleTheIcons('display: none;') // 'background-color: #ccc;'\n    icon.setAttribute('style', iconStyle + 'background-color: yellow;')\n  }\n\n  function selectNewTool (_event?) {\n    visible = !visible\n    star.setAttribute(\n      'style',\n      iconStyle + (visible ? 'background-color: yellow;' : '')\n    )\n    styleTheIcons(visible ? '' : 'display: none;')\n  }\n\n  star.addEventListener('click', selectNewTool)\n\n  function makeNewAppInstance (options: NewAppInstanceOptions) {\n    return new Promise(function (resolve, reject) {\n      let selectUI // , selectUIParent\n      function callbackWS (ws, newBase) {\n        ensureLoadedProfile(createContext).then(\n          _context => {\n            const newPaneOptions: NewPaneOptions = Object.assign({\n              newBase,\n              folder: options.folder || undefined,\n              workspace: ws\n            }, options)\n            for (const opt in options) {\n              // get div, dom, me, folder, pane, refreshTable\n              newPaneOptions[opt] = options[opt]\n            }\n            debug.log(`newThingUI: Minting new ${newPaneOptions.pane.name} at ${newPaneOptions.newBase}`)\n            options.pane\n              .mintNew!(dataBrowserContext, newPaneOptions)\n              .then(function (newPaneOptions) {\n                if (!newPaneOptions || !newPaneOptions.newInstance) {\n                  throw new Error('Cannot mint new - missing newInstance')\n                }\n                if (newPaneOptions.folder) {\n                  const tail = newPaneOptions.newInstance.uri.slice(\n                    newPaneOptions.folder.uri.length\n                  )\n                  const isPackage = tail.includes('/')\n                  debug.log('  new thing is packge? ' + isPackage)\n                  if (isPackage) {\n                    kb.add(\n                      newPaneOptions.folder,\n                      ns.ldp('contains'),\n                      kb.sym(newPaneOptions.newBase),\n                      newPaneOptions.folder.doc()\n                    )\n                  } else {\n                    // single file\n                    kb.add(\n                      newPaneOptions.folder,\n                      ns.ldp('contains'),\n                      newPaneOptions.newInstance,\n                      newPaneOptions.folder.doc()\n                    ) // Ping the patch system?\n                  }\n                  // @ts-ignore @@ TODO check whether refresh can exist here. Either fix type or remove unreachable code\n                  if (newPaneOptions.refreshTarget && newPaneOptions.refreshTarget.refresh) {\n                    // @@ TODO Remove the need to cast as any\n                    ;(newPaneOptions.refreshTarget as any).refresh() // Refresh the containing display\n                  }\n                  // selectUI.parentNode.removeChild(selectUI) It removes itself\n                } else {\n                  const p = options.div.appendChild(dom.createElement('p'))\n                  p.setAttribute('style', 'font-size: 120%;')\n                  // Make link to new thing\n                  p.innerHTML =\n                    \"Your <a target='_blank' href='\" +\n                    newPaneOptions.newInstance.uri +\n                    \"'><b>new \" +\n                    options.noun +\n                    '</b></a> is ready to be set up. ' +\n                    \"<br/><br/><a target='_blank' href='\" +\n                    newPaneOptions.newInstance.uri +\n                    \"'>Go to your new \" +\n                    options.noun +\n                    '.</a>'\n                  // selectUI.parentNode.removeChild(selectUI) // Clean up\n                  // selectUIParent.removeChild(selectUI) // Clean up\n                }\n                selectNewTool() // toggle star to plain and menu vanish again\n              })\n              .catch(function (err) {\n                complain(err)\n                reject(err)\n              })\n          },\n          err => {\n            // login fails\n            complain('Error logging on: ' + err)\n          }\n        )\n      } // callbackWS\n\n      const pa = options.pane\n      // options.appPathSegment = pa.name // was 'edu.mit.solid.pane.'\n      options.noun = pa.mintClass ? utils.label(pa.mintClass) : pa.name\n      options.appPathSegment = options.noun.slice(0, 1).toUpperCase() + options.noun.slice(1)\n\n      if (!options.folder) {\n        // No folder given? Ask user for full URI\n        selectUI = selectWorkspace(dom, {\n          noun: options.noun,\n          appPathSegment: options.appPathSegment\n        }, callbackWS)\n        options.div.appendChild(selectUI)\n        // selectUIParent = options.div\n      } else {\n        const gotName = function (name) {\n          if (!name) {\n            // selectUIParent.removeChild(selectUI)   itremves itself if cancelled\n            selectNewTool() // toggle star to plain and menu vanish again\n          } else {\n            let uri = options.folder!.uri\n            if (!uri.endsWith('/')) {\n              uri = uri + '/'\n            }\n            uri = uri + encodeURIComponent(name) + '/'\n            callbackWS(null, uri)\n          }\n        }\n        widgets\n          .askName(\n            dom,\n            kb,\n            options.div,\n            ns.foaf('name'),\n            null,\n            options.noun\n          )\n          .then(gotName)\n        // selectUI = getNameForm(dom, kb, options.noun, gotName)\n        // options.div.appendChild(selectUI)\n        // selectUIParent = options.div\n      }\n    })\n  } // makeNewAppInstance\n\n  const iconArray: Array<any> = []\n  const mintingPanes = Object.values(thePanes).filter(pane => pane.mintNew)\n  const mintingClassMap = mintingPanes.reduce((classMap, pane) => {\n    if (pane.mintClass) {\n      classMap[pane.mintClass.uri] = (classMap[pane.mintClass.uri] || 0) + 1\n    }\n    return classMap\n  }, {})\n  mintingPanes.forEach(pane => {\n    // @@ TODO Remove the need to cast to any\n    const icon: any = createContext.div.appendChild(dom.createElement('img'))\n    icon.setAttribute('src', pane.icon)\n    const noun = pane.mintClass\n      ? mintingClassMap[pane.mintClass.uri] > 1\n        ? `${utils.label(pane.mintClass)} (using ${pane.name} pane)`\n        : utils.label(pane.mintClass)\n      : pane.name + ' @@'\n    icon.setAttribute('title', 'Make new ' + noun)\n    icon.setAttribute('style', iconStyle + 'display: none;')\n    iconArray.push(icon)\n    if (!icon.disabled) {\n      icon.addEventListener('click', function (e) {\n        selectTool(icon)\n        makeNewAppInstance({\n          event: e,\n          folder: createContext.folder || null,\n          iconEle: icon,\n          pane,\n          noun,\n          noIndexHTML: true, // do NOT @@ for now write a HTML file\n          div: createContext.div,\n          me: createContext.me,\n          dom: createContext.dom,\n          refreshTarget: createContext.refreshTarget\n        })\n      })\n    }\n  })\n}\n\n// Form to get the name of a new thing before we create it\n//\n// Used in contacts for new groups, individuals.\n//\n/*\nfunction getNameForm (dom, kb, classLabel, gotNameCallback) {\n  const form = dom.createElement('div') // form is broken as HTML behaviour can resurface on js error\n  form.innerHTML = '<p>Name of new ' + classLabel + ':</p>'\n  const namefield = dom.createElement('input')\n  namefield.setAttribute('type', 'text')\n  namefield.setAttribute('size', '30')\n  namefield.setAttribute('style', style.textInputStyle)\n  namefield.setAttribute('maxLength', '2048') // No arbitrary limits\n  namefield.select() // focus next user input\n\n  const gotName = function () {\n    namefield.setAttribute('class', 'pendingedit')\n    namefield.disabled = true\n    continueButton.disabled = true\n    cancel.disabled = true\n    gotNameCallback(true, namefield.value)\n  }\n\n  namefield.addEventListener('keyup', function (e) {\n    if (e.keyCode === 13) {\n      gotName()\n    }\n  }, false)\n  form.appendChild(namefield)\n\n  form.appendChild(dom.createElement('br'))\n\n  const cancel = form.appendChild(widgets.cancelButton(dom))\n  cancel.addEventListener('click', function (e) {\n    form.parentNode.removeChild(form)\n    gotNameCallback(false)\n  }, false)\n\n  const continueButton = form.appendChild(widgets.continueButton(dom))\n  continueButton.addEventListener('click', function (e) {\n    gotName()\n  }, false)\n\n  return form\n}\n*/\n"],"mappings":"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"}