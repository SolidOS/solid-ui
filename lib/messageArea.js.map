{"version":3,"file":"messageArea.js","names":["_iconBase","require","login","_interopRequireWildcard","_solidLogic","ns","rdf","style","utils","widgets","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","UI","icons","messageArea","dom","kb","subject","messageStore","options","solidLogicSingleton","store","doc","WF","Namespace","DCT","newestFirst","messageBodyStyle","div","createElement","messageTable","me","updater","anchor","text","term","uri","setAttribute","addEventListener","openHrefInOutlineMode","textContent","mention","message","pre","appendChild","createTextNode","announce","log","warn","error","newMessageForm","form","lhs","middle","rhs","AJAR_date","sendMessage","field","disabled","sts","now","Date","timestamp","getTime","dateStamp","sym","push","Statement","wf","sioc","literal","value","foaf","sendComplete","success","body","errorMessageBlock","bindings","renderMessage","update","sendButton","turnOnInput","creatorAndDate","innerHTML","rows","keyCode","altKey","button","iconBase","buttonStyle","context","ensureLoggedIn","then","nick","person","s","any","label","td1","creator","date","nickAnchor","fetcher","nowOrWhenFetched","undefined","_ok","_body","syncMessages","about","displayed","ele","ele2","firstChild","nextSibling","AJAR_subject","messages","each","stored","forEach","m","addMessage","removeChild","deleteMessage","deletions","statementsMatching","concat","ok","fresh","content","dateString","tr","done","insertBefore","shortDate","td2","td3","delButton","_event","cancelButton","sureButton","query","Query","v","vs","x","vars","variable","pat","add","msg","dct","doneQuery","refresh"],"sources":["../src/messageArea.js"],"sourcesContent":["//  Common code for a discussion are a of messages about something\n//\n\nimport { icons } from './iconBase'\nimport * as login from './login/login'\nimport { solidLogicSingleton } from 'solid-logic'\nimport * as ns from './ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\nimport * as style from './style'\nimport * as utils from './utils'\nimport * as widgets from './widgets'\n\nconst UI = { icons, ns, rdf, style, widgets }\n\nexport function messageArea (dom, kb, subject, messageStore, options) {\n  kb = kb || solidLogicSingleton.store\n  messageStore = messageStore.doc() // No hash\n  const ns = UI.ns\n  const WF = rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n  const DCT = rdf.Namespace('http://purl.org/dc/terms/')\n\n  options = options || {}\n\n  const newestFirst = !!options.newestFirst\n\n  const messageBodyStyle =\n    'white-space: pre-wrap; width: 90%; font-size:100%; border: 0.07em solid #eee; padding: .2em 0.5em; margin: 0.1em 1em 0.1em 1em;'\n  // 'font-size: 100%; margin: 0.1em 1em 0.1em 1em;  background-color: white; white-space: pre-wrap; padding: 0.1em;'\n\n  const div = dom.createElement('div')\n  // eslint-disable-next-line prefer-const\n  let messageTable // Shared by initial build and addMessageFromBindings\n\n  let me\n\n  const updater = solidLogicSingleton.store.updater\n\n  const anchor = function (text, term) {\n    // If there is no link return an element anyway\n    const a = dom.createElement('a')\n    if (term && term.uri) {\n      a.setAttribute('href', term.uri)\n      a.addEventListener('click', UI.widgets.openHrefInOutlineMode, true)\n      a.setAttribute('style', 'color: #3B5998; text-decoration: none; ') // font-weight: bold\n    }\n    a.textContent = text\n    return a\n  }\n\n  const mention = function mention (message, style) {\n    const pre = dom.createElement('pre')\n    pre.setAttribute('style', style || 'color: grey')\n    div.appendChild(pre)\n    pre.appendChild(dom.createTextNode(message))\n    return pre\n  }\n\n  const announce = {\n    log: function (message) {\n      mention(message, 'color: #111;')\n    },\n    warn: function (message) {\n      mention(message, 'color: #880;')\n    },\n    error: function (message) {\n      mention(message, 'color: #800;')\n    }\n  }\n\n  //       Form for a new message\n  //\n  const newMessageForm = function () {\n    const form = dom.createElement('tr')\n    const lhs = dom.createElement('td')\n    const middle = dom.createElement('td')\n    const rhs = dom.createElement('td')\n    form.appendChild(lhs)\n    form.appendChild(middle)\n    form.appendChild(rhs)\n    form.AJAR_date = '9999-01-01T00:00:00Z' // ISO format for field sort\n\n    const sendMessage = function () {\n      // titlefield.setAttribute('class','pendingedit')\n      // titlefield.disabled = true\n      field.setAttribute('class', 'pendingedit')\n      field.disabled = true\n      const sts = []\n      const now = new Date()\n      const timestamp = '' + now.getTime()\n      const dateStamp = rdf.term(now)\n      // http://www.w3schools.com/jsref/jsref_obj_date.asp\n      const message = kb.sym(messageStore.uri + '#' + 'Msg' + timestamp)\n\n      sts.push(\n        new rdf.Statement(subject, ns.wf('message'), message, messageStore)\n      )\n      sts.push(\n        new rdf.Statement(\n          message,\n          ns.sioc('content'),\n          kb.literal(field.value),\n          messageStore\n        )\n      )\n      sts.push(\n        new rdf.Statement(message, DCT('created'), dateStamp, messageStore)\n      )\n      if (me) {\n        sts.push(\n          new rdf.Statement(message, ns.foaf('maker'), me, messageStore)\n        )\n      }\n\n      const sendComplete = function (uri, success, body) {\n        if (!success) {\n          form.appendChild(\n            UI.widgets.errorMessageBlock(dom, 'Error writing message: ' + body)\n          )\n        } else {\n          const bindings = {\n            '?msg': message,\n            '?content': kb.literal(field.value),\n            '?date': dateStamp,\n            '?creator': me\n          }\n          renderMessage(bindings, false) // not green\n\n          field.value = '' // clear from out for reuse\n          field.setAttribute('class', '')\n          field.disabled = false\n        }\n      }\n      updater.update([], sts, sendComplete)\n    }\n    form.appendChild(dom.createElement('br'))\n\n    let field, sendButton\n    const turnOnInput = function () {\n      creatorAndDate(lhs, me, '', null)\n\n      field = dom.createElement('textarea')\n      middle.innerHTML = ''\n      middle.appendChild(field)\n      field.rows = 3\n      // field.cols = 40\n      field.setAttribute('style', messageBodyStyle + 'background-color: #eef;')\n\n      field.addEventListener(\n        'keyup',\n        function (e) {\n          // User preference?\n          if (e.keyCode === 13) {\n            if (!e.altKey) {\n              // Alt-Enter just adds a new line\n              sendMessage()\n            }\n          }\n        },\n        false\n      )\n\n      rhs.innerHTML = ''\n      sendButton = UI.widgets.button(\n        dom,\n        UI.icons.iconBase + 'noun_383448.svg',\n        'Send'\n      )\n      sendButton.setAttribute('style', UI.style.buttonStyle + 'float: right;')\n      sendButton.addEventListener('click', sendMessage, false)\n      rhs.appendChild(sendButton)\n    }\n\n    const context = { div: middle, dom }\n    login.ensureLoggedIn(context).then(context => {\n      me = context.me\n      turnOnInput()\n    })\n\n    return form\n  }\n\n  function nick (person) {\n    const s = solidLogicSingleton.store.any(person, UI.ns.foaf('nick'))\n    if (s) return '' + s.value\n    return '' + utils.label(person)\n  }\n\n  function creatorAndDate (td1, creator, date, message) {\n    const nickAnchor = td1.appendChild(anchor(nick(creator), creator))\n    if (creator.uri) {\n      solidLogicSingleton.store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n        _ok,\n        _body\n      ) {\n        nickAnchor.textContent = nick(creator)\n      })\n    }\n    td1.appendChild(dom.createElement('br'))\n    td1.appendChild(anchor(date, message))\n  }\n\n  // ///////////////////////////////////////////////////////////////////////\n\n  function syncMessages (about, messageTable) {\n    const displayed = {}\n    let ele, ele2\n    for (ele = messageTable.firstChild; ele; ele = ele.nextSibling) {\n      if (ele.AJAR_subject) {\n        displayed[ele.AJAR_subject.uri] = true\n      }\n    }\n    const messages = kb.each(about, ns.wf('message'))\n    const stored = {}\n    messages.forEach(function (m) {\n      stored[m.uri] = true\n      if (!displayed[m.uri]) {\n        addMessage(m)\n      }\n    })\n\n    // eslint-disable-next-line space-in-parens\n    for (ele = messageTable.firstChild; ele; ) {\n      ele2 = ele.nextSibling\n      if (ele.AJAR_subject && !stored[ele.AJAR_subject.uri]) {\n        messageTable.removeChild(ele)\n      }\n      ele = ele2\n    }\n  }\n\n  const deleteMessage = function (message) {\n    const deletions = kb\n      .statementsMatching(message)\n      .concat(kb.statementsMatching(undefined, undefined, message))\n    updater.update(deletions, [], function (uri, ok, body) {\n      if (!ok) {\n        announce.error('Cant delete messages:' + body)\n      } else {\n        syncMessages(subject, messageTable)\n      }\n    })\n  }\n\n  const addMessage = function (message) {\n    const bindings = {\n      '?msg': message,\n      '?creator': kb.any(message, ns.foaf('maker')),\n      '?date': kb.any(message, DCT('created')),\n      '?content': kb.any(message, ns.sioc('content'))\n    }\n    renderMessage(bindings, true) // fresh from elsewhere\n  }\n\n  const renderMessage = function (bindings, fresh) {\n    const creator = bindings['?creator']\n    const message = bindings['?msg']\n    const date = bindings['?date']\n    const content = bindings['?content']\n\n    const dateString = date.value\n    const tr = dom.createElement('tr')\n    tr.AJAR_date = dateString\n    tr.AJAR_subject = message\n\n    let done = false\n    for (let ele = messageTable.firstChild; ; ele = ele.nextSibling) {\n      if (!ele) {\n        // empty\n        break\n      }\n      if (\n        (dateString > ele.AJAR_date && newestFirst) ||\n        (dateString < ele.AJAR_date && !newestFirst)\n      ) {\n        messageTable.insertBefore(tr, ele)\n        done = true\n        break\n      }\n    }\n    if (!done) {\n      messageTable.appendChild(tr)\n    }\n\n    const td1 = dom.createElement('td')\n    tr.appendChild(td1)\n    creatorAndDate(td1, creator, UI.widgets.shortDate(dateString), message)\n\n    const td2 = dom.createElement('td')\n    tr.appendChild(td2)\n    const pre = dom.createElement('p')\n    pre.setAttribute(\n      'style',\n      messageBodyStyle +\n        (fresh ? 'background-color: #e8ffe8;' : 'background-color: #white;')\n    )\n    td2.appendChild(pre)\n    pre.textContent = content.value\n\n    const td3 = dom.createElement('td')\n    tr.appendChild(td3)\n\n    const delButton = dom.createElement('button')\n    td3.appendChild(delButton)\n    delButton.textContent = '-'\n\n    tr.setAttribute('class', 'hoverControl') // See tabbedtab.css (sigh global CSS)\n    delButton.setAttribute('class', 'hoverControlHide')\n    delButton.setAttribute('style', 'color: red;')\n    delButton.addEventListener(\n      'click',\n      function (_event) {\n        td3.removeChild(delButton) // Ask -- are you sure?\n        const cancelButton = dom.createElement('button')\n        cancelButton.textContent = 'cancel'\n        td3.appendChild(cancelButton).addEventListener(\n          'click',\n          function (_event) {\n            td3.removeChild(sureButton)\n            td3.removeChild(cancelButton)\n            td3.appendChild(delButton)\n          },\n          false\n        )\n        const sureButton = dom.createElement('button')\n        sureButton.textContent = 'Delete message'\n        td3.appendChild(sureButton).addEventListener(\n          'click',\n          function (_event) {\n            td3.removeChild(sureButton)\n            td3.removeChild(cancelButton)\n            deleteMessage(message)\n          },\n          false\n        )\n      },\n      false\n    )\n  }\n\n  // Messages with date, author etc\n\n  messageTable = dom.createElement('table')\n  messageTable.fresh = false\n  div.appendChild(messageTable)\n  messageTable.setAttribute('style', 'width: 100%;') // fill that div!\n\n  const tr = newMessageForm()\n  if (newestFirst) {\n    messageTable.insertBefore(tr, messageTable.firstChild) // If newestFirst\n  } else {\n    messageTable.appendChild(tr) // not newestFirst\n  }\n\n  let query\n  // Do this with a live query to pull in messages from web\n  if (options.query) {\n    query = options.query\n  } else {\n    query = new rdf.Query('Messages')\n    const v = {} // semicolon needed\n    const vs = ['msg', 'date', 'creator', 'content']\n    vs.forEach(function (x) {\n      query.vars.push((v[x] = rdf.variable(x)))\n    })\n    query.pat.add(subject, WF('message'), v.msg)\n    query.pat.add(v.msg, ns.dct('created'), v.date)\n    query.pat.add(v.msg, ns.foaf('maker'), v.creator)\n    query.pat.add(v.msg, ns.sioc('content'), v.content)\n  }\n  function doneQuery () {\n    messageTable.fresh = true // any new are fresh and so will be greenish\n  }\n  kb.query(query, renderMessage, undefined, doneQuery)\n  div.refresh = function () {\n    syncMessages(subject, messageTable)\n  }\n  // syncMessages(subject, messageTable) // no the query will do this async\n  return div\n}\n"],"mappings":"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"}