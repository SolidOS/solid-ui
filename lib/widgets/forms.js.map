{"version":3,"sources":["../../src/widgets/forms.js"],"names":["module","exports","forms","field","UI","icons","require","log","ns","store","solidLogicSingleton","style","widgets","$rdf","error","buttons","utils","checkMarkCharacter","cancelCharacter","dashCharacter","ui","uri","dom","container","already","subject","form","callbackFunction","kb","box","createElement","setAttribute","formBorderColor","appendChild","key","toNT","createTextNode","plist","st","owl","outlineManager","appendPropertyTRs","already2","x","formDoc","doc","parts","any","p2","elements","each","sortBySequence","errorMessageBlock","eles","original","i","t","dep","fn","itemChanged","ok","body","j","length","newOne","removeChild","insertBefore","push","dependingOn","rdf","cases","values","sameTerm","findTypeURIs","value","undefined","c","tests","the","appendForm","debugString","map","toString","slice","join","addItem","object","newThing","ordered","createListIfNecessary","list","saveListThenRefresh","toBeInserted","property","updater","update","msg","debug","refresh","renderItem","deleteThisItem","splice","holds","del","message","subField","moveThisItem","event","upwards","alert","itemDone","linkDone","element","editable","deleteButtonWithCheck","label","button","iconBase","plusIconURI","UpdateManager","orderedNode","Node","toJS","reverse","anyJS","min","tail","padding","img","title","predicateLabel","prompt","textContent","addEventListener","_eventNotUsed","Collection","add","fetcher","putBack","vals","li","sort","syncTableToArrayReOrdered","asyncStuff","extra","then","err","fieldParams","basicField","fieldLabel","fieldStore","text","suppressEmptyUneditable","display","makeDescription","booleanField","tristate","errorBlock","lab","state","ins","buildCheckboxForm","category","checkOptions","makeSelectForNestedCategory","multiple","p","lhs","rhs","from","subForm","follow","possible","possibleProperties","np","opts","nullLabel","disambiguate","findMembersNT","fromNT","rdfs","allClassURIs","sym","propertyTriage","op","dp","addSubForm","possible2","sortByLabel","mint","selector","makeSelectForOptions","_callbackFunction","contents","params","anyValue","suppressIfUneditable","editFormButton","b","innerHTML","_e","ff","parentNode","propertiesForClass","explicit","dc","foaf","forEach","members","used","statementsMatching","predicate","result","findClosest","cla","prop","agenda","shift","lists","supers","formsFor","t1","bottom","bottomTypeURIs","candidates","concat","k","a","pair","toLowerCase","newButton","theClass","promptForNew","GotoSubject","formFunction","gotButton","insertMe","linkButton","info","f","rb","removeButton","AJAR_subject","group","desc","rows","split","cols","multilineTextInputStyle","select","v","saveChange","submit","disabled","ds","is","br","backgroundColor","textInputBackgroundColorUneditable","options","n","uris","sub","warn","getActual","actual","onChange","removeValue","opt","selected","AJAR_mint","newObject","mintClass","thisForm","mintStatementsFun","AJAR_uri","currentURI","sel","subSelect","superSelect","doneNew","children","option","labelWithOntology","firstChild","makeSelectForCategory","du","subs","nullPrompt","child","tx","checkboxStyle","input","fix","why","Array","Error","holdsAll","missing","filter","displayState","negation","defa","boxHandler","toDelete","newState","toInsert","success","errorBody","hmmm","anchor","def","sts","now","Date","getTime"],"mappings":"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","sourcesContent":["/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n\n/* global alert */\n\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport * as debug from '../debug'\nimport { basicField } from './forms/basic'\nimport * as style from '../style'\nmodule.exports = {}\n\nconst forms = {}\n\nforms.field = field // Form field functions by URI of field type.\n\nconst UI = {\n  icons: require('../iconBase'),\n  log: require('../log'),\n  ns: require('../ns'),\n  store: require('../logic').solidLogicSingleton.store,\n  style: require('../style'),\n  widgets: forms\n}\nconst $rdf = require('rdflib')\nconst error = require('./error')\nconst buttons = require('./buttons')\nconst ns = require('../ns')\nconst utils = require('../utils')\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} store The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nforms.field[ns.ui('Form').uri] = forms.field[\n  ns.ui('Group').uri\n] = function (dom, container, already, subject, form, store, callbackFunction) {\n  const kb = UI.store\n  const box = dom.createElement('div')\n  box.setAttribute('style', `padding-left: 2em; border: 0.05em solid ${UI.style.formBorderColor};`) // Indent a group\n  const ui = UI.ns.ui\n  if (container) container.appendChild(box)\n\n  // Prevent loops\n  const key = subject.toNT() + '|' + form.toNT()\n  if (already[key]) {\n    // been there done that\n    box.appendChild(dom.createTextNode('Group: see above ' + key))\n    const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n    dom.outlineManager.appendPropertyTRs(box, plist)\n    return box\n  }\n  // box.appendChild(dom.createTextNode('Group: first time, key: '+key))\n  const already2 = {}\n  for (const x in already) already2[x] = 1\n  already2[key] = 1\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n  let parts = kb.any(form, ui('parts'), null, formDoc)\n  let p2\n  if (parts) {\n    p2 = parts.elements\n  } else {\n    parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n    p2 = forms.sortBySequence(parts)\n  }\n  if (!parts) {\n    box.appendChild(error.errorMessageBlock(dom, 'No parts to form! '))\n    return dom\n  }\n  const eles = []\n  const original = []\n  for (let i = 0; i < p2.length; i++) {\n    const field = p2[i]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ui('Options').uri) {\n      const dep = kb.any(field, ui('dependingOn'), null, formDoc)\n      if (dep && kb.any(subject, dep)) original[i] = kb.any(subject, dep).toNT()\n    }\n\n    const fn = fieldFunction(dom, field)\n\n    const itemChanged = function (ok, body) {\n      if (ok) {\n        for (let j = 0; j < p2.length; j++) {\n          // This is really messy.\n          const field = p2[j]\n          const t = mostSpecificClassURI(field) // Field type\n          if (t === ui('Options').uri) {\n            const dep = kb.any(field, ui('dependingOn'))\n            const newOne = fn(\n              dom,\n              box,\n              already,\n              subject,\n              field,\n              store,\n              callbackFunction\n            )\n            box.removeChild(newOne)\n            box.insertBefore(newOne, eles[j])\n            box.removeChild(eles[j])\n            original[j] = kb.any(subject, dep).toNT()\n            eles[j] = newOne\n          }\n        }\n      }\n      callbackFunction(ok, body)\n    }\n    eles.push(fn(dom, box, already2, subject, field, store, itemChanged))\n  }\n  return box\n}\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} store The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nforms.field[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  const kb = UI.store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em dotted purple;')  // Indent Options\n  const ui = UI.ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(error.errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = kb.findTypeURIs(subject)\n  } else {\n    const value = kb.any(subject, dependingOn)\n    if (value === undefined) {\n      box.appendChild(\n        error.errorMessageBlock(\n          dom,\n          \"Can't select subform as no value of: \" + dependingOn\n        )\n      )\n    } else {\n      values = {}\n      values[value.uri] = true\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  for (let i = 0; i < cases.length; i++) {\n    const c = cases[i]\n    const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n    for (let j = 0; j < tests.length; j++) {\n      if (values[tests[j].uri]) {\n        const field = kb.the(c, ui('use'))\n        if (!field) {\n          box.appendChild(\n            error.errorMessageBlock(\n              dom,\n              'No \"use\" part for case in form ' + form\n            )\n          )\n          return box\n        } else {\n          forms.appendForm(\n            dom,\n            box,\n            already,\n            subject,\n            field,\n            store,\n            callbackFunction\n          )\n        }\n        break\n      }\n    }\n  }\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} store The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nforms.field[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem (object) {\n    if (!object) object = forms.newThing(store) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      const toBeInserted = [$rdf.st(subject, property, object, store)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(error.errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh() // 20191213\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, store)) {\n          const del = [$rdf.st(subject, property, object, store)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                error.errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (uri, ok, message) {\n      debug.log(`Item ${uri} done callback for item ${object.uri.slice(-7)}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      } else {\n        linkDone(uri, ok, message)\n      }\n    }\n    const linkDone = function (uri, ok, message) {\n      return callbackFunction(ok, message)\n    }\n\n    // if (!object) object = forms.newThing(store)\n    UI.log.debug('Multiple: render object: ' + object)\n    // var tr = box.insertBefore(dom.createElement('tr'), tail)\n    // var ins = []\n    // var del = []\n\n    const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, store, itemDone) // p2 was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(store.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, utils.label(property),\n        deleteThisItem)\n      if (ordered) {\n        subField.appendChild(\n          buttons.button(\n            dom, UI.icons.iconBase + 'noun_1369237.svg', 'Move Up',\n            async event => moveThisItem(event, true))\n        )\n        subField.appendChild(\n          buttons.button(\n            dom, UI.icons.iconBase + 'noun_1369241.svg', 'Move Down',\n            async event => moveThisItem(event, false))\n        )\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of form field implementation\n\n  const plusIconURI = UI.icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = UI.store\n  kb.updater = kb.updater || new $rdf.UpdateManager(kb)\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = dom.createElement('table')\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = UI.ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      error.errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return box\n  }\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n  // var max = kb.any(form, ui('max')) // This is the minimum number\n  // max = max ? max.value : 99999999\n\n  var element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      error.errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return box\n  }\n\n  var body = box.appendChild(dom.createElement('tr')) // 20191207\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, store) : kb.any(subject, property, null, store)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, store) : kb.any(subject, property, null, store)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, store) : kb.each(subject, property, null, store)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(store.uri)) {\n    const tail = box.appendChild(dom.createElement('tr'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add one or more ' + utils.predicateLabel(property, reverse)\n    const prompt = tail.appendChild(dom.createElement('span'))\n    prompt.textContent =\n      (values.length === 0 ? 'Add one or more ' : 'Add more ') +\n      utils.label(property)\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, store)\n      } else {\n        kb.add(subject, property, list, store)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(store)\n    } catch (err) {\n      box.appendChild(\n        error.errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, store) : kb.the(subject, property, null, store)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, store) : kb.each(subject, property, null, store)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n    // if (unsavedList) {\n    //     await saveListThenRefresh() // async\n    // }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return box\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nforms.fieldParams = fieldParams\n\nforms.field[ns.ui('PhoneField').uri] = basicField\nforms.field[ns.ui('EmailField').uri] = basicField\nforms.field[ns.ui('ColorField').uri] = basicField\nforms.field[ns.ui('DateField').uri] = basicField\nforms.field[ns.ui('DateTimeField').uri] = basicField\nforms.field[ns.ui('TimeField').uri] = basicField\nforms.field[ns.ui('NumericField').uri] = basicField\nforms.field[ns.ui('IntegerField').uri] = basicField\nforms.field[ns.ui('DecimalField').uri] = basicField\nforms.field[ns.ui('FloatField').uri] = basicField\nforms.field[ns.ui('TextField').uri] = basicField\nforms.field[ns.ui('SingleLineTextField').uri] = basicField\nforms.field[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nforms.field[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  const ui = UI.ns.ui\n  const kb = UI.store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return error.errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.appendChild(forms.fieldLabel(dom, property, form))\n  store = forms.fieldStore(subject, property, store)\n\n  const text = kb.anyJS(subject, property, null, store) || ''\n  const editable = UI.store.updater.editable(store.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = forms.makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    store,\n    callbackFunction\n  )\n  // box.appendChild(dom.createTextNode('<-@@ subj:'+subject+', prop:'+property))\n  box.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction,\n  tristate\n) {\n  const ui = UI.ns.ui\n  const kb = UI.store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = error.errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  store = forms.fieldStore(subject, property, store)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  // UI.log.debug('store is '+store)\n  const ins = $rdf.st(subject, property, true, store)\n  const del = $rdf.st(subject, property, false, store)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, store, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nforms.field[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    store,\n    callbackFunction,\n    false\n  )\n}\n\nforms.field[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    store,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nforms.field[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  const kb = UI.store\n  const ui = UI.ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return error.errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  UI.log.debug('Classifier: store=' + store)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n\n    /*\n    var parent = kb.any(undefined, ui('part'), form)\n    if (!parent) return callbackFunction(ok, body)\n    var kids = kb.each(parent, ui('part')); // @@@@@@@@@ Garbage\n    kids = kids.filter(function(k){return kb.any(k, ns.rdf('type'), ui('Options'))})\n    if (kids.length) UI.log.debug('Yes, found related options: '+kids[0])\n    */\n    return callbackFunction(ok, body)\n  }\n  const box = forms.makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    store,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Alternative implementatons caould be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** Todo: Deal with multiple.  Maybe merge with multiple code.\n */\n\nforms.field[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  callbackFunction\n) {\n  const ns = UI.ns\n  const ui = UI.ns.ui\n  const kb = UI.store\n  const multiple = false\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  let p\n  const box = dom.createElement('tr')\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('td')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('td')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return error.errorMessageBlock(dom, 'No property for Choice: ' + form)\n  }\n  lhs.appendChild(forms.fieldLabel(dom, property, form))\n  const from = kb.any(form, ui('from'))\n  if (!from) {\n    return error.errorMessageBlock(dom, \"No 'from' for Choice: \" + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n  let possible = []\n  let possibleProperties\n  const np = '--' + utils.label(property) + '-?'\n  const opts = { multiple: multiple, nullLabel: np, disambiguate: false }\n  possible = kb.each(undefined, ns.rdf('type'), from, formDoc)\n  for (const x in kb.findMembersNT(from)) {\n    possible.push(kb.fromNT(x))\n    // box.appendChild(dom.createTextNode(\"RDFS: adding \"+x))\n  } // Use rdfs\n  // UI.log.debug(\"%%% Choice field: possible.length 1 = \"+possible.length)\n  if (from.sameTerm(ns.rdfs('Class'))) {\n    for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n    // UI.log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n  } else if (from.sameTerm(ns.rdf('Property'))) {\n    possibleProperties = buttons.propertyTriage(kb)\n    for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n    for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n    opts.disambiguate = true // This is a big class, and the labels won't be enough.\n  } else if (from.sameTerm(ns.owl('ObjectProperty'))) {\n    possibleProperties = buttons.propertyTriage(kb)\n    for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n    opts.disambiguate = true\n  } else if (from.sameTerm(ns.owl('DatatypeProperty'))) {\n    possibleProperties = buttons.propertyTriage(kb)\n    for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n    opts.disambiguate = true\n  }\n  let object = kb.any(subject, property)\n  function addSubForm () {\n    object = kb.any(subject, property)\n    fieldFunction(dom, subForm)(\n      dom,\n      rhs,\n      already,\n      object,\n      subForm,\n      follow ? object.doc() : store,\n      callbackFunction\n    )\n  }\n  const possible2 = forms.sortByLabel(possible)\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* New *' // @@ could be better\n    opts.subForm = subForm\n  }\n  const selector = forms.makeSelectForOptions(\n    dom,\n    kb,\n    subject,\n    property,\n    possible2,\n    opts,\n    store,\n    callbackFunction\n  )\n  rhs.appendChild(selector)\n  if (object && subForm) addSubForm()\n  return box\n}\n\n//          Documentation - non-interactive fields\n//\n\nforms.field[ns.ui('Comment').uri] = forms.field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  _callbackFunction\n) {\n  const ui = UI.ns.ui\n  const kb = UI.store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  let params = forms.fieldParams[uri]\n  if (params === undefined) {\n    params = {}\n  } // non-bottom field types can do this\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  const style = kb.anyValue(form, ui('style')) || params.style || ''\n  if (style) p.setAttribute('style', style)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = UI.store.updater.editable(store.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nforms.editFormButton = function (\n  dom,\n  container,\n  form,\n  store,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = forms.appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        store,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nforms.appendForm = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  store,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    store,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nforms.propertiesForClass = function (kb, c) {\n  const ns = UI.ns\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The store\n* @param cla - the URI of the class\n* @param prop\n*/\nforms.findClosest = function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    // if (c.uri && (c.uri == ns.owl('Thing').uri || c.uri == ns.rdf('Resource').uri )) continue\n    const lists = kb.each(c, prop)\n    UI.log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      UI.log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nforms.formsFor = function (subject) {\n  const ns = UI.ns\n  const kb = UI.store\n\n  UI.log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    UI.log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    UI.log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      forms.findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      forms.findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nforms.sortBySequence = function (list) {\n  const p2 = list.map(function (p) {\n    const k = UI.store.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  p2.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return p2.map(function (pair) {\n    return pair[1]\n  })\n}\n\nforms.sortByLabel = function (list) {\n  const p2 = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  p2.sort()\n  return p2.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param store - optional store else will prompt for one (unimplemented)\n*/\nforms.newButton = function (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  store,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        forms.promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          store,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param store - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nforms.promptForNew = function (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  store,\n  callbackFunction\n) {\n  const ns = UI.ns\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = forms.findClosest(kb, theClass.uri, UI.ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        \" but I don't know enough information about those to ask you.\"\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    UI.log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  UI.log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${UI.style.formBorderColor}; color: ${UI.style.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = forms.newThing(store)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, store)) {\n      insertMe.push($rdf.st(subject, predicate, object, store))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, store)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, store))\n    }\n    if (insertMe.length) {\n      UI.store.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(forms.linkButton(dom, object))\n    }\n    // tabulator.outline.GotoSubject(object, true, undefined, true, undefined)\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  UI.log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, store, itemDone)\n  const rb = forms.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nforms.makeDescription = function (\n  dom,\n  kb,\n  subject,\n  predicate,\n  store,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, store)\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', UI.style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\"\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, store)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.setAttribute('style', style + 'color: gray;') // pending\n    const ds = kb.statementsMatching(subject, predicate, null, store)\n    const is = $rdf.st(subject, predicate, field.value, store)\n    UI.store.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.setAttribute('style', style + 'color: black;')\n        field.disabled = false\n      } else {\n        group.appendChild(\n          error.errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + store.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const br = dom.createElement('br')\n  group.appendChild(br)\n\n  const editable = UI.store.updater.editable(store.uri)\n  if (editable) {\n    var submit = dom.createElement('input')\n    submit.setAttribute('type', 'submit')\n    submit.disabled = true // until the filled has been modified\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    submit.value = 'Save ' + utils.label(predicate) // @@ I18n\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.setAttribute('style', 'float: right;') // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n    submit.addEventListener('click', saveChange, false)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = style.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiple - Boolean - Whether more than one at a time is allowed\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param store - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nforms.makeSelectForOptions = function (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  store,\n  callbackFunction\n) {\n  UI.log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = UI.store.updater.editable(store.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return error.errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n  if (options.mint && !options.subForm) {\n    return error.errorMessageBlock(dom, \"Selector: can't mint new with no subform.\")\n  }\n  UI.log.debug('makeSelectForOptions: store=' + store)\n\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, store).forEach(function (x) {\n        actual[x.uri] = true\n      })\n    }\n    return actual\n  }\n  var actual = getActual()\n\n  // var newObject = null\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, store)) {\n        ds.push($rdf.st(subject, predicate, t, store))\n      }\n    }\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        var newObject\n        if (options.mintClass) {\n          const thisForm = forms.promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            store,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = forms.newThing(store)\n        }\n        is.push($rdf.st(subject, predicate, newObject, store))\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), store))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n        // ds.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), store ))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    function doneNew (ok, body) {\n      callbackFunction(ok, body)\n    }\n    UI.log.info('selectForOptions: stote = ' + store)\n    UI.store.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      // kb.each(subject, predicate, null, store).map(function(x){actual[x.uri] = true})\n      if (ok) {\n        select.disabled = false // data written back\n        if (newObject) {\n          const fn = fieldFunction(dom, options.subForm)\n          fn(\n            dom,\n            select.parentNode,\n            {},\n            newObject,\n            options.subForm,\n            store,\n            doneNew\n          )\n        }\n      }\n      if (callbackFunction) callbackFunction(ok, body)\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', 'margin: 0.6em 1.5em;')\n  if (options.multiple) select.setAttribute('multiple', 'true')\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n  if (select.currentURI == null && !options.multiple) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nforms.makeSelectForCategory = function (\n  dom,\n  kb,\n  subject,\n  category,\n  store,\n  callbackFunction\n) {\n  const log = UI.log\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  let multiple = false\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n    multiple = true\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n  if (subs.length === 0) {\n    return error.errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with no subclasses of category: ' +\n        category\n    )\n  }\n  if (subs.length === 1) {\n    return error.errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with only 1 subclass of category: ' +\n        category +\n        ':' +\n        subs[1]\n    )\n  }\n  return forms.makeSelectForOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { multiple: multiple, nullPrompt: '--classify--' },\n    store,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nforms.makeSelectForNestedCategory = function (\n  dom,\n  kb,\n  subject,\n  category,\n  store,\n  callbackFunction\n) {\n  const container = dom.createElement('span') // Container\n  let child = null\n  let select\n  const onChange = function (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  // eslint-disable-next-line prefer-const\n  select = forms.makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    store,\n    onChange\n  )\n  container.appendChild(select)\n  var update = function () {\n    // UI.log.info(\"Selected is now: \"+select.currentURI)\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = forms.makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        store,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nfunction buildCheckboxForm (dom, kb, lab, del, ins, form, store, tristate) {\n  // 20190115\n  const box = dom.createElement('div')\n  const tx = dom.createTextNode(lab)\n  const editable = UI.store.updater.editable(store.uri)\n  tx.style = style.checkboxStyle\n\n  box.appendChild(tx)\n  let input\n  // eslint-disable-next-line prefer-const\n  input = dom.createElement('button')\n\n  input.setAttribute(\n    'style',\n    'font-size: 150%; height: 1.2em; width: 1.2em; background-color: #eef; margin: 0.1em'\n  )\n  box.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = store // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          UI.widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in store!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    tx.style = 'color: #bbb;' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    UI.store.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        tx.style = 'color: #black; background-color: #fee;'\n        box.appendChild(\n          error.errorMessageBlock(\n            dom,\n            `Checkbox: Error updating store from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        tx.style = 'color: #black;'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\nforms.buildCheckboxForm = buildCheckboxForm\n\nforms.fieldLabel = function (dom, property, form) {\n  let lab = UI.store.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', 'color: #3B5998; text-decoration: none;') // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nforms.fieldStore = function (subject, predicate, def) {\n  const sts = UI.store.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    UI.store.updater.editable(sts[0].why.uri, UI.store)\n  ) {\n    return UI.store.sym(sts[0].why.uri)\n  }\n  return def\n}\n\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nforms.newThing = function (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\nmodule.exports = forms\n"],"file":"forms.js"}