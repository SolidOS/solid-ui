{"version":3,"file":"access-controller.js","names":["_acl","require","_rdflib","_accessGroups","_aclControl","utils","_interopRequireWildcard","debug","style","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","AccessController","exports","subject","noun","context","statusElement","targetIsProtected","targetDoc","targetACLDoc","defaultHolder","defaultACLDoc","prospectiveDefaultHolder","store","dom","_classCallCheck2","_defineProperty2","rootElement","createElement","setAttribute","aclGroupContent","isContainer","uri","slice","isUsingDefaults","aclDefaultStore","adoptACLDefault","mainCombo","AccessGroups","defaults","defaultsCombo","defaultsDiffer","sameACL","aclMap","_createClass2","key","value","render","innerHTML","renderStatus","concat","defaultHolderLink","appendChild","href","innerText","shortNameForFolder","renderRemoveDefaultsController","isEditable","renderAddDefaultsController","renderAddAclsController","renderRemoveAclsController","_this","useDefaultButton","label","bigButton","addEventListener","removeAcls","then","error","_this2","addAclButton","addAcls","_this3","containerElement","defaultsController","noticeElement","defaultsControllerNotice","button","addDefaults","_this4","removeDefaults","renderTemporaryStatus","message","_this5","aclControlBoxStatusRevealed","temporaryStatusInit","setTimeout","temporaryStatusEnd","_addAcls","_asyncToGenerator2","_regenerator","mark","_callee","_this6","aclGraph","_message","wrap","_callee$","_context","prev","next","abrupt","Promise","reject","statements","forEach","st","add","predicate","object","fetcher","putBack","resolve","t0","stop","apply","arguments","_addDefaults","_callee2","_callee2$","_context2","_removeAcls","_callee3","_callee3$","_context3","getProspectiveHolder","sent","warn","t1","_removeDefaults","_callee4","fallbackCombo","_callee4$","_context4","save","_this7","newAClGraph","graph","makeACLGraphbyCombo","byCombo","fetch","_fetch","updater","UpdateManager","put","statementsMatching","undefined","ok","Error","unload","requested","log"],"sources":["../../src/acl/access-controller.ts"],"sourcesContent":["/**\n * Contains the [[AccessController]] class\n * @packageDocumentation\n */\n\nimport { adoptACLDefault, getProspectiveHolder, makeACLGraphbyCombo, sameACL } from './acl'\nimport { fetcher, graph, NamedNode, UpdateManager } from 'rdflib'\nimport { AccessGroups } from './access-groups'\nimport { DataBrowserContext } from 'pane-registry'\nimport { shortNameForFolder } from './acl-control'\nimport * as utils from '../utils'\nimport * as debug from '../debug'\nimport * as style from '../style'\n\n/**\n * Rendered HTML component used in the databrowser's Sharing pane.\n */\nexport class AccessController {\n  public mainCombo: AccessGroups\n  public defaultsCombo: AccessGroups | null\n  private readonly isContainer: boolean\n  private defaultsDiffer: boolean\n  private readonly rootElement: HTMLDivElement\n  private isUsingDefaults: boolean\n\n  constructor (\n    public subject: NamedNode,\n    public noun: string,\n    public context: DataBrowserContext,\n    private statusElement: HTMLElement,\n    public targetIsProtected: boolean,\n    private targetDoc: NamedNode,\n    private targetACLDoc: NamedNode,\n    private defaultHolder: NamedNode | null,\n    private defaultACLDoc: NamedNode | null,\n    private prospectiveDefaultHolder: NamedNode | undefined,\n    public store,\n    public dom: HTMLDocument\n  ) {\n    this.rootElement = dom.createElement('div')\n    this.rootElement.setAttribute('style', style.aclGroupContent)\n    this.isContainer = targetDoc.uri.slice(-1) === '/' // Give default for all directories\n    if (defaultHolder && defaultACLDoc) {\n      this.isUsingDefaults = true\n      const aclDefaultStore = adoptACLDefault(this.targetDoc, targetACLDoc, defaultHolder, defaultACLDoc)\n      this.mainCombo = new AccessGroups(targetDoc, targetACLDoc, this, aclDefaultStore, { defaults: this.isContainer })\n      this.defaultsCombo = null\n      this.defaultsDiffer = false\n    } else {\n      this.isUsingDefaults = false\n      this.mainCombo = new AccessGroups(targetDoc, targetACLDoc, this, store)\n      this.defaultsCombo = new AccessGroups(targetDoc, targetACLDoc, this, store, { defaults: this.isContainer })\n      this.defaultsDiffer = !sameACL(this.mainCombo.aclMap, this.defaultsCombo.aclMap)\n    }\n  }\n\n  public get isEditable (): boolean {\n    return !this.isUsingDefaults\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    if (this.isUsingDefaults) {\n      this.renderStatus(`The sharing for this ${this.noun} is the default for folder `)\n      if (this.defaultHolder) {\n        const defaultHolderLink = this.statusElement.appendChild(this.dom.createElement('a'))\n        defaultHolderLink.href = this.defaultHolder.uri\n        defaultHolderLink.innerText = shortNameForFolder(this.defaultHolder)\n      }\n    } else if (!this.defaultsDiffer && this.isContainer) {\n      this.renderStatus('This is also the default for things in this folder.')\n    } else {\n      this.renderStatus('')\n    }\n    this.rootElement.appendChild(this.mainCombo.render())\n    if (this.defaultsCombo && this.defaultsDiffer) {\n      this.rootElement.appendChild(this.renderRemoveDefaultsController())\n      this.rootElement.appendChild(this.defaultsCombo.render())\n    } else if (this.isEditable && this.isContainer) {\n      this.rootElement.appendChild(this.renderAddDefaultsController())\n    }\n    if (!this.targetIsProtected && this.isUsingDefaults) {\n      this.rootElement.appendChild(this.renderAddAclsController())\n    } else if (!this.targetIsProtected) {\n      this.rootElement.appendChild(this.renderRemoveAclsController())\n    }\n    return this.rootElement\n  }\n\n  private renderRemoveAclsController (): HTMLElement {\n    const useDefaultButton = this.dom.createElement('button')\n    useDefaultButton.innerText = `Remove custom sharing settings for this ${this.noun} -- just use default${this.prospectiveDefaultHolder ? ` for ${utils.label(this.prospectiveDefaultHolder)}` : ''}`\n    useDefaultButton.setAttribute('style', style.bigButton)\n    useDefaultButton.addEventListener('click', () => this.removeAcls()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return useDefaultButton\n  }\n\n  private renderAddAclsController (): HTMLElement {\n    const addAclButton = this.dom.createElement('button')\n    addAclButton.innerText = `Set specific sharing for this ${this.noun}`\n    addAclButton.setAttribute('style', style.bigButton)\n    addAclButton.addEventListener('click', () => this.addAcls()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return addAclButton\n  }\n\n  private renderAddDefaultsController (): HTMLElement {\n    const containerElement = this.dom.createElement('div')\n    containerElement.setAttribute('style', style.defaultsController)\n\n    const noticeElement = containerElement.appendChild(this.dom.createElement('div'))\n    noticeElement.innerText = 'Sharing for things within the folder currently tracks sharing for the folder.'\n    noticeElement.setAttribute('style', style.defaultsControllerNotice)\n\n    const button = containerElement.appendChild(this.dom.createElement('button'))\n    button.innerText = 'Set the sharing of folder contents separately from the sharing for the folder'\n    button.setAttribute('style', style.bigButton)\n    button.addEventListener('click', () => this.addDefaults()\n      .then(() => this.render()))\n    return containerElement\n  }\n\n  private renderRemoveDefaultsController (): HTMLElement {\n    const containerElement = this.dom.createElement('div')\n    containerElement.setAttribute('style', style.defaultsController)\n\n    const noticeElement = containerElement.appendChild(this.dom.createElement('div'))\n    noticeElement.innerText = 'Access to things within this folder:'\n    noticeElement.setAttribute('style', style.defaultsControllerNotice)\n\n    const button = containerElement.appendChild(this.dom.createElement('button'))\n    button.innerText = 'Set default for folder contents to just track the sharing for the folder'\n    button.setAttribute('style', style.bigButton)\n    button.addEventListener('click', () => this.removeDefaults()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return containerElement\n  }\n\n  public renderTemporaryStatus (message: string): void {\n    // @@ TODO Introduce better system for error notification to user https://github.com/solidos/mashlib/issues/87\n    this.statusElement.setAttribute('style', style.aclControlBoxStatusRevealed)\n    this.statusElement.innerText = message\n    this.statusElement.setAttribute('style', style.temporaryStatusInit)\n    setTimeout(() => {\n      this.statusElement.setAttribute('style', style.temporaryStatusEnd)\n    })\n    setTimeout(() => {\n      this.statusElement.innerText = ''\n    }, 5000)\n  }\n\n  public renderStatus (message: string): void {\n    // @@ TODO Introduce better system for error notification to user https://github.com/solidos/mashlib/issues/87\n    if (!message) {\n      this.statusElement.setAttribute('style', style.aclControlBoxStatusRevealed)\n    }\n    this.statusElement.innerText = message\n  }\n\n  private async addAcls (): Promise<void> {\n    if (!this.defaultHolder || !this.defaultACLDoc) {\n      const message = 'Unable to find defaults to copy'\n      debug.error(message)\n      return Promise.reject(message)\n    }\n    const aclGraph = adoptACLDefault(this.targetDoc, this.targetACLDoc, this.defaultHolder, this.defaultACLDoc)\n    aclGraph.statements.forEach(st => this.store.add(st.subject, st.predicate, st.object, this.targetACLDoc))\n    try {\n      await this.store.fetcher.putBack(this.targetACLDoc)\n      this.isUsingDefaults = false\n      return Promise.resolve()\n    } catch (error) {\n      const message = ` Error writing back access control file! ${error}`\n      debug.error(message)\n      return Promise.reject(message)\n    }\n  }\n\n  private async addDefaults (): Promise<void> {\n    this.defaultsCombo = new AccessGroups(this.targetDoc, this.targetACLDoc, this, this.store, { defaults: true })\n    this.defaultsDiffer = true\n  }\n\n  private async removeAcls (): Promise<void> {\n    try {\n      await this.store.fetcher.delete(this.targetACLDoc.uri, {})\n      this.isUsingDefaults = true\n      try {\n        this.prospectiveDefaultHolder = await getProspectiveHolder(this.targetDoc.uri)\n      } catch (error) {\n        // No need to show this error in status, but good to warn about it in console\n        debug.warn(error)\n      }\n    } catch (error) {\n      const message = `Error deleting access control file: ${this.targetACLDoc}: ${error}`\n      debug.error(message)\n      return Promise.reject(message)\n    }\n  }\n\n  private async removeDefaults (): Promise<void> {\n    const fallbackCombo = this.defaultsCombo\n    try {\n      this.defaultsCombo = null\n      this.defaultsDiffer = false\n      await this.save()\n    } catch (error) {\n      this.defaultsCombo = fallbackCombo\n      this.defaultsDiffer = true\n      debug.error(error)\n      return Promise.reject(error)\n    }\n  }\n\n  public save (): Promise<void> {\n    // build graph\n    const newAClGraph = graph()\n    if (!this.isContainer) {\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true)\n    } else if (this.defaultsCombo && this.defaultsDiffer) {\n      // Pair of controls\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true)\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.defaultsCombo.byCombo, this.targetACLDoc, false, true)\n    } else {\n      // Linked controls\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true, true)\n    }\n\n    // add authenticated fetcher\n    newAClGraph.fetcher = fetcher(newAClGraph, { fetch: this.store.fetcher._fetch })\n    const updater = newAClGraph.updater || new UpdateManager(newAClGraph)\n\n    // save ACL resource\n    return new Promise((resolve, reject) => {\n      updater.put(\n        this.targetACLDoc,\n        newAClGraph.statementsMatching(undefined, undefined, undefined, this.targetACLDoc),\n        'text/turtle',\n        (uri, ok, message) => {\n          if (!ok) {\n            return reject(new Error(`ACL file save failed: ${message}`))\n          }\n          this.store.fetcher.unload(this.targetACLDoc)\n          this.store.add(newAClGraph.statements)\n          this.store.fetcher.requested[this.targetACLDoc.uri] = 'done' // missing: save headers\n          this.mainCombo.store = this.store\n          if (this.defaultsCombo) {\n            this.defaultsCombo.store = this.store\n          }\n          this.defaultsDiffer = !!this.defaultsCombo && !sameACL(this.mainCombo.aclMap, this.defaultsCombo.aclMap)\n          debug.log('ACL modification: success!')\n          resolve()\n        }\n      )\n    })\n  }\n}\n"],"mappings":"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"}