{"version":3,"file":"add-agent-buttons.js","names":["debug","_interopRequireWildcard","require","_iconBase","_login","ns","utils","widgets","style","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","AddAgentButtons","exports","groupList","_classCallCheck2","_defineProperty2","rootElement","controller","dom","createElement","barElement","_createClass2","key","value","render","innerHTML","appendChild","renderAddButton","_this","button","concat","icons","iconBase","toggleBar","renderBar","isExpanded","renderPersonButton","renderGroupButton","renderPublicButton","renderAuthenticatedAgentButton","renderBotButton","renderAppsButton","renderSimplifiedBar","_this2","Array","from","children","filter","element","forEach","removeChild","_this3","iconForClass","event","target","renderNameForm","vcard","then","name","addPerson","renderCleanup","error","renderStatus","_this4","addGroup","type","noun","askName","store","_this5","addAgent","foaf","uri","renderTemporaryStatus","_this6","acl","_this7","schema","addBot","_this8","eventContext","div","existingApps","renderAppsTable","renderAppsView","newApp","getOriginFromName","Promise","race","origin","addNewURI","_this9","trustedApplications","context","session","paneRegistry","byName","trustedApplicationsElement","setAttribute","trustedAppController","cancelButton","trustedAppCancelButton","insertBefore","firstChild","_renderAppsTable","_asyncToGenerator2","_regenerator","mark","_callee","_this0","trustedApps","trustedOrigins","wrap","_context","prev","next","ensureLoadedProfile","each","me","flatMap","app","textContent","length","abrupt","resolve","reject","appsTable","trustedAppAddApplicationsTable","any","Error","thingTR","personTR","innerTable","innerRow","innerLeftColumn","innerMiddleColumn","label","subject","innerRightColumn","continueButton","stop","_x","apply","arguments","_addPerson","_callee2","domainNameRegexp","_context2","match","log","_x2","_addGroup","_callee3","_context3","_x3","_addAgent","_callee4","agentUri","_context4","_x4","_addBot","_callee5","_context5","_x5","_getOriginFromName","_callee6","_context6","_x6"],"sources":["../../src/acl/add-agent-buttons.ts"],"sourcesContent":["/**\n * Contains the [[AddAgentButtons]] class\n * @packageDocumentation\n */\n\nimport { NamedNode, Store } from 'rdflib'\nimport { AuthenticationContext } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile } from '../login/login'\nimport * as ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport * as style from '../style'\nimport { AccessGroups } from './access-groups'\n\n/**\n * Renders the Sharing pane's \"+\" button and the menus behind it,\n * see https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md#add\n */\nexport class AddAgentButtons {\n  private readonly rootElement: HTMLElement\n  private readonly barElement: HTMLElement\n  private isExpanded: boolean = false\n\n  constructor (private groupList: AccessGroups) {\n    this.rootElement = groupList.controller.dom.createElement('div')\n    this.barElement = groupList.controller.dom.createElement('div')\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    this.rootElement.appendChild(this.renderAddButton())\n    this.rootElement.appendChild(this.barElement)\n    return this.rootElement\n  }\n\n  private renderAddButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_34653_green.svg`,\n      'Add ...',\n      () => {\n        this.toggleBar()\n        this.renderBar()\n      }\n    )\n  }\n\n  private renderBar (): void {\n    this.barElement.innerHTML = ''\n    if (!this.isExpanded) {\n      return\n    }\n    this.barElement.appendChild(this.renderPersonButton())\n    this.barElement.appendChild(this.renderGroupButton())\n    this.barElement.appendChild(this.renderPublicButton())\n    this.barElement.appendChild(this.renderAuthenticatedAgentButton())\n    this.barElement.appendChild(this.renderBotButton())\n    this.barElement.appendChild(this.renderAppsButton())\n  }\n\n  private renderSimplifiedBar (button: EventTarget | null) {\n    Array.from(this.barElement.children)\n      .filter(element => element !== button)\n      .forEach(element => this.barElement.removeChild(element))\n  }\n\n  private renderPersonButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Individual'],\n      'Add Person',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Individual'), 'person')\n          .then(name => this.addPerson(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderGroupButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Group'],\n      'Add Group',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Group'), 'group')\n          .then(name => this.addGroup(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderNameForm (type: NamedNode, noun: string): Promise<string | undefined> {\n    return widgets.askName(\n      this.groupList.controller.dom,\n      this.groupList.store,\n      this.barElement,\n      ns.vcard('URI'),\n      type,\n      noun\n    )\n  }\n\n  private renderPublicButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['foaf:Agent'],\n      'Add Everyone',\n      () => this.addAgent(ns.foaf('Agent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding the general public to those who can read. Drag the globe to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderAuthenticatedAgentButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_99101.svg`,\n      'Anyone logged In',\n      () => this.addAgent(ns.acl('AuthenticatedAgent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderBotButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + 'noun_Robot_849764.svg',\n      'A Software Agent (bot)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.schema('Application'), 'bot')\n          .then(name => this.addBot(name))\n          .then(() => this.renderCleanup())\n      })\n  }\n\n  private renderAppsButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_15177.svg`,\n      'A Web App (origin)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        const eventContext = {\n          div: this.barElement,\n          dom: this.groupList.controller.dom\n        }\n        const existingApps = this.renderAppsTable(eventContext)\n          .catch(error => this.groupList.controller.renderStatus(error))\n        this.renderAppsView()\n        const newApp = this.renderNameForm(ns.schema('WebApplication'), 'webapp domain')\n          .then(name => this.getOriginFromName(name))\n        Promise.race([\n          existingApps,\n          newApp\n        ])\n          .then(origin => {\n            if (origin) {\n              this.groupList.addNewURI(origin)\n            }\n          })\n          .then(() => this.renderCleanup())\n      }\n    )\n  }\n\n  private renderAppsView (): void {\n    const trustedApplications = this.groupList.controller.context.session.paneRegistry.byName('trustedApplications')\n    if (trustedApplications) {\n      const trustedApplicationsElement = trustedApplications.render(null, this.groupList.controller.context)\n      trustedApplicationsElement.setAttribute('style', style.trustedAppController)\n\n      const cancelButton = widgets.cancelButton(this.groupList.controller.dom, () => this.renderCleanup())\n      cancelButton.setAttribute('style', style.trustedAppCancelButton)\n      trustedApplicationsElement.insertBefore(cancelButton, trustedApplicationsElement.firstChild)\n\n      this.barElement.appendChild(trustedApplicationsElement)\n    }\n  }\n\n  private async renderAppsTable (eventContext: AuthenticationContext): Promise<string> {\n    await ensureLoadedProfile(eventContext)\n    const trustedApps = (this.groupList.store as Store).each(eventContext.me, ns.acl('trustedApp')) as Array<NamedNode> // @@ TODO fix as\n    const trustedOrigins = trustedApps.flatMap(app => (this.groupList.store as Store).each(app, ns.acl('origin'))) // @@ TODO fix as\n\n    this.barElement.appendChild(this.groupList.controller.dom.createElement('p')).textContent = `You have ${trustedOrigins.length} selected web apps.`\n    return new Promise((resolve, reject) => {\n      const appsTable = this.barElement.appendChild(this.groupList.controller.dom.createElement('table'))\n      appsTable.setAttribute('style', style.trustedAppAddApplicationsTable)\n      trustedApps.forEach(app => {\n        const origin = (this.groupList.store as Store).any(app, ns.acl('origin')) // @@ TODO fix as\n        if (!origin) {\n          reject(new Error(`Unable to pick app: ${app.value}`))\n        }\n        const thingTR = widgets.personTR(this.groupList.controller.dom, ns.acl('origin'), origin, {})\n        const innerTable = this.groupList.controller.dom.createElement('table')\n        const innerRow = innerTable.appendChild(this.groupList.controller.dom.createElement('tr'))\n\n        const innerLeftColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerLeftColumn.appendChild(thingTR)\n\n        const innerMiddleColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerMiddleColumn.textContent = `Give access to ${this.groupList.controller.noun} ${utils.label(this.groupList.controller.subject)}?`\n\n        const innerRightColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerRightColumn.appendChild(widgets.continueButton(this.groupList.controller.dom, () => resolve(origin!.value)))\n\n        appsTable.appendChild(innerTable)\n      })\n    })\n  }\n\n  private renderCleanup (): void {\n    this.renderBar()\n    this.groupList.render()\n  }\n\n  private async addPerson (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a person and has an owner who agrees they own it\n    debug.log(`Adding to ACL person: ${name}`)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addGroup (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a group and has an owner who agrees they own it\n    debug.log('Adding to ACL group: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addAgent (agentUri: string): Promise<void> {\n    await this.groupList.addNewURI(agentUri)\n    this.toggleBar()\n  }\n\n  private async addBot (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a bot and has an owner who agrees they own it\n    debug.log('Adding to ACL bot: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async getOriginFromName (name?: string): Promise<string | void> {\n    if (!name) return Promise.resolve() // user cancelled\n    const domainNameRegexp = /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i\n    // https://www.oreilly.com/library/view/regular-expressions-cookbook/9781449327453/ch08s15.html\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a domain name'))\n    }\n    const origin = 'https://' + name\n    debug.log('Adding to ACL origin: ' + origin)\n    this.toggleBar()\n    return origin\n  }\n\n  private toggleBar (): void {\n    this.isExpanded = !this.isExpanded\n  }\n}\n"],"mappings":"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","ignoreList":[]}