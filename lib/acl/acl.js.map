{"version":3,"file":"acl.js","names":["ns","_interopRequireWildcard","require","_solidLogic","utils","debug","_rdflib","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","kb","solidLogicSingleton","store","adoptACLDefault","doc","aclDoc","defaultResource","defaultACLDoc","ACL","acl","isContainer","uri","slice","defaults","each","undefined","concat","proposed","reduce","accumulatedStatements","da","statementsMatching","rdf","st","kb2","graph","forEach","add","move","subject","predicate","object","sym","symbol","y","length","readACL","arguments","getDefaults","auths","getDefaultsFallback","ac","agent","agentClass","agentGroup","origin","originClass","keys","pred","mode","sameACL","b","contains","ACLunion","list","ag","_loop","k","loadUnionACL","subjectList","callbackFunction","aclList","doList","shift","getACLorDefault","ok","p2","targetDoc","targetACLDoc","defaultHolder","defa","push","ACLbyCombination","byCombo","combo","sort","combo2","join","makeACLGraph","x","makeACLGraphbyCombo","main","pairs","modeURIs","split","short","map","ACLToString","comboToString","str","initials","sameTerm","foaf","label","makeACLString","serialize","putACLObject","putACLbyCombo","_kb$updater","updater","put","message","_kb$fetcher","fetcher","unload","requested","fixIndividualCardACL","person","log","groups","vcard","fixIndividualACL","item","subjects","exists","union","setACL","docURI","aclText","any","ACL_LINK","Error","webOperation","value","data","contentType","then","res","error","nowOrWhenFetched","body","getACL","status","tryParent","right","lastIndexOf","left","indexOf","doc2","nonexistent","response","getProspectiveHolder","_x","_getProspectiveHolder","apply","_asyncToGenerator2","_regenerator","mark","_callee","targetDirectory","wrap","_callee$","_context","prev","next","abrupt","Promise","resolve","reject","isDirectACL","stop"],"sources":["../../src/acl/acl.ts"],"sourcesContent":["/**\n * Non-UI functions for access control.\n * See https://github.com/solidos/web-access-control-spec\n * for the spec that defines how ACL documents work.\n * @packageDocumentation\n */\n\nimport * as ns from '../ns'\nimport { solidLogicSingleton, ACL_LINK } from 'solid-logic'\nimport * as utils from '../utils'\nimport { AgentMapMap, AgentMapUnion, ComboList } from './types'\nimport * as debug from '../debug'\nimport { graph, Store, NamedNode, serialize, st, Statement, sym, LiveStore } from 'rdflib'\n\nconst kb = solidLogicSingleton.store\n\n/**\n * Take the \"default\" ACL and convert it into the equivalent ACL\n * which the resource would have had. Return it as a new separate store.\n * The \"defaultForNew\" predicate is also accepted, as a deprecated\n * synonym for \"default\".\n */\nexport function adoptACLDefault (\n  doc: NamedNode,\n  aclDoc: NamedNode,\n  defaultResource: NamedNode,\n  defaultACLDoc: NamedNode\n): Store {\n  const ACL = ns.acl\n  const isContainer = doc.uri.slice(-1) === '/' // Give default for all directories\n\n  const defaults = kb\n    .each(undefined, ACL('default'), defaultResource, defaultACLDoc)\n    .concat(kb.each(undefined, ACL('defaultForNew'), defaultResource, defaultACLDoc))\n\n  const proposed = defaults.reduce((accumulatedStatements, da) => accumulatedStatements\n    .concat(kb.statementsMatching(da as NamedNode, ns.rdf('type'), ACL('Authorization'), defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('agent'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('agentClass'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('agentGroup'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('origin'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('originClass'), undefined, defaultACLDoc))\n    .concat(kb.statementsMatching(da as NamedNode, ACL('mode'), undefined, defaultACLDoc))\n    .concat(st(da as NamedNode, ACL('accessTo'), doc, defaultACLDoc))\n    .concat(isContainer ? st(da as NamedNode, ACL('default'), doc, defaultACLDoc) : []), [] as Statement[])\n\n  const kb2 = graph() // Potential - derived is kept apart\n  proposed.forEach(st => kb2.add(move(st.subject), move(st.predicate), move(st.object), sym(aclDoc.uri)))\n  return kb2 as LiveStore\n\n  function move (symbol) {\n    const y = defaultACLDoc.uri.length // The default ACL file\n    return sym(\n      symbol.uri.slice(0, y) === defaultACLDoc.uri\n        ? aclDoc.uri + symbol.uri.slice(y)\n        : symbol.uri\n    )\n  }\n}\n\n/**\n * Read and canonicalize the ACL for x in aclDoc\n *\n * Accumulate the access rights which each agent or class has\n */\nexport function readACL (\n  doc: NamedNode,\n  aclDoc: NamedNode,\n  kb2: Store = kb,\n  getDefaults: boolean = false\n): AgentMapMap {\n  const auths: Array<NamedNode> = getDefaults\n    ? getDefaultsFallback(kb2, ns)\n    : kb2.each(undefined, ns.acl('accessTo'), doc)\n\n  const ACL = ns.acl\n  const ac = {\n    agent: {},\n    agentClass: {},\n    agentGroup: {},\n    origin: {},\n    originClass: {}\n  }\n  Object.keys(ac).forEach(pred => {\n    auths.forEach(function (a) {\n      (kb2.each(a, ACL('mode')) as Array<NamedNode>).forEach(function (mode) {\n        (kb2.each(a, ACL(pred)) as Array<NamedNode>).forEach(function (agent) {\n          ac[pred][agent.uri] = ac[pred][agent.uri] || {}\n          ac[pred][agent.uri][mode.uri] = a // could be \"true\" but leave pointer just in case\n        })\n      })\n    })\n  })\n  return ac\n\n  function getDefaultsFallback (kb, ns) {\n    return kb\n      .each(undefined, ns.acl('default'), doc)\n      .concat(kb.each(undefined, ns.acl('defaultForNew'), doc))\n  }\n}\n\n/**\n * Compare two ACLs\n */\nexport function sameACL (a: AgentMapMap | AgentMapUnion, b: AgentMapMap | AgentMapUnion): boolean {\n  const contains = function (a, b) {\n    for (const pred in {\n      agent: true,\n      agentClass: true,\n      agentGroup: true,\n      origin: true,\n      originClass: true\n    }) {\n      if (a[pred]) {\n        for (const agent in a[pred]) {\n          for (const mode in a[pred][agent]) {\n            if (!b[pred][agent] || !b[pred][agent][mode]) {\n              return false\n            }\n          }\n        }\n      }\n    }\n    return true\n  }\n  return contains(a, b) && contains(b, a)\n}\n\n/**\n * Union N ACLs\n */\nexport function ACLunion (list: Array<AgentMapMap | AgentMapUnion>): AgentMapUnion {\n  const b = list[0]\n  let a, ag\n  for (let k = 1; k < list.length; k++) {\n    ;['agent', 'agentClass', 'agentGroup', 'origin', 'originClass'].forEach(\n      function (pred) {\n        a = list[k]\n        if (a[pred]) {\n          for (ag in a[pred]) {\n            for (const mode in a[pred][ag]) {\n              if (!b[pred][ag]) b[pred][ag] = []\n              b[pred][ag][mode] = true\n            }\n          }\n        }\n      }\n    )\n  }\n  return b as AgentMapUnion\n}\n\ntype loadUnionACLCallback = (ok: boolean, message?: string | NamedNode | AgentMapUnion | AgentMapMap) => void\n\n/**\n * Merge ACLs lists from things to form union\n */\nexport function loadUnionACL (subjectList: Array<NamedNode>, callbackFunction: loadUnionACLCallback): void {\n  const aclList: Array<AgentMapMap> = []\n  const doList = function (list) {\n    if (list.length) {\n      const doc = list.shift().doc()\n      getACLorDefault(doc, function (\n        ok,\n        p2,\n        targetDoc,\n        targetACLDoc,\n        defaultHolder,\n        defaultACLDoc\n      ) {\n        const defa = !p2\n        if (!ok || !defaultHolder || !defaultACLDoc) return callbackFunction(ok, targetACLDoc)\n        const acl = defa\n          ? readACL(defaultHolder, defaultACLDoc)\n          : readACL(targetDoc as NamedNode, targetACLDoc as NamedNode)\n        aclList.push(acl)\n        doList(list.slice(1))\n      })\n    } else {\n      // all gone\n      callbackFunction(true, ACLunion(aclList))\n    }\n  }\n  doList(subjectList)\n}\n\n/**\n * Represents these as an RDF graph by combination of modes\n *\n * Each agent can only be in one place in this model, one combination of modes.\n * Combos are like full control, read append, read only etc.\n */\nexport function ACLbyCombination (ac: AgentMapMap | AgentMapUnion): ComboList {\n  const byCombo = {}\n  ;['agent', 'agentClass', 'agentGroup', 'origin', 'originClass'].forEach(function (pred) {\n    for (const agent in ac[pred]) {\n      const combo: string[] = []\n      for (const mode in ac[pred][agent]) {\n        combo.push(mode)\n      }\n      combo.sort()\n      const combo2 = combo.join('\\n')\n      if (!byCombo[combo2]) byCombo[combo2] = []\n      byCombo[combo2].push([pred, agent])\n    }\n  })\n  return byCombo\n}\n\n/**\n * Write ACL graph to store from AC\n */\nexport function makeACLGraph (kb: Store, x: NamedNode, ac: AgentMapMap, aclDoc: NamedNode): void {\n  const byCombo = ACLbyCombination(ac)\n  return makeACLGraphbyCombo(kb, x, byCombo, aclDoc)\n}\n\n/**\n * Write ACL graph to store from combo\n */\nexport function makeACLGraphbyCombo (\n  kb: Store,\n  x: NamedNode,\n  byCombo: ComboList,\n  aclDoc: NamedNode,\n  main?: boolean,\n  defa?: boolean\n): void {\n  const ACL = ns.acl\n  for (const combo in byCombo) {\n    const pairs = byCombo[combo]\n    if (!pairs.length) continue // do not add to store when no agent\n    const modeURIs = combo.split('\\n')\n    let short = modeURIs\n      .map(function (u) {\n        return u.split('#')[1]\n      })\n      .join('')\n    if (defa && !main) short += 'Default' // don't muddle authorizations\n    const a = kb.sym(aclDoc.uri + '#' + short)\n    kb.add(a, ns.rdf('type'), ACL('Authorization'), aclDoc)\n    if (main) {\n      kb.add(a, ACL('accessTo'), x, aclDoc)\n    }\n    if (defa) {\n      kb.add(a, ACL('default'), x, aclDoc)\n    }\n    for (let i = 0; i < modeURIs.length; i++) {\n      kb.add(a, ACL('mode'), kb.sym(modeURIs[i]), aclDoc)\n    }\n    for (let i = 0; i < pairs.length; i++) {\n      const pred = pairs[i][0]\n      const ag = pairs[i][1]\n      kb.add(a, ACL(pred), kb.sym(ag), aclDoc)\n    }\n  }\n}\n\n/**\n * Debugging short strings for dumping ACL\n * and possibly in the UI\n */\nexport function ACLToString (ac: AgentMapMap): string {\n  return comboToString(ACLbyCombination(ac))\n}\n\n/**\n * Convert a [[ComboList]] to a string\n */\nexport function comboToString (byCombo: ComboList): string {\n  let str = ''\n  for (const combo in byCombo) {\n    const modeURIs = combo.split('\\n')\n    const initials = modeURIs\n      .map(function (u) {\n        return u.split('#')[1][0]\n      })\n      .join('')\n    str += initials + ':'\n    const pairs = byCombo[combo]\n    for (let i = 0; i < pairs.length; i++) {\n      const pred = pairs[i][0]\n      const ag = sym(pairs[i][1])\n      str += pred === 'agent' ? '@' : ''\n      str += ag.sameTerm(ns.foaf('Agent')) ? '*' : utils.label(ag)\n      if (i < pairs.length - 1) str += ','\n    }\n    str += ';'\n  }\n  return '{' + str.slice(0, -1) + '}' // drop extra semicolon\n}\n\n/**\n * Write ACL graph as Turtle\n */\nexport function makeACLString (x: NamedNode, ac: AgentMapMap, aclDoc: NamedNode): string {\n  const kb2 = graph()\n  makeACLGraph(kb2, x, ac, aclDoc)\n  return serialize(aclDoc, kb2, aclDoc.uri, 'text/turtle') || ''\n}\n\n/**\n * Write ACL graph to web\n */\nexport function putACLObject (\n  kb: LiveStore,\n  x: NamedNode,\n  ac: AgentMapMap | AgentMapUnion,\n  aclDoc: NamedNode,\n  callbackFunction: (ok: boolean, message?: string) => void\n): void {\n  const byCombo = ACLbyCombination(ac)\n  return putACLbyCombo(kb, x, byCombo, aclDoc, callbackFunction)\n}\n\n/**\n * Write ACL graph to web from a [[ComboList]]\n */\nexport function putACLbyCombo (\n  kb: LiveStore,\n  x: NamedNode,\n  byCombo: ComboList,\n  aclDoc: NamedNode,\n  callbackFunction: (ok: boolean, message?: string) => void\n): void {\n  const kb2 = graph()\n  makeACLGraphbyCombo(kb2, x, byCombo, aclDoc, true)\n\n  // const str = makeACLString = function(x, ac, aclDoc)\n  kb.updater?.put(\n    aclDoc,\n    kb2.statementsMatching(undefined, undefined, undefined, aclDoc),\n    'text/turtle',\n    function (uri, ok, message) {\n      if (!ok) {\n        callbackFunction(ok, message)\n      } else {\n        kb.fetcher?.unload(aclDoc)\n        makeACLGraphbyCombo(kb, x, byCombo, aclDoc, true)\n        kb.fetcher!.requested[aclDoc.uri] = 'done' // missing: save headers\n        callbackFunction(ok)\n      }\n    }\n  )\n}\n\ntype fixIndividualCardACLCallback = (ok: boolean, message?: string | NamedNode | AgentMapUnion | AgentMapMap) => void\ntype fixIndividualACLCallback = (ok: boolean, message?: string | NamedNode | AgentMapUnion | AgentMapMap) => void\n\n/**\n * Fix the ACl for an individual card as a function of the groups it is in\n *\n * All group files must be loaded first\n */\nexport function fixIndividualCardACL (person: NamedNode, log: Function, callbackFunction: fixIndividualCardACLCallback): void {\n  const groups = kb.each(undefined, ns.vcard('hasMember'), person) as NamedNode[]\n  // const doc = person.doc()\n  if (groups) {\n    fixIndividualACL(person, groups, log, callbackFunction)\n  } else {\n    log('This card is in no groups')\n    callbackFunction(true) // fine, no requirements to access. default should be ok\n  }\n  // @@ if no groups, then use default for People container or the book top container.?\n}\n\n/**\n * This function is used by [[fixIndividualCardACL]]\n */\nexport function fixIndividualACL (item: NamedNode, subjects: Array<NamedNode>, log: Function, callbackFunction: fixIndividualACLCallback): void {\n  log = log || debug.log\n  const doc = item.doc()\n  getACLorDefault(doc, function (\n    ok,\n    exists,\n    targetDoc,\n    targetACLDoc,\n    defaultHolder,\n    defaultACLDoc\n  ) {\n    if (!ok || !defaultHolder || !defaultACLDoc) return callbackFunction(false, targetACLDoc) // ie message\n    const ac = exists\n      ? readACL(targetDoc as NamedNode, targetACLDoc as NamedNode)\n      : readACL(defaultHolder, defaultACLDoc)\n    loadUnionACL(subjects, function (ok, union) {\n      if (!ok) return callbackFunction(false, union)\n      if (sameACL(union as AgentMapMap | AgentMapUnion, ac)) {\n        log('Nice - same ACL. no change ' + utils.label(item) + ' ' + doc)\n      } else {\n        log('Group ACLs differ for ' + utils.label(item) + ' ' + doc)\n\n        // log(\"Group ACLs: \" + makeACLString(targetDoc, union, targetACLDoc))\n        // log((exists ? \"Previous set\" : \"Default\") + \" ACLs: \" +\n        // makeACLString(targetDoc, ac, targetACLDoc))\n\n        putACLObject(\n          kb as unknown as LiveStore,\n          targetDoc as NamedNode,\n          union as AgentMapMap | AgentMapUnion,\n          targetACLDoc as NamedNode,\n          callbackFunction\n        )\n      }\n    })\n  })\n}\n\n/**\n * Set an ACL\n */\nexport function setACL (\n  docURI: NamedNode,\n  aclText: string,\n  callbackFunction: (ok: boolean, message: string) => void\n): void {\n  const aclDoc = kb.any(\n    docURI,\n    ACL_LINK\n  ) // @@ check that this get set by web.js\n  if (!kb.fetcher) {\n    throw new Error('Store has no fetcher')\n  }\n  if (aclDoc) {\n    // Great we already know where it is\n    kb.fetcher\n      .webOperation('PUT', aclDoc.value, {\n        data: aclText,\n        contentType: 'text/turtle'\n      })\n      .then((res) => {\n        callbackFunction(res.ok, res.error || '')\n      }) // @@@ check params\n  } else {\n    kb.fetcher.nowOrWhenFetched(docURI, undefined, function (ok, body) {\n      if (!ok) return callbackFunction(ok, 'Gettting headers for ACL: ' + body)\n      const aclDoc = kb.any(\n        docURI,\n        ACL_LINK\n      ) // @@ check that this get set by web.js\n      if (!aclDoc) {\n        // complainIfBad(false, \"No Link rel=ACL header for \" + docURI)\n        callbackFunction(false, 'No Link rel=ACL header for ' + docURI)\n      } else {\n        if (!kb.fetcher) {\n          throw new Error('Store has no fetcher')\n        }\n        kb.fetcher\n          .webOperation('PUT', aclDoc.value, {\n            data: aclText,\n            contentType: 'text/turtle'\n          })\n          .then((res) => {\n            callbackFunction(res.ok, res.error || '')\n          })\n      }\n    })\n  }\n}\n\n/**\n * Get ACL file or default if necessary\n *\n * @param callbackFunction  Will be called in the following ways, in the following cases:\n * * `callbackFunction(true, true, doc, aclDoc)` if the ACL did exist\n * * `callbackFunction(true, false, doc, aclDoc, defaultHolder, defaultACLDoc)` if the ACL file did not exist but a default did\n * * `callbackFunction(false, false, status, message)` when there was an error getting the original\n * * `callbackFunction(false, true, status, message)` when there was an error getting the default\n */\nexport function getACLorDefault (\n  doc: NamedNode,\n  callbackFunction: (\n    a: boolean,\n    b: boolean,\n    statusOrMessage: number | NamedNode,\n    message: string | NamedNode,\n    c?: NamedNode,\n    d?: NamedNode\n  ) => void\n): void {\n  getACL(doc, function (ok, status, aclDoc, message): string | void {\n    const ACL = ns.acl\n    if (!ok) return callbackFunction(false, false, status as number, message as string)\n\n    // Recursively search for the ACL file which gives default access\n    const tryParent = function (uri) {\n      if (uri.slice(-1) === '/') {\n        uri = uri.slice(0, -1)\n      }\n      const right = uri.lastIndexOf('/')\n      const left = uri.indexOf('/', uri.indexOf('//') + 2)\n      if (left > right) {\n        return callbackFunction(false, true, 404, 'Found no ACL resource')\n      }\n      uri = uri.slice(0, right + 1)\n      const doc2 = sym(uri)\n      getACL(doc2, function (ok, status, defaultACLDoc: any): NamedNode | void {\n        if (!ok) {\n          return callbackFunction(\n            false,\n            true,\n            status as number,\n            `( No ACL pointer ${uri} ${status})${defaultACLDoc}`\n          ) as void\n        } else if (status === 403) {\n          return callbackFunction(\n            false,\n            true,\n            status,\n            `( default ACL file FORBIDDEN. Stop.${uri})`\n          )\n        } else if (status === 404) {\n          return tryParent(uri)\n        } else if (status !== 200) {\n          return callbackFunction(\n            false,\n            true,\n            status as number,\n            `Error status '${status}' searching for default for ${doc2}`\n          )\n        }\n        // 200\n        // statusBlock.textContent += (\" ACCESS set at \" + uri + \". End search.\")\n        const defaults = kb\n          .each(undefined, ACL('default'), kb.sym(uri), defaultACLDoc)\n          .concat(\n            kb.each(undefined, ACL('defaultForNew'), kb.sym(uri), defaultACLDoc)\n          )\n        if (!defaults.length) {\n          return tryParent(uri) // Keep searching\n        }\n        const defaultHolder = kb.sym(uri)\n        return callbackFunction(\n          true,\n          false,\n          doc,\n          aclDoc as NamedNode,\n          defaultHolder,\n          defaultACLDoc as NamedNode\n        )\n      })\n    } // tryParent\n\n    if (!ok) {\n      return callbackFunction(\n        false,\n        false,\n        status as number,\n        `Error accessing Access Control information for ${doc}) ${message}`\n      )\n    } else if (status === 404) {\n      tryParent(doc.uri) //  @@ construct default one - the server should do that\n    } else if (status === 403) {\n      return callbackFunction(\n        false,\n        false,\n        status,\n        `(Sharing not available to you)${message}`\n      )\n    } else if (status !== 200) {\n      return callbackFunction(\n        false,\n        false,\n        status as number,\n        `Error ${status} accessing Access Control information for ${doc}: ${message}`\n      )\n    } else {\n      // 200\n      return callbackFunction(true, true, doc, aclDoc as NamedNode)\n    }\n  }) // Call to getACL\n}\n\n/**\n * Calls back `(ok, status, acldoc, message)` as follows\n *\n * * `(false, 900, errormessage)` if no link header\n * * `(true, 403, documentSymbol, fileaccesserror)` if not authorized\n * * `(true, 404, documentSymbol, fileaccesserror)` if does not exist\n * * `(true, 200, documentSymbol)` if file exists and read OK\n */\nexport function getACL (\n  doc: NamedNode,\n  callbackFunction: (\n    ok: boolean,\n    messageOrStatus: number | string,\n    messageOrDoc?: NamedNode | string,\n    message?: string\n  ) => void\n): void {\n  if (!kb.fetcher) {\n    throw new Error('kb has no fetcher')\n  }\n  kb.fetcher.nowOrWhenFetched(doc, undefined, function (ok, body) {\n    if (!ok) {\n      return callbackFunction(ok, `Can't get headers to find ACL for ${doc}: ${body}`)\n    }\n    const aclDoc = kb.any(\n      doc,\n      ACL_LINK\n    ) // @@ check that this get set by web.js\n    if (!aclDoc) {\n      callbackFunction(false, 900, `No Link rel=ACL header for ${doc}`)\n    } else {\n      if (!kb.fetcher) {\n        throw new Error('kb has no fetcher')\n      }\n      if (kb.fetcher.nonexistent[aclDoc.value]) {\n        return callbackFunction(\n          true,\n          404,\n          aclDoc as NamedNode,\n          `ACL file ${aclDoc} does not exist.`\n        )\n      }\n      kb.fetcher.nowOrWhenFetched(aclDoc as NamedNode, undefined, function (\n        ok,\n        message,\n        response\n      ) {\n        if (!ok) {\n          callbackFunction(\n            true,\n            response.status,\n            aclDoc as NamedNode,\n            `Can't read Access Control File ${aclDoc}: ${message}`\n          )\n        } else {\n          callbackFunction(true, 200, aclDoc as NamedNode)\n        }\n      })\n    }\n  })\n}\n\n/**\n * Calls [[getACLorDefault]] and then (?)\n */\nexport async function getProspectiveHolder (targetDirectory: string): Promise<NamedNode | undefined> {\n  return new Promise((resolve, reject) => getACLorDefault(sym(targetDirectory), (\n    ok,\n    isDirectACL,\n    targetDoc,\n    targetACLDoc,\n    defaultHolder\n  ) => {\n    if (ok) {\n      return resolve((isDirectACL ? targetDoc : defaultHolder) as NamedNode)\n    }\n    return reject(new Error(`Error loading ${targetDirectory}`))\n  }))\n}\n"],"mappings":"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","ignoreList":[]}