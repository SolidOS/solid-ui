{"version":3,"file":"messageTools.js","names":["debug","_interopRequireWildcard","require","_iconBase","ns","rdf","utils","widgets","_bookmarks","_solidLogic","_chatLogic","_message","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","dom","window","document","PENCIL_ICON","THUMBS_UP_ICON","THUMBS_DOWN_ICON","emoji","schema","sentimentStrip","target","doc","latest","mostRecentVersion","actions","store","holds","value","each","sentiments","map","any","sort","strings","x","createTextNode","join","sentimentStripLinked","strip","createElement","refresh","innerHTML","uri","forEach","ss","_ss","_slicedToArray2","theClass","agent","res","setAttribute","textContent","appendChild","messageToolbar","message","messageRow","userContext","channelObject","deleteMessage","_deleteMessage","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee2","author","msg","area","wrap","_callee2$","_context2","prev","next","foaf","me","alert","sameTerm","t0","warn","statusArea","parentNode","errorMessageBlock","removeChild","closeToolbar","stop","editMessage","_x","_editMessage","_callee3","_callee3$","_context3","switchToEditor","div","parentElement","deleteThingThen","_x2","_deleteThingThen","_callee4","_callee4$","_context4","updater","update","connectedStatements","authn","currentUser","deleteButtonWithCheck","button","icons","iconBase","renderBookmarksButton","then","bookmarkButton","sentimentButton","context","icon","actionClass","mutuallyExclusive","setColor","style","backgroundColor","action","label","_ref","_callee","_event","insertMe","dirty","_callee$","_context","newThing","st","length","existingAction","refreshTree","_x3","filter","context1","cancelButton","firstChild","opacity","addEventListener"],"sources":["../../src/chat/messageTools.js"],"sourcesContent":["/**\n * Tools for doing things with a message\n * Let us be creative here.  Allow all sorts of things to\n * be done to a message - linking to new or old objects in an open way\n *\n * Ideas: Bookmark, Like, star, pin at top of chat, reply as new thread,\n * If you made it originally: edit, delete, attach\n * @packageDocumentation\n */\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\n// import { media } from '../media/index'\nimport * as ns from '../ns'\n// import * as pad from '../pad'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n// import * as style from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { renderBookmarksButton } from './bookmarks'\nimport { authn, store } from 'solid-logic'\n\nimport { mostRecentVersion } from './chatLogic'\nimport { switchToEditor } from './message'\n\nconst dom = window.document\n\n// THE UNUSED ICONS are here as reminders for possible future functionality\n// const BOOKMARK_ICON = 'noun_45961.svg'\n// const HEART_ICON = 'noun_130259.svg' -> Add this to my (private) favorites\n// const MENU_ICON = 'noun_897914.svg'\n// const PAPERCLIP_ICON = 'noun_25830.svg' -> add attachments to this message\n// const PIN_ICON = 'noun_562340.svg'  -> pin this message permanently in the chat UI\nconst PENCIL_ICON = 'noun_253504.svg' // edit a message\n// const SPANNER_ICON = 'noun_344563.svg' -> settings\nconst THUMBS_UP_ICON = 'noun_1384132.svg'\nconst THUMBS_DOWN_ICON = 'noun_1384135.svg'\n/**\n * Emoji in Unicode\n */\nconst emoji = {}\nemoji[ns.schema('AgreeAction')] = 'ðŸ‘'\nemoji[ns.schema('DisagreeAction')] = 'ðŸ‘Ž'\nemoji[ns.schema('EndorseAction')] = 'â­ï¸'\nemoji[ns.schema('LikeAction')] = 'â¤ï¸'\n\n/**\n * Create strip of sentiments expressed\n */\nexport function sentimentStrip (target, doc) { // alain seems not used\n  const latest = mostRecentVersion(target)\n  const actions = store.holds(latest, ns.schema('dateDeleted').value, null, latest.doc()) ? store.each(null, ns.schema('target'), target, doc) : []\n  const sentiments = actions.map(a => store.any(a, ns.rdf('type'), null, doc))\n  sentiments.sort()\n  const strings = sentiments.map(x => emoji[x] || '')\n  return dom.createTextNode(strings.join(' '))\n}\n/**\n * Create strip of sentiments expressed, with hyperlinks\n *\n * @param target {NamedNode} - The thing about which they are expressed\n * @param doc {NamedNode} - The document in which they are expressed\n */\nexport function sentimentStripLinked (target, doc) {\n  const strip = dom.createElement('span')\n  function refresh () {\n    strip.innerHTML = ''\n    const actions = (mostRecentVersion(target).uri !== ns.schema('dateDeleted').uri) ? store.each(null, ns.schema('target'), target, doc) : []\n    const sentiments = actions.map(a => [\n      store.any(a, ns.rdf('type'), null, doc),\n      store.any(a, ns.schema('agent'), null, doc)\n    ])\n    sentiments.sort()\n    sentiments.forEach(ss => {\n      const [theClass, agent] = ss\n      let res\n      if (agent) {\n        res = dom.createElement('a')\n        res.setAttribute('href', agent.uri)\n      } else {\n        res = dom.createTextNode('')\n      }\n      res.textContent = emoji[theClass] || '*'\n      strip.appendChild(res)\n    })\n  }\n  refresh()\n  strip.refresh = refresh\n  return strip\n}\n/**\n * Creates a message toolbar component\n */\nexport function messageToolbar (message, messageRow, userContext, channelObject) {\n  async function deleteMessage () {\n    const author = store.any(message, ns.foaf('maker'))\n    if (!me) {\n      alert('You can\\'t delete the message, you are not logged in.')\n    } else if (me.sameTerm(author)) {\n      try {\n        await channelObject.deleteMessage(message)\n      } catch (err) {\n        const msg = 'Error deleting messaage ' + err\n        debug.warn(msg)\n        alert(msg)\n        const area = userContext.statusArea || messageRow.parentNode\n        area.appendChild(widgets.errorMessageBlock(dom, msg))\n      }\n      messageRow.parentNode.removeChild(messageRow)\n    } else {\n      alert('You can\\'t delete the message, you are not logged in as the author, ' + author)\n    }\n    closeToolbar()\n  }\n\n  async function editMessage (messageRow) {\n    if (me.value === store.any(message, ns.foaf('maker')).value) {\n      closeToolbar() // edit is a one-off action\n      switchToEditor(messageRow, message, channelObject, userContext)\n    }\n  }\n\n  // alain TODO allow chat owner to fully delete message + sentiments and replacing messages\n\n  const div = dom.createElement('div')\n  // is message deleted ?\n  if (mostRecentVersion(message).value === ns.schema('dateDeleted').value) return div\n  function closeToolbar () {\n    div.parentElement.parentElement.removeChild(div.parentElement) // remive the TR\n  }\n\n  async function deleteThingThen (x) {\n    await store.updater.update(store.connectedStatements(x), [])\n  }\n\n  // Things only the original author can do\n  let me = authn.currentUser() // If already logged on\n  if (me && store.holds(message, ns.foaf('maker'), me)) {\n    // button to delete the message\n    div.appendChild(widgets.deleteButtonWithCheck(dom, div, 'message', deleteMessage))\n    // button to edit the message\n    div.appendChild(widgets.button(dom, icons.iconBase + PENCIL_ICON, 'edit', () => editMessage(messageRow)))\n  } // if mine\n  // Things anyone can do if they have a bookmark list async\n  /*\n var bookmarkButton = await bookmarks.renderBookmarksButton(userContext)\n if (bookmarkButton) {\n   div.appendChild(bookmarkButton)\n }\n */\n  // Things anyone can do if they have a bookmark list\n\n  renderBookmarksButton(userContext).then(bookmarkButton => {\n    if (bookmarkButton) div.appendChild(bookmarkButton)\n  })\n\n  /**   Button to allow user to express a sentiment (like, endorse, etc) about a target\n   *\n   * @param context {Object} - Provide dom and me\n   * @param target {NamedNode} - The thing the user expresses an opnion about\n   * @param icon {uristring} - The icon to be used for the button\n   * @param actionClass {NamedNode} - The RDF class  - typically a subclass of schema:Action\n   * @param doc - {NamedNode} - the Solid document iunto which the data should be written\n   * @param mutuallyExclusive {Array<NamedNode>} - Any RDF classes of sentimentswhich are mutiually exclusive\n   */\n  function sentimentButton (\n    context,\n    target,\n    icon,\n    actionClass,\n    doc,\n    mutuallyExclusive\n  ) {\n    function setColor () {\n      button.style.backgroundColor = action ? 'yellow' : 'white'\n    }\n    const button = widgets.button(\n      dom,\n      icon,\n      utils.label(actionClass),\n      async function (_event) {\n        if (action) {\n          await deleteThingThen(action)\n          action = null\n          setColor()\n        } else {\n          // no action\n          action = widgets.newThing(doc)\n          const insertMe = [\n            rdf.st(action, ns.schema('agent'), context.me, doc),\n            rdf.st(action, ns.rdf('type'), actionClass, doc),\n            rdf.st(action, ns.schema('target'), target, doc)\n          ]\n          await store.updater.update([], insertMe)\n          setColor()\n\n          if (mutuallyExclusive) {\n            // Delete incompative sentiments\n            let dirty = false\n            for (let i = 0; i < mutuallyExclusive.length; i++) {\n              const a = existingAction(mutuallyExclusive[i])\n              if (a) {\n                await deleteThingThen(a) // but how refresh? refreshTree the parent?\n                dirty = true\n              }\n            }\n            if (dirty) {\n              // widgets.refreshTree(button.parentNode) // requires them all to be immediate siblings\n              widgets.refreshTree(messageRow) // requires them all to be immediate siblings\n            }\n          }\n        }\n      }\n    )\n    function existingAction (actionClass) {\n      const actions = store\n        .each(null, ns.schema('agent'), context.me, doc)\n        .filter(x => store.holds(x, ns.rdf('type'), actionClass, doc))\n        .filter(x => store.holds(x, ns.schema('target'), target, doc))\n      return actions.length ? actions[0] : null\n    }\n    function refresh () {\n      action = existingAction(actionClass)\n      setColor()\n    }\n    let action\n    button.refresh = refresh // If the file changes, refresh live\n    refresh()\n    return button\n  }\n\n  // THUMBS_UP_ICON\n  // https://schema.org/AgreeAction\n  me = authn.currentUser() // If already logged on\n  // debug.log('Actions 3' + mostRecentVersion(message).value + ' ' + ns.schema('dateDeleted').value + ' ' + (mostRecentVersion(message).value !== ns.schema('dateDeleted').value))\n\n  if (me && (mostRecentVersion(message).value !== ns.schema('dateDeleted').value)) {\n    const context1 = { me, dom, div }\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message, // @@ TODO use widgets.sentimentButton\n        icons.iconBase + THUMBS_UP_ICON,\n        ns.schema('AgreeAction'),\n        message.doc(),\n        [ns.schema('DisagreeAction')]\n      )\n    )\n    // Thumbs down\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message,\n        icons.iconBase + THUMBS_DOWN_ICON,\n        ns.schema('DisagreeAction'),\n        message.doc(),\n        [ns.schema('AgreeAction')]\n      )\n    )\n  }\n  // X button to remove the tool UI itself\n  const cancelButton = div.appendChild(widgets.cancelButton(dom))\n  cancelButton.style.float = 'right'\n  cancelButton.firstChild.style.opacity = '0.3'\n  cancelButton.addEventListener('click', closeToolbar)\n  return div\n}\n"],"mappings":"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"}