{"version":3,"file":"label.js","names":["log","_interopRequireWildcard","require","_solidLogic","ns","rdf","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","UI","label","thing","initialCap","arguments","length","undefined","doCap","slice","toUpperCase","cleanUp","result","toLowerCase","getWellKnownLabel","value","termType","elements","s","uri","toString","split","map","decodeURIComponent","join","hex","indexOf","String","fromCharCode","parseInt","hash","slash","lastIndexOf","suffix","store","any","ui","link","vcard","foaf","dct","dc","rss","contact","sym","cal","as","schema","rdfs"],"sources":["../../src/utils/label.ts"],"sourcesContent":["import * as log from '../log'\nimport { store } from 'solid-logic'\nimport * as ns from '../ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n\nconst UI = { log, ns, rdf }\n\n// This ubiquitous function returns the best label for a thing\n//\n// The hacks in this code make a major difference to the usability\nexport function label (thing, initialCap = false): string {\n  function doCap (label: string) {\n    if (initialCap) {\n      return label.slice(0, 1).toUpperCase() + label.slice(1)\n    }\n    return label\n  }\n  function cleanUp (label: string) {\n    let result = ''\n    if (label.slice(-1) === '/') label = label.slice(0, -1) // chop trailing slash\n    for (let i = 0; i < label.length; i++) {\n      if (label[i] === '_' || label[i] === '-') {\n        result += ' '\n        continue\n      }\n      result += label[i]\n      if (\n        i + 1 < label.length &&\n        label[i].toUpperCase() !== label[i] &&\n        label[i + 1].toLowerCase() !== label[i + 1]\n      ) {\n        result += ' '\n      }\n    }\n    if (result.slice(0, 4) === 'has ') result = result.slice(4)\n    return doCap(result)\n  }\n\n  const label = getWellKnownLabel(thing)\n\n  if (label) {\n    return doCap(label.value)\n  }\n\n  // Default to label just generated from the URI\n\n  if (thing.termType === 'BlankNode') {\n    return '...'\n  }\n  if (thing.termType === 'Collection') {\n    return '(' + thing.elements.length + ')'\n  }\n  let s = thing.uri\n  if (typeof s === 'undefined') return thing.toString() // can't be a symbol\n  // s = decodeURI(s) // This can crash is random valid @ signs are presentation\n  // The idea was to clean up eg URIs encoded in query strings\n  // Also encoded character in what was filenames like @ [] {}\n  try {\n    s = s\n      .split('/')\n      .map(decodeURIComponent)\n      .join('/') // If it is properly encoded\n  } catch (e) {\n    // try individual decoding of ASCII code points\n    for (let i = s.length - 3; i > 0; i--) {\n      const hex = '0123456789abcefABCDEF' // The while upacks multiple layers of encoding\n      while (\n        s[i] === '%' &&\n        hex.indexOf(s[i + 1]) >= 0 &&\n        hex.indexOf(s[i + 2]) >= 0\n      ) {\n        s =\n          s.slice(0, i) +\n          String.fromCharCode(parseInt(s.slice(i + 1, i + 3), 16)) +\n          s.slice(i + 3)\n      }\n    }\n  }\n\n  s = slice(s, '/profile/card#me')\n  s = slice(s, '#this')\n  s = slice(s, '#me')\n\n  const hash = s.indexOf('#')\n  if (hash >= 0) return cleanUp(s.slice(hash + 1))\n\n  // Eh? Why not do this? e.g. dc:title needs it only trim URIs, not rdfs:labels\n  const slash = s.lastIndexOf('/', s.length - 2) // (len-2) excludes trailing slash\n  if (slash >= 0 && slash < thing.uri.length) return cleanUp(s.slice(slash + 1))\n\n  return doCap(decodeURIComponent(thing.uri))\n}\n\nfunction slice (s: string, suffix: string) {\n  const length = suffix.length * -1\n  if (s.slice(length) === suffix) {\n    return s.slice(0, length)\n  }\n  return s\n}\n\n// Hard coded known label predicates\n//  @@ TBD: Add subproperties of rdfs:label\nfunction getWellKnownLabel (thing) {\n  return store.any(thing, UI.ns.ui('label')) || // Prioritize ui:label\n      store.any(thing, UI.ns.link('message')) ||\n      store.any(thing, UI.ns.vcard('fn')) ||\n      store.any(thing, UI.ns.foaf('name')) ||\n      store.any(thing, UI.ns.dct('title')) ||\n      store.any(thing, UI.ns.dc('title')) ||\n      store.any(thing, UI.ns.rss('title')) ||\n      store.any(thing, UI.ns.contact('fullName')) ||\n      store.any(thing, store.sym('http://www.w3.org/2001/04/roadmap/org#name')) ||\n      store.any(thing, UI.ns.cal('summary')) ||\n      store.any(thing, UI.ns.foaf('nick')) ||\n      store.any(thing, UI.ns.as('name')) ||\n      store.any(thing, UI.ns.schema('name')) ||\n      store.any(thing, UI.ns.rdfs('label')) ||\n      store.any(thing, store.sym('http://www.w3.org/2004/02/skos/core#prefLabel'))\n}\n"],"mappings":"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","ignoreList":[]}