{"version":3,"file":"headerFooterHelpers.js","names":["_rdflib","require","_","getPod","sym","document","location","origin","site","getPodOwner","_x","_x2","_getPodOwner","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee","pod","store","response","containerTurtle","podOwner","guess","wrap","_callee$","_context","prev","next","any","ns","ldp","fetcher","webOperation","uri","initFetchOptions","headers","accept","sent","responseText","parse","t0","console","error","abrupt","holds","rdf","space","warn","solid","load","doc","t1","concat","t2","stop","getName","user","anyValue","vcard","foaf","throttle","func","wait","options","length","undefined","context","args","result","timeout","previous","later","leading","Date","now","remaining","clearTimeout","trailing","setTimeout"],"sources":["../../src/utils/headerFooterHelpers.ts"],"sourcesContent":["/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, LiveStore, NamedNode, parse, sym } from 'rdflib'\nimport { ns } from '..'\n\n/* @ts-ignore  no-console */\ntype ThrottleOptions = {\n    leading?: boolean;\n    throttling?: boolean;\n    trailing?: boolean;\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n */\nexport async function getPodOwner (pod: NamedNode, store: LiveStore): Promise<NamedNode | null> {\n  // This is a massive guess.  In future\n  // const podOwner = sym(`${pod.uri}profile/card#me`)\n/* eslint-disable no-console */\n  try {\n    // load turtle Container representation\n    if (!store.any(pod, null, ns.ldp('Container'), pod)) {\n      const response = await store.fetcher.webOperation('GET', pod.uri, store.fetcher.initFetchOptions(pod.uri, { headers: { accept: 'text/turtle' } }))\n      const containerTurtle = response.responseText\n      parse(containerTurtle as string, store, pod.uri, 'text/turtle')\n    }\n  } catch (err) {\n    console.error('Error loading pod ' + pod + ': ' + err)\n    return null\n  }\n  if (!store.holds(pod, ns.rdf('type'), ns.space('Storage'), pod)) {\n    console.warn('Pod  ' + pod + ' does not declare itself as a space:Storage')\n    return null\n  }\n  const podOwner = store.any(pod, ns.solid('owner'), null, pod) ||\n        store.any(null, ns.space('storage'), pod, pod)\n  if (podOwner) {\n    try {\n      await store.fetcher.load((podOwner as NamedNode).doc())\n    } catch (err) {\n      console.warn('Unable to load profile of pod owner ' + podOwner)\n      return null\n    }\n    if (!store.holds(podOwner, ns.space('storage'), pod, (podOwner as NamedNode).doc())) {\n      console.warn(`Pod owner ${podOwner} does NOT list pod ${pod} as their storage`)\n    }\n    return podOwner as NamedNode// Success!\n  } else { // pod owner not declared in pod\n    // @@ TODO: This is given the structure that NSS provides\n    // This is a massive guess.  For old pods which don't have owner link\n    const guess = sym(`${pod.uri}profile/card#me`)\n    try {\n      // @ts-ignore  LiveStore always has fetcher\n      await store.fetcher.load(guess)\n    } catch (err) {\n      console.error('Ooops. Guessed wrong pod owner webid {$guess} : can\\'t load it.')\n      return null\n    }\n    if (store.holds(guess, ns.space('storage'), pod, guess.doc())) {\n      console.warn('Using guessed pod owner webid but it links back.')\n      return guess\n    }\n    return null\n  }\n  /* eslint-enable no-console */\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n"],"mappings":"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","ignoreList":[]}