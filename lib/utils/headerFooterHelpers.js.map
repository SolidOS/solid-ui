{"version":3,"file":"headerFooterHelpers.js","names":["_rdflib","require","_","getPod","sym","document","location","origin","site","getPodOwner","_x","_x2","_getPodOwner","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee","pod","store","response","containerTurtle","podOwner","guess","_t","_t2","_t3","wrap","_context","prev","next","any","ns","ldp","fetcher","webOperation","uri","initFetchOptions","headers","accept","sent","responseText","parse","console","error","abrupt","holds","rdf","space","warn","solid","load","doc","concat","stop","getName","user","anyValue","vcard","foaf","throttle","func","wait","options","length","undefined","context","args","result","timeout","previous","later","leading","Date","now","remaining","clearTimeout","trailing","setTimeout"],"sources":["../../src/utils/headerFooterHelpers.ts"],"sourcesContent":["/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, LiveStore, NamedNode, parse, sym } from 'rdflib'\nimport { ns } from '..'\n\n/* @ts-ignore  no-console */\ntype ThrottleOptions = {\n    leading?: boolean;\n    throttling?: boolean;\n    trailing?: boolean;\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n */\nexport async function getPodOwner (pod: NamedNode, store: LiveStore): Promise<NamedNode | null> {\n  // This is a massive guess.  In future\n  // const podOwner = sym(`${pod.uri}profile/card#me`)\n/* eslint-disable no-console */\n  try {\n    // load turtle Container representation\n    if (!store.any(pod, null, ns.ldp('Container'), pod)) {\n      const response = await store.fetcher.webOperation('GET', pod.uri, store.fetcher.initFetchOptions(pod.uri, { headers: { accept: 'text/turtle' } }))\n      const containerTurtle = response.responseText\n      parse(containerTurtle as string, store, pod.uri, 'text/turtle')\n    }\n  } catch (err) {\n    console.error('Error loading pod ' + pod + ': ' + err)\n    return null\n  }\n  if (!store.holds(pod, ns.rdf('type'), ns.space('Storage'), pod)) {\n    console.warn('Pod  ' + pod + ' does not declare itself as a space:Storage')\n    return null\n  }\n  const podOwner = store.any(pod, ns.solid('owner'), null, pod) ||\n        store.any(null, ns.space('storage'), pod, pod)\n  if (podOwner) {\n    try {\n      await store.fetcher.load((podOwner as NamedNode).doc())\n    } catch (err) {\n      console.warn('Unable to load profile of pod owner ' + podOwner)\n      return null\n    }\n    if (!store.holds(podOwner, ns.space('storage'), pod, (podOwner as NamedNode).doc())) {\n      console.warn(`Pod owner ${podOwner} does NOT list pod ${pod} as their storage`)\n    }\n    return podOwner as NamedNode// Success!\n  } else { // pod owner not declared in pod\n    // @@ TODO: This is given the structure that NSS provides\n    // This is a massive guess.  For old pods which don't have owner link\n    const guess = sym(`${pod.uri}profile/card#me`)\n    try {\n      // @ts-ignore  LiveStore always has fetcher\n      await store.fetcher.load(guess)\n    } catch (err) {\n      console.error('Ooops. Guessed wrong pod owner webid {$guess} : can\\'t load it.')\n      return null\n    }\n    if (store.holds(guess, ns.space('storage'), pod, guess.doc())) {\n      console.warn('Using guessed pod owner webid but it links back.')\n      return guess\n    }\n    return null\n  }\n  /* eslint-enable no-console */\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n"],"mappings":"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","ignoreList":[]}